
#Область ОбработчикиСобытийФормы

&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	ДатаЗагрузки =ТекущаяДата();
	СозданиеМРЦ = Истина;
КонецПроцедуры


#КонецОбласти


#Область ОбработчикиСобытийЭлементовФормы


#КонецОбласти


#Область ОбработчикиКомандФормы

&НаКлиенте
Процедура Загрузить(Команда)
	ОчиститьСообщения();
	
	ЗагрузитьФайлыНаСервере();
КонецПроцедуры

&НаСервере
Процедура ЗагрузитьФайлыНаСервере()
	
	ДеревоДокументов.ПолучитьЭлементы().Очистить();	
	Дерево = РеквизитФормыВЗначение("ДеревоДокументов", Тип("ДеревоЗначений"));	
	
	ПараметрыЗагрузки = Новый Структура;
	ПараметрыЗагрузки.Вставить("ДеревоДокументов", Дерево);
	ПараметрыЗагрузки.Вставить("ДатаЗагрузки", ДатаЗагрузки);
	ПараметрыЗагрузки.Вставить("СоздатьМРЦ", СозданиеМРЦ);
	
	Результат = Обработки.ТК_ЗагрузкаПриходовТедис.ЗагрузитьФайлы(ПараметрыЗагрузки);
	
	Если ТипЗнч(Результат) <> Тип("Структура") Тогда 
		Возврат;
	КонецЕсли;
	
	Если Результат.Свойство("ДеревоДокументов", Дерево) Тогда 
		ЗначениеВДанныеФормы(Дерево, ДеревоДокументов);
	КонецЕсли;
	
КонецПроцедуры

&НаКлиенте
Процедура СформироватьДокументы(Команда)
	
	Если ПроверитьЗаполнение() И ДеревоДокументов.ПолучитьЭлементы().Количество() > 0 Тогда 
		СформироватьДокументыНаСервере();	
	КонецЕсли;
	
КонецПроцедуры

&НаСервере
Процедура СформироватьДокументыНаСервере()
	
	Дерево = РеквизитФормыВЗначение("ДеревоДокументов", Тип("ДеревоЗначений"));		
	
	ДополнительныеПараметры = Новый Структура;
	//ДополнительныеПараметры.Вставить("СкладКомпании", СкладКомпании);
	ДополнительныеПараметры.Вставить("КонтрагентПоставщик", КонтрагентПоставщик);
	ДополнительныеПараметры.Вставить("ДоговорПоставщик", ДоговорПоставщик);
	
	Результат = Обработки.ТК_ЗагрузкаПриходовТедис.СформироватьДокументы(Дерево, ДополнительныеПараметры);
	
	Если ТипЗнч(Результат) <> Тип("Структура") Тогда 
		Возврат;
	КонецЕсли;
	УстановитьПривилегированныйРежим(Истина);
	Если Результат.Свойство("ДеревоДокументов", Дерево) Тогда 
		ЗначениеВДанныеФормы(Дерево, ДеревоДокументов);
	КонецЕсли;	
	УстановитьПривилегированныйРежим(Ложь);
	
КонецПроцедуры

&НаКлиенте
Процедура ОтменитьВсе(Команда)
	ОбойтиДеревоНаСервере();
КонецПроцедуры

&НаСервере
Процедура ОбойтиДеревоНаСервере()
	
	ДеревоЗнач = РеквизитФормыВЗначение("ДеревоДокументов");
	
	Для Каждого СтрДерева Из ДеревоЗнач.Строки Цикл
		СтрДерева.Выбор = Ложь;
	КонецЦикла;
	
	ЗначениеВДанныеФормы(ДеревоЗнач, ДеревоДокументов);
	
КонецПроцедуры

&НаКлиенте
Процедура ОтметитьВыделеные(Команда)
	Для Каждого СтрДерева Из Элементы.ДеревоДокументов.ВыделенныеСтроки Цикл
		 ЭлементДерева = Элементы.ДеревоДокументов.ДанныеСтроки(СтрДерева);
		 ЭлементДерева.Выбор = Истина;
	КонецЦикла;	
КонецПроцедуры

#КонецОбласти



#Область СлужебныеПроцедурыИФункции


#КонецОбласти


#Область ПрочиеПроцедурыИФункции


#КонецОбласти
 
