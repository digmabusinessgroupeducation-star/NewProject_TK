


Функция ПолучитьТорговуюПлощадку(UUID)Экспорт
	УстановитьПривилегированныйРежим(Истина);
	тпСсылка = Справочники.ТорговыеПлощадки.ПолучитьСсылку(Новый УникальныйИдентификатор(UUID)); 
	Возврат тпСсылка;
	
КонецФункции

Функция ПолучитьСклад(UUID)Экспорт
	
	СкладСсылка = Справочники.СкладыКомпании.ПолучитьСсылку(Новый УникальныйИдентификатор(UUID)); 
	Возврат СкладСсылка;
	
КонецФункции

Функция ПолучитьГуидСкладаТорговыйЗал(тпСсылка)Экспорт
	
	СкладСсылка = Справочники.СкладыКомпании.ОсновнойСкладТорговойПлощадки(тпСсылка);
	
	Если СкладСсылка.Пустая() Тогда
		Возврат Неопределено;
	КонецЕсли;
	
		
	Возврат Строка(СкладСсылка.УникальныйИдентификатор());
	
КонецФункции

Функция ПолучитьСкладТорговыйЗал(тпСсылка)Экспорт
	
	СкладСсылка = Справочники.СкладыКомпании.ОсновнойСкладТорговойПлощадки(тпСсылка);

	Возврат СкладСсылка
	
КонецФункции

Функция ПолучитьСкладТНП(тпСсылка)Экспорт
	
	СкладСсылка = Справочники.СкладыКомпании.ТНПСкладТорговойПлощадки(тпСсылка);

	Возврат СкладСсылка
	
КонецФункции

Функция ПолучитьКонтрагента(ГуидКонтрагента) Экспорт
	Если ГуидКонтрагента = "null" Тогда
		Возврат Справочники.Контрагенты.ПустаяСсылка();
	Иначе
		Возврат  Справочники.Контрагенты.ПолучитьСсылку(Новый УникальныйИдентификатор(ГуидКонтрагента)); 
	КонецЕсли;
	
КонецФункции

Функция ПолучитьМассивСкладовТорговойПлощадки(тпСсылка)Экспорт
	
	МассивОтвет = Справочники.СкладыКомпании.МассивСкладовТорговойПлощадкиТСД(тпСсылка);	
	Возврат МассивОтвет;
	
КонецФункции

Функция СкладИспользуетМРЦ(СкладСсылка)Экспорт
	
	 Возврат НЕ Справочники.СкладыКомпании.НеВестиУчетПоХарактеристикамНаСкладе(СкладСсылка);
	 
КонецФункции

Функция ПолучитьМассивТорговыхПлощадокПоРодителю(ТекТорговаяПлощадка) Экспорт 
	
	МассивОтвет = Новый Массив;
	УстановитьПривилегированныйРежим(Истина);
	
	
	Если Справочники.ПодразделенияКомпании.ЭтоАттика(ТекТорговаяПлощадка.ПодразделениеКомпании) Тогда
		
		РЦ = Справочники.ТорговыеПлощадки.ПолучитьСсылку(Новый УникальныйИдентификатор("b0855ae2-fd3e-11e3-8e10-0050568c0032"));//Распределительный центр - Харьков Аттика
		РЦ_Реквизиты = ОбщегоНазначения.ЗначенияРеквизитовОбъекта(РЦ,"Наименование,Global_ID");
		СтруктураТорговойПлощадки = Новый Структура("ТорговаяПлощадка, ТорговаяПлощадкаUUID", 
														Формат(РЦ_Реквизиты.Global_ID,"ЧЦ=6; ЧДЦ=0; ЧН=0; ЧГ=")+" "+РЦ_Реквизиты.Наименование, 
														"b0855ae2-fd3e-11e3-8e10-0050568c0032");	
		МассивОтвет.Добавить(СтруктураТорговойПлощадки);

	КонецЕсли;
	

	
	
	Запрос = Новый Запрос;
	Запрос.Текст = "ВЫБРАТЬ
	               |	ТорговыеПлощадки.Ссылка КАК ТорговаяПлощадкаСсылка,
	               |	ПРЕДСТАВЛЕНИЕССЫЛКИ(ТорговыеПлощадки.Ссылка) КАК ТорговаяПлощадкаПредставление,
	               |	ТорговыеПлощадки.Родитель КАК Родитель,
	               |	ТорговыеПлощадки.Global_ID КАК Global_ID
	               |ИЗ
	               |	Справочник.ТорговыеПлощадки КАК ТорговыеПлощадки
	               |		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.ТК_НастройкиТСД КАК ТК_НастройкиТСД
	               |		ПО ТорговыеПлощадки.Ссылка = ТК_НастройкиТСД.ТорговаяПлощадка
	               |			И (ТК_НастройкиТСД.Настройка = ЗНАЧЕНИЕ(ПланВидовХарактеристик.НастройкиТСД.ЗапретНаВыборТорговойПлощадки))
	               |ГДЕ
	               |	ТорговыеПлощадки.Ссылка В ИЕРАРХИИ
	               |			(ВЫБРАТЬ
	               |				ВЫБОР
	               |					КОГДА ТорговыеПлощадки.Родитель = ЗНАЧЕНИЕ(справочник.ТорговыеПлощадки.ПустаяСсылка)
	               |						ТОГДА ТорговыеПлощадки.Ссылка
	               |					КОГДА ТорговыеПлощадки.Родитель.Родитель = ЗНАЧЕНИЕ(справочник.ТорговыеПлощадки.ПустаяСсылка)
	               |						ТОГДА ТорговыеПлощадки.Родитель
	               |					ИНАЧЕ ТорговыеПлощадки.Родитель
	               |				КОНЕЦ КАК Родитель
	               |			ИЗ
	               |				Справочник.ТорговыеПлощадки КАК ТорговыеПлощадки
	               |			ГДЕ
	               |				ТорговыеПлощадки.Ссылка = &Ссылка)
	               |	И НЕ ТорговыеПлощадки.ПометкаУдаления
	               |	И ВЫБОР
	               |			КОГДА ЕСТЬNULL(ТК_НастройкиТСД.Значение, ЛОЖЬ) = ИСТИНА
	               |				ТОГДА ЛОЖЬ
	               |			ИНАЧЕ ИСТИНА
	               |		КОНЕЦ
	               |АВТОУПОРЯДОЧИВАНИЕ";
	
	Запрос.УстановитьПараметр("Ссылка", ТекТорговаяПлощадка);

	
	Выборка = Запрос.Выполнить().Выбрать();
	Пока Выборка.Следующий() Цикл 
		СтруктураТорговойПлощадки = Новый Структура("ТорговаяПлощадка, ТорговаяПлощадкаUUID", 
														Формат(Выборка.Global_ID,"ЧЦ=6; ЧДЦ=0; ЧН=0; ЧГ=")+" "+Выборка.ТорговаяПлощадкаПредставление, 
														Строка(Выборка.ТорговаяПлощадкаСсылка.УникальныйИдентификатор()));	
		МассивОтвет.Добавить(СтруктураТорговойПлощадки);
	КонецЦикла;
	
	Возврат МассивОтвет;
	
КонецФункции


Функция ПолучитьПрефиксВесовогоШК()Экспорт
	Возврат 21;	
КонецФункции

Функция МассивМасокШК()Экспорт
	
	
	Запрос = Новый Запрос;
	Запрос.Текст = 	"ВЫБРАТЬ
	|	МаскиШтрихКодов.Ссылка,
	|	МаскиШтрихКодов.Маска
	|ИЗ
	|	Справочник.ТК_МаскиШтрихКодовOS КАК МаскиШтрихКодов
	|ГДЕ
	|	МаскиШтрихКодов.ПометкаУдаления = ЛОЖЬ"   ;
	Рез = Запрос.Выполнить();
	Выборка = Рез.Выбрать();
	
	МассивМасок = Новый Массив;	
	Пока Выборка.Следующий() Цикл 
		
		Если Найти(Выборка.Маска,"BD")>0 Тогда
			Продолжить;
		КонецЕсли;
		СимволНачало = Найти(Выборка.Маска,":");
		Если СимволНачало = 0 Тогда
			Продолжить;
		КонецЕсли;
		СимволНачало = СимволНачало +1;
		
		ДлиннаСтроки = СтрДлина(Выборка.Маска);
		
		Если ДлиннаСтроки - (СимволНачало-1) = 16 Тогда
			ПрефНач = 1;
		Иначе
			ПрефНач = 2;
		КонецЕсли;
		

		Преф = Сред(Выборка.Маска,СимволНачало,ПрефНач);
		
		Попытка 
			ПрефЧисло = Число(Преф);
		Исключение
			Продолжить;
		КонецПопытки;
		
		чАртикул =0;
		чВес = 0;
		Для ч = СимволНачало+ПрефНач По ДлиннаСтроки Цикл 
			
			мч = Сред(Выборка.Маска,ч,1);
			Если мч = "A" Тогда
				чАртикул = чАртикул+1;
			ИначеЕсли мч = "Q" Тогда
				чВес = чВес+1;
			КонецЕсли;
			
			
		КонецЦикла;
		ДанныеМаскиШК = Новый Структура("Маска,Артикул,Вес,Преф",Выборка.Ссылка,чАртикул,чВес,Преф);
		Если МассивМасок.ВГраница()>ПрефЧисло Тогда
			МассивМасок[ПрефЧисло] =  ДанныеМаскиШК;
			Иначе
		МассивМасок.Вставить(ПрефЧисло,ДанныеМаскиШК);
		КонецЕсли;
		
		
	КонецЦикла;
	

	
	Возврат МассивМасок;
	
	
КонецФункции

Функция ПолучитьЗадачуПоГуиду(ГудЗадачи)Экспорт
	
	ЗадачаСсылка =  Задачи.ТК_ЗадачаТСД.ПолучитьСсылку(Новый УникальныйИдентификатор(ГудЗадачи)); 
	Возврат ЗадачаСсылка;
	
КонецФункции

Функция ПолучитьСотрудника(ГуидСотрудника)Экспорт
	
	СотрудникСсылка = Справочники.ФизическиеЛица.ПолучитьСсылку(Новый УникальныйИдентификатор(ГуидСотрудника));
	
	Возврат СотрудникСсылка;
		
КонецФункции


Функция ПолучитьСтатьюДДС(КодСтатьи)Экспорт
	
	СтатьяСсылка = Справочники.СтатьиДоходовИРасходов.НайтиПоКоду(КодСтатьи); 
	Возврат СтатьяСсылка;
	
КонецФункции

Функция ПолучитьТипыЦенСклада(СкладСсылка)Экспорт
	
	Структура = Новый Структура("БазовыйТипЦен,ТипЦенРеализации",Справочники.ТипыЦен.ПустаяСсылка(),Справочники.ТипыЦен.ПустаяСсылка());
	
	Запрос = Новый Запрос;
	Запрос.Текст =
	"ВЫБРАТЬ
	 |	СкладыКомпанииДоступныеЦены.ТипЦен КАК ТипЦен
	 |ИЗ
	 |	Справочник.СкладыКомпании.ДоступныеЦены КАК СкладыКомпанииДоступныеЦены
	 |ГДЕ
	 |	СкладыКомпанииДоступныеЦены.Ссылка = &СкладСсылка
	 |
	 |УПОРЯДОЧИТЬ ПО
	 |	СкладыКомпанииДоступныеЦены.НомерСтроки";
	Запрос.УстановитьПараметр("СкладСсылка",СкладСсылка);
	
	Рез = Запрос.Выполнить();
	Если Рез.Пустой() Тогда
		Возврат Структура;
	КонецЕсли;
	
	
	Выборка = Рез.Выбрать();
	///
	
	Если Выборка.Следующий() Тогда 
		Структура.Вставить("ТипЦенРеализации",Выборка.ТипЦен);
	КонецЕсли;
	
	Если Выборка.Следующий() Тогда 
		Структура.Вставить("БазовыйТипЦен",Выборка.ТипЦен);
	КонецЕсли;
	
	 Возврат Структура;
	
	
КонецФункции

Функция ПроизовдительБАТ()Экспорт
	Возврат Справочники.ТК_Производитель.ПроизводительБАТ();
КонецФункции

Функция ПроизовдительФМ()Экспорт
	Возврат Справочники.ТК_Производитель.ПроизводительФМ();
КонецФункции

