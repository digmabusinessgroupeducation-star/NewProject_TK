<ПравилаОбмена>
	<ВерсияФормата РежимСовместимости="РежимСовместимостиСБСП20">2.01</ВерсияФормата>
	<Ид>8e8ecbf2-7622-469f-b04e-bf3bab1f510a    </Ид>
	<Наименование>ТК_ssl --&gt; УПП Химзавод (2016.08.02  11:00)</Наименование>
	<ДатаВремяСоздания>2024-02-16T11:42:00</ДатаВремяСоздания>
	<Источник ВерсияПлатформы="8.0" ВерсияКонфигурации="1.0.1.25" СинонимКонфигурации="ТК">ТК</Источник>
	<Приемник ВерсияПлатформы="8.0" ВерсияКонфигурации="1.3.39.1" СинонимКонфигурации="Управление производственным предприятием для Украины, редакция 1.3">УправлениеПроизводственнымПредприятиемДляУкраины</Приемник>
	<ПередВыгрузкойДанных>
ОрганизацииГринстеп = Новый СписокЗначений;
ОрганизацииГринстеп.Добавить(Справочники.Организации.НайтиПоКоду("000000034")); //Биоресурс ООО
ОрганизацииГринстеп.Добавить(Справочники.Организации.НайтиПоКоду("GL000035"));	//Эковолокно ООО
ОрганизацииГринстеп.Добавить(Справочники.Организации.НайтиПоКоду("GL000017"));  //Техноподдержка ООО
ОрганизацииГринстеп.Добавить(Справочники.Организации.НайтиПоКоду("D116"));		//Харьковвторсырье ЧП

Параметры.Вставить("ОрганизацииГринстеп",ОрганизацииГринстеп);


Запрос = Новый Запрос;
Запрос.Текст = 
"ВЫБРАТЬ РАЗРЕШЕННЫЕ РАЗЛИЧНЫЕ
|	ДоговорыКонтрагентов.Контрагент КАК Контрагент
|ИЗ
|	Справочник.ДоговорыКонтрагентов КАК ДоговорыКонтрагентов
|ГДЕ
|	ДоговорыКонтрагентов.Организация В(&amp;Организация)
|	И НЕ ДоговорыКонтрагентов.ПометкаУдаления
|	И ДоговорыКонтрагентов.Контрагент &lt;&gt; ЗНАЧЕНИЕ(Справочник.Контрагенты.ПустаяСсылка)";

Запрос.УстановитьПараметр("Организация", ОрганизацииГринстеп);

КонтрагентыГринстеп = Запрос.Выполнить().Выгрузить();

Параметры.Вставить("КонтрагентыГринстеп",КонтрагентыГринстеп);
</ПередВыгрузкойДанных>
	<Параметры/>
	<Обработки/>
	<ПравилаКонвертацииОбъектов>
		<Группа>
			<Код>Справочники</Код>
			<Наименование>Справочники</Наименование>
			<Порядок>50</Порядок>
			<Правило>
				<Код>Валюты</Код>
				<Наименование>Справочник: Валюты</Наименование>
				<Порядок>50</Порядок>
				<НеЗамещать>true</НеЗамещать>
				<СинхронизироватьПоИдентификатору>true</СинхронизироватьПоИдентификатору>
				<ПродолжитьПоискПоПолямПоискаЕслиПоИдентификаторуНеНашли>true</ПродолжитьПоискПоПолямПоискаЕслиПоИдентификаторуНеНашли>
				<НеВыгружатьОбъектыСвойствПоСсылкам>true</НеВыгружатьОбъектыСвойствПоСсылкам>
				<НеСоздаватьЕслиНеНайден>true</НеСоздаватьЕслиНеНайден>
				<ИспользоватьБыстрыйПоискПриЗагрузке>true</ИспользоватьБыстрыйПоискПриЗагрузке>
				<ПриПереносеОбъектаПоСсылкеУстанавливатьТолькоGIUD>true</ПриПереносеОбъектаПоСсылкеУстанавливатьТолькоGIUD>
				<Источник>СправочникСсылка.Валюты</Источник>
				<Приемник>СправочникСсылка.Валюты</Приемник>
				<Свойства>
					<Свойство Поиск="true">
						<Код>1</Код>
						<Наименование>Код --&gt; Код</Наименование>
						<Порядок>50</Порядок>
						<Источник Имя="Код" Вид="Свойство" Тип="Строка"/>
						<Приемник Имя="Код" Вид="Свойство" Тип="Строка"/>
					</Свойство>
				</Свойства>
				<Значения/>
			</Правило>
			<Правило>
				<Код>Банки</Код>
				<Наименование>Справочник: Классификатор банков</Наименование>
				<Порядок>100</Порядок>
				<НеЗамещать>true</НеЗамещать>
				<СинхронизироватьПоИдентификатору>true</СинхронизироватьПоИдентификатору>
				<ПродолжитьПоискПоПолямПоискаЕслиПоИдентификаторуНеНашли>true</ПродолжитьПоискПоПолямПоискаЕслиПоИдентификаторуНеНашли>
				<Источник>СправочникСсылка.КлассификаторБанков</Источник>
				<Приемник>СправочникСсылка.Банки</Приемник>
				<Свойства>
					<Свойство Поиск="true">
						<Код>1</Код>
						<Наименование>Код --&gt; Код</Наименование>
						<Порядок>50</Порядок>
						<Источник Имя="Код" Вид="Свойство" Тип="Строка"/>
						<Приемник Имя="Код" Вид="Свойство" Тип="Строка"/>
					</Свойство>
					<Свойство>
						<Код>2</Код>
						<Наименование>КодПоЕДРПОУ --&gt; КодПоЕДРПОУ</Наименование>
						<Порядок>100</Порядок>
						<Источник Имя="КодПоЕДРПОУ" Вид="Реквизит" Тип="Строка"/>
						<Приемник Имя="КодПоЕДРПОУ" Вид="Реквизит" Тип="Строка"/>
					</Свойство>
					<Свойство>
						<Код>3</Код>
						<Наименование>Наименование --&gt; Наименование</Наименование>
						<Порядок>150</Порядок>
						<Источник Имя="Наименование" Вид="Свойство" Тип="Строка"/>
						<Приемник Имя="Наименование" Вид="Свойство" Тип="Строка"/>
					</Свойство>
					<Свойство>
						<Код>4</Код>
						<Наименование>Адрес --&gt; Адрес</Наименование>
						<Порядок>200</Порядок>
						<Источник Имя="Адрес" Вид="Реквизит" Тип="Строка"/>
						<Приемник Имя="Адрес" Вид="Реквизит" Тип="Строка"/>
					</Свойство>
					<Свойство>
						<Код>5</Код>
						<Наименование>Город --&gt; Город</Наименование>
						<Порядок>250</Порядок>
						<Источник Имя="Город" Вид="Реквизит" Тип="Строка"/>
						<Приемник Имя="Город" Вид="Реквизит" Тип="Строка"/>
					</Свойство>
					<Свойство>
						<Код>6</Код>
						<Наименование>КоррСчет --&gt; КоррСчет</Наименование>
						<Порядок>300</Порядок>
						<Источник Имя="КоррСчет" Вид="Реквизит" Тип="Строка"/>
						<Приемник Имя="КоррСчет" Вид="Реквизит" Тип="Строка"/>
					</Свойство>
					<Свойство>
						<Код>7</Код>
						<Наименование>Телефоны --&gt; Телефоны</Наименование>
						<Порядок>350</Порядок>
						<Источник Имя="Телефоны" Вид="Реквизит" Тип="Строка"/>
						<Приемник Имя="Телефоны" Вид="Реквизит" Тип="Строка"/>
					</Свойство>
					<Свойство>
						<Код>8</Код>
						<Наименование>ПометкаУдаления --&gt; ПометкаУдаления</Наименование>
						<Порядок>400</Порядок>
						<Источник Имя="ПометкаУдаления" Вид="Свойство" Тип="Булево"/>
						<Приемник Имя="ПометкаУдаления" Вид="Свойство" Тип="Булево"/>
					</Свойство>
					<Свойство>
						<Код>9</Код>
						<Наименование>Родитель --&gt; Родитель</Наименование>
						<Порядок>450</Порядок>
						<Источник Имя="Родитель" Вид="Свойство" Тип="СправочникСсылка.КлассификаторБанков"/>
						<Приемник Имя="Родитель" Вид="Свойство" Тип="СправочникСсылка.Банки"/>
					</Свойство>
					<Свойство Обязательное="true">
						<Код>10</Код>
						<Наименование>ЭтоГруппа --&gt; ЭтоГруппа</Наименование>
						<Порядок>500</Порядок>
						<Источник Имя="ЭтоГруппа" Вид="Свойство" Тип="Булево"/>
						<Приемник Имя="ЭтоГруппа" Вид="Свойство" Тип="Булево"/>
					</Свойство>
				</Свойства>
				<Значения/>
			</Правило>
			<Правило>
				<Код>Организации</Код>
				<Наименование>Справочник: Организации</Наименование>
				<Порядок>150</Порядок>
				<НеЗамещать>true</НеЗамещать>
				<СинхронизироватьПоИдентификатору>true</СинхронизироватьПоИдентификатору>
				<ПродолжитьПоискПоПолямПоискаЕслиПоИдентификаторуНеНашли>true</ПродолжитьПоискПоПолямПоискаЕслиПоИдентификаторуНеНашли>
				<НеСоздаватьЕслиНеНайден>true</НеСоздаватьЕслиНеНайден>
				<Источник>СправочникСсылка.Организации</Источник>
				<Приемник>СправочникСсылка.Организации</Приемник>
				<Свойства>
					<Свойство Поиск="true">
						<Код>1</Код>
						<Наименование>Код --&gt; Код</Наименование>
						<Порядок>50</Порядок>
						<Источник Имя="Код" Вид="Свойство" Тип="Строка"/>
						<Приемник Имя="Код" Вид="Свойство" Тип="Строка"/>
					</Свойство>
				</Свойства>
				<Значения/>
			</Правило>
			<Правило>
				<Код>Контрагенты</Код>
				<Наименование>Справочник: Контрагенты</Наименование>
				<Порядок>200</Порядок>
				<ПередВыгрузкой>Отказ = Параметры.КонтрагентыГринстеп.Найти(Источник, "Контрагент") = Неопределено;
</ПередВыгрузкой>
				<ПоследовательностьПолейПоиска>Если НомерВариантаПоиска = 1 И ЗначениеЗаполнено(СвойстваПоиска.Получить("КодПоЕДРПОУ")) тогда
	СтрокаИменСвойствПоиска = "КодПоЕДРПОУ";
ИначеЕсли НомерВариантаПоиска = 2 И ЗначениеЗаполнено(СвойстваПоиска.Получить("ИНН")) тогда
	СтрокаИменСвойствПоиска = "ИНН";
Иначе
	СтрокаИменСвойствПоиска="";
	ПрекратитьПоиск = Истина;
КонецЕсли</ПоследовательностьПолейПоиска>
				<СинхронизироватьПоИдентификатору>true</СинхронизироватьПоИдентификатору>
				<ПродолжитьПоискПоПолямПоискаЕслиПоИдентификаторуНеНашли>true</ПродолжитьПоискПоПолямПоискаЕслиПоИдентификаторуНеНашли>
				<Источник>СправочникСсылка.Контрагенты</Источник>
				<Приемник>СправочникСсылка.Контрагенты</Приемник>
				<Свойства>
					<Свойство Поиск="true">
						<Код>3</Код>
						<Наименование>КодПоЕДРПОУ --&gt; КодПоЕДРПОУ</Наименование>
						<Порядок>50</Порядок>
						<Источник Имя="КодПоЕДРПОУ" Вид="Реквизит" Тип="Строка"/>
						<Приемник Имя="КодПоЕДРПОУ" Вид="Реквизит" Тип="Строка"/>
					</Свойство>
					<Свойство Поиск="true">
						<Код>4</Код>
						<Наименование>ИННПлательщикаНДС --&gt; ИНН</Наименование>
						<Порядок>100</Порядок>
						<Источник Имя="ИННПлательщикаНДС" Вид="Реквизит" Тип="Строка"/>
						<Приемник Имя="ИНН" Вид="Реквизит" Тип="Строка"/>
					</Свойство>
					<Свойство>
						<Код>2</Код>
						<Наименование>Код --&gt; Код</Наименование>
						<Порядок>150</Порядок>
						<Источник Имя="Код" Вид="Свойство" Тип="Строка"/>
						<Приемник Имя="Код" Вид="Свойство" Тип="Строка"/>
						<ПриводитьКДлине>9</ПриводитьКДлине>
					</Свойство>
					<Свойство>
						<Код>6</Код>
						<Наименование>Наименование --&gt; Наименование</Наименование>
						<Порядок>200</Порядок>
						<Источник Имя="Наименование" Вид="Свойство" Тип="Строка"/>
						<Приемник Имя="Наименование" Вид="Свойство" Тип="Строка"/>
					</Свойство>
					<Свойство>
						<Код>7</Код>
						<Наименование>ПометкаУдаления --&gt; ПометкаУдаления</Наименование>
						<Порядок>250</Порядок>
						<Источник Имя="ПометкаУдаления" Вид="Свойство" Тип="Булево"/>
						<Приемник Имя="ПометкаУдаления" Вид="Свойство" Тип="Булево"/>
					</Свойство>
					<Свойство>
						<Код>5</Код>
						<Наименование>НаименованиеПолное --&gt; НаименованиеПолное</Наименование>
						<Порядок>300</Порядок>
						<Источник Имя="НаименованиеПолное" Вид="Реквизит" Тип="Строка"/>
						<Приемник Имя="НаименованиеПолное" Вид="Реквизит" Тип="Строка"/>
					</Свойство>
					<Свойство>
						<Код>1</Код>
						<Наименование>НомерСвидетельстваПлательщикаНДС --&gt; НомерСвидетельства</Наименование>
						<Порядок>350</Порядок>
						<Источник Имя="НомерСвидетельстваПлательщикаНДС" Вид="Реквизит" Тип="Строка"/>
						<Приемник Имя="НомерСвидетельства" Вид="Реквизит" Тип="Строка"/>
					</Свойство>
					<Свойство>
						<Код>8</Код>
						<Наименование>ЮрФизЛицо --&gt; ЮрФизЛицо</Наименование>
						<Порядок>400</Порядок>
						<Источник Имя="ЮрФизЛицо" Вид="Реквизит" Тип="ПеречислениеСсылка.ЮрФизЛицо"/>
						<Приемник Имя="ЮрФизЛицо" Вид="Реквизит" Тип="ПеречислениеСсылка.ЮрФизЛицо"/>
						<КодПравилаКонвертации>ЮрФизЛицо                                         </КодПравилаКонвертации>
					</Свойство>
					<Свойство>
						<Код>9</Код>
						<Наименование>--&gt; Поставщик</Наименование>
						<Порядок>450</Порядок>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="Поставщик" Вид="Реквизит" Тип="Булево"/>
						<ПередВыгрузкой>Значение = Истина;</ПередВыгрузкой>
					</Свойство>
					<Свойство>
						<Код>10</Код>
						<Наименование>--&gt; Покупатель</Наименование>
						<Порядок>500</Порядок>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="Покупатель" Вид="Реквизит" Тип="Булево"/>
						<ПередВыгрузкой>Значение = Истина;</ПередВыгрузкой>
					</Свойство>
				</Свойства>
				<Значения/>
			</Правило>
			<Правило>
				<Код>БанковскиеСчета</Код>
				<Наименование>Справочник: Банковские счета</Наименование>
				<Порядок>250</Порядок>
				<ПередВыгрузкой>Отказ = Параметры.КонтрагентыГринстеп.Найти(Источник.Владелец, "Контрагент") = Неопределено;
</ПередВыгрузкой>
				<ПоследовательностьПолейПоиска>Если НомерВариантаПоиска = 1 тогда
	ПриемникНомерСчета = СокрЛП(СвойстваПоиска.Получить("НомерСчета"));
	ПриемникНомерСчета = СтрЗаменить(ПриемникНомерСчета, " ", "");
	
	Если СтрДлина(ПриемникНомерСчета) &gt; 14 тогда
		ПриемникНомерСчета = Прав(ПриемникНомерСчета, 16);
		Если СтроковыеФункцииКлиентСервер.ТолькоЦифрыВСтроке(ПриемникНомерСчета) Тогда
			ПриемникНомерСчета = Формат(Число(ПриемникНомерСчета), "ЧГ=0"); //избавиться от лидирующих нулей
		КонецЕсли;	
	КонецЕсли;	
	
	ПриемникНомерСчета	= СтрЗаменить(ПриемникНомерСчета, """", """""");
	ПриемникБанк		= СокрЛП(СвойстваПоиска.Получить("Банк"));
	ПриемникВалюта		= СокрЛП(СвойстваПоиска.Получить("ВалютаДенежныхСредств"));
	ПриемникВладелец	= СокрЛП(СвойстваПоиска.Получить("Владелец"));
	
	Запрос = Новый Запрос; 
	Запрос.Текст =  "ВЫБРАТЬ РАЗРЕШЕННЫЕ
	|	БанковскиеСчета.Ссылка
	|ИЗ
	|	Справочник.БанковскиеСчета КАК БанковскиеСчета
	|ГДЕ
	|	БанковскиеСчета.Владелец = &amp;Владелец
	|	И БанковскиеСчета.Банк = &amp;Банк
	|	И БанковскиеСчета.НомерСчета подобно ""%" + ПриемникНомерСчета + "%""" +
	"	И БанковскиеСчета.ВалютаДенежныхСредств = &amp;Валюта";
	
	Запрос.УстановитьПараметр("Банк",ПриемникБанк);
	Запрос.УстановитьПараметр("Валюта",ПриемникВалюта);
	Запрос.УстановитьПараметр("Владелец",ПриемникВладелец);
	
	Попытка
		Выборка = Запрос.Выполнить().Выбрать();
	Исключение
		Сообщить("Возникла ошибка при выполнении запроса к базе приемнику """ +  """ по поиску Банковского счета! (" + ОписаниеОшибки() + ")", СтатусСообщения.Важное);
	КонецПопытки;
	
	Если Выборка.Следующий() Тогда
		СсылкаНаОбъект = Выборка.Ссылка;  	
	КонецЕсли;
	
Иначе
	СтрокаИменСвойствПоиска = "";
	ПрекратитьПоиск = Истина;
КонецЕсли;</ПоследовательностьПолейПоиска>
				<СинхронизироватьПоИдентификатору>true</СинхронизироватьПоИдентификатору>
				<ПродолжитьПоискПоПолямПоискаЕслиПоИдентификаторуНеНашли>true</ПродолжитьПоискПоПолямПоискаЕслиПоИдентификаторуНеНашли>
				<ГенерироватьНовыйНомерИлиКодЕслиНеУказан>true</ГенерироватьНовыйНомерИлиКодЕслиНеУказан>
				<Источник>СправочникСсылка.БанковскиеСчетаКонтрагентов</Источник>
				<Приемник>СправочникСсылка.БанковскиеСчета</Приемник>
				<Свойства>
					<Свойство Поиск="true">
						<Код>7</Код>
						<Наименование>НомерСчета --&gt; НомерСчета</Наименование>
						<Порядок>50</Порядок>
						<Источник Имя="НомерСчета" Вид="Реквизит" Тип="Строка"/>
						<Приемник Имя="НомерСчета" Вид="Реквизит" Тип="Строка"/>
						<ПередВыгрузкой>Значение = СтрЗаменить(Источник.НомерСчета," ","");
</ПередВыгрузкой>
					</Свойство>
					<Свойство Поиск="true">
						<Код>1</Код>
						<Наименование>Банк --&gt; Банк</Наименование>
						<Порядок>100</Порядок>
						<Источник Имя="Банк" Вид="Реквизит" Тип="СправочникСсылка.КлассификаторБанков"/>
						<Приемник Имя="Банк" Вид="Реквизит" Тип="СправочникСсылка.Банки"/>
						<КодПравилаКонвертации>Банки                                             </КодПравилаКонвертации>
					</Свойство>
					<Свойство Поиск="true">
						<Код>2</Код>
						<Наименование>ВалютаДенежныхСредств --&gt; ВалютаДенежныхСредств</Наименование>
						<Порядок>150</Порядок>
						<Источник Имя="ВалютаДенежныхСредств" Вид="Реквизит" Тип="СправочникСсылка.Валюты"/>
						<Приемник Имя="ВалютаДенежныхСредств" Вид="Реквизит" Тип="СправочникСсылка.Валюты"/>
						<КодПравилаКонвертации>Валюты                                            </КодПравилаКонвертации>
					</Свойство>
					<Свойство>
						<Код>4</Код>
						<Наименование>ДатаЗакрытия --&gt; ДатаЗакрытия</Наименование>
						<Порядок>200</Порядок>
						<Источник Имя="ДатаЗакрытия" Вид="Реквизит" Тип="Дата"/>
						<Приемник Имя="ДатаЗакрытия" Вид="Реквизит" Тип="Дата"/>
					</Свойство>
					<Свойство>
						<Код>5</Код>
						<Наименование>ДатаОткрытия --&gt; ДатаОткрытия</Наименование>
						<Порядок>250</Порядок>
						<Источник Имя="ДатаОткрытия" Вид="Реквизит" Тип="Дата"/>
						<Приемник Имя="ДатаОткрытия" Вид="Реквизит" Тип="Дата"/>
					</Свойство>
					<Свойство>
						<Код>6</Код>
						<Наименование>НомерИДатаРазрешения --&gt; НомерИДатаРазрешения</Наименование>
						<Порядок>300</Порядок>
						<Источник Имя="НомерИДатаРазрешения" Вид="Реквизит" Тип="Строка"/>
						<Приемник Имя="НомерИДатаРазрешения" Вид="Реквизит" Тип="Строка"/>
					</Свойство>
					<Свойство Поиск="true">
						<Код>8</Код>
						<Наименование>Владелец --&gt; Владелец</Наименование>
						<Порядок>350</Порядок>
						<Источник Имя="Владелец" Вид="Свойство"/>
						<Приемник Имя="Владелец" Вид="Свойство"/>
						<КодПравилаКонвертации>Контрагенты                                       </КодПравилаКонвертации>
					</Свойство>
					<Свойство>
						<Код>9</Код>
						<Наименование>Наименование --&gt; Наименование</Наименование>
						<Порядок>400</Порядок>
						<Источник Имя="Наименование" Вид="Свойство" Тип="Строка"/>
						<Приемник Имя="Наименование" Вид="Свойство" Тип="Строка"/>
					</Свойство>
					<Свойство>
						<Код>10</Код>
						<Наименование>ПометкаУдаления --&gt; ПометкаУдаления</Наименование>
						<Порядок>450</Порядок>
						<Источник Имя="ПометкаУдаления" Вид="Свойство" Тип="Булево"/>
						<Приемник Имя="ПометкаУдаления" Вид="Свойство" Тип="Булево"/>
					</Свойство>
					<Свойство>
						<Код>3</Код>
						<Наименование>ВидСчета --&gt; ВидСчета</Наименование>
						<Порядок>500</Порядок>
						<Источник Имя="ВидСчета" Вид="Реквизит" Тип="Строка"/>
						<Приемник Имя="ВидСчета" Вид="Реквизит" Тип="Строка"/>
					</Свойство>
				</Свойства>
				<Значения/>
			</Правило>
			<Правило>
				<Код>ДоговорыКонтрагентов</Код>
				<Наименование>: </Наименование>
				<Порядок>300</Порядок>
				<ПередВыгрузкой>Отказ = Параметры.ОрганизацииГринстеп.НайтиПоЗначению(Источник.ОрганизациЯ) = Неопределено;
</ПередВыгрузкой>
				<ПослеВыгрузкиВФайл>Запрос=новый Запрос;
Запрос.Текст="ВЫБРАТЬ
|	ДоговорыКонтрагентовПрисоединенныеФайлы.Ссылка КАК Ссылка,
|	ДоговорыКонтрагентовПрисоединенныеФайлы.ВладелецФайла.Наименование КАК Наименование,
|	ДоговорыКонтрагентовПрисоединенныеФайлы.ПометкаУдаления КАК ПометкаУдаления,
|	ДоговорыКонтрагентовПрисоединенныеФайлы.Наименование + ""."" + ДоговорыКонтрагентовПрисоединенныеФайлы.Расширение КАК ИмяФайла,
|	ДоговорыКонтрагентовПрисоединенныеФайлы.ВладелецФайла КАК Объект,
|	ДвоичныеДанныеФайлов.ДвоичныеДанныеФайла КАК Хранилище,
|	ДоговорыКонтрагентовПрисоединенныеФайлы.ТекстХранилище КАК ТекстХранилище
|ИЗ
|	Справочник.ДоговорыКонтрагентовПрисоединенныеФайлы КАК ДоговорыКонтрагентовПрисоединенныеФайлы
|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.ДвоичныеДанныеФайлов КАК ДвоичныеДанныеФайлов
|		ПО ДоговорыКонтрагентовПрисоединенныеФайлы.Ссылка = ДвоичныеДанныеФайлов.Файл
|ГДЕ
|	ДоговорыКонтрагентовПрисоединенныеФайлы.ВладелецФайла = &amp;ВладелецФайла";

Запрос.УстановитьПараметр("ВладелецФайла",Источник);

Результат = Запрос.Выполнить().Выбрать();


Пока Результат.Следующий() Цикл
	СтруктураСтроки = Новый Структура("Ссылка, Наименование, ПометкаУдаления, ИмяФайла, Объект, Хранилище, ТекстХранилище");
	ЗаполнитьЗначенияСвойств(СтруктураСтроки, Результат);
	ВыгрузитьПоПравилу(СтруктураСтроки, , , , "ХранилищеДополнительнойИнформации");	
КонецЦикла;
</ПослеВыгрузкиВФайл>
				<ПослеЗагрузки>Объект.ВедениеВзаиморасчетов		= Перечисления.ВедениеВзаиморасчетовПоДоговорам.ПоДоговоруВЦелом;
Объект.ВедениеВзаиморасчетовРегл	= Перечисления.ВедениеВзаиморасчетовПоДоговорам.ПоДоговоруВЦелом;
Объект.СхемаНалоговогоУчета			= Справочники.СхемыНалоговогоУчетаПоДоговорамКонтрагентов.ПоПервомуСобытию;
Объект.СхемаНалоговогоУчетаПоТаре	= Справочники.СхемыНалоговогоУчетаПоДоговорамКонтрагентов.ПоПервомуСобытию;
Если Объект.ЭтоНовый() Тогда
	Объект.Комментарий = "Загружен из ТК "+ТекущаяДата();
КонецЕсли;
</ПослеЗагрузки>
				<СинхронизироватьПоИдентификатору>true</СинхронизироватьПоИдентификатору>
				<Источник>СправочникСсылка.ДоговорыКонтрагентов</Источник>
				<Приемник>СправочникСсылка.ДоговорыКонтрагентов</Приемник>
				<Свойства>
					<Свойство>
						<Код>5</Код>
						<Наименование>Код --&gt; Код</Наименование>
						<Порядок>50</Порядок>
						<Источник Имя="Код" Вид="Свойство" Тип="Строка"/>
						<Приемник Имя="Код" Вид="Свойство" Тип="Строка"/>
					</Свойство>
					<Свойство>
						<Код>2</Код>
						<Наименование>Наименование --&gt; Наименование</Наименование>
						<Порядок>100</Порядок>
						<Источник Имя="Наименование" Вид="Свойство" Тип="Строка"/>
						<Приемник Имя="Наименование" Вид="Свойство" Тип="Строка"/>
					</Свойство>
					<Свойство>
						<Код>4</Код>
						<Наименование>ПометкаУдаления --&gt; ПометкаУдаления</Наименование>
						<Порядок>150</Порядок>
						<Источник Имя="ПометкаУдаления" Вид="Свойство" Тип="Булево"/>
						<Приемник Имя="ПометкаУдаления" Вид="Свойство" Тип="Булево"/>
					</Свойство>
					<Свойство>
						<Код>3</Код>
						<Наименование>НаименованиеДляПечати --&gt; НаименованиеДляПечати</Наименование>
						<Порядок>200</Порядок>
						<Источник Имя="НаименованиеДляПечати" Вид="Реквизит" Тип="Строка"/>
						<Приемник Имя="НаименованиеДляПечати" Вид="Реквизит" Тип="Строка"/>
					</Свойство>
					<Свойство>
						<Код>6</Код>
						<Наименование>Номер --&gt; Номер</Наименование>
						<Порядок>250</Порядок>
						<Источник Имя="Номер" Вид="Реквизит" Тип="Строка"/>
						<Приемник Имя="Номер" Вид="Реквизит" Тип="Строка"/>
					</Свойство>
					<Свойство>
						<Код>8</Код>
						<Наименование>Организация --&gt; Организация</Наименование>
						<Порядок>350</Порядок>
						<Источник Имя="Организация" Вид="Реквизит" Тип="СправочникСсылка.Организации"/>
						<Приемник Имя="Организация" Вид="Реквизит" Тип="СправочникСсылка.Организации"/>
						<КодПравилаКонвертации>Организации                                       </КодПравилаКонвертации>
					</Свойство>
					<Свойство>
						<Код>9</Код>
						<Наименование>ДатаНачалаДействия --&gt; Дата</Наименование>
						<Порядок>400</Порядок>
						<Источник Имя="ДатаНачалаДействия" Вид="Реквизит" Тип="Дата"/>
						<Приемник Имя="Дата" Вид="Реквизит" Тип="Дата"/>
					</Свойство>
					<Свойство>
						<Код>10</Код>
						<Наименование>ДатаОкончанияДействия --&gt; СрокДействия</Наименование>
						<Порядок>450</Порядок>
						<Источник Имя="ДатаОкончанияДействия" Вид="Реквизит" Тип="Дата"/>
						<Приемник Имя="СрокДействия" Вид="Реквизит" Тип="Дата"/>
					</Свойство>
					<Свойство>
						<Код>1</Код>
						<Наименование>ВидДоговора --&gt; ВидДоговора</Наименование>
						<Порядок>500</Порядок>
						<Источник Имя="ВидДоговора" Вид="Реквизит" Тип="СправочникСсылка.ВидыДоговоров"/>
						<Приемник Имя="ВидДоговора" Вид="Реквизит" Тип="ПеречислениеСсылка.ВидыДоговоровКонтрагентов"/>
						<КодПравилаКонвертации>ВидыДоговоровКонтрагентов                         </КодПравилаКонвертации>
						<ПередВыгрузкой>Значение = Источник.ВидДоговора.ВидДоговора;</ПередВыгрузкой>
					</Свойство>
					<Свойство>
						<Код>11</Код>
						<Наименование>Контрагент --&gt; Владелец</Наименование>
						<Порядок>550</Порядок>
						<Источник Имя="Контрагент" Вид="Реквизит" Тип="СправочникСсылка.Контрагенты"/>
						<Приемник Имя="Владелец" Вид="Свойство" Тип="СправочникСсылка.Контрагенты"/>
						<КодПравилаКонвертации>Контрагенты                                       </КодПравилаКонвертации>
					</Свойство>
					<Свойство>
						<Код>12</Код>
						<Наименование>ВалютаВзаиморасчетов --&gt; ВалютаВзаиморасчетов</Наименование>
						<Порядок>600</Порядок>
						<Источник Имя="ВалютаВзаиморасчетов" Вид="Реквизит" Тип="СправочникСсылка.Валюты"/>
						<Приемник Имя="ВалютаВзаиморасчетов" Вид="Реквизит" Тип="СправочникСсылка.Валюты"/>
						<КодПравилаКонвертации>Валюты                                            </КодПравилаКонвертации>
					</Свойство>
				</Свойства>
				<Значения/>
			</Правило>
			<Правило>
				<Код>ХранилищеДополнительнойИнформации</Код>
				<Наименование>Справочник: Присоединенные файлы (Договора)</Наименование>
				<Порядок>350</Порядок>
				<ПриЗагрузке>Объект.ВидДанных = Перечисления.ВидыДополнительнойИнформацииОбъектов.Файл; </ПриЗагрузке>
				<НеЗапоминатьВыгруженные>true</НеЗапоминатьВыгруженные>
				<СинхронизироватьПоИдентификатору>true</СинхронизироватьПоИдентификатору>
				<НеВыгружатьОбъектыСвойствПоСсылкам>true</НеВыгружатьОбъектыСвойствПоСсылкам>
				<ГенерироватьНовыйНомерИлиКодЕслиНеУказан>true</ГенерироватьНовыйНомерИлиКодЕслиНеУказан>
				<Источник>СправочникСсылка.ДоговорыКонтрагентовПрисоединенныеФайлы</Источник>
				<Приемник>СправочникСсылка.ХранилищеДополнительнойИнформации</Приемник>
				<Свойства>
					<Свойство>
						<Код>1</Код>
						<Наименование>--&gt; Наименование</Наименование>
						<Порядок>50</Порядок>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="Наименование" Вид="Свойство" Тип="Строка"/>
					</Свойство>
					<Свойство>
						<Код>4</Код>
						<Наименование>--&gt; ПометкаУдаления</Наименование>
						<Порядок>100</Порядок>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="ПометкаУдаления" Вид="Свойство" Тип="Булево"/>
					</Свойство>
					<Свойство>
						<Код>3</Код>
						<Наименование>--&gt; ИмяФайла</Наименование>
						<Порядок>150</Порядок>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="ИмяФайла" Вид="Реквизит" Тип="Строка"/>
					</Свойство>
					<Свойство>
						<Код>8</Код>
						<Наименование>--&gt; Объект</Наименование>
						<Порядок>200</Порядок>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="Объект" Вид="Реквизит"/>
					</Свойство>
					<Свойство>
						<Код>7</Код>
						<Наименование>--&gt; Хранилище</Наименование>
						<Порядок>250</Порядок>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="Хранилище" Вид="Реквизит" Тип="ХранилищеЗначения"/>
					</Свойство>
				</Свойства>
				<Значения/>
			</Правило>
		</Группа>
		<Группа>
			<Код>Перечисления</Код>
			<Наименование>Перечисления</Наименование>
			<Порядок>100</Порядок>
			<Правило>
				<Код>ВидыДоговоровКонтрагентов</Код>
				<Наименование>Справочник: Виды договоров</Наименование>
				<Порядок>50</Порядок>
				<Источник>ПеречислениеСсылка.ВидыДоговоров</Источник>
				<Приемник>ПеречислениеСсылка.ВидыДоговоровКонтрагентов</Приемник>
				<Свойства/>
				<Значения>
					<Значение>
						<Код>2</Код>
						<Наименование>Бартерный --&gt; Бартерный</Наименование>
						<Порядок>50</Порядок>
						<Источник>Бартерный</Источник>
						<Приемник>Бартерный</Приемник>
					</Значение>
					<Значение>
						<Код>3</Код>
						<Наименование>Бонус --&gt; СПокупателем</Наименование>
						<Порядок>100</Порядок>
						<Источник>Бонус</Источник>
						<Приемник>Прочее</Приемник>
					</Значение>
					<Значение>
						<Код>15</Код>
						<Наименование>Покупка --&gt; СПоставщиком</Наименование>
						<Порядок>150</Порядок>
						<Источник>Покупка</Источник>
						<Приемник>СПоставщиком</Приемник>
					</Значение>
					<Значение>
						<Код>24</Код>
						<Наименование>Продажа --&gt; СПокупателем</Наименование>
						<Порядок>200</Порядок>
						<Источник>Продажа</Источник>
						<Приемник>СПокупателем</Приемник>
					</Значение>
					<Значение>
						<Код>5</Код>
						<Наименование>Комиссия --&gt; СКомиссионером</Наименование>
						<Порядок>250</Порядок>
						<Источник>Комиссия</Источник>
						<Приемник>СКомиссионером</Приемник>
					</Значение>
					<Значение>
						<Код>4</Код>
						<Наименование>СКомитентом --&gt; СКомитентом</Наименование>
						<Порядок>300</Порядок>
						<Источник>СКомитентом</Источник>
						<Приемник>СКомитентом</Приемник>
					</Значение>
					<Значение>
						<Код>32</Код>
						<Наименование>УпрощеннаяКомиссия --&gt; Прочее</Наименование>
						<Порядок>350</Порядок>
						<Источник>УпрощеннаяКомиссия</Источник>
						<Приемник>Прочее</Приемник>
					</Значение>
					<Значение>
						<Код>27</Код>
						<Наименование>Прочее --&gt; Прочее</Наименование>
						<Порядок>400</Порядок>
						<Источник>Прочее</Источник>
						<Приемник>Прочее</Приемник>
					</Значение>
					<Значение>
						<Код>1</Код>
						<Наименование>Аренда --&gt; СПокупателем</Наименование>
						<Порядок>450</Порядок>
						<Приемник>СПокупателем</Приемник>
					</Значение>
					<Значение>
						<Код>6</Код>
						<Наименование>БухгалтерскиеУслуги --&gt; СПокупателем</Наименование>
						<Порядок>500</Порядок>
						<Приемник>СПокупателем</Приемник>
					</Значение>
					<Значение>
						<Код>7</Код>
						<Наименование>ВозвратнаяТара --&gt; Прочее</Наименование>
						<Порядок>550</Порядок>
						<Приемник>Прочее</Приемник>
					</Значение>
					<Значение>
						<Код>8</Код>
						<Наименование>ВыполнениеНИОКР --&gt; СПокупателем</Наименование>
						<Порядок>600</Порядок>
						<Приемник>СПокупателем</Приемник>
					</Значение>
					<Значение>
						<Код>9</Код>
						<Наименование>Госорганы --&gt; СПокупателем</Наименование>
						<Порядок>650</Порядок>
						<Приемник>СПокупателем</Приемник>
					</Значение>
					<Значение>
						<Код>10</Код>
						<Наименование>ЗаймКредитГарантии --&gt; СПокупателем</Наименование>
						<Порядок>700</Порядок>
						<Приемник>СПокупателем</Приемник>
					</Значение>
					<Значение>
						<Код>11</Код>
						<Наименование>КомиссияПоставка --&gt; СКомитентом</Наименование>
						<Порядок>750</Порядок>
						<Приемник>СКомитентом</Приемник>
					</Значение>
					<Значение>
						<Код>12</Код>
						<Наименование>КомиссияПродажа --&gt; СКомиссионером</Наименование>
						<Порядок>800</Порядок>
						<Приемник>СКомиссионером</Приемник>
					</Значение>
					<Значение>
						<Код>13</Код>
						<Наименование>Консалтинг --&gt; СПокупателем</Наименование>
						<Порядок>850</Порядок>
						<Приемник>СПокупателем</Приемник>
					</Значение>
					<Значение>
						<Код>14</Код>
						<Наименование>Маркетинг --&gt; СПокупателем</Наименование>
						<Порядок>900</Порядок>
						<Приемник>СПокупателем</Приемник>
					</Значение>
					<Значение>
						<Код>16</Код>
						<Наименование>Охрана --&gt; СПоставщиком</Наименование>
						<Порядок>950</Порядок>
						<Приемник>СПоставщиком</Приемник>
					</Значение>
					<Значение>
						<Код>17</Код>
						<Наименование>Перевозка --&gt; СПоставщиком</Наименование>
						<Порядок>1000</Порядок>
						<Приемник>СПоставщиком</Приемник>
					</Значение>
					<Значение>
						<Код>18</Код>
						<Наименование>ПеремещениеДС --&gt; Прочее</Наименование>
						<Порядок>1050</Порядок>
						<Приемник>Прочее</Приемник>
					</Значение>
					<Значение>
						<Код>19</Код>
						<Наименование>ПодборПерсонала --&gt; СПоставщиком</Наименование>
						<Порядок>1100</Порядок>
						<Приемник>СПоставщиком</Приемник>
					</Значение>
					<Значение>
						<Код>20</Код>
						<Наименование>Подписка --&gt; СПоставщиком</Наименование>
						<Порядок>1150</Порядок>
						<Приемник>СПоставщиком</Приемник>
					</Значение>
					<Значение>
						<Код>21</Код>
						<Наименование>Подряд --&gt; СПоставщиком</Наименование>
						<Порядок>1200</Порядок>
						<Приемник>СПоставщиком</Приемник>
					</Значение>
					<Значение>
						<Код>22</Код>
						<Наименование>Поставка --&gt; СПоставщиком</Наименование>
						<Порядок>1250</Порядок>
						<Приемник>СПоставщиком</Приемник>
					</Значение>
					<Значение>
						<Код>23</Код>
						<Наименование>ПоставкаПереводДолга --&gt; Прочее</Наименование>
						<Порядок>1300</Порядок>
						<Приемник>Прочее</Приемник>
					</Значение>
					<Значение>
						<Код>25</Код>
						<Наименование>ПродажаМобильныхПополнений --&gt; СПокупателем</Наименование>
						<Порядок>1350</Порядок>
						<Приемник>СПокупателем</Приемник>
					</Значение>
					<Значение>
						<Код>26</Код>
						<Наименование>ПродажаПоКартам --&gt; СПокупателем</Наименование>
						<Порядок>1400</Порядок>
						<Приемник>СПокупателем</Приемник>
					</Значение>
					<Значение>
						<Код>28</Код>
						<Наименование>Ссуда --&gt; Прочее</Наименование>
						<Порядок>1450</Порядок>
						<Приемник>Прочее</Приемник>
					</Значение>
					<Значение>
						<Код>29</Код>
						<Наименование>Страхование --&gt; СПоставщиком</Наименование>
						<Порядок>1500</Порядок>
						<Приемник>СПоставщиком</Приемник>
					</Значение>
					<Значение>
						<Код>30</Код>
						<Наименование>Субаренда --&gt; СПокупателем</Наименование>
						<Порядок>1550</Порядок>
						<Приемник>СПокупателем</Приемник>
					</Значение>
					<Значение>
						<Код>31</Код>
						<Наименование>ТранспортноеЭкспедирование --&gt; СПоставщиком</Наименование>
						<Порядок>1600</Порядок>
						<Приемник>СПоставщиком</Приемник>
					</Значение>
					<Значение>
						<Код>33</Код>
						<Наименование>Хранение --&gt; СПоставщиком</Наименование>
						<Порядок>1650</Порядок>
						<Приемник>СПоставщиком</Приемник>
					</Значение>
					<Значение>
						<Код>34</Код>
						<Наименование>ЮридическиеУслуги --&gt; СПоставщиком</Наименование>
						<Порядок>1700</Порядок>
						<Приемник>СПоставщиком</Приемник>
					</Значение>
				</Значения>
			</Правило>
			<Правило>
				<Код>ЮрФизЛицо</Код>
				<Наименование>Перечисление: Юр/Физлицо</Наименование>
				<Порядок>100</Порядок>
				<Источник>ПеречислениеСсылка.ЮрФизЛицо</Источник>
				<Приемник>ПеречислениеСсылка.ЮрФизЛицо</Приемник>
				<Свойства/>
				<Значения>
					<Значение>
						<Код>1</Код>
						<Наименование>ИндивидуальныйПредприниматель --&gt; ФизЛицо</Наименование>
						<Порядок>50</Порядок>
						<Источник>ИндивидуальныйПредприниматель</Источник>
						<Приемник>ФизЛицо</Приемник>
					</Значение>
					<Значение>
						<Код>2</Код>
						<Наименование>ФизЛицо --&gt; ФизЛицо</Наименование>
						<Порядок>100</Порядок>
						<Источник>ФизЛицо</Источник>
						<Приемник>ФизЛицо</Приемник>
					</Значение>
					<Значение>
						<Код>3</Код>
						<Наименование>ЮрЛицо --&gt; ЮрЛицо</Наименование>
						<Порядок>150</Порядок>
						<Источник>ЮрЛицо</Источник>
						<Приемник>ЮрЛицо</Приемник>
					</Значение>
					<Значение>
						<Код>4</Код>
						<Наименование>ЮрЛицоНеРезидент --&gt; ЮрЛицо</Наименование>
						<Порядок>200</Порядок>
						<Источник>ЮрЛицоНеРезидент</Источник>
						<Приемник>ЮрЛицо</Приемник>
					</Значение>
				</Значения>
			</Правило>
		</Группа>
	</ПравилаКонвертацииОбъектов>
	<ПравилаВыгрузкиДанных>
		<Группа Отключить="false">
			<Код>Справочники</Код>
			<Наименование>Справочники</Наименование>
			<Порядок>50</Порядок>
			<Правило Отключить="false">
				<Код>Контрагенты</Код>
				<Наименование>Контрагенты</Наименование>
				<Порядок>50</Порядок>
				<КодПравилаКонвертации>Контрагенты                                       </КодПравилаКонвертации>
				<СпособОтбораДанных>СтандартнаяВыборка</СпособОтбораДанных>
				<ОбъектВыборки>СправочникСсылка.Контрагенты</ОбъектВыборки>
				<ПередОбработкойПравила>ТипОбъекта 	  = "Контрагенты";
ИмяПравилаПКО = "Контрагенты";

Выполнить(Алгоритмы.ВыполнитьВыгрузкуСправочников);

Отказ  = Истина;
</ПередОбработкойПравила>
			</Правило>
			<Правило Отключить="false">
				<Код>ДоговорыКонтрагентов</Код>
				<Наименование>Договоры с контрагентами</Наименование>
				<Порядок>100</Порядок>
				<КодПравилаКонвертации>ДоговорыКонтрагентов                              </КодПравилаКонвертации>
				<СпособОтбораДанных>СтандартнаяВыборка</СпособОтбораДанных>
				<ОбъектВыборки>СправочникСсылка.ДоговорыКонтрагентов</ОбъектВыборки>
				<ПередОбработкойПравила>ТипОбъекта 	  = "ДоговорыКонтрагентов";
ИмяПравилаПКО = "ДоговорыКонтрагентов";

Выполнить(Алгоритмы.ВыполнитьВыгрузкуСправочников);

Отказ  = Истина;
</ПередОбработкойПравила>
			</Правило>
			<Правило Отключить="false">
				<Код>БанковскиеСчетаКонтрагентов</Код>
				<Наименование>Банковские счета</Наименование>
				<Порядок>150</Порядок>
				<КодПравилаКонвертации>БанковскиеСчета                                   </КодПравилаКонвертации>
				<СпособОтбораДанных>СтандартнаяВыборка</СпособОтбораДанных>
				<ОбъектВыборки>СправочникСсылка.БанковскиеСчетаКонтрагентов</ОбъектВыборки>
				<ПередОбработкойПравила>ТипОбъекта 	  = "БанковскиеСчетаКонтрагентов";
ИмяПравилаПКО = "БанковскиеСчета";

Выполнить(Алгоритмы.ВыполнитьВыгрузкуСправочников);

Отказ  = Истина;
</ПередОбработкойПравила>
			</Правило>
		</Группа>
	</ПравилаВыгрузкиДанных>
	<ПравилаОчисткиДанных/>
	<Алгоритмы>
		<Алгоритм Имя="ВыполнитьВыгрузкуСправочников" ИспользуетсяПриЗагрузке="false">
			<Текст>ПланОбмена = ПланыОбмена.ОбменНСИ.НайтиПоКоду("GrSt");

Если ПланОбмена &lt;&gt; Неопределено И Не ПланОбмена.Пустая() Тогда
	
	Если ТипОбъекта = "ДоговорыКонтрагентов" Тогда
		КоличествоВыборки = 5;
	Иначе
		КоличествоВыборки = 500;
	КонецЕсли;
	
	ТекстЗапроса =	"ВЫБРАТЬ ПЕРВЫЕ %КоличествоВыборки%
	|	ОбъектИзменения.Ссылка,
	|	ОбъектИзменения.НомерСообщения КАК НомерСообщения
	|ИЗ
	|	Справочник.%ТипОбъекта%.Изменения КАК ОбъектИзменения
	|ГДЕ
	|	ОбъектИзменения.Узел = &amp;Узел
	|
	|УПОРЯДОЧИТЬ ПО
	|	НомерСообщения УБЫВ";
	
	ТекстЗапроса = СтрЗаменить(ТекстЗапроса, "%ТипОбъекта%", ТипОбъекта);
	ТекстЗапроса = СтрЗаменить(ТекстЗапроса, "%КоличествоВыборки%", КоличествоВыборки);
	
	Запрос = Новый Запрос;
	Запрос.Текст = ТекстЗапроса;
	Запрос.УстановитьПараметр("Узел", ПланОбмена);
	
	РезультатЗапроса = Запрос.Выполнить();
	
	Если НЕ РезультатЗапроса.Пустой() Тогда 						
		
		МассивСсылок = РезультатЗапроса.Выгрузить().ВыгрузитьКолонку("Ссылка");
		
		ПланыОбмена.ВыбратьИзменения(ПланОбмена,1,МассивСсылок);
		
		Если НЕ ПустаяСтрока(ИмяПравилаПКО) Тогда
			Для Каждого Спр Из МассивСсылок Цикл 
				ВыгрузитьПоПравилу(Спр, , , , ИмяПравилаПКО);				
			КонецЦикла;			
		КонецЕсли;
		
	КонецЕсли;
	
КонецЕсли;	
</Текст>
		</Алгоритм>
	</Алгоритмы>
	<Запросы/>
</ПравилаОбмена>