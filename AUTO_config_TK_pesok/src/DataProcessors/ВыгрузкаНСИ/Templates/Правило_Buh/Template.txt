<ПравилаОбмена>
	<ВерсияФормата РежимСовместимости="РежимСовместимостиСБСП20">2.01</ВерсияФормата>
	<Ид>123e721e-fb76-4f9c-bc99-7a3bcb4ebf14    </Ид>
	<Наименование>ТК_ssl --&gt; БухгалтерияДляУкраины</Наименование>
	<ДатаВремяСоздания>2022-03-21T10:01:06</ДатаВремяСоздания>
	<Источник ВерсияПлатформы="8.0" ВерсияКонфигурации="1.0.1.25" СинонимКонфигурации="ТК">ТК</Источник>
	<Приемник ВерсияПлатформы="8.0" ВерсияКонфигурации="1.2.40.2" СинонимКонфигурации="Бухгалтерия для Украины, редакция 1.2">БухгалтерияДляУкраины</Приемник>
	<ПередВыгрузкойДанных>Параметры.УзелБухгалтерия = ТК_ОбменCentrПовтИсп.МассивУзловБухгалтерия()[0];

СоответствиеСчетов = Новый Соответствие;
СоответствиеСчетов.Вставить(Справочники.Организации.НайтиПоКоду("GL000008"),"GL004717") ;//Основа/БанкПриват

Параметры.Вставить("СоответствиеСчетов",СоответствиеСчетов);
Параметры.Вставить("СтатьяДДСРКО",Справочники.СтатьиДДС.НайтиПоКоду("DG000001"));

//Шаблоны Проводок
	ТаблицаПроводок = Новый ТаблицаЗначений;
	ТаблицаПроводок.Колонки.Добавить("СчетДт");
	ТаблицаПроводок.Колонки.Добавить("СчетКт");
	ТаблицаПроводок.Колонки.Добавить("СубконтоДт1");
	ТаблицаПроводок.Колонки.Добавить("СубконтоДт2");
	ТаблицаПроводок.Колонки.Добавить("СубконтоДт3");
	ТаблицаПроводок.Колонки.Добавить("СубконтоКт1");
	ТаблицаПроводок.Колонки.Добавить("СубконтоКт2");
	ТаблицаПроводок.Колонки.Добавить("СубконтоКт3");
	ТаблицаПроводок.Колонки.Добавить("Сумма");
	ТаблицаПроводок.Колонки.Добавить("Содержание");
	
	ТаблицаПроводок.Колонки.Добавить("НалоговоеНазначениеДт");
	ТаблицаПроводок.Колонки.Добавить("НалоговоеНазначениеКт");
	ТаблицаПроводок.Колонки.Добавить("СуммаНУДт"); //Множитель к сумме проводки
	ТаблицаПроводок.Колонки.Добавить("СуммаНУКт"); //Множитель к сумме проводки
	
	ТаблицаПроводок.Колонки.Добавить("ПризнакПроводки");
	ТаблицаПроводок.Колонки.Добавить("ПоставщикНаЕдиномНалоге");
	
	
	
	НалНазначениеОблНДС = Новый Структура("Код", "000027");
	
	сбТорговаяВыручка = Новый Структура;
	сбТорговаяВыручка.Вставить("Субконто", Новый Структура("Код", "000001052"));
	сбТорговаяВыручка.Вставить("ИмяПКО", "СтатьиДоходов");
	
	сбНалоги = Новый Структура;
	сбНалоги.Вставить("Субконто", Новый Структура("Код", "Акцизный налог"));
	сбНалоги.Вставить("ИмяПКО", "Налоги");
	
	
	
	НоваяПроводка = ТаблицаПроводок.Добавить();
	НоваяПроводка.СчетДт = "902";
	НоваяПроводка.СубконтоДт1 = "Номенклатурные_группы";	
	НоваяПроводка.СчетКт = "281";
	НоваяПроводка.СубконтоКт1 = "Номенклатура";
	НоваяПроводка.СубконтоКт3 = "Склады";
	НоваяПроводка.Сумма = "СебестоимостьБезНДС";
	НоваяПроводка.Содержание = "Себестоимость ТМЦ";	
	НоваяПроводка.НалоговоеНазначениеДт = НалНазначениеОблНДС;
	НоваяПроводка.НалоговоеНазначениеКт = НалНазначениеОблНДС;	
	НоваяПроводка.СуммаНУДт = 1;
	НоваяПроводка.СуммаНУКт = 1;
	НоваяПроводка.ПризнакПроводки = "ПоСобственнойНоменклатуре";
	НоваяПроводка.ПоставщикНаЕдиномНалоге = Ложь;
	
	//НоваяПроводка = ТаблицаПроводок.Добавить();
	//НоваяПроводка.СчетДт = "902";
	//НоваяПроводка.СубконтоДт1 = "Номенклатурные_группы";	
	//НоваяПроводка.СчетКт = "2821";
	//НоваяПроводка.СубконтоКт1 = "Номенклатура";
	//НоваяПроводка.СубконтоКт2 = "Склады";
	//НоваяПроводка.Сумма = "СебестоимостьБезНДС";
	//НоваяПроводка.Содержание = "Себестоимость ТМЦ";
	//НоваяПроводка.ПризнакПроводки = "ПоСобственнойНоменклатуре";
	//НоваяПроводка.ПоставщикНаЕдиномНалоге = Истина;
	
	НоваяПроводка = ТаблицаПроводок.Добавить();
	НоваяПроводка.СчетДт = "791";
	НоваяПроводка.СчетКт = "902";
	НоваяПроводка.СубконтоКт1 = "Номенклатурные_группы";
	НоваяПроводка.Сумма = "СебестоимостьБезНДС";
	НоваяПроводка.НалоговоеНазначениеДт = НалНазначениеОблНДС;
	НоваяПроводка.НалоговоеНазначениеКт = НалНазначениеОблНДС;	
	НоваяПроводка.СуммаНУДт = 1;
	НоваяПроводка.СуммаНУКт = 1;	
	НоваяПроводка.Содержание = "Уменьшение фин.рез. на себ.";
	НоваяПроводка.ПризнакПроводки = "ПоСобственнойНоменклатуре";
	
	НоваяПроводка = ТаблицаПроводок.Добавить();
	НоваяПроводка.СчетДт = "303";
	НоваяПроводка.СубконтоДт1 = "Кассы";	
	НоваяПроводка.СчетКт = "702";
	НоваяПроводка.СубконтоКт1 = сбТорговаяВыручка;
	НоваяПроводка.Сумма = "Сумма";
	НоваяПроводка.НалоговоеНазначениеКт = НалНазначениеОблНДС;	
	НоваяПроводка.СуммаНУДт = 0;
	НоваяПроводка.СуммаНУКт = 1;	
	НоваяПроводка.Содержание = "Оплата наличными, Реализация:товары";
	НоваяПроводка.ПризнакПроводки = "ПоКассамЗаСобственныйТовар";
	
	НоваяПроводка = ТаблицаПроводок.Добавить();
	НоваяПроводка.СчетДт = "331";
	НоваяПроводка.СубконтоДт1 = "Контрагенты";	
	НоваяПроводка.СубконтоДт2 = "БанковскийСчет";	
	НоваяПроводка.СчетКт = "303";
	НоваяПроводка.СубконтоКт1 = "Кассы";
	НоваяПроводка.Сумма = "Сумма";
	НоваяПроводка.СуммаНУДт = 0;
	НоваяПроводка.СуммаНУКт = 0;	
	НоваяПроводка.Содержание = "Оплата по терминалу";
	НоваяПроводка.ПризнакПроводки = "ОплатаПоТерминалу";
	
	НоваяПроводка = ТаблицаПроводок.Добавить();
	НоваяПроводка.СчетДт = "702";
	НоваяПроводка.СубконтоДт1 = сбТорговаяВыручка;
	НоваяПроводка.СчетКт = "6434";
	НоваяПроводка.Сумма = "Сумма";
	НоваяПроводка.НалоговоеНазначениеДт = НалНазначениеОблНДС;
	НоваяПроводка.СуммаНУДт = 1;		
	НоваяПроводка.Содержание = "НДС";
	НоваяПроводка.ПризнакПроводки = "НДСПоСобственнойНоменклатуре";
	
	НоваяПроводка = ТаблицаПроводок.Добавить();
	НоваяПроводка.СчетДт = "702";
	НоваяПроводка.СубконтоДт1 = сбТорговаяВыручка;
	НоваяПроводка.СчетКт = "791";
	НоваяПроводка.Сумма = "Сумма";
	НоваяПроводка.НалоговоеНазначениеДт = НалНазначениеОблНДС;
	НоваяПроводка.НалоговоеНазначениеКт = НалНазначениеОблНДС;	
	НоваяПроводка.СуммаНУДт = 1;
	НоваяПроводка.Содержание = "Списание на фин.результат";
	НоваяПроводка.ПризнакПроводки = "ПоВсемСобственнымТоварам";
	
	НоваяПроводка = ТаблицаПроводок.Добавить();
	НоваяПроводка.СчетДт = "702";
	НоваяПроводка.СубконтоДт1 = сбТорговаяВыручка;
	НоваяПроводка.СчетКт = "6415";
	НоваяПроводка.СубконтоКт1 = сбНалоги;
	НоваяПроводка.Сумма = "Сумма";
	НоваяПроводка.НалоговоеНазначениеДт = НалНазначениеОблНДС;
	НоваяПроводка.СуммаНУДт = 1;
	НоваяПроводка.Содержание = "Акцизный налог с розничных продаж";
	НоваяПроводка.ПризнакПроводки = "АкцизныйНалог";
	
	НоваяПроводка = ТаблицаПроводок.Добавить();
	НоваяПроводка.СчетДт = "702";
	НоваяПроводка.СубконтоДт1 = сбТорговаяВыручка;
	НоваяПроводка.СчетКт = "6434";
	НоваяПроводка.Сумма = "Сумма";
	НоваяПроводка.НалоговоеНазначениеДт = НалНазначениеОблНДС;
	НоваяПроводка.СуммаНУДт = 1;
	НоваяПроводка.Содержание = "НДС (корректировка)";
	НоваяПроводка.ПризнакПроводки = "КорректировкаНДС";
	
	НоваяПроводка = ТаблицаПроводок.Добавить();
	НоваяПроводка.СчетДт = "702";
	НоваяПроводка.СубконтоДт1 = сбТорговаяВыручка;
	НоваяПроводка.СчетКт = "791";
	НоваяПроводка.Сумма = "СуммаФинРезультат";
	НоваяПроводка.НалоговоеНазначениеДт = НалНазначениеОблНДС;
	НоваяПроводка.НалоговоеНазначениеКт = НалНазначениеОблНДС;	
	НоваяПроводка.СуммаНУДт = -1;	
	НоваяПроводка.Содержание = "Корректировка фин.результата";
	НоваяПроводка.ПризнакПроводки = "КорректировкаНДС";
	
	НоваяПроводка = ТаблицаПроводок.Добавить();
	НоваяПроводка.СчетДт = "702";
	НоваяПроводка.СубконтоДт1 = сбТорговаяВыручка;
	НоваяПроводка.СчетКт = "6415";
	НоваяПроводка.СубконтоКт1 = сбНалоги;
	НоваяПроводка.Сумма = "Сумма";
	НоваяПроводка.НалоговоеНазначениеДт = НалНазначениеОблНДС;
	НоваяПроводка.НалоговоеНазначениеКт = НалНазначениеОблНДС;	
	НоваяПроводка.СуммаНУДт = 1;	
	НоваяПроводка.Содержание = "Акцизный налог с розничных продаж (корректировка)";
	НоваяПроводка.ПризнакПроводки = "КорректировкаАкциз";
	
	НоваяПроводка = ТаблицаПроводок.Добавить();
	НоваяПроводка.СчетДт = "702";
	НоваяПроводка.СубконтоДт1 = сбТорговаяВыручка;
	НоваяПроводка.СчетКт = "791";
	НоваяПроводка.Сумма = "СуммаФинРезультат";
	НоваяПроводка.НалоговоеНазначениеДт = НалНазначениеОблНДС;
	НоваяПроводка.НалоговоеНазначениеКт = НалНазначениеОблНДС;	
	НоваяПроводка.СуммаНУДт = -1;	
	НоваяПроводка.Содержание = "Корректировка фин.результата";
	НоваяПроводка.ПризнакПроводки = "КорректировкаАкциз";
	
	
КешШаблонов = Новый Соответствие;
КешШаблонов.Вставить("ЗКС_Общий", ТаблицаПроводок);

Параметры.Вставить("КешШаблонов", КешШаблонов);
	
</ПередВыгрузкойДанных>
	<ПередЗагрузкойДанных>УстановитьПривилегированныйРежим(Истина);

УзелОбмена = ПланыОбмена.Полный.НайтиПоКоду("SSL");
Если Не ЗначениеЗаполнено(УзелОбмена) Тогда 
	НовУзел = ПланыОбмена.Полный.СоздатьУзел();
	НовУзел.Код = "SSL";
	НовУзел.Наименование = "Обмен с базой SSL";
	НовУзел.Записать();
	
	УзелОбмена = НовУзел.Ссылка;
КонецЕсли;

Параметры.Вставить("УзелОбменаДляСоответствияОбъектов", УзелОбмена);
Параметры.Вставить("ПараметрыАлгоритмов",Новый Структура);

</ПередЗагрузкойДанных>
	<Параметры>
		<Параметр Имя="ВозвратОтПокупателя                               " Наименование="ВозвратОтПокупателя                               " ИспользуетсяПриЗагрузке="false" УстанавливатьВДиалоге="true" ТипЗначения="ДокументСсылка.ВозвратОтПокупателя" ПередаватьПараметрПриВыгрузке="false" ПравилоКонвертации="ВозвратОтПокупателя                               "/>
		<Параметр Имя="ВозвратПоставщику                                 " Наименование="ВозвратПоставщику                                 " ИспользуетсяПриЗагрузке="false" УстанавливатьВДиалоге="true" ТипЗначения="ДокументСсылка.ВозвратПоставщику" ПередаватьПараметрПриВыгрузке="false" ПравилоКонвертации="ВозвратПоставщику                                 "/>
		<Параметр Имя="ВыгрузкаДокументы                                 " Наименование="ВыгрузкаДокументы                                 " ИспользуетсяПриЗагрузке="false" УстанавливатьВДиалоге="true" ТипЗначения="Булево" ПередаватьПараметрПриВыгрузке="false"/>
		<Параметр Имя="ВыгрузкаНСИ                                       " Наименование="ВыгрузкаНСИ                                      " ИспользуетсяПриЗагрузке="false" УстанавливатьВДиалоге="true" ТипЗначения="Булево" ПередаватьПараметрПриВыгрузке="false"/>
		<Параметр Имя="Договор                                           " Наименование="Договор                                           " ИспользуетсяПриЗагрузке="false" УстанавливатьВДиалоге="true" ТипЗначения="СправочникСсылка.ДоговорыКонтрагентов" ПередаватьПараметрПриВыгрузке="false"/>
		<Параметр Имя="ЗКС                                               " Наименование="ЗКС                                               " ИспользуетсяПриЗагрузке="false" УстанавливатьВДиалоге="true" ТипЗначения="ДокументСсылка.ТК_ЗакрытиеСменыЗКС" ПередаватьПараметрПриВыгрузке="false" ПравилоКонвертации="ЗКС                                               "/>
		<Параметр Имя="ЗКС_Дата                                          " Наименование="ЗКС_Дата                                          " ИспользуетсяПриЗагрузке="false" УстанавливатьВДиалоге="true" ТипЗначения="Дата" ПередаватьПараметрПриВыгрузке="false"/>
		<Параметр Имя="ЗКС_Организация                                   " Наименование="ЗКС_Организация                                   " ИспользуетсяПриЗагрузке="false" УстанавливатьВДиалоге="true" ТипЗначения="СправочникСсылка.Организации" ПередаватьПараметрПриВыгрузке="false" ПравилоКонвертации="Организации                                       "/>
		<Параметр Имя="КонсПоступлениеТоваров                            " Наименование="КонсПоступлениеТоваров                            " ИспользуетсяПриЗагрузке="false" УстанавливатьВДиалоге="true" ТипЗначения="ДокументСсылка.КонсолидированныеОстаткиОрганизации" ПередаватьПараметрПриВыгрузке="false" ПравилоКонвертации="КонсПоступлениеТоваров                            "/>
		<Параметр Имя="КорректировкаДолга                                " Наименование="КорректировкаДолга                                " ИспользуетсяПриЗагрузке="false" УстанавливатьВДиалоге="true" ТипЗначения="ДокументСсылка.ТК_КорректировкаДолга" ПередаватьПараметрПриВыгрузке="false" ПравилоКонвертации="КорректировкаДолга                                "/>
		<Параметр Имя="НалоговаяНакладная                                " Наименование="НалоговаяНакладная                                " ИспользуетсяПриЗагрузке="false" УстанавливатьВДиалоге="true" ТипЗначения="ДокументСсылка.ТК_НалоговаяНакладная" ПередаватьПараметрПриВыгрузке="false" ПравилоКонвертации="НалоговаяНакладная                                "/>
		<Параметр Имя="ПоступлениеТоваров                                " Наименование="ПоступлениеТоваров                             " ИспользуетсяПриЗагрузке="false" УстанавливатьВДиалоге="true" ТипЗначения="ДокументСсылка.ПоступлениеТоваров" ПередаватьПараметрПриВыгрузке="false" ПравилоКонвертации="ПоступлениеТоваров                                "/>
		<Параметр Имя="Приложение2кНН                                    " Наименование="Приложение2кНН                                    " ИспользуетсяПриЗагрузке="false" УстанавливатьВДиалоге="true" ТипЗначения="ДокументСсылка.ТК_Приложение2КНалоговойНакладной" ПередаватьПараметрПриВыгрузке="false" ПравилоКонвертации="Приложение2КНалоговойНакладной                    "/>
		<Параметр Имя="РеализацияТоваров                                 " Наименование="РеализацияТоваров                                 " ИспользуетсяПриЗагрузке="false" УстанавливатьВДиалоге="true" ТипЗначения="ДокументСсылка.РеализацияТоваров" ПередаватьПараметрПриВыгрузке="false" ПравилоКонвертации="РеализацияТоваров                                 "/>
		<Параметр Имя="РКО                                               " Наименование="РКО                                               " ИспользуетсяПриЗагрузке="false" УстанавливатьВДиалоге="true" ТипЗначения="ДокументСсылка.РасходныйКассовыйОрдер" ПередаватьПараметрПриВыгрузке="false" ПравилоКонвертации="РасходныйКассовыйОрдер                            "/>
		<Параметр Имя="УзелБухгалтерия                                   " Наименование="ПланОбменаБухгалтерия                             " ИспользуетсяПриЗагрузке="false" УстанавливатьВДиалоге="true" ПередаватьПараметрПриВыгрузке="false"/>
		<Параметр Имя="УзелНСИ                                           " Наименование="УзелНСИ                                           " ИспользуетсяПриЗагрузке="false" УстанавливатьВДиалоге="true" ПередаватьПараметрПриВыгрузке="false"/>
		<Параметр Имя="УзелОбменаДляСоответствияОбъектов                 " Наименование="УзелОбменаДляСоответствияОбъектов                 " ИспользуетсяПриЗагрузке="true" УстанавливатьВДиалоге="false" ПередаватьПараметрПриВыгрузке="false"/>
	</Параметры>
	<Обработки/>
	<ПравилаКонвертацииОбъектов>
		<Группа>
			<Код>Справочники_Не_Перегружаемые</Код>
			<Наименование>Справочники_Не_Перегружаемые                      </Наименование>
			<Порядок>50</Порядок>
			<Правило>
				<Код>Организации</Код>
				<Наименование>Справочник: Организации</Наименование>
				<Порядок>50</Порядок>
				<ПослеЗагрузки>ЗаписатьОбъект =  ПараметрыОбъекта.Получить("ЗаписатьОбъект");
Если ЗаписатьОбъект = Неопределено Тогда
	ЗаписатьОбъект = Ложь;	
	ОбъектМодифицирован = Ложь;
КонецЕсли;

Если ЗаписатьОбъект Тогда		
	Выполнить(Алгоритмы.ЗаписатьСоответствиеОбъектов);
КонецЕсли;
</ПослеЗагрузки>
				<ПоследовательностьПолейПоиска>Если НомерВариантаПоиска = 1 тогда
	Параметры.ПараметрыАлгоритмов.Вставить("ВидОбъекта","Организации");
	Параметры.ПараметрыАлгоритмов.Вставить("ТипОбъектаИсточника","СправочникСсылка.Организации");
	СтрокаИменСвойствПоиска = "ПоискАлгоритмом";

	Выполнить(Алгоритмы.ПолучитьСоответствиеОбъектов);
ИначеЕсли НомерВариантаПоиска = 2 тогда
	СтрокаИменСвойствПоиска = "Код";
ИначеЕсли НомерВариантаПоиска = 3 тогда
	Выполнить(Алгоритмы.ПоискОрганизацииПоЕДРПОУ);
Иначе
	СтрокаИменСвойствПоиска="";
	ПрекратитьПоиск = Истина;
КонецЕсли</ПоследовательностьПолейПоиска>
				<НеЗамещать>true</НеЗамещать>
				<НеВыгружатьОбъектыСвойствПоСсылкам>true</НеВыгружатьОбъектыСвойствПоСсылкам>
				<НеСоздаватьЕслиНеНайден>true</НеСоздаватьЕслиНеНайден>
				<ИспользоватьБыстрыйПоискПриЗагрузке>true</ИспользоватьБыстрыйПоискПриЗагрузке>
				<Источник>СправочникСсылка.Организации</Источник>
				<Приемник>СправочникСсылка.Организации</Приемник>
				<Свойства>
					<Свойство Поиск="true">
						<Код>2</Код>
						<Наименование>--&gt; GUID_Поиска</Наименование>
						<Порядок>50</Порядок>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="" Вид=""/>
						<ИмяПараметраДляПередачи>GUID_Поиска</ИмяПараметраДляПередачи>
						<ПередВыгрузкой>Значение = ЗначениеВСтрокуВнутр(Источник.УникальныйИдентификатор());</ПередВыгрузкой>
					</Свойство>
					<Свойство Поиск="true">
						<Код>3</Код>
						<Наименование>КодПоЕДРПОУ --&gt; КодПоЕДРПОУ</Наименование>
						<Порядок>100</Порядок>
						<Источник Имя="КодПоЕДРПОУ" Вид="Реквизит" Тип="Строка"/>
						<Приемник Имя="" Вид=""/>
						<ИмяПараметраДляПередачи>КодПоЕДРПОУ</ИмяПараметраДляПередачи>
					</Свойство>
					<Свойство Поиск="true">
						<Код>1</Код>
						<Наименование>Код --&gt; Код</Наименование>
						<Порядок>150</Порядок>
						<Источник Имя="Код" Вид="Свойство" Тип="Строка"/>
						<Приемник Имя="Код" Вид="Свойство" Тип="Строка"/>
					</Свойство>
				</Свойства>
				<Значения/>
			</Правило>
			<Правило>
				<Код>Номенклатура</Код>
				<Наименование>Справочник: Группы ценообразования</Наименование>
				<Порядок>100</Порядок>
				<ПослеЗагрузки>ЗаписатьОбъект =  ПараметрыОбъекта.Получить("ЗаписатьОбъект");
Если ЗаписатьОбъект = Неопределено Тогда
	ЗаписатьОбъект = Ложь;	
	ОбъектМодифицирован = Ложь;
КонецЕсли;

Если ЗаписатьОбъект Тогда		
	Выполнить(Алгоритмы.ЗаписатьСоответствиеОбъектов);
КонецЕсли;
</ПослеЗагрузки>
				<ПоследовательностьПолейПоиска>Если НомерВариантаПоиска = 1 тогда
	Параметры.ПараметрыАлгоритмов.Вставить("ВидОбъекта","Номенклатура");
	Параметры.ПараметрыАлгоритмов.Вставить("ТипОбъектаИсточника","СправочникСсылка.ГруппыЦенообразования");
	СтрокаИменСвойствПоиска = "ПоискАлгоритмом";

	Выполнить(Алгоритмы.ПолучитьСоответствиеОбъектов);
ИначеЕсли НомерВариантаПоиска = 2 тогда
	СтрокаИменСвойствПоиска = "Код, Наименование";
Иначе
	СтрокаИменСвойствПоиска="";
	ПрекратитьПоиск = Истина;
КонецЕсли</ПоследовательностьПолейПоиска>
				<НеЗамещать>true</НеЗамещать>
				<НеВыгружатьОбъектыСвойствПоСсылкам>true</НеВыгружатьОбъектыСвойствПоСсылкам>
				<НеСоздаватьЕслиНеНайден>true</НеСоздаватьЕслиНеНайден>
				<ИспользоватьБыстрыйПоискПриЗагрузке>true</ИспользоватьБыстрыйПоискПриЗагрузке>
				<Источник>СправочникСсылка.ГруппыЦенообразования</Источник>
				<Приемник>СправочникСсылка.Номенклатура</Приемник>
				<Свойства>
					<Свойство Поиск="true">
						<Код>1</Код>
						<Наименование>--&gt; GUID_Поиска</Наименование>
						<Порядок>50</Порядок>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="" Вид=""/>
						<ИмяПараметраДляПередачи>GUID_Поиска</ИмяПараметраДляПередачи>
						<ПередВыгрузкой>Значение = ЗначениеВСтрокуВнутр(Источник.УникальныйИдентификатор());</ПередВыгрузкой>
					</Свойство>
					<Свойство Поиск="true">
						<Код>3</Код>
						<Наименование>Код --&gt; Код</Наименование>
						<Порядок>100</Порядок>
						<Источник Имя="Код" Вид="Свойство" Тип="Строка"/>
						<Приемник Имя="Код" Вид="Свойство" Тип="Строка"/>
					</Свойство>
					<Свойство Поиск="true">
						<Код>4</Код>
						<Наименование>Наименование --&gt; Наименование</Наименование>
						<Порядок>150</Порядок>
						<Источник Имя="Наименование" Вид="Свойство" Тип="Строка"/>
						<Приемник Имя="Наименование" Вид="Свойство" Тип="Строка"/>
					</Свойство>
				</Свойства>
				<Значения/>
			</Правило>
			<Правило>
				<Код>НоменклатурныеГруппы</Код>
				<Наименование>Справочник: Номенклатурные группы бухгалтерии</Наименование>
				<Порядок>150</Порядок>
				<ПослеЗагрузки>ЗаписатьОбъект =  ПараметрыОбъекта.Получить("ЗаписатьОбъект");
Если ЗаписатьОбъект = Неопределено Тогда
	ЗаписатьОбъект = Ложь;	
	ОбъектМодифицирован = Ложь;
КонецЕсли;

Если ЗаписатьОбъект Тогда		
	Выполнить(Алгоритмы.ЗаписатьСоответствиеОбъектов);
КонецЕсли;
</ПослеЗагрузки>
				<ПоследовательностьПолейПоиска>Если НомерВариантаПоиска = 1 тогда
	Параметры.ПараметрыАлгоритмов.Вставить("ВидОбъекта","НоменклатурныеГруппы");
	Параметры.ПараметрыАлгоритмов.Вставить("ТипОбъектаИсточника","СправочникСсылка.ГруппыЦенообразования");
	СтрокаИменСвойствПоиска = "ПоискАлгоритмом";

	Выполнить(Алгоритмы.ПолучитьСоответствиеОбъектов);
ИначеЕсли НомерВариантаПоиска = 2 тогда
	СтрокаИменСвойствПоиска = "Наименование";
Иначе
	СтрокаИменСвойствПоиска="";
	ПрекратитьПоиск = Истина;
КонецЕсли</ПоследовательностьПолейПоиска>
				<НеЗамещать>true</НеЗамещать>
				<НеВыгружатьОбъектыСвойствПоСсылкам>true</НеВыгружатьОбъектыСвойствПоСсылкам>
				<НеСоздаватьЕслиНеНайден>true</НеСоздаватьЕслиНеНайден>
				<ИспользоватьБыстрыйПоискПриЗагрузке>true</ИспользоватьБыстрыйПоискПриЗагрузке>
				<Источник>СправочникСсылка.ГруппыЦенообразования</Источник>
				<Приемник>СправочникСсылка.НоменклатурныеГруппы</Приемник>
				<Свойства>
					<Свойство Поиск="true">
						<Код>1</Код>
						<Наименование>--&gt; GUID_Поиска</Наименование>
						<Порядок>50</Порядок>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="" Вид=""/>
						<ИмяПараметраДляПередачи>GUID_Поиска</ИмяПараметраДляПередачи>
						<ПередВыгрузкой>Значение = ЗначениеВСтрокуВнутр(Источник.УникальныйИдентификатор());</ПередВыгрузкой>
					</Свойство>
					<Свойство Поиск="true">
						<Код>2</Код>
						<Наименование>Наименование --&gt; Наименование</Наименование>
						<Порядок>100</Порядок>
						<Источник Имя="Наименование" Вид="Свойство" Тип="Строка"/>
						<Приемник Имя="Наименование" Вид="Свойство" Тип="Строка"/>
					</Свойство>
				</Свойства>
				<Значения/>
			</Правило>
			<Правило>
				<Код>Объекты</Код>
				<Наименование>Справочник: Торговые площадки</Наименование>
				<Порядок>200</Порядок>
				<ПослеЗагрузки>ЗаписатьОбъект =  ПараметрыОбъекта.Получить("ЗаписатьОбъект");
Если ЗаписатьОбъект = Неопределено Тогда
	ЗаписатьОбъект = Ложь;
	ОбъектМодифицирован = Ложь;
КонецЕсли;

Если ЗаписатьОбъект Тогда		
	Выполнить(Алгоритмы.ЗаписатьСоответствиеОбъектов);
КонецЕсли;
</ПослеЗагрузки>
				<ПоследовательностьПолейПоиска>Если НомерВариантаПоиска = 1 тогда
	Параметры.ПараметрыАлгоритмов.Вставить("ВидОбъекта","Объекты");
	Параметры.ПараметрыАлгоритмов.Вставить("ТипОбъектаИсточника","СправочникСсылка.ТорговыеПлощадки");
	СтрокаИменСвойствПоиска = "ПоискАлгоритмом";

	Выполнить(Алгоритмы.ПолучитьСоответствиеОбъектов);
ИначеЕсли НомерВариантаПоиска = 2 тогда
	СтрокаИменСвойствПоиска = "Код, ЭтоГруппа";
Иначе
	СтрокаИменСвойствПоиска="";
	ПрекратитьПоиск = Истина;
КонецЕсли</ПоследовательностьПолейПоиска>
				<НеЗамещать>true</НеЗамещать>
				<НеСоздаватьЕслиНеНайден>true</НеСоздаватьЕслиНеНайден>
				<Источник>СправочникСсылка.ТорговыеПлощадки</Источник>
				<Приемник>СправочникСсылка.Объекты</Приемник>
				<Свойства>
					<Свойство Поиск="true">
						<Код>1</Код>
						<Наименование>--&gt; GUID_Поиска</Наименование>
						<Порядок>50</Порядок>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="" Вид=""/>
						<ИмяПараметраДляПередачи>GUID_Поиска</ИмяПараметраДляПередачи>
						<ПередВыгрузкой>Значение = ЗначениеВСтрокуВнутр(Источник.УникальныйИдентификатор());</ПередВыгрузкой>
					</Свойство>
					<Свойство Поиск="true">
						<Код>3</Код>
						<Наименование>Код --&gt; Код</Наименование>
						<Порядок>100</Порядок>
						<Источник Имя="Код" Вид="Свойство" Тип="Строка"/>
						<Приемник Имя="Код" Вид="Свойство" Тип="Строка"/>
					</Свойство>
					<Свойство Поиск="true" Обязательное="true">
						<Код>4</Код>
						<Наименование>--&gt; ЭтоГруппа</Наименование>
						<Порядок>150</Порядок>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="ЭтоГруппа" Вид="Свойство" Тип="Булево"/>
						<ПередВыгрузкой>Значение = Ложь;</ПередВыгрузкой>
					</Свойство>
				</Свойства>
				<Значения/>
			</Правило>
			<Правило>
				<Код>Подразделения</Код>
				<Наименование>Справочник: Подразделения</Наименование>
				<Порядок>250</Порядок>
				<ПослеЗагрузки>ЗаписатьОбъект =  ПараметрыОбъекта.Получить("ЗаписатьОбъект");
Если ЗаписатьОбъект = Неопределено Тогда
	ЗаписатьОбъект = Ложь;
	ОбъектМодифицирован = Ложь;
КонецЕсли;

Если ЗаписатьОбъект Тогда		
	Выполнить(Алгоритмы.ЗаписатьСоответствиеОбъектов);
КонецЕсли;
</ПослеЗагрузки>
				<ПоследовательностьПолейПоиска>Если НомерВариантаПоиска = 1 тогда
	Параметры.ПараметрыАлгоритмов.Вставить("ВидОбъекта","Подразделения");
	Параметры.ПараметрыАлгоритмов.Вставить("ТипОбъектаИсточника","СправочникСсылка.ПодразделенияКомпании");
	СтрокаИменСвойствПоиска = "ПоискАлгоритмом";

	Выполнить(Алгоритмы.ПолучитьСоответствиеОбъектов);
ИначеЕсли НомерВариантаПоиска = 2 тогда
	СтрокаИменСвойствПоиска = "Код";
Иначе
	СтрокаИменСвойствПоиска="";
	ПрекратитьПоиск = Истина;
КонецЕсли</ПоследовательностьПолейПоиска>
				<НеЗамещать>true</НеЗамещать>
				<НеСоздаватьЕслиНеНайден>true</НеСоздаватьЕслиНеНайден>
				<ИспользоватьБыстрыйПоискПриЗагрузке>true</ИспользоватьБыстрыйПоискПриЗагрузке>
				<Источник>СправочникСсылка.ПодразделенияКомпании</Источник>
				<Приемник>СправочникСсылка.Подразделения</Приемник>
				<Свойства>
					<Свойство Поиск="true">
						<Код>1</Код>
						<Наименование>--&gt; GUID_Поиска</Наименование>
						<Порядок>50</Порядок>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="" Вид=""/>
						<ИмяПараметраДляПередачи>GUID_Поиска</ИмяПараметраДляПередачи>
						<ПередВыгрузкой>Значение = ЗначениеВСтрокуВнутр(Источник.УникальныйИдентификатор());</ПередВыгрузкой>
					</Свойство>
					<Свойство Поиск="true">
						<Код>3</Код>
						<Наименование>Код --&gt; Код</Наименование>
						<Порядок>100</Порядок>
						<Источник Имя="Код" Вид="Свойство" Тип="Строка"/>
						<Приемник Имя="Код" Вид="Свойство" Тип="Строка"/>
					</Свойство>
				</Свойства>
				<Значения/>
			</Правило>
			<Правило>
				<Код>СтатьиДДС_Код</Код>
				<Наименование>: </Наименование>
				<Порядок>300</Порядок>
				<ПоследовательностьПолейПоиска>СтрокаИменСвойствПоиска = "Код";</ПоследовательностьПолейПоиска>
				<НеЗамещать>true</НеЗамещать>
				<НеСоздаватьЕслиНеНайден>true</НеСоздаватьЕслиНеНайден>
				<Приемник>СправочникСсылка.СтатьиДвиженияДенежныхСредств</Приемник>
				<Свойства>
					<Свойство Поиск="true">
						<Код>1</Код>
						<Наименование>--&gt; Код</Наименование>
						<Порядок>50</Порядок>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="Код" Вид="Свойство" Тип="Строка"/>
					</Свойство>
				</Свойства>
				<Значения/>
			</Правило>
			<Правило>
				<Код>СтатьиДвиженияДенежныхСредств</Код>
				<Наименование>Справочник: Группы ценообразования</Наименование>
				<Порядок>350</Порядок>
				<ПослеЗагрузки>ЗаписатьОбъект =  ПараметрыОбъекта.Получить("ЗаписатьОбъект");
Если ЗаписатьОбъект = Неопределено Тогда
	ЗаписатьОбъект = Ложь;
КонецЕсли;

Если ОбъектНайден И ЗаписатьОбъект Тогда		
	Выполнить(Алгоритмы.ЗаписатьСоответствиеОбъектов);
КонецЕсли;
</ПослеЗагрузки>
				<ПоследовательностьПолейПоиска>Если НомерВариантаПоиска = 1 тогда
	Параметры.ПараметрыАлгоритмов.Вставить("ВидОбъекта","СтатьиДвиженияДенежныхСредств");
	Параметры.ПараметрыАлгоритмов.Вставить("ТипОбъектаИсточника","СправочникСсылка.СтатьиДДС");
	СтрокаИменСвойствПоиска = "ПоискАлгоритмом";

	Выполнить(Алгоритмы.ПолучитьСоответствиеОбъектов);
ИначеЕсли НомерВариантаПоиска = 2 тогда
	СтрокаИменСвойствПоиска = "Код";
Иначе
	СтрокаИменСвойствПоиска="";
	ПрекратитьПоиск = Истина;
КонецЕсли</ПоследовательностьПолейПоиска>
				<НеЗамещать>true</НеЗамещать>
				<НеСоздаватьЕслиНеНайден>true</НеСоздаватьЕслиНеНайден>
				<Источник>СправочникСсылка.СтатьиДДС</Источник>
				<Приемник>СправочникСсылка.СтатьиДвиженияДенежныхСредств</Приемник>
				<Свойства>
					<Свойство Поиск="true">
						<Код>1</Код>
						<Наименование>--&gt; GUID_Поиска</Наименование>
						<Порядок>50</Порядок>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="" Вид=""/>
						<ИмяПараметраДляПередачи>GUID_Поиска</ИмяПараметраДляПередачи>
						<ПередВыгрузкой>Значение = ЗначениеВСтрокуВнутр(Источник.УникальныйИдентификатор());</ПередВыгрузкой>
					</Свойство>
					<Свойство Поиск="true">
						<Код>3</Код>
						<Наименование>Код --&gt; Код</Наименование>
						<Порядок>100</Порядок>
						<Источник Имя="Код" Вид="Свойство" Тип="Строка"/>
						<Приемник Имя="Код" Вид="Свойство" Тип="Строка"/>
						<ПриводитьКДлине>9</ПриводитьКДлине>
					</Свойство>
					<Свойство Поиск="true">
						<Код>4</Код>
						<Наименование>Наименование --&gt; Наименование</Наименование>
						<Порядок>150</Порядок>
						<Источник Имя="Наименование" Вид="Свойство" Тип="Строка"/>
						<Приемник Имя="Наименование" Вид="Свойство" Тип="Строка"/>
					</Свойство>
				</Свойства>
				<Значения/>
			</Правило>
			<Правило>
				<Код>Валюты</Код>
				<Наименование>Справочник: Валюты</Наименование>
				<Порядок>400</Порядок>
				<ПослеЗагрузки>ЗаписатьОбъект =  ПараметрыОбъекта.Получить("ЗаписатьОбъект");
Если ЗаписатьОбъект = Неопределено Тогда
	ЗаписатьОбъект = Ложь;
КонецЕсли;

Если ЗаписатьОбъект Тогда		
	Выполнить(Алгоритмы.ЗаписатьСоответствиеОбъектов);
КонецЕсли;
</ПослеЗагрузки>
				<ПоследовательностьПолейПоиска>Если НомерВариантаПоиска = 1 тогда
	Параметры.ПараметрыАлгоритмов.Вставить("ВидОбъекта","Валюты");
	Параметры.ПараметрыАлгоритмов.Вставить("ТипОбъектаИсточника","СправочникСсылка.Валюты");
	СтрокаИменСвойствПоиска = "ПоискАлгоритмом";

	Выполнить(Алгоритмы.ПолучитьСоответствиеОбъектов);
ИначеЕсли НомерВариантаПоиска = 2 тогда
	СтрокаИменСвойствПоиска = "Код";
Иначе
	СтрокаИменСвойствПоиска="";
	ПрекратитьПоиск = Истина;
КонецЕсли</ПоследовательностьПолейПоиска>
				<НеЗамещать>true</НеЗамещать>
				<НеВыгружатьОбъектыСвойствПоСсылкам>true</НеВыгружатьОбъектыСвойствПоСсылкам>
				<НеСоздаватьЕслиНеНайден>true</НеСоздаватьЕслиНеНайден>
				<ИспользоватьБыстрыйПоискПриЗагрузке>true</ИспользоватьБыстрыйПоискПриЗагрузке>
				<Источник>СправочникСсылка.Валюты</Источник>
				<Приемник>СправочникСсылка.Валюты</Приемник>
				<Свойства>
					<Свойство Поиск="true">
						<Код>1</Код>
						<Наименование>--&gt; GUID_Поиска</Наименование>
						<Порядок>50</Порядок>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="" Вид=""/>
						<ИмяПараметраДляПередачи>GUID_Поиска</ИмяПараметраДляПередачи>
						<ПередВыгрузкой>Значение = ЗначениеВСтрокуВнутр(Источник.УникальныйИдентификатор());</ПередВыгрузкой>
					</Свойство>
					<Свойство Поиск="true">
						<Код>3</Код>
						<Наименование>Код --&gt; Код</Наименование>
						<Порядок>100</Порядок>
						<Источник Имя="Код" Вид="Свойство" Тип="Строка"/>
						<Приемник Имя="Код" Вид="Свойство" Тип="Строка"/>
					</Свойство>
				</Свойства>
				<Значения/>
			</Правило>
			<Правило>
				<Код>СтатьиЗатрат</Код>
				<Наименование>Справочник: Статьи доходов и расходов</Наименование>
				<Порядок>450</Порядок>
				<ПоследовательностьПолейПоиска>Параметры.ПараметрыАлгоритмов.Вставить("ВидОбъекта","СтатьиЗатрат");
Параметры.ПараметрыАлгоритмов.Вставить("ТипОбъектаИсточника","СправочникСсылка.СтатьиДоходовИРасходов");

Выполнить(Алгоритмы.ПолучитьСоответствиеОбъектов);
СтрокаИменСвойствПоиска="";
ПрекратитьПоиск = Истина;


</ПоследовательностьПолейПоиска>
				<НеЗамещать>true</НеЗамещать>
				<НеСоздаватьЕслиНеНайден>true</НеСоздаватьЕслиНеНайден>
				<ИспользоватьБыстрыйПоискПриЗагрузке>true</ИспользоватьБыстрыйПоискПриЗагрузке>
				<Источник>СправочникСсылка.СтатьиДоходовИРасходов</Источник>
				<Приемник>СправочникСсылка.СтатьиЗатрат</Приемник>
				<Свойства>
					<Свойство Поиск="true">
						<Код>1</Код>
						<Наименование>--&gt; GUID_Поиска</Наименование>
						<Порядок>50</Порядок>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="" Вид=""/>
						<ИмяПараметраДляПередачи>GUID_Поиска</ИмяПараметраДляПередачи>
						<ПередВыгрузкой>Значение = ЗначениеВСтрокуВнутр(Источник.УникальныйИдентификатор());</ПередВыгрузкой>
					</Свойство>
					<Свойство Отключить="true">
						<Код>2</Код>
						<Наименование>--&gt; Код_Связи</Наименование>
						<Порядок>100</Порядок>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="" Вид=""/>
						<ИмяПараметраДляПередачи>Код_Связи</ИмяПараметраДляПередачи>
						<ПередВыгрузкой>нСтрока = Параметры.КешТаблицаКодовСвязи.Найти(Источник,"Объект");
Если нСтрока = Неопределено Тогда
Иначе
	Значение = нСтрока.Значение;
КонецЕсли;

</ПередВыгрузкой>
					</Свойство>
				</Свойства>
				<Значения/>
			</Правило>
			<Правило>
				<Код>ТиповыеОперации</Код>
				<Наименование>: </Наименование>
				<Порядок>500</Порядок>
				<НеЗамещать>true</НеЗамещать>
				<НеСоздаватьЕслиНеНайден>true</НеСоздаватьЕслиНеНайден>
				<ИспользоватьБыстрыйПоискПриЗагрузке>true</ИспользоватьБыстрыйПоискПриЗагрузке>
				<Приемник>СправочникСсылка.ТиповыеОперации</Приемник>
				<Свойства>
					<Свойство Поиск="true" Обязательное="true">
						<Код>1</Код>
						<Наименование>--&gt; ЭтоГруппа</Наименование>
						<Порядок>50</Порядок>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="ЭтоГруппа" Вид="Свойство" Тип="Булево"/>
						<ПередВыгрузкой>Значение = Ложь;</ПередВыгрузкой>
					</Свойство>
					<Свойство Поиск="true">
						<Код>2</Код>
						<Наименование>--&gt; Код</Наименование>
						<Порядок>100</Порядок>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="Код" Вид="Свойство" Тип="Строка"/>
					</Свойство>
				</Свойства>
				<Значения/>
			</Правило>
			<Правило>
				<Код>НалоговыеНазначенияАктивовИЗатрат</Код>
				<Наименование>: </Наименование>
				<Порядок>500</Порядок>
				<НеСоздаватьЕслиНеНайден>true</НеСоздаватьЕслиНеНайден>
				<ИспользоватьБыстрыйПоискПриЗагрузке>true</ИспользоватьБыстрыйПоискПриЗагрузке>
				<Приемник>СправочникСсылка.НалоговыеНазначенияАктивовИЗатрат</Приемник>
				<Свойства>
					<Свойство Поиск="true">
						<Код>1</Код>
						<Наименование>--&gt; Код</Наименование>
						<Порядок>50</Порядок>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="Код" Вид="Свойство" Тип="Строка"/>
					</Свойство>
				</Свойства>
				<Значения/>
			</Правило>
			<Правило>
				<Код>Налоги</Код>
				<Наименование>: </Наименование>
				<Порядок>500</Порядок>
				<НеСоздаватьЕслиНеНайден>true</НеСоздаватьЕслиНеНайден>
				<Приемник>СправочникСсылка.Налоги</Приемник>
				<Свойства>
					<Свойство Поиск="true" Обязательное="true">
						<Код>1</Код>
						<Наименование>--&gt; ЭтоГруппа</Наименование>
						<Порядок>50</Порядок>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="ЭтоГруппа" Вид="Свойство" Тип="Булево"/>
						<ПередВыгрузкой>Значение = Ложь;</ПередВыгрузкой>
					</Свойство>
					<Свойство Поиск="true">
						<Код>2</Код>
						<Наименование>--&gt; Код</Наименование>
						<Порядок>100</Порядок>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="Код" Вид="Свойство" Тип="Строка"/>
					</Свойство>
				</Свойства>
				<Значения/>
			</Правило>
			<Правило>
				<Код>ОбособленныеПодразделенияОрганизаций</Код>
				<Наименование>Справочник: Кассы ККМ</Наименование>
				<Порядок>550</Порядок>
				<ПослеЗагрузки>ЗаписатьОбъект =  ПараметрыОбъекта.Получить("ЗаписатьОбъект");
Если ЗаписатьОбъект = Неопределено Тогда
	ЗаписатьОбъект = Ложь;
	ОбъектМодифицирован = Ложь;
КонецЕсли;

Если ЗаписатьОбъект Тогда		
	Выполнить(Алгоритмы.ЗаписатьСоответствиеОбъектов);
КонецЕсли;
</ПослеЗагрузки>
				<ПоследовательностьПолейПоиска>Если НомерВариантаПоиска = 1 тогда
	Параметры.ПараметрыАлгоритмов.Вставить("ВидОбъекта","ОбособленныеПодразделенияОрганизаций");
	Параметры.ПараметрыАлгоритмов.Вставить("ТипОбъектаИсточника","СправочникСсылка.КассыККМ");
	СтрокаИменСвойствПоиска = "ПоискАлгоритмом";

	Выполнить(Алгоритмы.ПолучитьСоответствиеОбъектов);
ИначеЕсли НомерВариантаПоиска = 2 тогда
	СтрокаИменСвойствПоиска = "Код,НаименованиеПолное";
ИначеЕсли НомерВариантаПоиска = 3 тогда
	СтрокаИменСвойствПоиска = "НаименованиеПолное";
Иначе
	СтрокаИменСвойствПоиска="";
	ПрекратитьПоиск = Истина;
КонецЕсли</ПоследовательностьПолейПоиска>
				<НеСоздаватьЕслиНеНайден>true</НеСоздаватьЕслиНеНайден>
				<ИспользоватьБыстрыйПоискПриЗагрузке>true</ИспользоватьБыстрыйПоискПриЗагрузке>
				<Источник>СправочникСсылка.КассыККМ</Источник>
				<Приемник>СправочникСсылка.ОбособленныеПодразделенияОрганизаций</Приемник>
				<Свойства>
					<Свойство Поиск="true">
						<Код>1</Код>
						<Наименование>--&gt; GUID_Поиска</Наименование>
						<Порядок>50</Порядок>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="" Вид=""/>
						<ИмяПараметраДляПередачи>GUID_Поиска</ИмяПараметраДляПередачи>
						<ПередВыгрузкой>Значение = ЗначениеВСтрокуВнутр(Источник.УникальныйИдентификатор());</ПередВыгрузкой>
					</Свойство>
					<Свойство Поиск="true">
						<Код>3</Код>
						<Наименование>Код --&gt; Код</Наименование>
						<Порядок>100</Порядок>
						<Источник Имя="Код" Вид="Свойство" Тип="Строка"/>
						<Приемник Имя="Код" Вид="Свойство" Тип="Строка"/>
						<ПриводитьКДлине>9</ПриводитьКДлине>
					</Свойство>
					<Свойство Поиск="true">
						<Код>2</Код>
						<Наименование>Наименование --&gt; НаименованиеПолное</Наименование>
						<Порядок>150</Порядок>
						<Источник Имя="Наименование" Вид="Свойство" Тип="Строка"/>
						<Приемник Имя="НаименованиеПолное" Вид="Реквизит" Тип="Строка"/>
					</Свойство>
				</Свойства>
				<Значения/>
			</Правило>
			<Правило>
				<Код>СтатьиДоходов</Код>
				<Наименование>: </Наименование>
				<Порядок>550</Порядок>
				<НеСоздаватьЕслиНеНайден>true</НеСоздаватьЕслиНеНайден>
				<Приемник>СправочникСсылка.СтатьиДоходов</Приемник>
				<Свойства>
					<Свойство Поиск="true">
						<Код>1</Код>
						<Наименование>--&gt; Код</Наименование>
						<Порядок>50</Порядок>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="Код" Вид="Свойство" Тип="Строка"/>
					</Свойство>
					<Свойство Поиск="true" Обязательное="true">
						<Код>2</Код>
						<Наименование>--&gt; ЭтоГруппа</Наименование>
						<Порядок>100</Порядок>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="ЭтоГруппа" Вид="Свойство" Тип="Булево"/>
						<ПередВыгрузкой>Значение = Ложь;</ПередВыгрузкой>
					</Свойство>
				</Свойства>
				<Значения/>
			</Правило>
			<Группа>
				<Код>Вспомогательные_Правила</Код>
				<Наименование>Вспомогательные_Правила                           </Наименование>
				<Порядок>600</Порядок>
				<Правило>
					<Код>Склады_В_Подразделения</Код>
					<Наименование>Справочник: Склады компании</Наименование>
					<Порядок>50</Порядок>
					<ПослеЗагрузки>ЗаписатьОбъект =  ПараметрыОбъекта.Получить("ЗаписатьОбъект");
Если ЗаписатьОбъект = Неопределено Тогда
	ЗаписатьОбъект = Ложь;
КонецЕсли;

Если ОбъектНайден И ЗаписатьОбъект Тогда		
	Выполнить(Алгоритмы.ЗаписатьСоответствиеОбъектов);
КонецЕсли;
</ПослеЗагрузки>
					<ПоследовательностьПолейПоиска>Если НомерВариантаПоиска = 1 тогда
	Параметры.ПараметрыАлгоритмов.Вставить("ВидОбъекта","Подразделения");
	Параметры.ПараметрыАлгоритмов.Вставить("ТипОбъектаИсточника","СправочникСсылка.СкладыКомпании");
	СтрокаИменСвойствПоиска = "ПоискАлгоритмом";

	Выполнить(Алгоритмы.ПолучитьСоответствиеОбъектов);
ИначеЕсли НомерВариантаПоиска = 2 тогда
	СтрокаИменСвойствПоиска = "Код";
Иначе
	СтрокаИменСвойствПоиска="";
	ПрекратитьПоиск = Истина;
КонецЕсли</ПоследовательностьПолейПоиска>
					<НеЗамещать>true</НеЗамещать>
					<НеСоздаватьЕслиНеНайден>true</НеСоздаватьЕслиНеНайден>
					<Источник>СправочникСсылка.СкладыКомпании</Источник>
					<Приемник>СправочникСсылка.Подразделения</Приемник>
					<Свойства>
						<Свойство Поиск="true">
							<Код>1</Код>
							<Наименование>--&gt; GUID_Поиска</Наименование>
							<Порядок>50</Порядок>
							<Источник Имя="" Вид=""/>
							<Приемник Имя="" Вид=""/>
							<ИмяПараметраДляПередачи>GUID_Поиска</ИмяПараметраДляПередачи>
							<ПередВыгрузкой>Значение = ЗначениеВСтрокуВнутр(Источник.УникальныйИдентификатор())+"СкладПодразделение";</ПередВыгрузкой>
						</Свойство>
						<Свойство Поиск="true">
							<Код>3</Код>
							<Наименование>Код --&gt; Код</Наименование>
							<Порядок>100</Порядок>
							<Источник Имя="Код" Вид="Свойство" Тип="Строка"/>
							<Приемник Имя="Код" Вид="Свойство" Тип="Строка"/>
							<ПриводитьКДлине>9</ПриводитьКДлине>
						</Свойство>
						<Свойство>
							<Код>4</Код>
							<Наименование>Наименование --&gt; Наименование</Наименование>
							<Порядок>150</Порядок>
							<Источник Имя="Наименование" Вид="Свойство" Тип="Строка"/>
							<Приемник Имя="Наименование" Вид="Свойство" Тип="Строка"/>
						</Свойство>
					</Свойства>
					<Значения/>
				</Правило>
			</Группа>
			<Правило>
				<Код>НазначенияНаличныхДенежныхСредств</Код>
				<Наименование>: </Наименование>
				<Порядок>650</Порядок>
				<Приемник>СправочникСсылка.НазначенияНаличныхДенежныхСредств</Приемник>
				<Свойства>
					<Свойство Поиск="true">
						<Код>1</Код>
						<Наименование>--&gt; Код</Наименование>
						<Порядок>50</Порядок>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="Код" Вид="Свойство" Тип="Строка"/>
					</Свойство>
				</Свойства>
				<Значения/>
			</Правило>
			<Правило>
				<Код>БанковскиеСчетаКод</Код>
				<Наименование>: </Наименование>
				<Порядок>700</Порядок>
				<ПоследовательностьПолейПоиска> СтрокаИменСвойствПоиска = "Код,Владелец";</ПоследовательностьПолейПоиска>
				<НеЗамещать>true</НеЗамещать>
				<НеСоздаватьЕслиНеНайден>true</НеСоздаватьЕслиНеНайден>
				<Приемник>СправочникСсылка.БанковскиеСчета</Приемник>
				<Свойства>
					<Свойство Поиск="true">
						<Код>1</Код>
						<Наименование>--&gt; Код</Наименование>
						<Порядок>50</Порядок>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="Код" Вид="Свойство" Тип="Строка"/>
					</Свойство>
					<Свойство Поиск="true">
						<Код>2</Код>
						<Наименование>--&gt; Владелец</Наименование>
						<Порядок>100</Порядок>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="Владелец" Вид="Свойство"/>
					</Свойство>
				</Свойства>
				<Значения/>
			</Правило>
			<Правило>
				<Код>ОбособленныеПодразделенияКассаКомпании</Код>
				<Наименование>: </Наименование>
				<Порядок>750</Порядок>
				<НеЗамещать>true</НеЗамещать>
				<СинхронизироватьПоИдентификатору>true</СинхронизироватьПоИдентификатору>
				<Источник>СправочникСсылка.КассыКомпании</Источник>
				<Приемник>СправочникСсылка.ОбособленныеПодразделенияОрганизаций</Приемник>
				<Свойства>
					<Свойство Поиск="true">
						<Код>3</Код>
						<Наименование>Код --&gt; Код</Наименование>
						<Порядок>50</Порядок>
						<Источник Имя="Код" Вид="Свойство" Тип="Строка"/>
						<Приемник Имя="Код" Вид="Свойство" Тип="Строка"/>
					</Свойство>
					<Свойство Поиск="true">
						<Код>2</Код>
						<Наименование>Организация --&gt; Владелец</Наименование>
						<Порядок>100</Порядок>
						<Источник Имя="Организация" Вид="Реквизит" Тип="СправочникСсылка.Организации"/>
						<Приемник Имя="Владелец" Вид="Свойство" Тип="СправочникСсылка.Организации"/>
						<КодПравилаКонвертации>Организации                                       </КодПравилаКонвертации>
					</Свойство>
					<Свойство>
						<Код>4</Код>
						<Наименование>Наименование --&gt; Наименование</Наименование>
						<Порядок>150</Порядок>
						<Источник Имя="Наименование" Вид="Свойство" Тип="Строка"/>
						<Приемник Имя="Наименование" Вид="Свойство" Тип="Строка"/>
					</Свойство>
					<Свойство>
						<Код>1</Код>
						<Наименование>Наименование --&gt; НаименованиеПолное</Наименование>
						<Порядок>200</Порядок>
						<Источник Имя="Наименование" Вид="Свойство" Тип="Строка"/>
						<Приемник Имя="НаименованиеПолное" Вид="Реквизит" Тип="Строка"/>
					</Свойство>
					<Свойство>
						<Код>5</Код>
						<Наименование>ПометкаУдаления --&gt; ПометкаУдаления</Наименование>
						<Порядок>250</Порядок>
						<Источник Имя="ПометкаУдаления" Вид="Свойство" Тип="Булево"/>
						<Приемник Имя="ПометкаУдаления" Вид="Свойство" Тип="Булево"/>
					</Свойство>
				</Свойства>
				<Значения/>
			</Правило>
			<Правило>
				<Код>ВидыКонтактнойИнформации</Код>
				<Наименование>Справочник: Виды контактной информации</Наименование>
				<Порядок>800</Порядок>
				<Источник>СправочникСсылка.ВидыКонтактнойИнформации</Источник>
				<Приемник>СправочникСсылка.ВидыКонтактнойИнформации</Приемник>
				<Свойства>
					<Свойство>
						<Код>1</Код>
						<Наименование>ИмяПредопределенногоВида --&gt; ИмяВида</Наименование>
						<Порядок>50</Порядок>
						<Источник Имя="ИмяПредопределенногоВида" Вид="Реквизит" Тип="Строка"/>
						<Приемник Имя="" Вид=""/>
						<ИмяПараметраДляПередачи>ИмяВида</ИмяПараметраДляПередачи>
					</Свойство>
					<Свойство Поиск="true">
						<Код>2</Код>
						<Наименование>--&gt; Код</Наименование>
						<Порядок>100</Порядок>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="Код" Вид="Свойство" Тип="Строка"/>
					</Свойство>
				</Свойства>
				<Значения/>
			</Правило>
		</Группа>
		<Группа>
			<Код>Справочники</Код>
			<Наименование>Справочники                                       </Наименование>
			<Порядок>100</Порядок>
			<Группа>
				<Код>{Склады}</Код>
				<Наименование>Склады                                            </Наименование>
				<Порядок>50</Порядок>
				<Правило>
					<Код>Склады_Группа</Код>
					<Наименование>Справочник: Склады компании</Наименование>
					<Порядок>50</Порядок>
					<ПередВыгрузкой>Отказ = НЕ Источник.ЭтоГруппа;
</ПередВыгрузкой>
					<ПослеЗагрузки>//Если Объект.ЭтоНовый() Тогда 
//	GUID_Поиска = ПараметрыОбъекта.Получить("GUID_Поиска");	
//	ГУИД = ЗначениеИзСтрокиВнутр(GUID_Поиска);			
//	Если ТипЗнч(ГУИД) = Тип("УникальныйИдентификатор") Тогда 
//		ВидОбъекта  = Параметры.ПараметрыАлгоритмов["ВидОбъекта"];		
//		нСсылка = Справочники[ВидОбъекта].ПолучитьСсылку(ГУИД);				
//		
//		Если Не ОбщегоНазначения.СсылкаСуществует(нСсылка) Тогда 
//			Объект.УстановитьСсылкуНового(нСсылка);
//		КонецЕсли;
//	КонецЕсли;
//КонецЕсли;

ЗаписатьОбъект = ПараметрыОбъекта.Получить("ЗаписатьОбъект");
Если ЗаписатьОбъект = Неопределено Тогда
	ЗаписатьОбъект = Ложь;
КонецЕсли;

Если ЗаписатьОбъект Тогда		
	Выполнить(Алгоритмы.ЗаписатьСоответствиеОбъектов);
КонецЕсли;

</ПослеЗагрузки>
					<ПоследовательностьПолейПоиска>Если НомерВариантаПоиска = 1 тогда
	Параметры.ПараметрыАлгоритмов.Вставить("ВидОбъекта","Склады");
	Параметры.ПараметрыАлгоритмов.Вставить("ТипОбъектаИсточника", "СправочникСсылка.СкладыКомпании");
	СтрокаИменСвойствПоиска = "ПоискАлгоритмом";

	Выполнить(Алгоритмы.ПолучитьСоответствиеОбъектов);
ИначеЕсли НомерВариантаПоиска = 2 тогда
	СтрокаИменСвойствПоиска = "Код, ЭтоГруппа";
Иначе
	СтрокаИменСвойствПоиска="";
	ПрекратитьПоиск = Истина;
КонецЕсли</ПоследовательностьПолейПоиска>
					<НеЗамещать>true</НеЗамещать>
					<СинхронизироватьПоИдентификатору>true</СинхронизироватьПоИдентификатору>
					<ПродолжитьПоискПоПолямПоискаЕслиПоИдентификаторуНеНашли>true</ПродолжитьПоискПоПолямПоискаЕслиПоИдентификаторуНеНашли>
					<Источник>СправочникСсылка.СкладыКомпании</Источник>
					<Приемник>СправочникСсылка.Склады</Приемник>
					<Свойства>
						<Свойство Поиск="true">
							<Код>1</Код>
							<Наименование>--&gt; GUID_Поиска</Наименование>
							<Порядок>50</Порядок>
							<Источник Имя="" Вид=""/>
							<Приемник Имя="" Вид=""/>
							<ИмяПараметраДляПередачи>GUID_Поиска</ИмяПараметраДляПередачи>
							<ПередВыгрузкой>Значение = ЗначениеВСтрокуВнутр(Источник.УникальныйИдентификатор());</ПередВыгрузкой>
						</Свойство>
						<Свойство Поиск="true" Обязательное="true">
							<Код>3</Код>
							<Наименование>ЭтоГруппа --&gt; ЭтоГруппа</Наименование>
							<Порядок>100</Порядок>
							<Источник Имя="ЭтоГруппа" Вид="Свойство" Тип="Булево"/>
							<Приемник Имя="ЭтоГруппа" Вид="Свойство" Тип="Булево"/>
						</Свойство>
						<Свойство Поиск="true">
							<Код>4</Код>
							<Наименование>Наименование --&gt; Наименование</Наименование>
							<Порядок>150</Порядок>
							<Источник Имя="Наименование" Вид="Свойство" Тип="Строка"/>
							<Приемник Имя="Наименование" Вид="Свойство" Тип="Строка"/>
						</Свойство>
						<Свойство Поиск="true">
							<Код>5</Код>
							<Наименование>Родитель --&gt; Родитель</Наименование>
							<Порядок>200</Порядок>
							<Источник Имя="Родитель" Вид="Свойство" Тип="СправочникСсылка.СкладыКомпании"/>
							<Приемник Имя="Родитель" Вид="Свойство" Тип="СправочникСсылка.Склады"/>
							<КодПравилаКонвертации>Склады_Группа                                     </КодПравилаКонвертации>
						</Свойство>
						<Свойство Отключить="true">
							<Код>2</Код>
							<Наименование>--&gt; Код_Связи</Наименование>
							<Порядок>300</Порядок>
							<Источник Имя="" Вид=""/>
							<Приемник Имя="" Вид=""/>
							<ИмяПараметраДляПередачи>Код_Связи</ИмяПараметраДляПередачи>
							<ПередВыгрузкой>нСтрока = Параметры.КешТаблицаКодовСвязи.Найти(Источник,"Объект");
Если нСтрока&lt;&gt; Неопределено Тогда
	Значение = нСтрока.Значение;
КонецЕсли;
</ПередВыгрузкой>
						</Свойство>
					</Свойства>
					<Значения/>
				</Правило>
				<Правило>
					<Код>Склады</Код>
					<Наименование>Справочник: Склады компании</Наименование>
					<Порядок>100</Порядок>
					<ПередВыгрузкой>Отказ = Источник.ЭтоГруппа;
</ПередВыгрузкой>
					<ПослеЗагрузки>//Если Объект.ЭтоНовый() Тогда 
//	GUID_Поиска = ПараметрыОбъекта.Получить("GUID_Поиска");	
//	ГУИД = ЗначениеИзСтрокиВнутр(GUID_Поиска);			
//	Если ТипЗнч(ГУИД) = Тип("УникальныйИдентификатор") Тогда 
//		ВидОбъекта  = Параметры.ПараметрыАлгоритмов["ВидОбъекта"];		
//		нСсылка = Справочники[ВидОбъекта].ПолучитьСсылку(ГУИД);				
//		
//		Если Не ОбщегоНазначения.СсылкаСуществует(нСсылка) Тогда 
//			Объект.УстановитьСсылкуНового(нСсылка);
//		КонецЕсли;
//	КонецЕсли;
//КонецЕсли;

Если Не Отказ Тогда
	
	ЗаписатьОбъект = ПараметрыОбъекта.Получить("ЗаписатьОбъект");
	Если ЗаписатьОбъект = Неопределено Тогда
		ЗаписатьОбъект = Ложь;
	КонецЕсли;
	
	ОбъектМодифицирован = Ложь;
	
	Если ЗаписатьОбъект Тогда		
		Выполнить(Алгоритмы.ЗаписатьСоответствиеОбъектов);
	КонецЕсли;
	
КонецЕсли;</ПослеЗагрузки>
					<ПоследовательностьПолейПоиска>Если НомерВариантаПоиска = 1 тогда
	Параметры.ПараметрыАлгоритмов.Вставить("ВидОбъекта","Склады");
	Параметры.ПараметрыАлгоритмов.Вставить("ТипОбъектаИсточника", "СправочникСсылка.СкладыКомпании");
	СтрокаИменСвойствПоиска = "ПоискАлгоритмом";

	Выполнить(Алгоритмы.ПолучитьСоответствиеОбъектов);
ИначеЕсли НомерВариантаПоиска = 2 тогда
	СтрокаИменСвойствПоиска = "Код, ЭтоГруппа";
Иначе
	СтрокаИменСвойствПоиска="";
	ПрекратитьПоиск = Истина;
КонецЕсли</ПоследовательностьПолейПоиска>
					<НеЗамещать>true</НеЗамещать>
					<СинхронизироватьПоИдентификатору>true</СинхронизироватьПоИдентификатору>
					<ПродолжитьПоискПоПолямПоискаЕслиПоИдентификаторуНеНашли>true</ПродолжитьПоискПоПолямПоискаЕслиПоИдентификаторуНеНашли>
					<ИспользоватьБыстрыйПоискПриЗагрузке>true</ИспользоватьБыстрыйПоискПриЗагрузке>
					<Источник>СправочникСсылка.СкладыКомпании</Источник>
					<Приемник>СправочникСсылка.Склады</Приемник>
					<Свойства>
						<Свойство Поиск="true">
							<Код>1</Код>
							<Наименование>--&gt; GUID_Поиска</Наименование>
							<Порядок>50</Порядок>
							<Источник Имя="" Вид=""/>
							<Приемник Имя="" Вид=""/>
							<ИмяПараметраДляПередачи>GUID_Поиска</ИмяПараметраДляПередачи>
							<ПередВыгрузкой>Значение = ЗначениеВСтрокуВнутр(Источник.УникальныйИдентификатор());</ПередВыгрузкой>
						</Свойство>
						<Свойство Поиск="true">
							<Код>9</Код>
							<Наименование>Код --&gt; Код</Наименование>
							<Порядок>100</Порядок>
							<Источник Имя="Код" Вид="Свойство" Тип="Строка"/>
							<Приемник Имя="Код" Вид="Свойство" Тип="Строка"/>
							<ПриводитьКДлине>9</ПриводитьКДлине>
						</Свойство>
						<Свойство Поиск="true" Обязательное="true">
							<Код>3</Код>
							<Наименование>ЭтоГруппа --&gt; ЭтоГруппа</Наименование>
							<Порядок>150</Порядок>
							<Источник Имя="ЭтоГруппа" Вид="Свойство" Тип="Булево"/>
							<Приемник Имя="ЭтоГруппа" Вид="Свойство" Тип="Булево"/>
						</Свойство>
						<Свойство Поиск="true">
							<Код>4</Код>
							<Наименование>Наименование --&gt; Наименование</Наименование>
							<Порядок>200</Порядок>
							<Источник Имя="Наименование" Вид="Свойство" Тип="Строка"/>
							<Приемник Имя="Наименование" Вид="Свойство" Тип="Строка"/>
						</Свойство>
						<Свойство>
							<Код>5</Код>
							<Наименование>Родитель --&gt; Родитель</Наименование>
							<Порядок>250</Порядок>
							<Источник Имя="Родитель" Вид="Свойство" Тип="СправочникСсылка.СкладыКомпании"/>
							<Приемник Имя="Родитель" Вид="Свойство" Тип="СправочникСсылка.Склады"/>
							<КодПравилаКонвертации>Склады_Группа                                     </КодПравилаКонвертации>
						</Свойство>
						<Свойство>
							<Код>6</Код>
							<Наименование>--&gt; ВидСклада</Наименование>
							<Порядок>300</Порядок>
							<Источник Имя="" Вид=""/>
							<Приемник Имя="ВидСклада" Вид="Реквизит" Тип="ПеречислениеСсылка.ВидыСкладов"/>
							<ПриВыгрузке>Если Источник.Розничный Тогда
	Значение = "Розничный";
Иначе
	Значение = "Оптовый";
КонецЕсли;</ПриВыгрузке>
						</Свойство>
						<Свойство>
							<Код>10</Код>
							<Наименование>ПометкаУдаления --&gt; ПометкаУдаления</Наименование>
							<Порядок>350</Порядок>
							<Источник Имя="ПометкаУдаления" Вид="Свойство" Тип="Булево"/>
							<Приемник Имя="ПометкаУдаления" Вид="Свойство" Тип="Булево"/>
						</Свойство>
						<Свойство>
							<Код>7</Код>
							<Наименование>Комментарий --&gt; Комментарий</Наименование>
							<Порядок>400</Порядок>
							<Источник Имя="Комментарий" Вид="Реквизит" Тип="Строка"/>
							<Приемник Имя="Комментарий" Вид="Реквизит" Тип="Строка"/>
						</Свойство>
					</Свойства>
					<Значения/>
				</Правило>
			</Группа>
			<Правило>
				<Код>ДоговорыКонтрагентов</Код>
				<Наименование>Справочник: ДоговорыКонтрагентов</Наименование>
				<Порядок>100</Порядок>
				<ПослеЗагрузки>//Если Объект.ЭтоНовый() Тогда 
//	GUID_Поиска = ПараметрыОбъекта.Получить("GUID_Поиска");	
//	ГУИД = ЗначениеИзСтрокиВнутр(GUID_Поиска);			
//	Если ТипЗнч(ГУИД) = Тип("УникальныйИдентификатор") Тогда 
//		ВидОбъекта  = Параметры.ПараметрыАлгоритмов["ВидОбъекта"];		
//		нСсылка = Справочники[ВидОбъекта].ПолучитьСсылку(ГУИД);				
//		
//		Если Не ОбщегоНазначения.СсылкаСуществует(нСсылка) Тогда 
//			Объект.УстановитьСсылкуНового(нСсылка);
//		КонецЕсли;
//	КонецЕсли;
//КонецЕсли;

ДоговорАренды		= ПараметрыОбъекта.Получить("ДоговорАренды");
ДоговорМаркетинга	= ПараметрыОбъекта.Получить("ДоговорМаркетинга");

Если ДоговорМаркетинга Тогда
	Объект.ВедениеВзаиморасчетов = Перечисления.ВедениеВзаиморасчетовПоДоговорам.ПоРасчетнымДокументам;
	Объект.ВидВзаиморасчетаДоговора = Перечисления.ВидыВзаиморасчетовДоговора.Маркетинг;
ИначеЕсли ДоговорАренды Тогда
	Объект.ВедениеВзаиморасчетов = Перечисления.ВедениеВзаиморасчетовПоДоговорам.ПоРасчетнымДокументам;
	Объект.ВидВзаиморасчетаДоговора = Перечисления.ВидыВзаиморасчетовДоговора.Аренда;
Иначе	
	Объект.ВедениеВзаиморасчетов = Перечисления.ВедениеВзаиморасчетовПоДоговорам.ПоДоговоруВЦелом;
	Объект.ВидВзаиморасчетаДоговора = Перечисления.ВидыВзаиморасчетовДоговора.Прочие;
КонецЕсли;

Если Объект.ЭтоНовый() Тогда
	Объект.СложныйНалоговыйУчет		= Истина;
	Объект.ВедениеВзаиморасчетовНУ	= Перечисления.ВедениеВзаиморасчетовПоДоговорам.ПоДоговоруВЦелом;
КонецЕсли;
Объект.СхемаНалоговогоУчета			= Справочники.СхемыНалоговогоУчетаПоДоговорамКонтрагентов.ПоПервомуСобытию;
Объект.СхемаНалоговогоУчетаПоТаре	= Справочники.СхемыНалоговогоУчетаПоДоговорамКонтрагентов.ПоПервомуСобытию;

ЗаписатьОбъект = ПараметрыОбъекта.Получить("ЗаписатьОбъект");
Если ЗаписатьОбъект = Неопределено Тогда
	ЗаписатьОбъект = Ложь;
	ОбъектМодифицирован = Ложь;
КонецЕсли;

Если ЗаписатьОбъект Тогда		
	Выполнить(Алгоритмы.ЗаписатьСоответствиеОбъектов);
КонецЕсли;

</ПослеЗагрузки>
				<СинхронизироватьПоИдентификатору>true</СинхронизироватьПоИдентификатору>
				<ИспользоватьБыстрыйПоискПриЗагрузке>true</ИспользоватьБыстрыйПоискПриЗагрузке>
				<Источник>СправочникСсылка.ДоговорыКонтрагентов</Источник>
				<Приемник>СправочникСсылка.ДоговорыКонтрагентов</Приемник>
				<Свойства>
					<Свойство Поиск="true">
						<Код>1</Код>
						<Наименование>--&gt; GUID_Поиска</Наименование>
						<Порядок>50</Порядок>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="" Вид=""/>
						<ИмяПараметраДляПередачи>GUID_Поиска</ИмяПараметраДляПередачи>
						<ПередВыгрузкой>Значение = ЗначениеВСтрокуВнутр(Источник.УникальныйИдентификатор());</ПередВыгрузкой>
					</Свойство>
					<Свойство Поиск="true">
						<Код>12</Код>
						<Наименование>Код --&gt; Код</Наименование>
						<Порядок>100</Порядок>
						<Источник Имя="Код" Вид="Свойство" Тип="Строка"/>
						<Приемник Имя="Код" Вид="Свойство" Тип="Строка"/>
					</Свойство>
					<Свойство Поиск="true">
						<Код>13</Код>
						<Наименование>Контрагент --&gt; Владелец</Наименование>
						<Порядок>150</Порядок>
						<Источник Имя="Контрагент" Вид="Реквизит" Тип="СправочникСсылка.Контрагенты"/>
						<Приемник Имя="Владелец" Вид="Свойство" Тип="СправочникСсылка.Контрагенты"/>
						<КодПравилаКонвертации>Контрагенты                                       </КодПравилаКонвертации>
					</Свойство>
					<Свойство Поиск="true">
						<Код>5</Код>
						<Наименование>Номер --&gt; Номер</Наименование>
						<Порядок>200</Порядок>
						<Источник Имя="Номер" Вид="Реквизит" Тип="Строка"/>
						<Приемник Имя="Номер" Вид="Реквизит" Тип="Строка"/>
					</Свойство>
					<Свойство Поиск="true">
						<Код>4</Код>
						<Наименование>ВидДоговора --&gt; ВидДоговора</Наименование>
						<Порядок>250</Порядок>
						<Источник Имя="ВидДоговора" Вид="Реквизит" Тип="СправочникСсылка.ВидыДоговоров"/>
						<Приемник Имя="ВидДоговора" Вид="Реквизит" Тип="ПеречислениеСсылка.ВидыДоговоровКонтрагентов"/>
						<КодПравилаКонвертации>ВидыДоговоровКонтрагентов                         </КодПравилаКонвертации>
						<ПередВыгрузкой>Значение = Источник.ВидДоговора.ВидДоговора;</ПередВыгрузкой>
					</Свойство>
					<Свойство Поиск="true">
						<Код>6</Код>
						<Наименование>ДатаНачалаДействия --&gt; Дата</Наименование>
						<Порядок>300</Порядок>
						<Источник Имя="ДатаНачалаДействия" Вид="Реквизит" Тип="Дата"/>
						<Приемник Имя="Дата" Вид="Реквизит" Тип="Дата"/>
						<ПередВыгрузкой>Значение = НачалоДня(Источник.ДатаНачалаДействия);</ПередВыгрузкой>
					</Свойство>
					<Свойство>
						<Код>2</Код>
						<Наименование>Наименование --&gt; Наименование</Наименование>
						<Порядок>350</Порядок>
						<Источник Имя="Наименование" Вид="Свойство" Тип="Строка"/>
						<Приемник Имя="Наименование" Вид="Свойство" Тип="Строка"/>
					</Свойство>
					<Свойство Поиск="true">
						<Код>7</Код>
						<Наименование>Организация --&gt; Организация</Наименование>
						<Порядок>400</Порядок>
						<Источник Имя="Организация" Вид="Реквизит" Тип="СправочникСсылка.Организации"/>
						<Приемник Имя="Организация" Вид="Реквизит" Тип="СправочникСсылка.Организации"/>
						<КодПравилаКонвертации>Организации                                       </КодПравилаКонвертации>
					</Свойство>
					<Свойство>
						<Код>8</Код>
						<Наименование>ВалютаВзаиморасчетов --&gt; ВалютаВзаиморасчетов</Наименование>
						<Порядок>450</Порядок>
						<Источник Имя="ВалютаВзаиморасчетов" Вид="Реквизит" Тип="СправочникСсылка.Валюты"/>
						<Приемник Имя="ВалютаВзаиморасчетов" Вид="Реквизит" Тип="СправочникСсылка.Валюты"/>
						<КодПравилаКонвертации>Валюты                                            </КодПравилаКонвертации>
					</Свойство>
					<Свойство>
						<Код>10</Код>
						<Наименование>--&gt; НаименованиеДляПечати</Наименование>
						<Порядок>500</Порядок>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="НаименованиеДляПечати" Вид="Реквизит" Тип="Строка"/>
						<ПередВыгрузкой>Значение  = Строка(Источник.ВидДоговора) + " №" + Источник.Номер + " від "+Формат(Источник.ДатаНачалаДействия, "ДФ=dd.MM.yy") + "..";</ПередВыгрузкой>
					</Свойство>
					<Свойство>
						<Код>11</Код>
						<Наименование>ДатаОкончанияДействия --&gt; ДатаОкончанияДействия</Наименование>
						<Порядок>550</Порядок>
						<Источник Имя="ДатаОкончанияДействия" Вид="Реквизит" Тип="Дата"/>
						<Приемник Имя="ДатаОкончанияДействия" Вид="Реквизит" Тип="Дата"/>
					</Свойство>
					<Свойство>
						<Код>9</Код>
						<Наименование>--&gt; ДоговорАренды</Наименование>
						<Порядок>600</Порядок>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="" Вид=""/>
						<ИмяПараметраДляПередачи>ДоговорАренды</ИмяПараметраДляПередачи>
						<ПередВыгрузкой>Значение = Ложь;

Если Источник.ВидДоговора = Справочники.ВидыДоговоров.Субаренда //ИЛИ Источник.ВидДоговора = Справочники.ВидыДоговоров.СубарендаПоставка 
	Тогда
	Значение = Истина;
Иначе 
	Если Найти(НРег(Источник.Наименование), "ком ") &gt; 0
		или Найти(НРег(Источник.Наименование), "комм") &gt; 0
		или Найти(НРег(Источник.Наименование), "субар") &gt; 0
		или Найти(НРег(Источник.Номер), "суб") &gt; 0 Тогда
		
		Значение = Истина;
	КонецЕсли;	
КонецЕсли;
</ПередВыгрузкой>
					</Свойство>
					<Свойство>
						<Код>14</Код>
						<Наименование>--&gt; ДоговорМаркетинга</Наименование>
						<Порядок>650</Порядок>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="" Вид=""/>
						<ИмяПараметраДляПередачи>ДоговорМаркетинга</ИмяПараметраДляПередачи>
						<ПередВыгрузкой>Если Источник.ВидДоговора = Справочники.ВидыДоговоров.Маркетинг Тогда
	Значение = Истина;
Иначе	
	Значение = Найти(НРег(Источник.Наименование), "аркет") &gt; 0;
КонецЕсли;
</ПередВыгрузкой>
					</Свойство>
				</Свойства>
				<Значения/>
			</Правило>
			<Правило>
				<Код>Контрагенты</Код>
				<Наименование>Справочник: Валюты</Наименование>
				<Порядок>150</Порядок>
				<ПередВыгрузкой>Отказ = Источник.ЭтоГруппа;
</ПередВыгрузкой>
				<ПослеВыгрузкиВФайл>Запрос = Новый Запрос;
Запрос.Текст = "ВЫБРАТЬ
|СхемыНалогообложенияКонтрагентов.Период,
|СхемыНалогообложенияКонтрагентов.Контрагент,
|СхемыНалогообложенияКонтрагентов.СхемаНалогообложения
|ИЗ
|	РегистрСведений.ТК_УчетнаяПолитикаКонтрагенты КАК СхемыНалогообложенияКонтрагентов
|ГДЕ
|	СхемыНалогообложенияКонтрагентов.Контрагент = &amp;Контрагент";
Запрос.УстановитьПараметр("Контрагент",Источник);

Результат = Запрос.Выполнить();

Выборка = Результат.Выбрать();

Пока Выборка.Следующий() Цикл
	
	Структура = Новый Структура("Период,Контрагент,СхемаНалогообложения");
	ЗаполнитьЗначенияСвойств(Структура,Выборка);
	ВыгрузитьПоПравилу(Структура, , , , "СхемыНалогообложенияКонтрагентов");
	
КонецЦикла;

сооКИ = Новый Соответствие;
сооКИ.Вставить("ZIPcode"	,"Поле1");
сооКИ.Вставить("area"		,"Поле2");
сооКИ.Вставить("district"	,"Поле3");
сооКИ.Вставить("city"		,"Поле4");
сооКИ.Вставить("locality"	,"Поле5");
сооКИ.Вставить("street"		,"Поле6");
сооКИ.Вставить("houseNumber","Поле7");
сооКИ.Вставить("buildings"	,"Поле8");
сооКИ.Вставить("apartments"	,"Поле9");
сооКИ.Вставить("country"	,"Поле10");
сооКИ.Вставить("comment"	,"Комментарий");
сооКИ.Вставить("value"		,"Представление");

ВидКИ = УправлениеКонтактнойИнформацией.ВидКонтактнойИнформацииПоИмени("ЮридическийАдресКонтрагента");

тзКИ = УправлениеКонтактнойИнформацией.КонтактнаяИнформацияОбъекта(Источник,ВидКИ,ТекущаяДата(),Ложь);

Если ЗначениеЗаполнено(тзКИ) Тогда
	
	СтруктураКИ = УправлениеКонтактнойИнформациейСлужебный.СтрокуJSONВСтруктуру(тзКИ[0].Значение);
	
	СтруктураСвойств = Новый Структура();
	СтруктураСвойств.Вставить("Объект",тзКИ[0].Объект);
	СтруктураСвойств.Вставить("Тип",тзКИ[0].Тип);
	СтруктураСвойств.Вставить("Вид",тзКИ[0].Вид.ИмяПредопределенногоВида);
	
	Для Каждого эл Из СтруктураКИ Цикл
		Ключ = СтрЗаменить(эл.Ключ,"Type","");
		стрКлюч = сооКИ.Получить(Ключ);
		Если стрКлюч &lt;&gt; Неопределено Тогда
			Если ТипЗнч(эл.Значение) = Тип("Массив") Тогда
				СтруктураСвойств.Вставить(стрКлюч,эл.Значение[0].number);	
			Иначе
				Если СтруктураСвойств.Свойство(стрКлюч) Тогда
					СтруктураСвойств[стрКлюч] = СтруктураСвойств[стрКлюч] + " " + эл.Значение;	
				Иначе
					СтруктураСвойств.Вставить(стрКлюч,эл.Значение);	
				КонецЕсли;
			КонецЕсли;
		КонецЕсли;
	КонецЦикла;
	
	ВыгрузитьПоПравилу(СтруктураСвойств, , , , "КонтактнаяИнформация");
	
КонецЕсли;

сооКИ = Новый Соответствие;
сооКИ.Вставить("countryCode","Поле1");
сооКИ.Вставить("areaCode"	,"Поле2");
сооКИ.Вставить("number"		,"Поле3");
сооКИ.Вставить("extNumber"	,"Поле4");
сооКИ.Вставить("comment"	,"Комментарий");
сооКИ.Вставить("value"		,"Представление");

ВидКИ = УправлениеКонтактнойИнформацией.ВидКонтактнойИнформацииПоИмени("КонтактныйТелефонКонтрагента");

тзКИ = УправлениеКонтактнойИнформацией.КонтактнаяИнформацияОбъекта(Источник,ВидКИ,ТекущаяДата(),Ложь);

Если ЗначениеЗаполнено(тзКИ) Тогда
	
	СтруктураКИ = УправлениеКонтактнойИнформациейСлужебный.СтрокуJSONВСтруктуру(тзКИ[0].Значение);
	
	СтруктураСвойств = Новый Структура();
	СтруктураСвойств.Вставить("Объект",тзКИ[0].Объект);
	СтруктураСвойств.Вставить("Тип",тзКИ[0].Тип);
	СтруктураСвойств.Вставить("Вид",тзКИ[0].Вид.ИмяПредопределенногоВида);
	
	Для Каждого эл Из СтруктураКИ Цикл
		Ключ = сооКИ.Получить(эл.Ключ);
		Если Ключ &lt;&gt; Неопределено Тогда
			//Если ТипЗнч(эл.Значение) = Тип("Массив") Тогда
			//	СтруктураСвойств.Вставить(Ключ,эл.Значение[0].number);	
			//Иначе
			СтруктураСвойств.Вставить(Ключ,эл.Значение);	
			//КонецЕсли;
		КонецЕсли;
	КонецЦикла;
	
	ВыгрузитьПоПравилу(СтруктураСвойств, , , , "КонтактнаяИнформация");
	
КонецЕсли;
</ПослеВыгрузкиВФайл>
				<ПослеЗагрузки>//Если Объект.ЭтоНовый() Тогда 
//	GUID_Поиска = ПараметрыОбъекта.Получить("GUID_Поиска");	
//	ГУИД = ЗначениеИзСтрокиВнутр(GUID_Поиска);			
//	Если ТипЗнч(ГУИД) = Тип("УникальныйИдентификатор") Тогда 
//		ВидОбъекта  = Параметры.ПараметрыАлгоритмов["ВидОбъекта"];		
//		нСсылка = Справочники[ВидОбъекта].ПолучитьСсылку(ГУИД);				
//		
//		Если Не ОбщегоНазначения.СсылкаСуществует(нСсылка) Тогда 
//			Объект.УстановитьСсылкуНового(нСсылка);
//		КонецЕсли;
//	КонецЕсли;
//КонецЕсли;

ЗаписатьОбъект = ПараметрыОбъекта.Получить("ЗаписатьОбъект");
Если ЗаписатьОбъект = Неопределено Тогда
	ЗаписатьОбъект = Ложь;
КонецЕсли;

ОбъектМодифицирован = Ложь;

Если ЗаписатьОбъект Тогда		
	Выполнить(Алгоритмы.ЗаписатьСоответствиеОбъектов);
КонецЕсли;

</ПослеЗагрузки>
				<ПоследовательностьПолейПоиска>Если НомерВариантаПоиска = 1 тогда
	Параметры.ПараметрыАлгоритмов.Вставить("ВидОбъекта","Контрагенты");
	Параметры.ПараметрыАлгоритмов.Вставить("ТипОбъектаИсточника", "СправочникСсылка.Контрагенты");
	СтрокаИменСвойствПоиска = "ПоискАлгоритмом";

	Выполнить(Алгоритмы.ПолучитьСоответствиеОбъектов);
ИначеЕсли НомерВариантаПоиска = 2 тогда
	СтрокаИменСвойствПоиска = "Код,КодПоЕДРПОУ,ЭтоГруппа";
Иначе
	СтрокаИменСвойствПоиска="";
	ПрекратитьПоиск = Истина;
КонецЕсли</ПоследовательностьПолейПоиска>
				<СинхронизироватьПоИдентификатору>true</СинхронизироватьПоИдентификатору>
				<ПродолжитьПоискПоПолямПоискаЕслиПоИдентификаторуНеНашли>true</ПродолжитьПоискПоПолямПоискаЕслиПоИдентификаторуНеНашли>
				<ИспользоватьБыстрыйПоискПриЗагрузке>true</ИспользоватьБыстрыйПоискПриЗагрузке>
				<ГенерироватьНовыйНомерИлиКодЕслиНеУказан>true</ГенерироватьНовыйНомерИлиКодЕслиНеУказан>
				<Источник>СправочникСсылка.Контрагенты</Источник>
				<Приемник>СправочникСсылка.Контрагенты</Приемник>
				<Свойства>
					<Свойство Поиск="true">
						<Код>1</Код>
						<Наименование>--&gt; GUID_Поиска</Наименование>
						<Порядок>50</Порядок>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="" Вид=""/>
						<ИмяПараметраДляПередачи>GUID_Поиска</ИмяПараметраДляПередачи>
						<ПередВыгрузкой>Значение = ЗначениеВСтрокуВнутр(Источник.УникальныйИдентификатор());</ПередВыгрузкой>
					</Свойство>
					<Свойство Поиск="true">
						<Код>11</Код>
						<Наименование>Код --&gt; Код</Наименование>
						<Порядок>100</Порядок>
						<Источник Имя="Код" Вид="Свойство" Тип="Строка"/>
						<Приемник Имя="Код" Вид="Свойство" Тип="Строка"/>
					</Свойство>
					<Свойство Поиск="true">
						<Код>3</Код>
						<Наименование>КодПоЕДРПОУ --&gt; КодПоЕДРПОУ</Наименование>
						<Порядок>150</Порядок>
						<Источник Имя="КодПоЕДРПОУ" Вид="Реквизит" Тип="Строка"/>
						<Приемник Имя="КодПоЕДРПОУ" Вид="Реквизит" Тип="Строка"/>
					</Свойство>
					<Свойство>
						<Код>7</Код>
						<Наименование>ЮрФизЛицо --&gt; ЮрФизЛицо</Наименование>
						<Порядок>200</Порядок>
						<Источник Имя="ЮрФизЛицо" Вид="Реквизит" Тип="ПеречислениеСсылка.ЮрФизЛицо"/>
						<Приемник Имя="ЮрФизЛицо" Вид="Реквизит" Тип="ПеречислениеСсылка.ЮрФизЛицо"/>
						<КодПравилаКонвертации>ЮрФизЛицо                                         </КодПравилаКонвертации>
					</Свойство>
					<Свойство Поиск="true" Обязательное="true">
						<Код>13</Код>
						<Наименование>--&gt; ЭтоГруппа</Наименование>
						<Порядок>250</Порядок>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="ЭтоГруппа" Вид="Свойство" Тип="Булево"/>
						<ПередВыгрузкой>Значение = Ложь;</ПередВыгрузкой>
					</Свойство>
					<Свойство>
						<Код>4</Код>
						<Наименование>ИННПлательщикаНДС --&gt; ИНН</Наименование>
						<Порядок>300</Порядок>
						<Источник Имя="ИННПлательщикаНДС" Вид="Реквизит" Тип="Строка"/>
						<Приемник Имя="ИНН" Вид="Реквизит" Тип="Строка"/>
					</Свойство>
					<Свойство>
						<Код>5</Код>
						<Наименование>Наименование --&gt; Наименование</Наименование>
						<Порядок>350</Порядок>
						<Источник Имя="Наименование" Вид="Свойство" Тип="Строка"/>
						<Приемник Имя="Наименование" Вид="Свойство" Тип="Строка"/>
					</Свойство>
					<Свойство>
						<Код>6</Код>
						<Наименование>НаименованиеПолное --&gt; НаименованиеПолное</Наименование>
						<Порядок>400</Порядок>
						<Источник Имя="НаименованиеПолное" Вид="Реквизит" Тип="Строка"/>
						<Приемник Имя="НаименованиеПолное" Вид="Реквизит" Тип="Строка"/>
					</Свойство>
					<Свойство>
						<Код>9</Код>
						<Наименование>КодФилиала --&gt; КодФилиала</Наименование>
						<Порядок>450</Порядок>
						<Источник Имя="КодФилиала" Вид="Реквизит" Тип="Строка"/>
						<Приемник Имя="КодФилиала" Вид="Реквизит" Тип="Строка"/>
					</Свойство>
					<Свойство>
						<Код>10</Код>
						<Наименование>Комментарий --&gt; Комментарий</Наименование>
						<Порядок>500</Порядок>
						<Источник Имя="Комментарий" Вид="Реквизит" Тип="Строка"/>
						<Приемник Имя="Комментарий" Вид="Реквизит" Тип="Строка"/>
					</Свойство>
					<Свойство>
						<Код>12</Код>
						<Наименование>ПометкаУдаления --&gt; ПометкаУдаления</Наименование>
						<Порядок>550</Порядок>
						<Источник Имя="ПометкаУдаления" Вид="Свойство" Тип="Булево"/>
						<Приемник Имя="ПометкаУдаления" Вид="Свойство" Тип="Булево"/>
					</Свойство>
				</Свойства>
				<Значения/>
			</Правило>
			<Правило>
				<Код>ФизическиеЛица</Код>
				<Наименование>Справочник: Физические лица</Наименование>
				<Порядок>200</Порядок>
				<ПередВыгрузкой>//Отказ = Источник.ЭтоГруппа;
//Если Параметры.КешТаблицаКодовСвязи.Найти(Источник,"Объект")&lt;&gt; Неопределено Тогда	
//	НеЗамещатьОбъектПриЗагрузке =Истина;
//КонецЕсли;
</ПередВыгрузкой>
				<ПослеЗагрузки>ЗаписатьОбъект = ПараметрыОбъекта.Получить("ЗаписатьОбъект");
Если ЗаписатьОбъект = Неопределено Тогда
	ЗаписатьОбъект = Ложь;
	ОбъектМодифицирован = Ложь;
КонецЕсли;

Если ЗаписатьОбъект Тогда		
	Выполнить(Алгоритмы.ЗаписатьСоответствиеОбъектов);
КонецЕсли;

</ПослеЗагрузки>
				<ПоследовательностьПолейПоиска>Если НомерВариантаПоиска = 1 тогда
	Параметры.ПараметрыАлгоритмов.Вставить("ВидОбъекта","ФизическиеЛица");
	Параметры.ПараметрыАлгоритмов.Вставить("ТипОбъектаИсточника","СправочникСсылка.ФизическиеЛица");
	СтрокаИменСвойствПоиска = "ПоискАлгоритмом";

	Выполнить(Алгоритмы.ПолучитьСоответствиеОбъектов);
ИначеЕсли НомерВариантаПоиска = 2 тогда
	СтрокаИменСвойствПоиска = "КодПоДРФО, ЭтоГруппа";
Иначе
	ПрекратитьПоиск = Истина;
	СтрокаИменСвойствПоиска = "";
КонецЕсли

</ПоследовательностьПолейПоиска>
				<НеЗамещать>true</НеЗамещать>
				<ГенерироватьНовыйНомерИлиКодЕслиНеУказан>true</ГенерироватьНовыйНомерИлиКодЕслиНеУказан>
				<Источник>СправочникСсылка.ФизическиеЛица</Источник>
				<Приемник>СправочникСсылка.ФизическиеЛица</Приемник>
				<Свойства>
					<Свойство Поиск="true">
						<Код>1</Код>
						<Наименование>--&gt; GUID_Поиска</Наименование>
						<Порядок>50</Порядок>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="" Вид=""/>
						<ИмяПараметраДляПередачи>GUID_Поиска</ИмяПараметраДляПередачи>
						<ПередВыгрузкой>Значение = ЗначениеВСтрокуВнутр(Источник.УникальныйИдентификатор());</ПередВыгрузкой>
					</Свойство>
					<Свойство>
						<Код>2</Код>
						<Наименование>ДатаРождения --&gt; ДатаРождения</Наименование>
						<Порядок>100</Порядок>
						<Источник Имя="ДатаРождения" Вид="Реквизит" Тип="Дата"/>
						<Приемник Имя="ДатаРождения" Вид="Реквизит" Тип="Дата"/>
					</Свойство>
					<Свойство Поиск="true">
						<Код>3</Код>
						<Наименование>Код --&gt; КодПоДРФО</Наименование>
						<Порядок>150</Порядок>
						<Источник Имя="Код" Вид="Свойство" Тип="Строка"/>
						<Приемник Имя="КодПоДРФО" Вид="Реквизит" Тип="Строка"/>
						<ПередВыгрузкой>Значение = СокрЛП(Источник.Код);</ПередВыгрузкой>
					</Свойство>
					<Свойство Поиск="true" Обязательное="true">
						<Код>4</Код>
						<Наименование>ЭтоГруппа --&gt; ЭтоГруппа</Наименование>
						<Порядок>200</Порядок>
						<Источник Имя="ЭтоГруппа" Вид="Свойство" Тип="Булево"/>
						<Приемник Имя="ЭтоГруппа" Вид="Свойство" Тип="Булево"/>
					</Свойство>
					<Свойство>
						<Код>5</Код>
						<Наименование>Наименование --&gt; Наименование</Наименование>
						<Порядок>250</Порядок>
						<Источник Имя="Наименование" Вид="Свойство" Тип="Строка"/>
						<Приемник Имя="Наименование" Вид="Свойство" Тип="Строка"/>
					</Свойство>
					<Свойство>
						<Код>7</Код>
						<Наименование>МестоРождения --&gt; МестоРождения</Наименование>
						<Порядок>300</Порядок>
						<Источник Имя="МестоРождения" Вид="Реквизит" Тип="Строка"/>
						<Приемник Имя="МестоРождения" Вид="Реквизит" Тип="Строка"/>
					</Свойство>
					<Свойство>
						<Код>8</Код>
						<Наименование>Пол --&gt; Пол</Наименование>
						<Порядок>350</Порядок>
						<Источник Имя="Пол" Вид="Реквизит" Тип="ПеречислениеСсылка.ПолФизическогоЛица"/>
						<Приемник Имя="Пол" Вид="Реквизит" Тип="ПеречислениеСсылка.ПолФизическихЛиц"/>
						<КодПравилаКонвертации>ПолФизическихЛиц                                  </КодПравилаКонвертации>
					</Свойство>
					<Свойство>
						<Код>9</Код>
						<Наименование>ПометкаУдаления --&gt; ПометкаУдаления</Наименование>
						<Порядок>400</Порядок>
						<Источник Имя="ПометкаУдаления" Вид="Свойство" Тип="Булево"/>
						<Приемник Имя="ПометкаУдаления" Вид="Свойство" Тип="Булево"/>
					</Свойство>
				</Свойства>
				<Значения/>
			</Правило>
			<Правило>
				<Код>БанковскиеСчетаКонтр</Код>
				<Наименование>Справочник: Банковские счета</Наименование>
				<Порядок>250</Порядок>
				<ПередВыгрузкой>Отказ = ТипЗнч(Источник.Владелец) &lt;&gt; Тип("СправочникСсылка.Контрагенты");

Если Не Отказ Тогда
	Если НЕ ЗначениеЗаполнено(Источник.Владелец) 
		И НЕ ЗначениеЗаполнено(Источник.Банк) 
		И НЕ ЗначениеЗаполнено(Источник.НомерСчета) Тогда 
		Сообщить("У банковского счета "+Строка(Источник)+" не заполнены Организация, Банк и Номер счета, выгрузка банковского счета отменена!");
		Отказ = Истина; 
	КонецЕсли;
КонецЕсли;
</ПередВыгрузкой>
				<ПослеЗагрузки>ЗаписатьОбъект = ПараметрыОбъекта.Получить("ЗаписатьОбъект");
Если ЗаписатьОбъект = Неопределено Тогда
	ЗаписатьОбъект = Ложь;
	ОбъектМодифицирован = Ложь;
КонецЕсли;

Если ЗаписатьОбъект Тогда		
	Выполнить(Алгоритмы.ЗаписатьСоответствиеОбъектов);
КонецЕсли;

</ПослеЗагрузки>
				<ПоследовательностьПолейПоиска>Если НомерВариантаПоиска = 1 тогда
	Параметры.ПараметрыАлгоритмов.Вставить("ВидОбъекта","БанковскиеСчета");
	Параметры.ПараметрыАлгоритмов.Вставить("ТипОбъектаИсточника","СправочникСсылка.БанковскиеСчетаКонтрагентов");
	СтрокаИменСвойствПоиска = "ПоискАлгоритмом";
	
	Выполнить(Алгоритмы.ПолучитьСоответствиеОбъектов);
ИначеЕсли НомерВариантаПоиска = 2 тогда
	СтрокаИменСвойствПоиска = "Владелец, НомерСчета, ВалютаДенежныхСредств";
ИначеЕсли НомерВариантаПоиска = 3 тогда
	СтрокаИменСвойствПоиска = "НомерСчета, ВалютаДенежныхСредств";
Иначе
	СтрокаИменСвойствПоиска="";
	ПрекратитьПоиск = Истина;

КонецЕсли

</ПоследовательностьПолейПоиска>
				<НеВыгружатьОбъектыСвойствПоСсылкам>true</НеВыгружатьОбъектыСвойствПоСсылкам>
				<ИспользоватьБыстрыйПоискПриЗагрузке>true</ИспользоватьБыстрыйПоискПриЗагрузке>
				<ГенерироватьНовыйНомерИлиКодЕслиНеУказан>true</ГенерироватьНовыйНомерИлиКодЕслиНеУказан>
				<Источник>СправочникСсылка.БанковскиеСчетаКонтрагентов</Источник>
				<Приемник>СправочникСсылка.БанковскиеСчета</Приемник>
				<Свойства>
					<Свойство Поиск="true">
						<Код>1</Код>
						<Наименование>--&gt; GUID_Поиска</Наименование>
						<Порядок>50</Порядок>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="" Вид=""/>
						<ИмяПараметраДляПередачи>GUID_Поиска</ИмяПараметраДляПередачи>
						<ПередВыгрузкой>Значение = ЗначениеВСтрокуВнутр(Источник.УникальныйИдентификатор());</ПередВыгрузкой>
					</Свойство>
					<Свойство Поиск="true">
						<Код>3</Код>
						<Наименование>Владелец --&gt; Владелец</Наименование>
						<Порядок>100</Порядок>
						<Источник Имя="Владелец" Вид="Свойство"/>
						<Приемник Имя="Владелец" Вид="Свойство"/>
						<КодПравилаКонвертации>Контрагенты                                       </КодПравилаКонвертации>
					</Свойство>
					<Свойство>
						<Код>4</Код>
						<Наименование>Наименование --&gt; Наименование</Наименование>
						<Порядок>150</Порядок>
						<Источник Имя="Наименование" Вид="Свойство" Тип="Строка"/>
						<Приемник Имя="Наименование" Вид="Свойство" Тип="Строка"/>
					</Свойство>
					<Свойство Поиск="true">
						<Код>2</Код>
						<Наименование>НомерСчета --&gt; НомерСчета</Наименование>
						<Порядок>200</Порядок>
						<Источник Имя="НомерСчета" Вид="Реквизит" Тип="Строка"/>
						<Приемник Имя="НомерСчета" Вид="Реквизит" Тип="Строка"/>
					</Свойство>
					<Свойство Поиск="true">
						<Код>5</Код>
						<Наименование>ВалютаДенежныхСредств --&gt; ВалютаДенежныхСредств</Наименование>
						<Порядок>250</Порядок>
						<Источник Имя="ВалютаДенежныхСредств" Вид="Реквизит" Тип="СправочникСсылка.Валюты"/>
						<Приемник Имя="ВалютаДенежныхСредств" Вид="Реквизит" Тип="СправочникСсылка.Валюты"/>
						<КодПравилаКонвертации>Валюты                                            </КодПравилаКонвертации>
					</Свойство>
					<Свойство>
						<Код>6</Код>
						<Наименование>ДатаОткрытия --&gt; ДатаОткрытия</Наименование>
						<Порядок>300</Порядок>
						<Источник Имя="ДатаОткрытия" Вид="Реквизит" Тип="Дата"/>
						<Приемник Имя="ДатаОткрытия" Вид="Реквизит" Тип="Дата"/>
					</Свойство>
					<Свойство>
						<Код>7</Код>
						<Наименование>ДатаЗакрытия --&gt; ДатаЗакрытия</Наименование>
						<Порядок>350</Порядок>
						<Источник Имя="ДатаЗакрытия" Вид="Реквизит" Тип="Дата"/>
						<Приемник Имя="ДатаЗакрытия" Вид="Реквизит" Тип="Дата"/>
					</Свойство>
					<Свойство>
						<Код>8</Код>
						<Наименование>ВидСчета --&gt; ВидСчета</Наименование>
						<Порядок>400</Порядок>
						<Источник Имя="ВидСчета" Вид="Реквизит" Тип="Строка"/>
						<Приемник Имя="ВидСчета" Вид="Реквизит" Тип="Строка"/>
					</Свойство>
					<Свойство>
						<Код>9</Код>
						<Наименование>ПометкаУдаления --&gt; ПометкаУдаления</Наименование>
						<Порядок>450</Порядок>
						<Источник Имя="ПометкаУдаления" Вид="Свойство" Тип="Булево"/>
						<Приемник Имя="ПометкаУдаления" Вид="Свойство" Тип="Булево"/>
					</Свойство>
					<Свойство>
						<Код>10</Код>
						<Наименование>НомерИДатаРазрешения --&gt; НомерИДатаРазрешения</Наименование>
						<Порядок>500</Порядок>
						<Источник Имя="НомерИДатаРазрешения" Вид="Реквизит" Тип="Строка"/>
						<Приемник Имя="НомерИДатаРазрешения" Вид="Реквизит" Тип="Строка"/>
					</Свойство>
					<Свойство>
						<Код>11</Код>
						<Наименование>Банк --&gt; Банк</Наименование>
						<Порядок>550</Порядок>
						<Источник Имя="Банк" Вид="Реквизит" Тип="СправочникСсылка.КлассификаторБанков"/>
						<Приемник Имя="Банк" Вид="Реквизит" Тип="СправочникСсылка.Банки"/>
						<КодПравилаКонвертации>Банки                                             </КодПравилаКонвертации>
					</Свойство>
				</Свойства>
				<Значения/>
			</Правило>
			<Правило>
				<Код>БанковскиеСчетаОрг</Код>
				<Наименование>Справочник: Банковские счета</Наименование>
				<Порядок>300</Порядок>
				<ПередВыгрузкой>Отказ = ТипЗнч(Источник.Владелец) &lt;&gt; Тип("СправочникСсылка.Организации");

Если Не Отказ Тогда
	Если НЕ ЗначениеЗаполнено(Источник.Владелец) 
		И НЕ ЗначениеЗаполнено(Источник.Банк) 
		И НЕ ЗначениеЗаполнено(Источник.НомерСчета) Тогда 
		Сообщить("У банковского счета "+Строка(Источник)+" не заполнены Организация, Банк и Номер счета, выгрузка банковского счета отменена!");
		Отказ = Истина; 
	КонецЕсли;
КонецЕсли;
</ПередВыгрузкой>
				<ПослеЗагрузки>ЗаписатьОбъект = ПараметрыОбъекта.Получить("ЗаписатьОбъект");
Если ЗаписатьОбъект = Неопределено Тогда
	ЗаписатьОбъект = Ложь;
	ОбъектМодифицирован = Ложь;
КонецЕсли;

Если ЗаписатьОбъект Тогда		
	Выполнить(Алгоритмы.ЗаписатьСоответствиеОбъектов);
КонецЕсли;

</ПослеЗагрузки>
				<ПоследовательностьПолейПоиска>Если НомерВариантаПоиска = 1 тогда
	Параметры.ПараметрыАлгоритмов.Вставить("ВидОбъекта","БанковскиеСчета");
	Параметры.ПараметрыАлгоритмов.Вставить("ТипОбъектаИсточника","СправочникСсылка.БанковскиеСчетаОрганизаций");
	СтрокаИменСвойствПоиска = "ПоискАлгоритмом";
	
	Выполнить(Алгоритмы.ПолучитьСоответствиеОбъектов);
ИначеЕсли НомерВариантаПоиска = 2 тогда
	СтрокаИменСвойствПоиска = "Владелец, НомерСчета, ВалютаДенежныхСредств";	
ИначеЕсли НомерВариантаПоиска = 3 тогда
	СтрокаИменСвойствПоиска = "НомерСчета, ВалютаДенежныхСредств";
Иначе
	СтрокаИменСвойствПоиска="";
	ПрекратитьПоиск = Истина;

КонецЕсли

</ПоследовательностьПолейПоиска>
				<НеЗамещать>true</НеЗамещать>
				<НеВыгружатьОбъектыСвойствПоСсылкам>true</НеВыгружатьОбъектыСвойствПоСсылкам>
				<ИспользоватьБыстрыйПоискПриЗагрузке>true</ИспользоватьБыстрыйПоискПриЗагрузке>
				<ГенерироватьНовыйНомерИлиКодЕслиНеУказан>true</ГенерироватьНовыйНомерИлиКодЕслиНеУказан>
				<Источник>СправочникСсылка.БанковскиеСчетаОрганизаций</Источник>
				<Приемник>СправочникСсылка.БанковскиеСчета</Приемник>
				<Свойства>
					<Свойство Поиск="true">
						<Код>10</Код>
						<Наименование>--&gt; GUID_Поиска</Наименование>
						<Порядок>50</Порядок>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="" Вид=""/>
						<ИмяПараметраДляПередачи>GUID_Поиска</ИмяПараметраДляПередачи>
						<ПередВыгрузкой>Значение = ЗначениеВСтрокуВнутр(Источник.УникальныйИдентификатор());</ПередВыгрузкой>
					</Свойство>
					<Свойство Поиск="true">
						<Код>4</Код>
						<Наименование>Владелец --&gt; Владелец</Наименование>
						<Порядок>100</Порядок>
						<Источник Имя="Владелец" Вид="Свойство" Тип="СправочникСсылка.Организации"/>
						<Приемник Имя="Владелец" Вид="Свойство"/>
						<КодПравилаКонвертации>Организации                                       </КодПравилаКонвертации>
					</Свойство>
					<Свойство>
						<Код>7</Код>
						<Наименование>Наименование --&gt; Наименование</Наименование>
						<Порядок>150</Порядок>
						<Источник Имя="Наименование" Вид="Свойство" Тип="Строка"/>
						<Приемник Имя="Наименование" Вид="Свойство" Тип="Строка"/>
					</Свойство>
					<Свойство Поиск="true">
						<Код>9</Код>
						<Наименование>НомерСчета --&gt; НомерСчета</Наименование>
						<Порядок>200</Порядок>
						<Источник Имя="НомерСчета" Вид="Реквизит" Тип="Строка"/>
						<Приемник Имя="НомерСчета" Вид="Реквизит" Тип="Строка"/>
					</Свойство>
					<Свойство Поиск="true">
						<Код>2</Код>
						<Наименование>ВалютаДенежныхСредств --&gt; ВалютаДенежныхСредств</Наименование>
						<Порядок>250</Порядок>
						<Источник Имя="ВалютаДенежныхСредств" Вид="Реквизит" Тип="СправочникСсылка.Валюты"/>
						<Приемник Имя="ВалютаДенежныхСредств" Вид="Реквизит" Тип="СправочникСсылка.Валюты"/>
						<КодПравилаКонвертации>Валюты                                            </КодПравилаКонвертации>
					</Свойство>
					<Свойство>
						<Код>6</Код>
						<Наименование>ДатаОткрытия --&gt; ДатаОткрытия</Наименование>
						<Порядок>300</Порядок>
						<Источник Имя="ДатаОткрытия" Вид="Реквизит" Тип="Дата"/>
						<Приемник Имя="ДатаОткрытия" Вид="Реквизит" Тип="Дата"/>
					</Свойство>
					<Свойство>
						<Код>5</Код>
						<Наименование>ДатаЗакрытия --&gt; ДатаЗакрытия</Наименование>
						<Порядок>350</Порядок>
						<Источник Имя="ДатаЗакрытия" Вид="Реквизит" Тип="Дата"/>
						<Приемник Имя="ДатаЗакрытия" Вид="Реквизит" Тип="Дата"/>
					</Свойство>
					<Свойство>
						<Код>3</Код>
						<Наименование>ВидСчета --&gt; ВидСчета</Наименование>
						<Порядок>400</Порядок>
						<Источник Имя="ВидСчета" Вид="Реквизит" Тип="Строка"/>
						<Приемник Имя="ВидСчета" Вид="Реквизит" Тип="Строка"/>
					</Свойство>
					<Свойство>
						<Код>8</Код>
						<Наименование>ПометкаУдаления --&gt; ПометкаУдаления</Наименование>
						<Порядок>450</Порядок>
						<Источник Имя="ПометкаУдаления" Вид="Свойство" Тип="Булево"/>
						<Приемник Имя="ПометкаУдаления" Вид="Свойство" Тип="Булево"/>
					</Свойство>
					<Свойство>
						<Код>11</Код>
						<Наименование>НомерИДатаРазрешения --&gt; НомерИДатаРазрешения</Наименование>
						<Порядок>500</Порядок>
						<Источник Имя="НомерИДатаРазрешения" Вид="Реквизит" Тип="Строка"/>
						<Приемник Имя="НомерИДатаРазрешения" Вид="Реквизит" Тип="Строка"/>
					</Свойство>
					<Свойство>
						<Код>12</Код>
						<Наименование>Банк --&gt; Банк</Наименование>
						<Порядок>550</Порядок>
						<Источник Имя="Банк" Вид="Реквизит" Тип="СправочникСсылка.КлассификаторБанков"/>
						<Приемник Имя="Банк" Вид="Реквизит" Тип="СправочникСсылка.Банки"/>
						<КодПравилаКонвертации>Банки                                             </КодПравилаКонвертации>
					</Свойство>
				</Свойства>
				<Значения/>
			</Правило>
			<Правило>
				<Код>Банки</Код>
				<Наименование>Справочник: Классификатор банков</Наименование>
				<Порядок>350</Порядок>
				<ПередВыгрузкой>Отказ = Источник.ЭтоГруппа;
</ПередВыгрузкой>
				<ПриЗагрузке>Отказ = Не Объект.ЭтоНовый();</ПриЗагрузке>
				<ПослеЗагрузки>ЗаписатьОбъект = ПараметрыОбъекта.Получить("ЗаписатьОбъект");
Если ЗаписатьОбъект = Неопределено Тогда
	ЗаписатьОбъект = Ложь;
КонецЕсли;

ОбъектМодифицирован = Ложь;

Если ЗаписатьОбъект Тогда		
	Выполнить(Алгоритмы.ЗаписатьСоответствиеОбъектов);
КонецЕсли;</ПослеЗагрузки>
				<ПоследовательностьПолейПоиска>Если  НомерВариантаПоиска = 1 Тогда
	Параметры.ПараметрыАлгоритмов.Вставить("ВидОбъекта","Банки");
	Параметры.ПараметрыАлгоритмов.Вставить("ТипОбъектаИсточника","СправочникСсылка.КлассификаторБанков");
	СтрокаИменСвойствПоиска = "ПоискАлгоритмом";
	
	Выполнить(Алгоритмы.ПолучитьСоответствиеОбъектов);
ИначеЕсли НомерВариантаПоиска = 2 тогда
	СтрокаИменСвойствПоиска = "Код";
Иначе
	СтрокаИменСвойствПоиска="";
	ПрекратитьПоиск = Истина;
КонецЕсли

</ПоследовательностьПолейПоиска>
				<НеЗамещать>true</НеЗамещать>
				<ГенерироватьНовыйНомерИлиКодЕслиНеУказан>true</ГенерироватьНовыйНомерИлиКодЕслиНеУказан>
				<Источник>СправочникСсылка.КлассификаторБанков</Источник>
				<Приемник>СправочникСсылка.Банки</Приемник>
				<Свойства>
					<Свойство Поиск="true">
						<Код>1</Код>
						<Наименование>--&gt; GUID_Поиска</Наименование>
						<Порядок>50</Порядок>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="" Вид=""/>
						<ИмяПараметраДляПередачи>GUID_Поиска</ИмяПараметраДляПередачи>
						<ПередВыгрузкой>Значение = ЗначениеВСтрокуВнутр(Источник.УникальныйИдентификатор());</ПередВыгрузкой>
					</Свойство>
					<Свойство Поиск="true">
						<Код>3</Код>
						<Наименование>Код --&gt; Код</Наименование>
						<Порядок>100</Порядок>
						<Источник Имя="Код" Вид="Свойство" Тип="Строка"/>
						<Приемник Имя="Код" Вид="Свойство" Тип="Строка"/>
					</Свойство>
					<Свойство>
						<Код>2</Код>
						<Наименование>Адрес --&gt; Адрес</Наименование>
						<Порядок>150</Порядок>
						<Источник Имя="Адрес" Вид="Реквизит" Тип="Строка"/>
						<Приемник Имя="Адрес" Вид="Реквизит" Тип="Строка"/>
					</Свойство>
					<Свойство>
						<Код>8</Код>
						<Наименование>Город --&gt; Город</Наименование>
						<Порядок>200</Порядок>
						<Источник Имя="Город" Вид="Реквизит" Тип="Строка"/>
						<Приемник Имя="Город" Вид="Реквизит" Тип="Строка"/>
					</Свойство>
					<Свойство>
						<Код>6</Код>
						<Наименование>КодПоЕДРПОУ --&gt; КодПоЕДРПОУ</Наименование>
						<Порядок>250</Порядок>
						<Источник Имя="КодПоЕДРПОУ" Вид="Реквизит" Тип="Строка"/>
						<Приемник Имя="КодПоЕДРПОУ" Вид="Реквизит" Тип="Строка"/>
					</Свойство>
					<Свойство>
						<Код>7</Код>
						<Наименование>КоррСчет --&gt; КоррСчет</Наименование>
						<Порядок>300</Порядок>
						<Источник Имя="КоррСчет" Вид="Реквизит" Тип="Строка"/>
						<Приемник Имя="КоррСчет" Вид="Реквизит" Тип="Строка"/>
					</Свойство>
					<Свойство>
						<Код>4</Код>
						<Наименование>Телефоны --&gt; Телефоны</Наименование>
						<Порядок>350</Порядок>
						<Источник Имя="Телефоны" Вид="Реквизит" Тип="Строка"/>
						<Приемник Имя="Телефоны" Вид="Реквизит" Тип="Строка"/>
					</Свойство>
					<Свойство>
						<Код>5</Код>
						<Наименование>Наименование --&gt; Наименование</Наименование>
						<Порядок>400</Порядок>
						<Источник Имя="Наименование" Вид="Свойство" Тип="Строка"/>
						<Приемник Имя="Наименование" Вид="Свойство" Тип="Строка"/>
					</Свойство>
				</Свойства>
				<Значения/>
			</Правило>
			<Правило>
				<Код>Кассы</Код>
				<Наименование>Справочник: Кассы компании</Наименование>
				<Порядок>400</Порядок>
				<ПередВыгрузкой>Отказ = Источник.ЭтоГруппа ИЛИ Источник.ПерегружатьВSAU = Ложь;
Если Параметры.КешТаблицаКодовСвязи.Найти(Источник,"Объект")&lt;&gt; Неопределено Тогда	
	НеЗамещатьОбъектПриЗагрузке =Истина;
КонецЕсли;
</ПередВыгрузкой>
				<ПослеЗагрузки>Отказ = Ложь;
ВсеОк = Истина;

Код_Поиска  = ПараметрыОбъекта.Получить("Код_Связи");
Если Код_Поиска&lt;&gt;Неопределено И ОбъектНайден = Ложь Тогда
	Отказ = Истина;
Конецесли;

Если НЕ Отказ Тогда
	
	ОбъектМодифицирован = Ложь;
	ЗаписатьОбъект =  ПараметрыОбъекта.Получить("ЗаписатьОбъект");
	Если ЗаписатьОбъект = Неопределено Тогда
		ЗаписатьОбъект = Ложь;
	КонецЕсли;
	
	Если Объект.ЭтоНовый() Или ЗаписатьОбъект Тогда
		
		Попытка 
			НачатьТранзакцию();
			УстановитьОбменДаннымиЗагрузка(Объект);
			
			Если Объект.ЭтоНовый() Тогда
				Объект.УстановитьНовыйКод();
			КонецЕсли;
			
			Объект.Записать();
			
			СсылкаВДругойБазе = ПараметрыОбъекта.Получить("GUID_Поиска");
			Если СсылкаВДругойБазе = Неопределено Тогда
				ВсеОк = Ложь;
			Иначе
				ТипОбъектаИсточника = ПараметрыОбъекта.Получить("ТипОбъектаИсточника");
				
				Запись = РегистрыСведений.СоответствиеОбъектовДляОбмена.СоздатьМенеджерЗаписи();
				Запись.УзелОбмена		= Параметры.УзелОбменаДляСоответствияОбъектов;
				Запись.СобственнаяСсылка= Объект.Ссылка;
				Запись.СсылкаВДругойИБ	= СсылкаВДругойБазе;
				Запись.ИмяТипаПриемника = ?(ТипОбъектаИсточника=Неопределено,"",ТипОбъектаИсточника);
				Запись.Записать();
				
			КонецЕсли;
			
			Если НЕ ВсеОк тогда
				ОтменитьТранзакцию();
			Иначе
				ЗафиксироватьТранзакцию();
				Отказ = Истина;
			КонецЕсли;
		Исключение
			ВсеОк = Ложь;	
		КонецПопытки;
		
	КонецЕсли;
	Если НЕ ВсеОК Тогда
		Отказ = Истина;
	КонецЕсли;
КонецЕсли;
</ПослеЗагрузки>
				<ПоследовательностьПолейПоиска>Если  НомерВариантаПоиска = 1 Тогда
	Параметры.ПараметрыАлгоритмов.Вставить("ВидОбъекта","Кассы");
	Параметры.ПараметрыАлгоритмов.Вставить("ТипОбъектаИсточника","СправочникСсылка.КассыКомпании");
	СтрокаИменСвойствПоиска = "ПоискАлгоритмом";
	
	Выполнить(Алгоритмы.ПолучитьСоответствиеОбъектов);
ИначеЕсли НомерВариантаПоиска = 2 тогда
	СтрокаИменСвойствПоиска = "КодИсточника";
Иначе
	СтрокаИменСвойствПоиска="";
	ПрекратитьПоиск = Истина;
КонецЕсли</ПоследовательностьПолейПоиска>
				<ГенерироватьНовыйНомерИлиКодЕслиНеУказан>true</ГенерироватьНовыйНомерИлиКодЕслиНеУказан>
				<Источник>СправочникСсылка.КассыКомпании</Источник>
				<Приемник>СправочникСсылка.Кассы</Приемник>
				<Свойства>
					<Свойство Поиск="true">
						<Код>1</Код>
						<Наименование>--&gt; GUID_Поиска</Наименование>
						<Порядок>50</Порядок>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="" Вид=""/>
						<ИмяПараметраДляПередачи>GUID_Поиска</ИмяПараметраДляПередачи>
						<ПередВыгрузкой>Значение = ЗначениеВСтрокуВнутр(Источник.УникальныйИдентификатор());</ПередВыгрузкой>
					</Свойство>
					<Свойство Поиск="true">
						<Код>3</Код>
						<Наименование>--&gt; КодИсточника</Наименование>
						<Порядок>100</Порядок>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="" Вид=""/>
						<ИмяПараметраДляПередачи>КодИсточника</ИмяПараметраДляПередачи>
						<ПередВыгрузкой>Значение = Источник.Код</ПередВыгрузкой>
					</Свойство>
					<Свойство>
						<Код>4</Код>
						<Наименование>Наименование --&gt; Наименование</Наименование>
						<Порядок>150</Порядок>
						<Источник Имя="Наименование" Вид="Свойство" Тип="Строка"/>
						<Приемник Имя="Наименование" Вид="Свойство" Тип="Строка"/>
					</Свойство>
					<Свойство>
						<Код>5</Код>
						<Наименование>ВалютаДенежныхСредств --&gt; ВалютаДенежныхСредств</Наименование>
						<Порядок>200</Порядок>
						<Источник Имя="ВалютаДенежныхСредств" Вид="Реквизит" Тип="СправочникСсылка.Валюты"/>
						<Приемник Имя="ВалютаДенежныхСредств" Вид="Реквизит" Тип="СправочникСсылка.Валюты"/>
						<КодПравилаКонвертации>Валюты                                            </КодПравилаКонвертации>
					</Свойство>
					<Свойство>
						<Код>7</Код>
						<Наименование>Код --&gt; Код</Наименование>
						<Порядок>350</Порядок>
						<Источник Имя="Код" Вид="Свойство" Тип="Строка"/>
						<Приемник Имя="Код" Вид="Свойство" Тип="Строка"/>
						<ПриводитьКДлине>9</ПриводитьКДлине>
					</Свойство>
					<Свойство>
						<Код>8</Код>
						<Наименование>ПометкаУдаления --&gt; ПометкаУдаления</Наименование>
						<Порядок>400</Порядок>
						<Источник Имя="ПометкаУдаления" Вид="Свойство" Тип="Булево"/>
						<Приемник Имя="ПометкаУдаления" Вид="Свойство" Тип="Булево"/>
					</Свойство>
				</Свойства>
				<Значения/>
			</Правило>
			<Правило>
				<Код>СхемыНалогообложения</Код>
				<Наименование>Перечисление: Схемы налогообложения</Наименование>
				<Порядок>450</Порядок>
				<Источник>ПеречислениеСсылка.СхемыНалогообложения</Источник>
				<Приемник>СправочникСсылка.СхемыНалогообложения</Приемник>
				<Свойства>
					<Свойство Поиск="true">
						<Код>1</Код>
						<Наименование>--&gt; Код</Наименование>
						<Порядок>50</Порядок>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="Код" Вид="Свойство" Тип="Строка"/>
					</Свойство>
				</Свойства>
				<Значения>
					<Значение>
						<Код>1</Код>
						<Наименование>ЕдиныйНалог --&gt; ЕдиныйНалог</Наименование>
						<Порядок>50</Порядок>
						<Источник>ЕдиныйНалог</Источник>
						<Приемник>ЕдиныйНалог</Приемник>
					</Значение>
					<Значение>
						<Код>2</Код>
						<Наименование>ЕдиныйНалогИНДС --&gt; ЕдиныйНалогИНДС</Наименование>
						<Порядок>100</Порядок>
						<Источник>ЕдиныйНалогИНДС</Источник>
						<Приемник>ЕдиныйНалогИНДС</Приемник>
					</Значение>
					<Значение>
						<Код>3</Код>
						<Наименование>НалогНаПрибыль --&gt; НалогНаПрибыль</Наименование>
						<Порядок>150</Порядок>
						<Источник>НалогНаПрибыль</Источник>
						<Приемник>НалогНаПрибыль</Приемник>
					</Значение>
					<Значение>
						<Код>4</Код>
						<Наименование>НалогНаПрибыльИНДС --&gt; НалогНаПрибыльИНДС</Наименование>
						<Порядок>200</Порядок>
						<Источник>НалогНаПрибыльИНДС</Источник>
						<Приемник>НалогНаПрибыльИНДС</Приемник>
					</Значение>
					<Значение>
						<Код>5</Код>
						<Наименование>НеПлательщик --&gt; НеПлательщик</Наименование>
						<Порядок>250</Порядок>
						<Источник>НеПлательщик</Источник>
						<Приемник>НеПлательщик</Приемник>
					</Значение>
				</Значения>
			</Правило>
		</Группа>
		<Группа>
			<Код>Перечисления</Код>
			<Наименование>Перечисления                                      </Наименование>
			<Порядок>150</Порядок>
			<Правило>
				<Код>ЮрФизЛицо</Код>
				<Наименование>Перечисление: Юр/Физлицо</Наименование>
				<Порядок>50</Порядок>
				<Источник>ПеречислениеСсылка.ЮрФизЛицо</Источник>
				<Приемник>ПеречислениеСсылка.ЮрФизЛицо</Приемник>
				<Свойства/>
				<Значения>
					<Значение>
						<Код>1</Код>
						<Наименование>ИндивидуальныйПредприниматель --&gt; ФизЛицо</Наименование>
						<Порядок>50</Порядок>
						<Источник>ИндивидуальныйПредприниматель</Источник>
						<Приемник>ФизЛицо</Приемник>
					</Значение>
					<Значение>
						<Код>2</Код>
						<Наименование>ФизЛицо --&gt; ФизЛицо</Наименование>
						<Порядок>100</Порядок>
						<Источник>ФизЛицо</Источник>
						<Приемник>ФизЛицо</Приемник>
					</Значение>
					<Значение>
						<Код>3</Код>
						<Наименование>ЮрЛицо --&gt; ЮрЛицо</Наименование>
						<Порядок>150</Порядок>
						<Источник>ЮрЛицо</Источник>
						<Приемник>ЮрЛицо</Приемник>
					</Значение>
					<Значение>
						<Код>4</Код>
						<Наименование>ЮрЛицоНеРезидент --&gt;</Наименование>
						<Порядок>200</Порядок>
						<Источник>ЮрЛицоНеРезидент</Источник>
						<Приемник>ЮрЛицо</Приемник>
					</Значение>
				</Значения>
			</Правило>
			<Правило>
				<Код>ВидыДоговоровКонтрагентов</Код>
				<Наименование>Справочник: Виды договоров</Наименование>
				<Порядок>100</Порядок>
				<Источник>ПеречислениеСсылка.ВидыДоговоров</Источник>
				<Приемник>ПеречислениеСсылка.ВидыДоговоровКонтрагентов</Приемник>
				<Свойства/>
				<Значения>
					<Значение>
						<Код>2</Код>
						<Наименование>Бартерный --&gt; Бартерный</Наименование>
						<Порядок>50</Порядок>
						<Источник>Бартерный</Источник>
						<Приемник>Бартерный</Приемник>
					</Значение>
					<Значение>
						<Код>3</Код>
						<Наименование>Бонус --&gt; Прочее</Наименование>
						<Порядок>100</Порядок>
						<Источник>Бонус</Источник>
						<Приемник>Прочее</Приемник>
					</Значение>
					<Значение>
						<Код>15</Код>
						<Наименование>Покупка --&gt; СПоставщиком</Наименование>
						<Порядок>150</Порядок>
						<Источник>Покупка</Источник>
						<Приемник>СПоставщиком</Приемник>
					</Значение>
					<Значение>
						<Код>24</Код>
						<Наименование>Продажа --&gt; СПокупателем</Наименование>
						<Порядок>200</Порядок>
						<Источник>Продажа</Источник>
						<Приемник>СПокупателем</Приемник>
					</Значение>
					<Значение>
						<Код>5</Код>
						<Наименование>Комиссия --&gt; СКомиссионером</Наименование>
						<Порядок>250</Порядок>
						<Источник>Комиссия</Источник>
						<Приемник>СКомиссионером</Приемник>
					</Значение>
					<Значение>
						<Код>4</Код>
						<Наименование>СКомитентом --&gt; СКомитентом</Наименование>
						<Порядок>300</Порядок>
						<Источник>СКомитентом</Источник>
						<Приемник>СКомитентом</Приемник>
					</Значение>
					<Значение>
						<Код>34</Код>
						<Наименование>УпрощеннаяКомиссия --&gt; Прочее</Наименование>
						<Порядок>350</Порядок>
						<Источник>УпрощеннаяКомиссия</Источник>
						<Приемник>Прочее</Приемник>
					</Значение>
					<Значение>
						<Код>27</Код>
						<Наименование>Прочее --&gt; Прочее</Наименование>
						<Порядок>400</Порядок>
						<Источник>Прочее</Источник>
						<Приемник>Прочее</Приемник>
					</Значение>
					<Значение>
						<Код>1</Код>
						<Наименование>Аренда --&gt; СПокупателем</Наименование>
						<Порядок>450</Порядок>
						<Приемник>СПокупателем</Приемник>
					</Значение>
					<Значение>
						<Код>6</Код>
						<Наименование>БухгалтерскиеУслуги --&gt; СПокупателем</Наименование>
						<Порядок>500</Порядок>
						<Приемник>СПокупателем</Приемник>
					</Значение>
					<Значение>
						<Код>7</Код>
						<Наименование>ВозвратнаяТара --&gt; Прочее</Наименование>
						<Порядок>550</Порядок>
						<Приемник>Прочее</Приемник>
					</Значение>
					<Значение>
						<Код>8</Код>
						<Наименование>ВыполнениеНИОКР --&gt; СПокупателем</Наименование>
						<Порядок>600</Порядок>
						<Приемник>СПокупателем</Приемник>
					</Значение>
					<Значение>
						<Код>9</Код>
						<Наименование>Госорганы --&gt; СПокупателем</Наименование>
						<Порядок>650</Порядок>
						<Приемник>СПокупателем</Приемник>
					</Значение>
					<Значение>
						<Код>10</Код>
						<Наименование>ЗаймКредитГарантии --&gt; СПокупателем</Наименование>
						<Порядок>700</Порядок>
						<Приемник>СПокупателем</Приемник>
					</Значение>
					<Значение>
						<Код>11</Код>
						<Наименование>КомиссияПоставка --&gt; СКомитентом</Наименование>
						<Порядок>750</Порядок>
						<Приемник>СКомитентом</Приемник>
					</Значение>
					<Значение>
						<Код>12</Код>
						<Наименование>КомиссияПродажа --&gt; СКомиссионером</Наименование>
						<Порядок>800</Порядок>
						<Приемник>СКомиссионером</Приемник>
					</Значение>
					<Значение>
						<Код>13</Код>
						<Наименование>Консалтинг --&gt; СПокупателем</Наименование>
						<Порядок>850</Порядок>
						<Приемник>СПокупателем</Приемник>
					</Значение>
					<Значение>
						<Код>14</Код>
						<Наименование>Маркетинг --&gt; СПокупателем</Наименование>
						<Порядок>900</Порядок>
						<Приемник>СПокупателем</Приемник>
					</Значение>
					<Значение>
						<Код>16</Код>
						<Наименование>Охрана --&gt; СПоставщиком</Наименование>
						<Порядок>950</Порядок>
						<Приемник>СПоставщиком</Приемник>
					</Значение>
					<Значение>
						<Код>17</Код>
						<Наименование>Перевозка --&gt; СПоставщиком</Наименование>
						<Порядок>1000</Порядок>
						<Приемник>СПоставщиком</Приемник>
					</Значение>
					<Значение>
						<Код>18</Код>
						<Наименование>ПеремещениеДС --&gt; Прочее</Наименование>
						<Порядок>1050</Порядок>
						<Приемник>Прочее</Приемник>
					</Значение>
					<Значение>
						<Код>19</Код>
						<Наименование>ПодборПерсонала --&gt; СПоставщиком</Наименование>
						<Порядок>1100</Порядок>
						<Приемник>СПоставщиком</Приемник>
					</Значение>
					<Значение>
						<Код>20</Код>
						<Наименование>Подписка --&gt; СПоставщиком</Наименование>
						<Порядок>1150</Порядок>
						<Приемник>СПоставщиком</Приемник>
					</Значение>
					<Значение>
						<Код>21</Код>
						<Наименование>Подряд --&gt; СПоставщиком</Наименование>
						<Порядок>1200</Порядок>
						<Приемник>СПоставщиком</Приемник>
					</Значение>
					<Значение>
						<Код>22</Код>
						<Наименование>Поставка --&gt; СПоставщиком</Наименование>
						<Порядок>1250</Порядок>
						<Приемник>СПоставщиком</Приемник>
					</Значение>
					<Значение>
						<Код>23</Код>
						<Наименование>ПоставкаПереводДолга --&gt; СПоставщиком</Наименование>
						<Порядок>1300</Порядок>
						<Приемник>СПоставщиком</Приемник>
					</Значение>
					<Значение>
						<Код>25</Код>
						<Наименование>ПродажаМобильныхПополнений --&gt; СПокупателем</Наименование>
						<Порядок>1350</Порядок>
						<Приемник>СПокупателем</Приемник>
					</Значение>
					<Значение>
						<Код>26</Код>
						<Наименование>ПродажаПоКартам --&gt; СПокупателем</Наименование>
						<Порядок>1400</Порядок>
						<Приемник>СПокупателем</Приемник>
					</Значение>
					<Значение>
						<Код>28</Код>
						<Наименование>Ссуда --&gt; Прочее</Наименование>
						<Порядок>1450</Порядок>
						<Приемник>Прочее</Приемник>
					</Значение>
					<Значение>
						<Код>29</Код>
						<Наименование>Страхование --&gt; Прочее</Наименование>
						<Порядок>1500</Порядок>
						<Приемник>СПоставщиком</Приемник>
					</Значение>
					<Значение>
						<Код>30</Код>
						<Наименование>Субаренда --&gt; СПокупателем</Наименование>
						<Порядок>1550</Порядок>
						<Приемник>СПокупателем</Приемник>
					</Значение>
					<Значение>
						<Код>31</Код>
						<Наименование>ТранспортноеЭкспедирование --&gt; СПоставщиком</Наименование>
						<Порядок>1600</Порядок>
						<Приемник>СПоставщиком</Приемник>
					</Значение>
					<Значение>
						<Код>32</Код>
						<Наименование>Хранение --&gt; СПоставщиком</Наименование>
						<Порядок>1650</Порядок>
						<Приемник>СПоставщиком</Приемник>
					</Значение>
					<Значение>
						<Код>33</Код>
						<Наименование>ЮридическиеУслуги --&gt; СПоставщиком</Наименование>
						<Порядок>1700</Порядок>
						<Приемник>СПоставщиком</Приемник>
					</Значение>
				</Значения>
			</Правило>
			<Правило>
				<Код>СтавкиНДС</Код>
				<Наименование>Справочник: Ставки НДС</Наименование>
				<Порядок>150</Порядок>
				<ПриВыгрузке>Если Источник = Справочники.СтавкиНДС.ОсновнаяСтавкаНДС
	ИЛИ Источник.Ставка = 20 Тогда
	
	УзелСсылки = "НДС20";
ИначеЕсли Источник = Справочники.СтавкиНДС.БезНДС Тогда
	УзелСсылки = "БезНДС";
ИначеЕсли Источник = Справочники.СтавкиНДС.НДС0 Тогда
	УзелСсылки = "НДС0";
ИначеЕсли Источник = Справочники.СтавкиНДС.НДС7 Тогда
	УзелСсылки = "НДС7";
КонецЕсли;

</ПриВыгрузке>
				<НеЗапоминатьВыгруженные>true</НеЗапоминатьВыгруженные>
				<Источник>СправочникСсылка.СтавкиНДС</Источник>
				<Приемник>ПеречислениеСсылка.СтавкиНДС</Приемник>
				<Свойства/>
				<Значения/>
			</Правило>
			<Правило>
				<Код>ПолФизическихЛиц</Код>
				<Наименование>Перечисление: Пол физического лица</Наименование>
				<Порядок>200</Порядок>
				<Источник>ПеречислениеСсылка.ПолФизическогоЛица</Источник>
				<Приемник>ПеречислениеСсылка.ПолФизическихЛиц</Приемник>
				<Свойства/>
				<Значения>
					<Значение>
						<Код>1</Код>
						<Наименование>Женский --&gt; Женский</Наименование>
						<Порядок>50</Порядок>
						<Источник>Женский</Источник>
						<Приемник>Женский</Приемник>
					</Значение>
					<Значение>
						<Код>2</Код>
						<Наименование>Мужской --&gt; Мужской</Наименование>
						<Порядок>100</Порядок>
						<Источник>Мужской</Источник>
						<Приемник>Мужской</Приемник>
					</Значение>
				</Значения>
			</Правило>
			<Правило>
				<Код>ТипыКонтактнойИнформации</Код>
				<Наименование>Перечисление: Типы контактной информации</Наименование>
				<Порядок>250</Порядок>
				<Источник>ПеречислениеСсылка.ТипыКонтактнойИнформации</Источник>
				<Приемник>ПеречислениеСсылка.ТипыКонтактнойИнформации</Приемник>
				<Свойства/>
				<Значения>
					<Значение>
						<Код>1</Код>
						<Наименование>Адрес --&gt; Адрес</Наименование>
						<Порядок>50</Порядок>
						<Источник>Адрес</Источник>
						<Приемник>Адрес</Приемник>
					</Значение>
					<Значение>
						<Код>2</Код>
						<Наименование>АдресЭлектроннойПочты --&gt; АдресЭлектроннойПочты</Наименование>
						<Порядок>100</Порядок>
						<Источник>АдресЭлектроннойПочты</Источник>
						<Приемник>АдресЭлектроннойПочты</Приемник>
					</Значение>
					<Значение>
						<Код>3</Код>
						<Наименование>ВебСтраница --&gt; ВебСтраница</Наименование>
						<Порядок>150</Порядок>
						<Источник>ВебСтраница</Источник>
						<Приемник>ВебСтраница</Приемник>
					</Значение>
					<Значение>
						<Код>4</Код>
						<Наименование>Другое --&gt; Другое</Наименование>
						<Порядок>200</Порядок>
						<Источник>Другое</Источник>
						<Приемник>Другое</Приемник>
					</Значение>
					<Значение>
						<Код>5</Код>
						<Наименование>Телефон --&gt; Телефон</Наименование>
						<Порядок>250</Порядок>
						<Источник>Телефон</Источник>
						<Приемник>Телефон</Приемник>
					</Значение>
				</Значения>
			</Правило>
		</Группа>
		<Группа>
			<Код>Документы</Код>
			<Наименование>Документы                                         </Наименование>
			<Порядок>200</Порядок>
			<Правило>
				<Код>ПоступлениеТоваров</Код>
				<Наименование>Документ: ПоступлениеТоваров</Наименование>
				<Порядок>50</Порядок>
				<ПередВыгрузкой>
Если Не Отказ Тогда 
	
	Транзит = Источник.ХозОперация = Справочники.ХозОперации.ПоступлениеТоваровТранзиты;
	
	ЗапрашиваемыеПараметры = Новый ТаблицаЗначений;
	ЗапрашиваемыеПараметры.Колонки.Добавить("Имя");
	ЗапрашиваемыеПараметры.Колонки.Добавить("Представление");
	ЗапрашиваемыеПараметры.Колонки.Добавить("Значение");
	
	ПриобретенияНУ = Новый ТаблицаЗначений;
	ПриобретенияНУ.Колонки.Добавить("ВидДвижения");
	ПриобретенияНУ.Колонки.Добавить("Период");
	ПриобретенияНУ.Колонки.Добавить("Активность");
	ПриобретенияНУ.Колонки.Добавить("Организация");  
	ПриобретенияНУ.Колонки.Добавить("ДоговорКонтрагента");
	ПриобретенияНУ.Колонки.Добавить("Событие");
	ПриобретенияНУ.Колонки.Добавить("СуммаВзаиморасчетов");
	
	ОжидаемыйНДС = Новый ТаблицаЗначений;
	ОжидаемыйНДС.Колонки.Добавить("ВидДвижения");
	ОжидаемыйНДС.Колонки.Добавить("Период");
	ОжидаемыйНДС.Колонки.Добавить("Активность");
	ОжидаемыйНДС.Колонки.Добавить("Организация");  
	ОжидаемыйНДС.Колонки.Добавить("ДоговорКонтрагента");
	ОжидаемыйНДС.Колонки.Добавить("СобытиеНДС");
	ОжидаемыйНДС.Колонки.Добавить("СтавкаНДС");
	ОжидаемыйНДС.Колонки.Добавить("ДляХозяйственнойДеятельности");
	ОжидаемыйНДС.Колонки.Добавить("ВидДеятельностиНДС");
	ОжидаемыйНДС.Колонки.Добавить("БазаНДС");
	ОжидаемыйНДС.Колонки.Добавить("СуммаНДС");
	ОжидаемыйНДС.Колонки.Добавить("КодОперации");
	
	Если Источник.Проведен Тогда
		КонтрагентВнутренний = ТК_СправочникиПовтИсп.ЭтоВнутреннийКонтрагент(Источник.Контрагент);
		
		Если Транзит Тогда
			Запросы.ПоступлениеТоваровТранзит.УстановитьПараметр("Ссылка", Источник);	
			ТаблицаПроводок = Запросы.ПоступлениеТоваровТранзит.Выполнить().Выгрузить();
			ТаблицаПроводок.ЗаполнитьЗначения(КонтрагентВнутренний, "ЭтоВнутренний");
			
			ПогрешностьСумма 	= 0;
			ПогрешностьСуммаНДС = 0;
			
			КолВоПроводок = ТаблицаПроводок.Количество();
			Ит = 0;
			Для Каждого Стр Из ТаблицаПроводок Цикл 
				Ит = Ит + 1;	
				
				Стр.Сумма = ОбщегоНазначенияТККлиентСервер.ОкруглитьСУчетомПогрешности(Стр.Сумма, 2, ПогрешностьСумма);
				Стр.СуммаНДС = ОбщегоНазначенияТККлиентСервер.ОкруглитьСУчетомПогрешности(Стр.СуммаНДС, 2, ПогрешностьСуммаНДС);
				
				Если Ит = КолВоПроводок Тогда 
					Стр.Сумма = ОбщегоНазначенияТККлиентСервер.ОкруглитьСУчетомПогрешности(Стр.Сумма, 2, ПогрешностьСумма);
					Стр.СуммаНДС = ОбщегоНазначенияТККлиентСервер.ОкруглитьСУчетомПогрешности(Стр.СуммаНДС, 2, ПогрешностьСуммаНДС);		
				КонецЕсли;
			КонецЦикла;			
			
		Иначе
			Дата = Источник.Дата;
			Организация = Источник.Организация;
			ДоговорКонтрагента = Источник.ДоговорВзаиморасчетов;
			СуммаДокумента= Источник.СуммаДокумента;		
			
			Запросы.ПоступлениеТоваров.УстановитьПараметр("Ссылка", Источник);	
			ТаблицаПроводок = Запросы.ПоступлениеТоваров.Выполнить().Выгрузить();
			ТаблицаПроводок.ЗаполнитьЗначения(КонтрагентВнутренний, "ЭтоВнутренний");
			
			ПогрешностьСумма 	= 0;
			ПогрешностьСуммаНДС = 0;
			
			КолВоПроводок = ТаблицаПроводок.Количество();
			Ит = 0;
			Для Каждого Стр Из ТаблицаПроводок Цикл 
				Ит = Ит + 1;	
				
				Стр.Сумма = ОбщегоНазначенияТККлиентСервер.ОкруглитьСУчетомПогрешности(Стр.Сумма, 2, ПогрешностьСумма);
				Стр.СуммаНДС = ОбщегоНазначенияТККлиентСервер.ОкруглитьСУчетомПогрешности(Стр.СуммаНДС, 2, ПогрешностьСуммаНДС);
				
				Если Ит = КолВоПроводок Тогда 
					Стр.Сумма = ОбщегоНазначенияТККлиентСервер.ОкруглитьСУчетомПогрешности(Стр.Сумма, 2, ПогрешностьСумма);
					Стр.СуммаНДС = ОбщегоНазначенияТККлиентСервер.ОкруглитьСУчетомПогрешности(Стр.СуммаНДС, 2, ПогрешностьСуммаНДС);		
				КонецЕсли;
			КонецЦикла;			
			
			
			// ПриобретенияНалоговыйУчет	
			НовоеДвижение = ПриобретенияНУ.Добавить();
			НовоеДвижение.ВидДвижения = ВидДвиженияНакопления.Приход;
			НовоеДвижение.Период = Дата;
			НовоеДвижение.Активность = Истина;
			НовоеДвижение.Организация = Организация;
			НовоеДвижение.ДоговорКонтрагента = ДоговорКонтрагента;
			НовоеДвижение.Событие = "ПоступлениеОтПоставщика";	
			НовоеДвижение.СуммаВзаиморасчетов = СуммаДокумента;
			
			// ОжидаемыйИПодтвержденныйНДСПриобретений 
			ТЗПроводки = ТаблицаПроводок.Скопировать(Новый Структура("Тара", Ложь), "Сумма, СуммаНДС, ЭтоПФ");
			ТЗПроводки.Свернуть("ЭтоПФ", "Сумма, СуммаНДС");	
			
			Для каждого СтрПроводки Из ТЗПроводки Цикл			
				НовоеДвижение = ОжидаемыйНДС.Добавить();
				НовоеДвижение.ВидДвижения = ВидДвиженияНакопления.Приход;
				НовоеДвижение.Период = Дата;
				НовоеДвижение.Активность = Истина;
				НовоеДвижение.Организация = Организация;
				НовоеДвижение.ДоговорКонтрагента = ДоговорКонтрагента;
				НовоеДвижение.СобытиеНДС = "Поступление";			
				НовоеДвижение.ДляХозяйственнойДеятельности = Истина;
				НовоеДвижение.ВидДеятельностиНДС = "Облагаемая";
				НовоеДвижение.КодОперации = "ОжидаемыйНДС";	
				
				Если СтрПроводки.ЭтоПФ Тогда    
					НовоеДвижение.СтавкаНДС = Справочники.СтавкиНДС.БезНДС;
					НовоеДвижение.БазаНДС = СтрПроводки.Сумма;
					НовоеДвижение.СуммаНДС = 0;
				Иначе	
					НовоеДвижение.СтавкаНДС = Справочники.СтавкиНДС.ОсновнаяСтавкаНДС;
					НовоеДвижение.БазаНДС = СтрПроводки.Сумма - СтрПроводки.СуммаНДС;
					НовоеДвижение.СуммаНДС = СтрПроводки.СуммаНДС;
				КонецЕсли; 		
			КонецЦикла;	
		КонецЕсли;
		
		// ЗапрашиваемыеПараметры
		НомерПроводки = 1;
		Для Каждого СтрВыборка Из ТаблицаПроводок Цикл 		
			Для Каждого Колонка Из ТаблицаПроводок.Колонки Цикл 
				Значение = СтрВыборка[Колонка.Имя];
				
				Если Колонка.Имя = "Сумма" 
					ИЛИ Колонка.Имя = "СуммаНДС"
					ИЛИ Колонка.Имя = "СуммаВсего" 
					ИЛИ Колонка.Имя = "Количество" Тогда
					
					Значение = Формат(Значение, "ЧН=0");
				КонецЕсли;
				
				НоваяСтрока = ЗапрашиваемыеПараметры.Добавить();
				НоваяСтрока.Имя =  "Проводка"+НомерПроводки;
				НоваяСтрока.Представление = Колонка.Имя;
				НоваяСтрока.Значение = Значение;
			КонецЦикла;
			НомерПроводки = НомерПроводки+1;
		КонецЦикла;

	КонецЕсли;
	
	ВходящиеДанные = Новый Структура;
	ВходящиеДанные.Вставить("Транзит", Транзит);
	ВходящиеДанные.Вставить("ЗапрашиваемыеПараметры", ЗапрашиваемыеПараметры);
	ВходящиеДанные.Вставить("ПриобретенияНалоговыйУчет", ПриобретенияНУ);
	ВходящиеДанные.Вставить("ОжидаемыйИПодтвержденныйНДСПриобретений", ОжидаемыйНДС);
	
КонецЕсли;</ПередВыгрузкой>
				<ПослеЗагрузки>Объект.Подразделение =Справочники.Подразделения.ПустаяСсылка();
Если НЕ Отказ Тогда			
	Если Не ЗначениеЗаполнено(Объект.ТиповаяОперация) Тогда
		тСообщение = "ОШИБКА, ЗАГРУЗКА ПРЕРВАНА, не найдена типовая операция с кодом ""ПТУ""";
		ВызватьИсключение(тСообщение);
	КонецЕсли;				
	
	Объект.ТаблицаРегистровНакопления.Очистить();
	Объект.Содержание = Объект.ТиповаяОперация.Наименование;
	
	Проведен = ПараметрыОбъекта.Получить("Проведен");
	Транзит = ПараметрыОбъекта.Получить("Транзит");
	
	Если Проведен Тогда
		Если Не Транзит Тогда
			НовРегНакопл = Объект.ТаблицаРегистровНакопления.Добавить();
			НовРегНакопл.Имя = "ПриобретенияНалоговыйУчет";
			НовРегНакопл.Представление = "Приобретения налоговый учет";
			
			НовРегНакопл = Объект.ТаблицаРегистровНакопления.Добавить();
			НовРегНакопл.Имя = "ОжидаемыйИПодтвержденныйНДСПриобретений";
			НовРегНакопл.Представление = "Ожидаемый и подтвержденный НДС приобретений";
		КонецЕсли;
		
		Выполнить(Алгоритмы.ЗаполнитьНаОснованииТиповойОперации);
	Иначе
		Объект.Движения.Хозрасчетный.Очистить();
		Объект.Движения.ПриобретенияНалоговыйУчет.Очистить();
		Объект.Движения.ОжидаемыйИПодтвержденныйНДСПриобретений.Очистить();
	КонецЕсли;
	
	ЗаписатьОбъект =  ПараметрыОбъекта.Получить("ЗаписатьОбъект");
	Если ЗаписатьОбъект = Неопределено Тогда
		ЗаписатьОбъект = Ложь;
	КонецЕсли;
	
	Если ЗаписатьОбъект Тогда		
		Выполнить(Алгоритмы.ЗаписатьСоответствиеОбъектов);
	КонецЕсли;
КонецЕсли;	</ПослеЗагрузки>
				<ПоследовательностьПолейПоиска>Параметры.ПараметрыАлгоритмов.Вставить("ВидОбъекта", "ОперацияБух");
Параметры.ПараметрыАлгоритмов.Вставить("ТипОбъектаИсточника", "ДокументСсылка.ПоступлениеТоваров");
СтрокаИменСвойствПоиска = "ПоискАлгоритмом";

Выполнить(Алгоритмы.ПолучитьСоответствиеОбъектов);

ПрекратитьПоиск = Истина;
</ПоследовательностьПолейПоиска>
				<ГенерироватьНовыйНомерИлиКодЕслиНеУказан>true</ГенерироватьНовыйНомерИлиКодЕслиНеУказан>
				<Источник>ДокументСсылка.ПоступлениеТоваров</Источник>
				<Приемник>ДокументСсылка.ОперацияБух</Приемник>
				<Свойства>
					<Свойство Поиск="true">
						<Код>1</Код>
						<Наименование>--&gt; GUID_Поиска</Наименование>
						<Порядок>50</Порядок>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="" Вид=""/>
						<ИмяПараметраДляПередачи>GUID_Поиска</ИмяПараметраДляПередачи>
						<ПередВыгрузкой>Значение = ЗначениеВСтрокуВнутр(Источник.УникальныйИдентификатор());</ПередВыгрузкой>
					</Свойство>
					<Свойство>
						<Код>2</Код>
						<Наименование>Проведен --&gt; Проведен</Наименование>
						<Порядок>100</Порядок>
						<Источник Имя="Проведен" Вид="Свойство" Тип="Булево"/>
						<Приемник Имя="" Вид=""/>
						<ИмяПараметраДляПередачи>Проведен</ИмяПараметраДляПередачи>
					</Свойство>
					<Свойство>
						<Код>9</Код>
						<Наименование>--&gt; Транзит</Наименование>
						<Порядок>150</Порядок>
						<ПолучитьИзВходящихДанных>true</ПолучитьИзВходящихДанных>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="" Вид=""/>
						<ИмяПараметраДляПередачи>Транзит</ИмяПараметраДляПередачи>
					</Свойство>
					<Свойство Отключить="true">
						<Код>7</Код>
						<Наименование>--&gt; ТипОбъектаИсточника</Наименование>
						<Порядок>200</Порядок>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="" Вид=""/>
						<ИмяПараметраДляПередачи>ТипОбъектаИсточника</ИмяПараметраДляПередачи>
					</Свойство>
					<Свойство>
						<Код>5</Код>
						<Наименование>Дата --&gt; Дата</Наименование>
						<Порядок>250</Порядок>
						<Источник Имя="Дата" Вид="Свойство" Тип="Дата"/>
						<Приемник Имя="Дата" Вид="Свойство" Тип="Дата"/>
					</Свойство>
					<Свойство>
						<Код>6</Код>
						<Наименование>--&gt; Организация</Наименование>
						<Порядок>300</Порядок>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="Организация" Вид="Измерение" Тип="СправочникСсылка.Организации"/>
						<КодПравилаКонвертации>Организации                                       </КодПравилаКонвертации>
						<ПередВыгрузкой>Значение = Источник.ДоговорВзаиморасчетов.Организация;</ПередВыгрузкой>
					</Свойство>
					<Свойство>
						<Код>4</Код>
						<Наименование>ПометкаУдаления --&gt; ПометкаУдаления</Наименование>
						<Порядок>350</Порядок>
						<Источник Имя="ПометкаУдаления" Вид="Свойство" Тип="Булево"/>
						<Приемник Имя="ПометкаУдаления" Вид="Свойство" Тип="Булево"/>
					</Свойство>
					<Свойство>
						<Код>8</Код>
						<Наименование>СуммаДокумента --&gt; СуммаОперации</Наименование>
						<Порядок>400</Порядок>
						<Источник Имя="СуммаДокумента" Вид="Реквизит" Тип="Число"/>
						<Приемник Имя="СуммаОперации" Вид="Реквизит" Тип="Число"/>
					</Свойство>
					<Свойство>
						<Код>35</Код>
						<Наименование>--&gt; Комментарий</Наименование>
						<Порядок>450</Порядок>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="Комментарий" Вид="Реквизит" Тип="Строка"/>
						<ПередВыгрузкой>Транзит = ВходящиеДанные.Транзит;
Значение = "ПТ " + Источник.Номер + ?(Транзит, " транзит", "");</ПередВыгрузкой>
					</Свойство>
					<Свойство>
						<Код>37</Код>
						<Наименование>--&gt; СпособЗаполнения</Наименование>
						<Порядок>500</Порядок>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="СпособЗаполнения" Вид="Реквизит"/>
						<ПередВыгрузкой>Значение = "ТиповыеОперации";</ПередВыгрузкой>
					</Свойство>
					<Свойство>
						<Код>38</Код>
						<Наименование>--&gt; ТиповаяОперация</Наименование>
						<Порядок>550</Порядок>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="ТиповаяОперация" Вид="Реквизит"/>
						<КодПравилаКонвертации>ТиповыеОперации                                   </КодПравилаКонвертации>
						<ПередВыгрузкой>Транзит = ВходящиеДанные.Транзит;
Если Транзит Тогда
	Значение = Новый Структура("Код", "ПТР1_1");
Иначе
	Значение = Новый Структура("Код", "ПТУ");
КонецЕсли;</ПередВыгрузкой>
					</Свойство>
					<Группа>
						<Код>10</Код>
						<Наименование>--&gt; ЗапрашиваемыеПараметры</Наименование>
						<Порядок>600</Порядок>
						<ПолучитьИзВходящихДанных>true</ПолучитьИзВходящихДанных>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="ЗапрашиваемыеПараметры" Вид="ТабличнаяЧасть"/>
						<Свойство>
							<Код>11</Код>
							<Наименование>--&gt; Имя</Наименование>
							<Порядок>50</Порядок>
							<Источник Имя="" Вид=""/>
							<Приемник Имя="Имя" Вид="Реквизит" Тип="Строка"/>
						</Свойство>
						<Свойство>
							<Код>12</Код>
							<Наименование>--&gt; Представление</Наименование>
							<Порядок>100</Порядок>
							<Источник Имя="" Вид=""/>
							<Приемник Имя="Представление" Вид="Реквизит" Тип="Строка"/>
						</Свойство>
						<Свойство>
							<Код>13</Код>
							<Наименование>--&gt; Значение</Наименование>
							<Порядок>150</Порядок>
							<Источник Имя="" Вид=""/>
							<Приемник Имя="Значение" Вид="Реквизит"/>
						</Свойство>
					</Группа>
					<Группа>
						<Код>14</Код>
						<Наименование>--&gt; ПриобретенияНалоговыйУчет</Наименование>
						<Порядок>650</Порядок>
						<ПолучитьИзВходящихДанных>true</ПолучитьИзВходящихДанных>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="ПриобретенияНалоговыйУчет" Вид="НаборДвиженийРегистраНакопления"/>
						<Свойство>
							<Код>20</Код>
							<Наименование>--&gt; ВидДвижения</Наименование>
							<Порядок>50</Порядок>
							<Источник Имя="" Вид=""/>
							<Приемник Имя="ВидДвижения" Вид="Свойство"/>
						</Свойство>
						<Свойство>
							<Код>21</Код>
							<Наименование>--&gt; Период</Наименование>
							<Порядок>100</Порядок>
							<Источник Имя="" Вид=""/>
							<Приемник Имя="Период" Вид="Свойство" Тип="Дата"/>
						</Свойство>
						<Свойство>
							<Код>19</Код>
							<Наименование>--&gt; Активность</Наименование>
							<Порядок>150</Порядок>
							<Источник Имя="" Вид=""/>
							<Приемник Имя="Активность" Вид="Свойство" Тип="Булево"/>
						</Свойство>
						<Свойство>
							<Код>16</Код>
							<Наименование>--&gt; Организация</Наименование>
							<Порядок>200</Порядок>
							<Источник Имя="" Вид=""/>
							<Приемник Имя="Организация" Вид="Измерение" Тип="СправочникСсылка.Организации"/>
							<КодПравилаКонвертации>Организации                                       </КодПравилаКонвертации>
						</Свойство>
						<Свойство>
							<Код>15</Код>
							<Наименование>--&gt; ДоговорКонтрагента</Наименование>
							<Порядок>250</Порядок>
							<Источник Имя="" Вид=""/>
							<Приемник Имя="ДоговорКонтрагента" Вид="Измерение" Тип="СправочникСсылка.ДоговорыКонтрагентов"/>
							<КодПравилаКонвертации>ДоговорыКонтрагентов                              </КодПравилаКонвертации>
						</Свойство>
						<Свойство>
							<Код>17</Код>
							<Наименование>--&gt; Событие</Наименование>
							<Порядок>300</Порядок>
							<Источник Имя="" Вид=""/>
							<Приемник Имя="Событие" Вид="Измерение" Тип="ПеречислениеСсылка.СобытияПриобретенияНалоговыйУчет"/>
						</Свойство>
						<Свойство>
							<Код>18</Код>
							<Наименование>--&gt; СуммаВзаиморасчетов</Наименование>
							<Порядок>350</Порядок>
							<Источник Имя="" Вид=""/>
							<Приемник Имя="СуммаВзаиморасчетов" Вид="Ресурс" Тип="Число"/>
						</Свойство>
						<Свойство Отключить="true">
							<Код>41</Код>
							<Наименование>--&gt; Регистратор</Наименование>
							<Порядок>400</Порядок>
							<Источник Имя="" Вид=""/>
							<Приемник Имя="Регистратор" Вид="Свойство"/>
							<КодПравилаКонвертации>ПоступлениеТоваров                                </КодПравилаКонвертации>
						</Свойство>
					</Группа>
					<Группа>
						<Код>22</Код>
						<Наименование>--&gt; ОжидаемыйИПодтвержденныйНДСПриобретений</Наименование>
						<Порядок>700</Порядок>
						<ПолучитьИзВходящихДанных>true</ПолучитьИзВходящихДанных>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="ОжидаемыйИПодтвержденныйНДСПриобретений" Вид="НаборДвиженийРегистраНакопления"/>
						<Свойство>
							<Код>33</Код>
							<Наименование>--&gt; ВидДвижения</Наименование>
							<Порядок>50</Порядок>
							<Источник Имя="" Вид=""/>
							<Приемник Имя="ВидДвижения" Вид="Свойство"/>
						</Свойство>
						<Свойство>
							<Код>34</Код>
							<Наименование>--&gt; Период</Наименование>
							<Порядок>100</Порядок>
							<Источник Имя="" Вид=""/>
							<Приемник Имя="Период" Вид="Свойство" Тип="Дата"/>
						</Свойство>
						<Свойство>
							<Код>32</Код>
							<Наименование>--&gt; Активность</Наименование>
							<Порядок>150</Порядок>
							<Источник Имя="" Вид=""/>
							<Приемник Имя="Активность" Вид="Свойство" Тип="Булево"/>
						</Свойство>
						<Свойство>
							<Код>26</Код>
							<Наименование>--&gt; Организация</Наименование>
							<Порядок>200</Порядок>
							<Источник Имя="" Вид=""/>
							<Приемник Имя="Организация" Вид="Измерение" Тип="СправочникСсылка.Организации"/>
							<КодПравилаКонвертации>Организации                                       </КодПравилаКонвертации>
						</Свойство>
						<Свойство>
							<Код>25</Код>
							<Наименование>--&gt; ДоговорКонтрагента</Наименование>
							<Порядок>250</Порядок>
							<Источник Имя="" Вид=""/>
							<Приемник Имя="ДоговорКонтрагента" Вид="Измерение" Тип="СправочникСсылка.ДоговорыКонтрагентов"/>
							<КодПравилаКонвертации>ДоговорыКонтрагентов                              </КодПравилаКонвертации>
						</Свойство>
						<Свойство>
							<Код>27</Код>
							<Наименование>--&gt; СобытиеНДС</Наименование>
							<Порядок>300</Порядок>
							<Источник Имя="" Вид=""/>
							<Приемник Имя="СобытиеНДС" Вид="Измерение" Тип="ПеречислениеСсылка.СобытияОжидаемыйИПодтвержденныйНДСПриобретений"/>
						</Свойство>
						<Свойство>
							<Код>28</Код>
							<Наименование>--&gt; СтавкаНДС</Наименование>
							<Порядок>350</Порядок>
							<Источник Имя="" Вид=""/>
							<Приемник Имя="СтавкаНДС" Вид="Измерение" Тип="ПеречислениеСсылка.СтавкиНДС"/>
							<КодПравилаКонвертации>СтавкиНДС                                         </КодПравилаКонвертации>
						</Свойство>
						<Свойство>
							<Код>24</Код>
							<Наименование>--&gt; ДляХозяйственнойДеятельности</Наименование>
							<Порядок>400</Порядок>
							<Источник Имя="" Вид=""/>
							<Приемник Имя="ДляХозяйственнойДеятельности" Вид="Измерение" Тип="Булево"/>
						</Свойство>
						<Свойство>
							<Код>23</Код>
							<Наименование>--&gt; ВидДеятельностиНДС</Наименование>
							<Порядок>450</Порядок>
							<Источник Имя="" Вид=""/>
							<Приемник Имя="ВидДеятельностиНДС" Вид="Измерение" Тип="ПеречислениеСсылка.ВидыДеятельностиНДС"/>
						</Свойство>
						<Свойство>
							<Код>30</Код>
							<Наименование>--&gt; БазаНДС</Наименование>
							<Порядок>500</Порядок>
							<Источник Имя="" Вид=""/>
							<Приемник Имя="БазаНДС" Вид="Ресурс" Тип="Число"/>
						</Свойство>
						<Свойство>
							<Код>31</Код>
							<Наименование>--&gt; СуммаНДС</Наименование>
							<Порядок>550</Порядок>
							<Источник Имя="" Вид=""/>
							<Приемник Имя="СуммаНДС" Вид="Ресурс" Тип="Число"/>
						</Свойство>
						<Свойство>
							<Код>29</Код>
							<Наименование>--&gt; КодОперации</Наименование>
							<Порядок>600</Порядок>
							<Источник Имя="" Вид=""/>
							<Приемник Имя="КодОперации" Вид="Реквизит" Тип="ПеречислениеСсылка.КодыОперацийОжидаемыйИПодтвержденныйНДСПриобретений"/>
						</Свойство>
						<Свойство Отключить="true">
							<Код>40</Код>
							<Наименование>--&gt; Регистратор</Наименование>
							<Порядок>650</Порядок>
							<Источник Имя="" Вид=""/>
							<Приемник Имя="Регистратор" Вид="Свойство"/>
							<КодПравилаКонвертации>ПоступлениеТоваров                                </КодПравилаКонвертации>
						</Свойство>
					</Группа>
				</Свойства>
				<Значения/>
			</Правило>
			<Правило>
				<Код>ВозвратПоставщику</Код>
				<Наименование>Документ: Возврат поставщику</Наименование>
				<Порядок>100</Порядок>
				<ПередВыгрузкой>Транзит = Источник.ХозОперация = Справочники.ХозОперации.ВозвратТоваровПоставщикуТранзиты;

ЗапрашиваемыеПараметры = Новый ТаблицаЗначений;
ЗапрашиваемыеПараметры.Колонки.Добавить("Имя");
ЗапрашиваемыеПараметры.Колонки.Добавить("Представление");
ЗапрашиваемыеПараметры.Колонки.Добавить("Значение");

ПриобретенияНУ = Новый ТаблицаЗначений;
ПриобретенияНУ.Колонки.Добавить("ВидДвижения");
ПриобретенияНУ.Колонки.Добавить("Период");
ПриобретенияНУ.Колонки.Добавить("Активность");
ПриобретенияНУ.Колонки.Добавить("Организация");  
ПриобретенияНУ.Колонки.Добавить("ДоговорКонтрагента");
ПриобретенияНУ.Колонки.Добавить("Событие");
ПриобретенияНУ.Колонки.Добавить("СуммаВзаиморасчетов");

ОжидаемыйНДС = Новый ТаблицаЗначений;
ОжидаемыйНДС.Колонки.Добавить("ВидДвижения");
ОжидаемыйНДС.Колонки.Добавить("Период");
ОжидаемыйНДС.Колонки.Добавить("Активность");
ОжидаемыйНДС.Колонки.Добавить("Организация");  
ОжидаемыйНДС.Колонки.Добавить("ДоговорКонтрагента");
ОжидаемыйНДС.Колонки.Добавить("СобытиеНДС");
ОжидаемыйНДС.Колонки.Добавить("СтавкаНДС");
ОжидаемыйНДС.Колонки.Добавить("ДляХозяйственнойДеятельности");
ОжидаемыйНДС.Колонки.Добавить("ВидДеятельностиНДС");
ОжидаемыйНДС.Колонки.Добавить("БазаНДС");
ОжидаемыйНДС.Колонки.Добавить("СуммаНДС");
ОжидаемыйНДС.Колонки.Добавить("КодОперации");

Если Источник.Проведен Тогда	
	Дата = Источник.Дата;
	Организация = Источник.ДоговорВзаиморасчетов.Организация;
	ДоговорКонтрагента = Источник.ДоговорВзаиморасчетов;
	СуммаДокумента= Источник.СуммаДокумента;
	КонтрагентВнутренний = ТК_СправочникиПовтИсп.ЭтоВнутреннийКонтрагент(Источник.Контрагент);
	
	Запросы.ВозвратПоставщику.УстановитьПараметр("Ссылка", Источник);	
	ТаблицаПроводок = Запросы.ВозвратПоставщику.Выполнить().Выгрузить();
	ТаблицаПроводок.ЗаполнитьЗначения(КонтрагентВнутренний, "ЭтоВнутренний");
	
	ПогрешностьСумма 	= 0;
	ПогрешностьСуммаНДС = 0;
	
	КолВоПроводок = ТаблицаПроводок.Количество();
	Ит = 0;
	Для Каждого Стр Из ТаблицаПроводок Цикл 
		Ит = Ит + 1;	
		
		Стр.Сумма = ОбщегоНазначенияТККлиентСервер.ОкруглитьСУчетомПогрешности(Стр.Сумма, 2, ПогрешностьСумма);
		Стр.СуммаНДС = ОбщегоНазначенияТККлиентСервер.ОкруглитьСУчетомПогрешности(Стр.СуммаНДС, 2, ПогрешностьСуммаНДС);
		
		Если Ит = КолВоПроводок Тогда 
			Стр.Сумма = ОбщегоНазначенияТККлиентСервер.ОкруглитьСУчетомПогрешности(Стр.Сумма, 2, ПогрешностьСумма);
			Стр.СуммаНДС = ОбщегоНазначенияТККлиентСервер.ОкруглитьСУчетомПогрешности(Стр.СуммаНДС, 2, ПогрешностьСуммаНДС);		
		КонецЕсли;
	КонецЦикла;	
	
	// ПриобретенияНалоговыйУчет	
	НовоеДвижение = ПриобретенияНУ.Добавить();
	НовоеДвижение.ВидДвижения = ВидДвиженияНакопления.Приход;
	НовоеДвижение.Период = Дата;
	НовоеДвижение.Активность = Истина;
	НовоеДвижение.Организация = Организация;
	НовоеДвижение.ДоговорКонтрагента = ДоговорКонтрагента;
	НовоеДвижение.Событие = "ВозвратПоставщику";	
	НовоеДвижение.СуммаВзаиморасчетов = СуммаДокумента;
	
	// ОжидаемыйИПодтвержденныйНДСПриобретений 
	ТЗПроводки = ТаблицаПроводок.Скопировать(Новый Структура("Тара", Ложь), "чСтавкаНДС, Сумма, СуммаНДС");
	ТЗПроводки.Свернуть("чСтавкаНДС", "Сумма, СуммаНДС");	
	
	Для каждого СтрПроводки Из ТЗПроводки Цикл			
		
		Если СтрПроводки.чСтавкаНДС = 20 Тогда
			ВидДеятельностиНДС = "Облагаемая";
			СтавкаНДС = Справочники.СтавкиНДС.ОсновнаяСтавкаНДС;
		ИначеЕсли СтрПроводки.чСтавкаНДС = 7 Тогда
			ВидДеятельностиНДС = "Облагаемая";
			СтавкаНДС = Справочники.СтавкиНДС.НДС7;
		ИначеЕсли СтрПроводки.чСтавкаНДС = 0 Тогда
			ВидДеятельностиНДС = "Необлагаемая";
			СтавкаНДС = Справочники.СтавкиНДС.БезНДС;
		Иначе
			ВидДеятельностиНДС = "";
			СтавкаНДС = Справочники.СтавкиНДС.ПустаяСсылка();
		КонецЕсли;
		
		
		НовоеДвижение = ОжидаемыйНДС.Добавить();
		НовоеДвижение.ВидДвижения = ВидДвиженияНакопления.Приход;
		НовоеДвижение.Период = Дата;
		НовоеДвижение.Активность = Истина;
		НовоеДвижение.Организация = Организация;
		НовоеДвижение.ДоговорКонтрагента = ДоговорКонтрагента;
		НовоеДвижение.СобытиеНДС = "Возврат";			
		НовоеДвижение.ДляХозяйственнойДеятельности = Истина;
		НовоеДвижение.ВидДеятельностиНДС = ВидДеятельностиНДС;
		НовоеДвижение.КодОперации = "ОжидаемыйНДС";	
		НовоеДвижение.СтавкаНДС = СтавкаНДС;
		НовоеДвижение.БазаНДС = СтрПроводки.Сумма - СтрПроводки.СуммаНДС;
		НовоеДвижение.СуммаНДС = СтрПроводки.СуммаНДС;
	КонецЦикла;	
	
	// ЗапрашиваемыеПараметры
	НомерПроводки = 1;
	Для Каждого СтрВыборка Из ТаблицаПроводок Цикл 		
		Для Каждого Колонка Из ТаблицаПроводок.Колонки Цикл 
			Значение = СтрВыборка[Колонка.Имя];
			
			Если Колонка.Имя = "Сумма" 
				ИЛИ Колонка.Имя = "СуммаНДС"
				ИЛИ Колонка.Имя = "СуммаВсего" 
				ИЛИ Колонка.Имя = "Количество" Тогда
				
				Значение = Формат(Значение, "ЧН=0; ЧГ=");
			КонецЕсли;
	
			НоваяСтрока = ЗапрашиваемыеПараметры.Добавить();
			НоваяСтрока.Имя =  "Проводка"+НомерПроводки;
			НоваяСтрока.Представление = Колонка.Имя;
			НоваяСтрока.Значение = Значение;
		КонецЦикла;
		НомерПроводки = НомерПроводки+1;
	КонецЦикла;
	
КонецЕсли;

ВходящиеДанные = Новый Структура;
ВходящиеДанные.Вставить("Транзит", Транзит);
ВходящиеДанные.Вставить("ЗапрашиваемыеПараметры", ЗапрашиваемыеПараметры);
ВходящиеДанные.Вставить("ПриобретенияНалоговыйУчет", ПриобретенияНУ);
ВходящиеДанные.Вставить("ОжидаемыйИПодтвержденныйНДСПриобретений", ОжидаемыйНДС);
</ПередВыгрузкой>
				<ПослеЗагрузки>Объект.Подразделение = Справочники.Подразделения.ПустаяСсылка();

Если НЕ Отказ Тогда			
	Проведен = ПараметрыОбъекта.Получить("Проведен");
	Транзит = ПараметрыОбъекта.Получить("Транзит");
	
	Если Не ЗначениеЗаполнено(Объект.ТиповаяОперация) Тогда
		Если Транзит Тогда
			тСообщение = "ОШИБКА, ЗАГРУЗКА ПРЕРВАНА, не найдена типовая операция с кодом ""ВТР1_1""";
		Иначе
			тСообщение = "ОШИБКА, ЗАГРУЗКА ПРЕРВАНА, не найдена типовая операция с кодом ""ВПОС""";
		КонецЕсли;
		
		ВызватьИсключение(тСообщение);
	КонецЕсли;				
	
		
	Объект.ТаблицаРегистровНакопления.Очистить();
	Объект.Содержание = Объект.ТиповаяОперация.Наименование;
		
	Если Проведен Тогда 
		НовРегНакопл = Объект.ТаблицаРегистровНакопления.Добавить();
		НовРегНакопл.Имя = "ПриобретенияНалоговыйУчет";
		НовРегНакопл.Представление = "Приобретения налоговый учет";
		
		НовРегНакопл = Объект.ТаблицаРегистровНакопления.Добавить();
		НовРегНакопл.Имя = "ОжидаемыйИПодтвержденныйНДСПриобретений";
		НовРегНакопл.Представление = "Ожидаемый и подтвержденный НДС приобретений";
		
		Выполнить(Алгоритмы.ЗаполнитьНаОснованииТиповойОперации);
	Иначе
		Объект.Движения.Хозрасчетный.Очистить();
		Объект.Движения.ПриобретенияНалоговыйУчет.Очистить();
		Объект.Движения.ОжидаемыйИПодтвержденныйНДСПриобретений.Очистить();	
	КонецЕсли;
	
	ЗаписатьОбъект =  ПараметрыОбъекта.Получить("ЗаписатьОбъект");
	Если ЗаписатьОбъект = Неопределено Тогда
		ЗаписатьОбъект = Ложь;
	КонецЕсли;
	
	Если ЗаписатьОбъект Тогда		
		Выполнить(Алгоритмы.ЗаписатьСоответствиеОбъектов);
	КонецЕсли;
КонецЕсли;	</ПослеЗагрузки>
				<ПоследовательностьПолейПоиска>Параметры.ПараметрыАлгоритмов.Вставить("ВидОбъекта","ОперацияБух");
Параметры.ПараметрыАлгоритмов.Вставить("ТипОбъектаИсточника", "ДокументСсылка.ВозвратПоставщику");
СтрокаИменСвойствПоиска = "ПоискАлгоритмом";

Выполнить(Алгоритмы.ПолучитьСоответствиеОбъектов);
ПрекратитьПоиск = Истина;
</ПоследовательностьПолейПоиска>
				<ГенерироватьНовыйНомерИлиКодЕслиНеУказан>true</ГенерироватьНовыйНомерИлиКодЕслиНеУказан>
				<Источник>ДокументСсылка.ВозвратПоставщику</Источник>
				<Приемник>ДокументСсылка.ОперацияБух</Приемник>
				<Свойства>
					<Свойство Поиск="true">
						<Код>1</Код>
						<Наименование>--&gt; GUID_Поиска</Наименование>
						<Порядок>50</Порядок>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="" Вид=""/>
						<ИмяПараметраДляПередачи>GUID_Поиска</ИмяПараметраДляПередачи>
						<ПередВыгрузкой>Значение = ЗначениеВСтрокуВнутр(Источник.УникальныйИдентификатор());</ПередВыгрузкой>
					</Свойство>
					<Свойство>
						<Код>6</Код>
						<Наименование>Проведен --&gt; Проведен</Наименование>
						<Порядок>100</Порядок>
						<Источник Имя="Проведен" Вид="Свойство" Тип="Булево"/>
						<Приемник Имя="" Вид=""/>
						<ИмяПараметраДляПередачи>Проведен</ИмяПараметраДляПередачи>
					</Свойство>
					<Свойство>
						<Код>38</Код>
						<Наименование>--&gt; Транзит</Наименование>
						<Порядок>150</Порядок>
						<ПолучитьИзВходящихДанных>true</ПолучитьИзВходящихДанных>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="" Вид=""/>
						<ИмяПараметраДляПередачи>Транзит</ИмяПараметраДляПередачи>
					</Свойство>
					<Свойство>
						<Код>2</Код>
						<Наименование>Дата --&gt; Дата</Наименование>
						<Порядок>200</Порядок>
						<Источник Имя="Дата" Вид="Свойство" Тип="Дата"/>
						<Приемник Имя="Дата" Вид="Свойство" Тип="Дата"/>
					</Свойство>
					<Свойство>
						<Код>4</Код>
						<Наименование>--&gt; Организация</Наименование>
						<Порядок>250</Порядок>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="Организация" Вид="Реквизит" Тип="СправочникСсылка.Организации"/>
						<КодПравилаКонвертации>Организации                                       </КодПравилаКонвертации>
						<ПередВыгрузкой>Значение = Источник.ДоговорВзаиморасчетов.Организация;</ПередВыгрузкой>
					</Свойство>
					<Свойство Отключить="true">
						<Код>7</Код>
						<Наименование>--&gt; Подразделение</Наименование>
						<Порядок>300</Порядок>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="Подразделение" Вид="Реквизит" Тип="СправочникСсылка.Подразделения"/>
						<КодПравилаКонвертации>Подразделения                                     </КодПравилаКонвертации>
						<ПередВыгрузкой>Значение = Неопределено;</ПередВыгрузкой>
					</Свойство>
					<Свойство>
						<Код>5</Код>
						<Наименование>ПометкаУдаления --&gt; ПометкаУдаления</Наименование>
						<Порядок>350</Порядок>
						<Источник Имя="ПометкаУдаления" Вид="Свойство" Тип="Булево"/>
						<Приемник Имя="ПометкаУдаления" Вид="Свойство" Тип="Булево"/>
					</Свойство>
					<Свойство>
						<Код>9</Код>
						<Наименование>СуммаДокумента --&gt; СуммаОперации</Наименование>
						<Порядок>400</Порядок>
						<Источник Имя="СуммаДокумента" Вид="Реквизит" Тип="Число"/>
						<Приемник Имя="СуммаОперации" Вид="Реквизит" Тип="Число"/>
					</Свойство>
					<Свойство>
						<Код>3</Код>
						<Наименование>--&gt; Комментарий</Наименование>
						<Порядок>450</Порядок>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="Комментарий" Вид="Реквизит" Тип="Строка"/>
						<ПередВыгрузкой>Транзит = ВходящиеДанные.Транзит;
Значение = "ВП " + Источник.Номер + ?(Транзит, " транзит", "");</ПередВыгрузкой>
					</Свойство>
					<Свойство>
						<Код>8</Код>
						<Наименование>--&gt; СпособЗаполнения</Наименование>
						<Порядок>500</Порядок>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="СпособЗаполнения" Вид="Реквизит"/>
						<ПередВыгрузкой>Значение = "ТиповыеОперации";</ПередВыгрузкой>
					</Свойство>
					<Свойство>
						<Код>10</Код>
						<Наименование>--&gt; ТиповаяОперация</Наименование>
						<Порядок>550</Порядок>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="ТиповаяОперация" Вид="Реквизит"/>
						<КодПравилаКонвертации>ТиповыеОперации                                   </КодПравилаКонвертации>
						<ПередВыгрузкой>Транзит = ВходящиеДанные.Транзит;
Если Транзит Тогда
	Значение = Новый Структура("Код", "ВТР1_1");
Иначе
	Значение = Новый Структура("Код", "ВПОС");
КонецЕсли;</ПередВыгрузкой>
					</Свойство>
					<Группа>
						<Код>11</Код>
						<Наименование>--&gt; ЗапрашиваемыеПараметры</Наименование>
						<Порядок>600</Порядок>
						<ПолучитьИзВходящихДанных>true</ПолучитьИзВходящихДанных>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="ЗапрашиваемыеПараметры" Вид="ТабличнаяЧасть"/>
						<Свойство>
							<Код>13</Код>
							<Наименование>--&gt; Имя</Наименование>
							<Порядок>50</Порядок>
							<Источник Имя="" Вид=""/>
							<Приемник Имя="Имя" Вид="Реквизит" Тип="Строка"/>
						</Свойство>
						<Свойство>
							<Код>14</Код>
							<Наименование>--&gt; Представление</Наименование>
							<Порядок>100</Порядок>
							<Источник Имя="" Вид=""/>
							<Приемник Имя="Представление" Вид="Реквизит" Тип="Строка"/>
						</Свойство>
						<Свойство>
							<Код>12</Код>
							<Наименование>--&gt; Значение</Наименование>
							<Порядок>150</Порядок>
							<Источник Имя="" Вид=""/>
							<Приемник Имя="Значение" Вид="Реквизит"/>
						</Свойство>
					</Группа>
					<Группа>
						<Код>29</Код>
						<Наименование>--&gt; ПриобретенияНалоговыйУчет</Наименование>
						<Порядок>650</Порядок>
						<ПолучитьИзВходящихДанных>true</ПолучитьИзВходящихДанных>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="ПриобретенияНалоговыйУчет" Вид="НаборДвиженийРегистраНакопления"/>
						<Свойство>
							<Код>35</Код>
							<Наименование>--&gt; ВидДвижения</Наименование>
							<Порядок>50</Порядок>
							<Источник Имя="" Вид=""/>
							<Приемник Имя="ВидДвижения" Вид="Свойство"/>
						</Свойство>
						<Свойство>
							<Код>36</Код>
							<Наименование>--&gt; Период</Наименование>
							<Порядок>100</Порядок>
							<Источник Имя="" Вид=""/>
							<Приемник Имя="Период" Вид="Свойство" Тип="Дата"/>
						</Свойство>
						<Свойство>
							<Код>34</Код>
							<Наименование>--&gt; Активность</Наименование>
							<Порядок>150</Порядок>
							<Источник Имя="" Вид=""/>
							<Приемник Имя="Активность" Вид="Свойство" Тип="Булево"/>
						</Свойство>
						<Свойство>
							<Код>31</Код>
							<Наименование>--&gt; Организация</Наименование>
							<Порядок>200</Порядок>
							<Источник Имя="" Вид=""/>
							<Приемник Имя="Организация" Вид="Измерение" Тип="СправочникСсылка.Организации"/>
							<КодПравилаКонвертации>Организации                                       </КодПравилаКонвертации>
						</Свойство>
						<Свойство>
							<Код>30</Код>
							<Наименование>--&gt; ДоговорКонтрагента</Наименование>
							<Порядок>250</Порядок>
							<Источник Имя="" Вид=""/>
							<Приемник Имя="ДоговорКонтрагента" Вид="Измерение" Тип="СправочникСсылка.ДоговорыКонтрагентов"/>
							<КодПравилаКонвертации>ДоговорыКонтрагентов                              </КодПравилаКонвертации>
						</Свойство>
						<Свойство>
							<Код>32</Код>
							<Наименование>--&gt; Событие</Наименование>
							<Порядок>300</Порядок>
							<Источник Имя="" Вид=""/>
							<Приемник Имя="Событие" Вид="Измерение" Тип="ПеречислениеСсылка.СобытияПриобретенияНалоговыйУчет"/>
						</Свойство>
						<Свойство>
							<Код>33</Код>
							<Наименование>--&gt; СуммаВзаиморасчетов</Наименование>
							<Порядок>350</Порядок>
							<Источник Имя="" Вид=""/>
							<Приемник Имя="СуммаВзаиморасчетов" Вид="Ресурс" Тип="Число"/>
						</Свойство>
						<Свойство Отключить="true">
							<Код>37</Код>
							<Наименование>--&gt; Регистратор</Наименование>
							<Порядок>400</Порядок>
							<Источник Имя="" Вид=""/>
							<Приемник Имя="Регистратор" Вид="Свойство"/>
							<КодПравилаКонвертации>ВозвратПоставщику                                 </КодПравилаКонвертации>
						</Свойство>
					</Группа>
					<Группа>
						<Код>15</Код>
						<Наименование>--&gt; ОжидаемыйИПодтвержденныйНДСПриобретений</Наименование>
						<Порядок>700</Порядок>
						<ПолучитьИзВходящихДанных>true</ПолучитьИзВходящихДанных>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="ОжидаемыйИПодтвержденныйНДСПриобретений" Вид="НаборДвиженийРегистраНакопления"/>
						<Свойство>
							<Код>26</Код>
							<Наименование>--&gt; ВидДвижения</Наименование>
							<Порядок>50</Порядок>
							<Источник Имя="" Вид=""/>
							<Приемник Имя="ВидДвижения" Вид="Свойство"/>
						</Свойство>
						<Свойство>
							<Код>27</Код>
							<Наименование>--&gt; Период</Наименование>
							<Порядок>100</Порядок>
							<Источник Имя="" Вид=""/>
							<Приемник Имя="Период" Вид="Свойство" Тип="Дата"/>
						</Свойство>
						<Свойство>
							<Код>25</Код>
							<Наименование>--&gt; Активность</Наименование>
							<Порядок>150</Порядок>
							<Источник Имя="" Вид=""/>
							<Приемник Имя="Активность" Вид="Свойство" Тип="Булево"/>
						</Свойство>
						<Свойство>
							<Код>19</Код>
							<Наименование>--&gt; Организация</Наименование>
							<Порядок>200</Порядок>
							<Источник Имя="" Вид=""/>
							<Приемник Имя="Организация" Вид="Измерение" Тип="СправочникСсылка.Организации"/>
							<КодПравилаКонвертации>Организации                                       </КодПравилаКонвертации>
						</Свойство>
						<Свойство>
							<Код>18</Код>
							<Наименование>--&gt; ДоговорКонтрагента</Наименование>
							<Порядок>250</Порядок>
							<Источник Имя="" Вид=""/>
							<Приемник Имя="ДоговорКонтрагента" Вид="Измерение" Тип="СправочникСсылка.ДоговорыКонтрагентов"/>
							<КодПравилаКонвертации>ДоговорыКонтрагентов                              </КодПравилаКонвертации>
						</Свойство>
						<Свойство>
							<Код>20</Код>
							<Наименование>--&gt; СобытиеНДС</Наименование>
							<Порядок>300</Порядок>
							<Источник Имя="" Вид=""/>
							<Приемник Имя="СобытиеНДС" Вид="Измерение" Тип="ПеречислениеСсылка.СобытияОжидаемыйИПодтвержденныйНДСПриобретений"/>
						</Свойство>
						<Свойство>
							<Код>21</Код>
							<Наименование>--&gt; СтавкаНДС</Наименование>
							<Порядок>350</Порядок>
							<Источник Имя="" Вид=""/>
							<Приемник Имя="СтавкаНДС" Вид="Измерение" Тип="ПеречислениеСсылка.СтавкиНДС"/>
							<КодПравилаКонвертации>СтавкиНДС                                         </КодПравилаКонвертации>
						</Свойство>
						<Свойство>
							<Код>17</Код>
							<Наименование>--&gt; ДляХозяйственнойДеятельности</Наименование>
							<Порядок>400</Порядок>
							<Источник Имя="" Вид=""/>
							<Приемник Имя="ДляХозяйственнойДеятельности" Вид="Измерение" Тип="Булево"/>
						</Свойство>
						<Свойство>
							<Код>16</Код>
							<Наименование>--&gt; ВидДеятельностиНДС</Наименование>
							<Порядок>450</Порядок>
							<Источник Имя="" Вид=""/>
							<Приемник Имя="ВидДеятельностиНДС" Вид="Измерение" Тип="ПеречислениеСсылка.ВидыДеятельностиНДС"/>
						</Свойство>
						<Свойство>
							<Код>23</Код>
							<Наименование>--&gt; БазаНДС</Наименование>
							<Порядок>500</Порядок>
							<Источник Имя="" Вид=""/>
							<Приемник Имя="БазаНДС" Вид="Ресурс" Тип="Число"/>
						</Свойство>
						<Свойство>
							<Код>24</Код>
							<Наименование>--&gt; СуммаНДС</Наименование>
							<Порядок>550</Порядок>
							<Источник Имя="" Вид=""/>
							<Приемник Имя="СуммаНДС" Вид="Ресурс" Тип="Число"/>
						</Свойство>
						<Свойство>
							<Код>22</Код>
							<Наименование>--&gt; КодОперации</Наименование>
							<Порядок>600</Порядок>
							<Источник Имя="" Вид=""/>
							<Приемник Имя="КодОперации" Вид="Реквизит" Тип="ПеречислениеСсылка.КодыОперацийОжидаемыйИПодтвержденныйНДСПриобретений"/>
						</Свойство>
						<Свойство Отключить="true">
							<Код>28</Код>
							<Наименование>--&gt; Регистратор</Наименование>
							<Порядок>650</Порядок>
							<Источник Имя="" Вид=""/>
							<Приемник Имя="Регистратор" Вид="Свойство"/>
							<КодПравилаКонвертации>ВозвратПоставщику                                 </КодПравилаКонвертации>
						</Свойство>
					</Группа>
				</Свойства>
				<Значения/>
			</Правило>
			<Правило>
				<Код>РеализацияТоваров</Код>
				<Наименование>Документ: Реализация товаров</Наименование>
				<Порядок>150</Порядок>
				<ПриВыгрузке>ЗапрашиваемыеПараметры = Новый ТаблицаЗначений;
ЗапрашиваемыеПараметры.Колонки.Добавить("Имя");
ЗапрашиваемыеПараметры.Колонки.Добавить("Представление");
ЗапрашиваемыеПараметры.Колонки.Добавить("Значение");

ПродажиНУ = Новый ТаблицаЗначений;
ПродажиНУ.Колонки.Добавить("ВидДвижения");
ПродажиНУ.Колонки.Добавить("Период");
ПродажиНУ.Колонки.Добавить("Активность");
ПродажиНУ.Колонки.Добавить("Организация");  
ПродажиНУ.Колонки.Добавить("ДоговорКонтрагента");
ПродажиНУ.Колонки.Добавить("Событие");
ПродажиНУ.Колонки.Добавить("СуммаВзаиморасчетов");

ОжидаемыйНДС = Новый ТаблицаЗначений;
ОжидаемыйНДС.Колонки.Добавить("ВидДвижения");
ОжидаемыйНДС.Колонки.Добавить("Период");
ОжидаемыйНДС.Колонки.Добавить("Активность");
ОжидаемыйНДС.Колонки.Добавить("Организация");  
ОжидаемыйНДС.Колонки.Добавить("ДоговорКонтрагента");
ОжидаемыйНДС.Колонки.Добавить("СобытиеНДС");
ОжидаемыйНДС.Колонки.Добавить("СтавкаНДС");
ОжидаемыйНДС.Колонки.Добавить("БазаНДС");
ОжидаемыйНДС.Колонки.Добавить("СуммаНДС");
ОжидаемыйНДС.Колонки.Добавить("КодОперации");

Если Источник.Проведен Тогда	
	Дата = Источник.Дата;
	Организация = Источник.Организация;
	ДоговорКонтрагента = Источник.ДоговорВзаиморасчетов;
	СуммаДокумента= Источник.СуммаДокумента;
	КонтрагентВнутренний = ТК_СправочникиПовтИсп.ЭтоВнутреннийКонтрагент(Источник.Контрагент);
	
	// ПриобретенияНалоговыйУчет	
	НовоеДвижение = ПродажиНУ.Добавить();
	НовоеДвижение.ВидДвижения = ВидДвиженияНакопления.Приход;
	НовоеДвижение.Период = Дата;
	НовоеДвижение.Активность = Истина;
	НовоеДвижение.Организация = Организация;
	НовоеДвижение.ДоговорКонтрагента = ДоговорКонтрагента;
	НовоеДвижение.Событие = "РеализацияПокупателю";	
	НовоеДвижение.СуммаВзаиморасчетов = СуммаДокумента;	
	
	Запросы.РеализацияТоваров.УстановитьПараметр("Ссылка", Источник);	
	Запросы.РеализацияТоваров.УстановитьПараметр("Дата", Источник.Дата);	
	
	МассивРезультатов = Запросы.РеализацияТоваров.ВыполнитьПакет();
	МаксИндекс = МассивРезультатов.ВГраница();
	
	ВыборкаНДС = МассивРезультатов[МаксИндекс-1].Выбрать();
	ВыборкаНДС.Следующий();
	
	ТаблицаПроводок = МассивРезультатов[МаксИндекс].Выгрузить();
	ТаблицаПроводок.ЗаполнитьЗначения(КонтрагентВнутренний, "ЭтоВнутренний");
	
	Если ТаблицаПроводок.Количество() &gt; 0 Тогда 	
		РазницаНДС = Окр(ВыборкаНДС.СуммаНДС, 2) - Окр(ТаблицаПроводок.Итог("СуммаНДС"), 2);
		РазницаСумма = Окр(ВыборкаНДС.Сумма, 2) - Окр(ТаблицаПроводок.Итог("Сумма"), 2);
		
		Если РазницаСумма &lt;&gt; 0 ИЛИ РазницаНДС &lt;&gt; 0 Тогда 
			ПоследняяСтрока = ТаблицаПроводок[ТаблицаПроводок.Количество()-1];
		КонецЕсли;
		
		Если РазницаНДС &lt;&gt; 0 Тогда 		
			ПоследняяСтрока.СуммаНДС = ПоследняяСтрока.СуммаНДС + РазницаНДС;
		КонецЕсли;
		
		Если РазницаСумма &lt;&gt; 0 Тогда 
			ПоследняяСтрока.Сумма = ПоследняяСтрока.Сумма + РазницаСумма;
		КонецЕсли;
	КонецЕсли;

	
	ТЗСобствНоменклатура = ТаблицаПроводок.Скопировать(Новый Структура("ПризнакПроводки, Тара", "ПоСобственнойНоменклатуре", Ложь), "Сумма, СуммаНДС");		
	ТЗКомиссНоменклатура = ТаблицаПроводок.Скопировать(Новый Структура("ПризнакПроводки, Тара", "ПоКомиссионнойНоменклатуре", Ложь), "Сумма, СуммаНДС");
	
	Если ТЗСобствНоменклатура.Количество() &gt; 0 Тогда 
		ТЗСобствНоменклатура.Свернуть(,"Сумма, СуммаНДС");	
		
		НоваяПроводка = ТаблицаПроводок.Добавить();
		НоваяПроводка.Контрагенты = Источник.Контрагент;
		НоваяПроводка.ЭтоВнутренний = КонтрагентВнутренний;
		НоваяПроводка.Договоры = ДоговорКонтрагента;
		НоваяПроводка.Склады = Источник.СкладКомпании;
		НоваяПроводка.Сумма = ТЗСобствНоменклатура[0].Сумма;
		НоваяПроводка.СуммаНДС = ТЗСобствНоменклатура[0].СуммаНДС;
		НоваяПроводка.СуммаПФ = 0;
		НоваяПроводка.Тара = Ложь;
		НоваяПроводка.ПФ = Ложь;
		НоваяПроводка.ПризнакПроводки = "ПоСобственнойНоменклатуреОбщ";
	КонецЕсли;
	
	Если ТЗКомиссНоменклатура.Количество() &gt; 0 Тогда 
		ТЗКомиссНоменклатура.Свернуть(,"Сумма, СуммаНДС");		
		
		НоваяПроводка = ТаблицаПроводок.Добавить();
		НоваяПроводка.Контрагенты = Источник.Контрагент;
		НоваяПроводка.ЭтоВнутренний = КонтрагентВнутренний;
		НоваяПроводка.Договоры = ДоговорКонтрагента;
		НоваяПроводка.Склады = Источник.СкладКомпании;
		НоваяПроводка.Сумма = ТЗКомиссНоменклатура[0].Сумма;
		НоваяПроводка.СуммаНДС = ТЗКомиссНоменклатура[0].СуммаНДС;
		НоваяПроводка.СуммаПФ = 0;
		НоваяПроводка.Тара = Ложь;
		НоваяПроводка.ПФ = Ложь;
		НоваяПроводка.ПризнакПроводки = "ПоКомиссионнойНоменклатуреОбщ";
	КонецЕсли;
	
	
	// ОжидаемыйИПодтвержденныйНДСПриобретений 	
	Если ТЗСобствНоменклатура.Количество() &gt; 0 Тогда 
		НовоеДвижение = ОжидаемыйНДС.Добавить();
		НовоеДвижение.ВидДвижения = ВидДвиженияНакопления.Приход;
		НовоеДвижение.Период = Дата;
		НовоеДвижение.Активность = Истина;
		НовоеДвижение.Организация = Организация;
		НовоеДвижение.ДоговорКонтрагента = ДоговорКонтрагента;
		НовоеДвижение.СобытиеНДС = "Реализация";			
		НовоеДвижение.КодОперации = "ОжидаемыйНДС";	
		НовоеДвижение.СтавкаНДС = Справочники.СтавкиНДС.ОсновнаяСтавкаНДС;
		НовоеДвижение.БазаНДС = ТЗСобствНоменклатура[0].Сумма - ТЗСобствНоменклатура[0].СуммаНДС;
		НовоеДвижение.СуммаНДС = ТЗСобствНоменклатура[0].СуммаНДС;
	КонецЕсли;
	
	// ЗапрашиваемыеПараметры
	НомерПроводки = 1;
	Для Каждого СтрВыборка Из ТаблицаПроводок Цикл 		
		Для Каждого Колонка Из ТаблицаПроводок.Колонки Цикл 
			Значение = СтрВыборка[Колонка.Имя];
			
			Если Колонка.Имя = "Сумма" 
				ИЛИ Колонка.Имя = "СуммаНДС"
				ИЛИ Колонка.Имя = "СуммаПФ" Тогда
				
				Значение = Формат(Значение, "ЧН=0");
			КонецЕсли;
			
			НоваяСтрока = ЗапрашиваемыеПараметры.Добавить();
			НоваяСтрока.Имя =  "Проводка"+НомерПроводки;
			НоваяСтрока.Представление = Колонка.Имя;
			НоваяСтрока.Значение = Значение;
			
			//Сообщить("Имя: " + НоваяСтрока.Имя + "; Представление: " + НоваяСтрока.Представление + "; Значение: " + НоваяСтрока.Значение);
		КонецЦикла;
		НомерПроводки = НомерПроводки+1;
	КонецЦикла;
	
КонецЕсли;

ВходящиеДанные = Новый Структура;
ВходящиеДанные.Вставить("ЗапрашиваемыеПараметры", ЗапрашиваемыеПараметры);
ВходящиеДанные.Вставить("ПродажиНалоговыйУчет", ПродажиНУ);
ВходящиеДанные.Вставить("ОжидаемыйИПодтвержденныйНДСПродаж", ОжидаемыйНДС);</ПриВыгрузке>
				<ПослеЗагрузки>Объект.Подразделение =Справочники.Подразделения.ПустаяСсылка();

Если НЕ Отказ Тогда			
	Если Не ЗначениеЗаполнено(Объект.ТиповаяОперация) Тогда
		тСообщение = "ОШИБКА, ЗАГРУЗКА ПРЕРВАНА, не найдена типовая операция с кодом ""РТУ""";
		ВызватьИсключение(тСообщение);
	КонецЕсли;				
	
	Объект.ТаблицаРегистровНакопления.Очистить();
	Объект.Содержание = Объект.ТиповаяОперация.Наименование;
	
	Проведен = ПараметрыОбъекта.Получить("Проведен");
	Если Проведен Тогда 
		НовРегНакопл = Объект.ТаблицаРегистровНакопления.Добавить();
		НовРегНакопл.Имя = "ПродажиНалоговыйУчет";
		НовРегНакопл.Представление = "Продажи налоговый учет";
		
		НовРегНакопл = Объект.ТаблицаРегистровНакопления.Добавить();
		НовРегНакопл.Имя = "ОжидаемыйИПодтвержденныйНДСПродаж";
		НовРегНакопл.Представление = "Ожидаемый и подтвержденный НДС продаж";
		
		Выполнить(Алгоритмы.ЗаполнитьНаОснованииТиповойОперации);
	Иначе
		Объект.Движения.Хозрасчетный.Очистить();
		Объект.Движения.ПродажиНалоговыйУчет.Очистить();
		Объект.Движения.ОжидаемыйИПодтвержденныйНДСПродаж.Очистить();
	КонецЕсли;
	
	ЗаписатьОбъект =  ПараметрыОбъекта.Получить("ЗаписатьОбъект");
	Если ЗаписатьОбъект = Неопределено Тогда
		ЗаписатьОбъект = Ложь;
	КонецЕсли;
	
	Если ЗаписатьОбъект Тогда		
		Выполнить(Алгоритмы.ЗаписатьСоответствиеОбъектов);
	КонецЕсли;
КонецЕсли;	</ПослеЗагрузки>
				<ПоследовательностьПолейПоиска>Параметры.ПараметрыАлгоритмов.Вставить("ВидОбъекта","ОперацияБух");
Параметры.ПараметрыАлгоритмов.Вставить("ТипОбъектаИсточника", "ДокументСсылка.РеализацияТоваров");
СтрокаИменСвойствПоиска = "ПоискАлгоритмом";

Выполнить(Алгоритмы.ПолучитьСоответствиеОбъектов);
ПрекратитьПоиск = Истина;
</ПоследовательностьПолейПоиска>
				<ГенерироватьНовыйНомерИлиКодЕслиНеУказан>true</ГенерироватьНовыйНомерИлиКодЕслиНеУказан>
				<Источник>ДокументСсылка.РеализацияТоваров</Источник>
				<Приемник>ДокументСсылка.ОперацияБух</Приемник>
				<Свойства>
					<Свойство Поиск="true">
						<Код>1</Код>
						<Наименование>--&gt; GUID_Поиска</Наименование>
						<Порядок>50</Порядок>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="" Вид=""/>
						<ИмяПараметраДляПередачи>GUID_Поиска</ИмяПараметраДляПередачи>
						<ПередВыгрузкой>Значение = ЗначениеВСтрокуВнутр(Источник.УникальныйИдентификатор());</ПередВыгрузкой>
					</Свойство>
					<Свойство>
						<Код>6</Код>
						<Наименование>Проведен --&gt; Проведен</Наименование>
						<Порядок>100</Порядок>
						<Источник Имя="Проведен" Вид="Свойство" Тип="Булево"/>
						<Приемник Имя="" Вид=""/>
						<ИмяПараметраДляПередачи>Проведен</ИмяПараметраДляПередачи>
					</Свойство>
					<Свойство>
						<Код>2</Код>
						<Наименование>Дата --&gt; Дата</Наименование>
						<Порядок>150</Порядок>
						<Источник Имя="Дата" Вид="Реквизит" Тип="Дата"/>
						<Приемник Имя="Дата" Вид="Свойство" Тип="Дата"/>
					</Свойство>
					<Свойство>
						<Код>4</Код>
						<Наименование>--&gt; Организация</Наименование>
						<Порядок>200</Порядок>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="Организация" Вид="Реквизит" Тип="СправочникСсылка.Организации"/>
						<КодПравилаКонвертации>Организации                                       </КодПравилаКонвертации>
						<ПередВыгрузкой>Значение = Источник.ДоговорВзаиморасчетов.Организация;</ПередВыгрузкой>
					</Свойство>
					<Свойство Отключить="true">
						<Код>25</Код>
						<Наименование>--&gt; Подразделение</Наименование>
						<Порядок>250</Порядок>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="Подразделение" Вид="Реквизит" Тип="СправочникСсылка.Подразделения"/>
						<КодПравилаКонвертации>Подразделения                                     </КодПравилаКонвертации>
						<ПередВыгрузкой>Значение = Неопределено;</ПередВыгрузкой>
					</Свойство>
					<Свойство>
						<Код>5</Код>
						<Наименование>ПометкаУдаления --&gt; ПометкаУдаления</Наименование>
						<Порядок>300</Порядок>
						<Источник Имя="ПометкаУдаления" Вид="Свойство" Тип="Булево"/>
						<Приемник Имя="ПометкаУдаления" Вид="Свойство" Тип="Булево"/>
					</Свойство>
					<Свойство>
						<Код>27</Код>
						<Наименование>СуммаДокумента --&gt; СуммаОперации</Наименование>
						<Порядок>350</Порядок>
						<Источник Имя="СуммаДокумента" Вид="Реквизит" Тип="Число"/>
						<Приемник Имя="СуммаОперации" Вид="Реквизит" Тип="Число"/>
					</Свойство>
					<Свойство>
						<Код>3</Код>
						<Наименование>--&gt; Комментарий</Наименование>
						<Порядок>400</Порядок>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="Комментарий" Вид="Реквизит" Тип="Строка"/>
						<ПередВыгрузкой>Значение = "РТ " + Источник.Номер;</ПередВыгрузкой>
					</Свойство>
					<Свойство>
						<Код>26</Код>
						<Наименование>--&gt; СпособЗаполнения</Наименование>
						<Порядок>450</Порядок>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="СпособЗаполнения" Вид="Реквизит"/>
						<ПередВыгрузкой>Значение = "ТиповыеОперации";</ПередВыгрузкой>
					</Свойство>
					<Свойство>
						<Код>28</Код>
						<Наименование>--&gt; ТиповаяОперация</Наименование>
						<Порядок>500</Порядок>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="ТиповаяОперация" Вид="Реквизит"/>
						<КодПравилаКонвертации>ТиповыеОперации                                   </КодПравилаКонвертации>
						<ПередВыгрузкой>Значение = Новый Структура("Код", "РТУ");</ПередВыгрузкой>
					</Свойство>
					<Группа>
						<Код>29</Код>
						<Наименование>--&gt; ЗапрашиваемыеПараметры</Наименование>
						<Порядок>550</Порядок>
						<ПолучитьИзВходящихДанных>true</ПолучитьИзВходящихДанных>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="ЗапрашиваемыеПараметры" Вид="ТабличнаяЧасть"/>
						<Свойство>
							<Код>31</Код>
							<Наименование>--&gt; Имя</Наименование>
							<Порядок>50</Порядок>
							<Источник Имя="" Вид=""/>
							<Приемник Имя="Имя" Вид="Реквизит" Тип="Строка"/>
						</Свойство>
						<Свойство>
							<Код>32</Код>
							<Наименование>--&gt; Представление</Наименование>
							<Порядок>100</Порядок>
							<Источник Имя="" Вид=""/>
							<Приемник Имя="Представление" Вид="Реквизит" Тип="Строка"/>
						</Свойство>
						<Свойство>
							<Код>30</Код>
							<Наименование>--&gt; Значение</Наименование>
							<Порядок>150</Порядок>
							<Источник Имя="" Вид=""/>
							<Приемник Имя="Значение" Вид="Реквизит"/>
						</Свойство>
					</Группа>
					<Группа>
						<Код>17</Код>
						<Наименование>--&gt; ПродажиНалоговыйУчет</Наименование>
						<Порядок>600</Порядок>
						<ПолучитьИзВходящихДанных>true</ПолучитьИзВходящихДанных>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="ПродажиНалоговыйУчет" Вид="НаборДвиженийРегистраНакопления"/>
						<Свойство>
							<Код>23</Код>
							<Наименование>--&gt; ВидДвижения</Наименование>
							<Порядок>50</Порядок>
							<Источник Имя="" Вид=""/>
							<Приемник Имя="ВидДвижения" Вид="Свойство"/>
						</Свойство>
						<Свойство>
							<Код>24</Код>
							<Наименование>--&gt; Период</Наименование>
							<Порядок>100</Порядок>
							<Источник Имя="" Вид=""/>
							<Приемник Имя="Период" Вид="Свойство" Тип="Дата"/>
						</Свойство>
						<Свойство>
							<Код>22</Код>
							<Наименование>--&gt; Активность</Наименование>
							<Порядок>150</Порядок>
							<Источник Имя="" Вид=""/>
							<Приемник Имя="Активность" Вид="Свойство" Тип="Булево"/>
						</Свойство>
						<Свойство>
							<Код>19</Код>
							<Наименование>--&gt; Организация</Наименование>
							<Порядок>200</Порядок>
							<Источник Имя="" Вид=""/>
							<Приемник Имя="Организация" Вид="Измерение" Тип="СправочникСсылка.Организации"/>
						</Свойство>
						<Свойство>
							<Код>18</Код>
							<Наименование>--&gt; ДоговорКонтрагента</Наименование>
							<Порядок>250</Порядок>
							<Источник Имя="" Вид=""/>
							<Приемник Имя="ДоговорКонтрагента" Вид="Измерение" Тип="СправочникСсылка.ДоговорыКонтрагентов"/>
						</Свойство>
						<Свойство>
							<Код>20</Код>
							<Наименование>--&gt; Событие</Наименование>
							<Порядок>300</Порядок>
							<Источник Имя="" Вид=""/>
							<Приемник Имя="Событие" Вид="Измерение" Тип="ПеречислениеСсылка.СобытияПродажиНалоговыйУчет"/>
						</Свойство>
						<Свойство>
							<Код>21</Код>
							<Наименование>--&gt; СуммаВзаиморасчетов</Наименование>
							<Порядок>350</Порядок>
							<Источник Имя="" Вид=""/>
							<Приемник Имя="СуммаВзаиморасчетов" Вид="Ресурс" Тип="Число"/>
						</Свойство>
					</Группа>
					<Группа>
						<Код>7</Код>
						<Наименование>--&gt; ОжидаемыйИПодтвержденныйНДСПродаж</Наименование>
						<Порядок>650</Порядок>
						<ПолучитьИзВходящихДанных>true</ПолучитьИзВходящихДанных>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="ОжидаемыйИПодтвержденныйНДСПродаж" Вид="НаборДвиженийРегистраНакопления"/>
						<Свойство>
							<Код>15</Код>
							<Наименование>--&gt; ВидДвижения</Наименование>
							<Порядок>50</Порядок>
							<Источник Имя="" Вид=""/>
							<Приемник Имя="ВидДвижения" Вид="Свойство"/>
						</Свойство>
						<Свойство>
							<Код>16</Код>
							<Наименование>--&gt; Период</Наименование>
							<Порядок>100</Порядок>
							<Источник Имя="" Вид=""/>
							<Приемник Имя="Период" Вид="Свойство" Тип="Дата"/>
						</Свойство>
						<Свойство>
							<Код>14</Код>
							<Наименование>--&gt; Активность</Наименование>
							<Порядок>150</Порядок>
							<Источник Имя="" Вид=""/>
							<Приемник Имя="Активность" Вид="Свойство" Тип="Булево"/>
						</Свойство>
						<Свойство>
							<Код>9</Код>
							<Наименование>--&gt; Организация</Наименование>
							<Порядок>200</Порядок>
							<Источник Имя="" Вид=""/>
							<Приемник Имя="Организация" Вид="Измерение" Тип="СправочникСсылка.Организации"/>
						</Свойство>
						<Свойство>
							<Код>8</Код>
							<Наименование>--&gt; ДоговорКонтрагента</Наименование>
							<Порядок>250</Порядок>
							<Источник Имя="" Вид=""/>
							<Приемник Имя="ДоговорКонтрагента" Вид="Измерение" Тип="СправочникСсылка.ДоговорыКонтрагентов"/>
						</Свойство>
						<Свойство>
							<Код>10</Код>
							<Наименование>--&gt; СобытиеНДС</Наименование>
							<Порядок>300</Порядок>
							<Источник Имя="" Вид=""/>
							<Приемник Имя="СобытиеНДС" Вид="Измерение" Тип="ПеречислениеСсылка.СобытияОжидаемыйИПодтвержденныйНДСПродаж"/>
						</Свойство>
						<Свойство>
							<Код>11</Код>
							<Наименование>--&gt; СтавкаНДС</Наименование>
							<Порядок>350</Порядок>
							<Источник Имя="" Вид=""/>
							<Приемник Имя="СтавкаНДС" Вид="Измерение" Тип="ПеречислениеСсылка.СтавкиНДС"/>
						</Свойство>
						<Свойство>
							<Код>12</Код>
							<Наименование>--&gt; БазаНДС</Наименование>
							<Порядок>400</Порядок>
							<Источник Имя="" Вид=""/>
							<Приемник Имя="БазаНДС" Вид="Ресурс" Тип="Число"/>
						</Свойство>
						<Свойство>
							<Код>13</Код>
							<Наименование>--&gt; СуммаНДС</Наименование>
							<Порядок>450</Порядок>
							<Источник Имя="" Вид=""/>
							<Приемник Имя="СуммаНДС" Вид="Ресурс" Тип="Число"/>
						</Свойство>
						<Свойство>
							<Код>33</Код>
							<Наименование>--&gt; КодОперации</Наименование>
							<Порядок>500</Порядок>
							<Источник Имя="" Вид=""/>
							<Приемник Имя="КодОперации" Вид="Реквизит" Тип="ПеречислениеСсылка.КодыОперацийОжидаемыйИПодтвержденныйНДСПродаж"/>
						</Свойство>
					</Группа>
				</Свойства>
				<Значения/>
			</Правило>
			<Правило>
				<Код>ВозвратОтПокупателя</Код>
				<Наименование>Документ: Возврат от покупателя</Наименование>
				<Порядок>200</Порядок>
				<ПриВыгрузке>ЗапрашиваемыеПараметры = Новый ТаблицаЗначений;
ЗапрашиваемыеПараметры.Колонки.Добавить("Имя");
ЗапрашиваемыеПараметры.Колонки.Добавить("Представление");
ЗапрашиваемыеПараметры.Колонки.Добавить("Значение");

ПродажиНУ = Новый ТаблицаЗначений;
ПродажиНУ.Колонки.Добавить("ВидДвижения");
ПродажиНУ.Колонки.Добавить("Период");
ПродажиНУ.Колонки.Добавить("Активность");
ПродажиНУ.Колонки.Добавить("Организация");  
ПродажиНУ.Колонки.Добавить("ДоговорКонтрагента");
ПродажиНУ.Колонки.Добавить("Событие");
ПродажиНУ.Колонки.Добавить("СуммаВзаиморасчетов");

ОжидаемыйНДС = Новый ТаблицаЗначений;
ОжидаемыйНДС.Колонки.Добавить("ВидДвижения");
ОжидаемыйНДС.Колонки.Добавить("Период");
ОжидаемыйНДС.Колонки.Добавить("Активность");
ОжидаемыйНДС.Колонки.Добавить("Организация");  
ОжидаемыйНДС.Колонки.Добавить("ДоговорКонтрагента");
ОжидаемыйНДС.Колонки.Добавить("СобытиеНДС");
ОжидаемыйНДС.Колонки.Добавить("СтавкаНДС");
ОжидаемыйНДС.Колонки.Добавить("БазаНДС");
ОжидаемыйНДС.Колонки.Добавить("СуммаНДС");
ОжидаемыйНДС.Колонки.Добавить("КодОперации");

Если Источник.Проведен Тогда	
	Дата = Источник.Дата;
	Организация = Источник.Организация;
	ДоговорКонтрагента = Источник.ДоговорВзаиморасчетов;
	СуммаДокумента= Источник.СуммаДокумента;
	
	// ПродажиНалоговыйУчет	
	НовоеДвижение = ПродажиНУ.Добавить();
	НовоеДвижение.ВидДвижения = ВидДвиженияНакопления.Приход;
	НовоеДвижение.Период = Дата;
	НовоеДвижение.Активность = Истина;
	НовоеДвижение.Организация = Организация;
	НовоеДвижение.ДоговорКонтрагента = ДоговорКонтрагента;
	НовоеДвижение.Событие = "ВозвратОтПокупателя";	
	НовоеДвижение.СуммаВзаиморасчетов = СуммаДокумента;	
	
	Запросы.ВозвратОтПокупателя.УстановитьПараметр("Ссылка", Источник);	
	Запросы.ВозвратОтПокупателя.УстановитьПараметр("Дата", Источник.Дата);	
	ТаблицаПроводок = Запросы.ВозвратОтПокупателя.Выполнить().Выгрузить();
	
	ТЗПроводки = ТаблицаПроводок.Скопировать(Новый Структура("Тара", Ложь), "Сумма, СуммаНДС");		
	ТЗПроводки.Свернуть(,"Сумма, СуммаНДС");	
		
	// ОжидаемыйИПодтвержденныйНДСПродажи
	Для каждого СтрПроводки Из ТЗПроводки Цикл
		НовоеДвижение = ОжидаемыйНДС.Добавить();
		НовоеДвижение.ВидДвижения = ВидДвиженияНакопления.Приход;
		НовоеДвижение.Период = Дата;
		НовоеДвижение.Активность = Истина;
		НовоеДвижение.Организация = Организация;
		НовоеДвижение.ДоговорКонтрагента = ДоговорКонтрагента;
		НовоеДвижение.СобытиеНДС = "Возврат";			
		НовоеДвижение.КодОперации = "ОжидаемыйНДС";	
		НовоеДвижение.СтавкаНДС = Справочники.СтавкиНДС.ОсновнаяСтавкаНДС;
		НовоеДвижение.БазаНДС = СтрПроводки.Сумма - СтрПроводки.СуммаНДС;
		НовоеДвижение.СуммаНДС = СтрПроводки.СуммаНДС;
	КонецЦикла;
	
	// ЗапрашиваемыеПараметры
	НомерПроводки = 1;
	Для Каждого СтрВыборка Из ТаблицаПроводок Цикл 		
		Для Каждого Колонка Из ТаблицаПроводок.Колонки Цикл 
			Значение = СтрВыборка[Колонка.Имя];
			
			Если Колонка.Имя = "Сумма" 
				ИЛИ Колонка.Имя = "СуммаНДС"
				ИЛИ Колонка.Имя = "Количество"
				ИЛИ Колонка.Имя = "СебестоимостьБезНДС" Тогда
				
				Значение = Формат(Значение, "ЧН=0");
			КонецЕсли;

			
			НоваяСтрока = ЗапрашиваемыеПараметры.Добавить();
			НоваяСтрока.Имя =  "Проводка"+НомерПроводки;
			НоваяСтрока.Представление = Колонка.Имя;
			НоваяСтрока.Значение = Значение;
		КонецЦикла;
		НомерПроводки = НомерПроводки+1;
	КонецЦикла;
	
КонецЕсли;

ВходящиеДанные = Новый Структура;
ВходящиеДанные.Вставить("ЗапрашиваемыеПараметры", ЗапрашиваемыеПараметры);
ВходящиеДанные.Вставить("ПродажиНалоговыйУчет", ПродажиНУ);
ВходящиеДанные.Вставить("ОжидаемыйИПодтвержденныйНДСПродаж", ОжидаемыйНДС);</ПриВыгрузке>
				<ПослеЗагрузки>Объект.Подразделение =Справочники.Подразделения.ПустаяСсылка();

Если НЕ Отказ Тогда			
	Если Не ЗначениеЗаполнено(Объект.ТиповаяОперация) Тогда
		тСообщение = "ОШИБКА, ЗАГРУЗКА ПРЕРВАНА, не найдена типовая операция с кодом ""ВПОК""";
		ВызватьИсключение(тСообщение);
	КонецЕсли;				
	
	Объект.ТаблицаРегистровНакопления.Очистить();
	Объект.Содержание = Объект.ТиповаяОперация.Наименование;
	
	Проведен = ПараметрыОбъекта.Получить("Проведен");
	Если Проведен Тогда 
		НовРегНакопл = Объект.ТаблицаРегистровНакопления.Добавить();
		НовРегНакопл.Имя = "ПродажиНалоговыйУчет";
		НовРегНакопл.Представление = "Продажи налоговый учет";
		
		НовРегНакопл = Объект.ТаблицаРегистровНакопления.Добавить();
		НовРегНакопл.Имя = "ОжидаемыйИПодтвержденныйНДСПродаж";
		НовРегНакопл.Представление = "Ожидаемый и подтвержденный НДС продаж";
		
		Выполнить(Алгоритмы.ЗаполнитьНаОснованииТиповойОперации);
	Иначе
		Объект.Движения.Хозрасчетный.Очистить();
		Объект.Движения.ПродажиНалоговыйУчет.Очистить();
		Объект.Движения.ОжидаемыйИПодтвержденныйНДСПродаж.Очистить();
	КонецЕсли;
	
	ЗаписатьОбъект =  ПараметрыОбъекта.Получить("ЗаписатьОбъект");
	Если ЗаписатьОбъект = Неопределено Тогда
		ЗаписатьОбъект = Ложь;
	КонецЕсли;
	
	Если ЗаписатьОбъект Тогда		
		Выполнить(Алгоритмы.ЗаписатьСоответствиеОбъектов);
	КонецЕсли;
КонецЕсли;	</ПослеЗагрузки>
				<ПоследовательностьПолейПоиска>Параметры.ПараметрыАлгоритмов.Вставить("ВидОбъекта","ОперацияБух");
Параметры.ПараметрыАлгоритмов.Вставить("ТипОбъектаИсточника", "ДокументСсылка.ВозвратОтПокупателя");
СтрокаИменСвойствПоиска = "ПоискАлгоритмом";

Выполнить(Алгоритмы.ПолучитьСоответствиеОбъектов);
ПрекратитьПоиск = Истина;
</ПоследовательностьПолейПоиска>
				<ГенерироватьНовыйНомерИлиКодЕслиНеУказан>true</ГенерироватьНовыйНомерИлиКодЕслиНеУказан>
				<Источник>ДокументСсылка.ВозвратОтПокупателя</Источник>
				<Приемник>ДокументСсылка.ОперацияБух</Приемник>
				<Свойства>
					<Свойство Поиск="true">
						<Код>1</Код>
						<Наименование>--&gt; GUID_Поиска</Наименование>
						<Порядок>50</Порядок>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="" Вид=""/>
						<ИмяПараметраДляПередачи>GUID_Поиска</ИмяПараметраДляПередачи>
						<ПередВыгрузкой>Значение = ЗначениеВСтрокуВнутр(Источник.УникальныйИдентификатор());</ПередВыгрузкой>
					</Свойство>
					<Свойство>
						<Код>33</Код>
						<Наименование>Проведен --&gt; Проведен</Наименование>
						<Порядок>100</Порядок>
						<Источник Имя="Проведен" Вид="Свойство" Тип="Булево"/>
						<Приемник Имя="" Вид=""/>
						<ИмяПараметраДляПередачи>Проведен</ИмяПараметраДляПередачи>
					</Свойство>
					<Свойство>
						<Код>2</Код>
						<Наименование>Дата --&gt; Дата</Наименование>
						<Порядок>150</Порядок>
						<Источник Имя="Дата" Вид="Свойство" Тип="Дата"/>
						<Приемник Имя="Дата" Вид="Свойство" Тип="Дата"/>
					</Свойство>
					<Свойство>
						<Код>4</Код>
						<Наименование>--&gt; Организация</Наименование>
						<Порядок>200</Порядок>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="Организация" Вид="Реквизит" Тип="СправочникСсылка.Организации"/>
						<КодПравилаКонвертации>Организации                                       </КодПравилаКонвертации>
						<ПередВыгрузкой>Значение = Источник.ДоговорВзаиморасчетов.Организация;</ПередВыгрузкой>
					</Свойство>
					<Свойство Отключить="true">
						<Код>25</Код>
						<Наименование>--&gt; Подразделение</Наименование>
						<Порядок>250</Порядок>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="Подразделение" Вид="Реквизит" Тип="СправочникСсылка.Подразделения"/>
						<КодПравилаКонвертации>Подразделения                                     </КодПравилаКонвертации>
						<ПередВыгрузкой>Значение = Неопределено;</ПередВыгрузкой>
					</Свойство>
					<Свойство>
						<Код>5</Код>
						<Наименование>ПометкаУдаления --&gt; ПометкаУдаления</Наименование>
						<Порядок>300</Порядок>
						<Источник Имя="ПометкаУдаления" Вид="Свойство" Тип="Булево"/>
						<Приемник Имя="ПометкаУдаления" Вид="Свойство" Тип="Булево"/>
					</Свойство>
					<Свойство>
						<Код>27</Код>
						<Наименование>СуммаДокумента --&gt; СуммаОперации</Наименование>
						<Порядок>350</Порядок>
						<Источник Имя="СуммаДокумента" Вид="Реквизит" Тип="Число"/>
						<Приемник Имя="СуммаОперации" Вид="Реквизит" Тип="Число"/>
					</Свойство>
					<Свойство>
						<Код>3</Код>
						<Наименование>--&gt; Комментарий</Наименование>
						<Порядок>400</Порядок>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="Комментарий" Вид="Реквизит" Тип="Строка"/>
						<ПередВыгрузкой>Значение = "ВЗ " + Источник.Номер;</ПередВыгрузкой>
					</Свойство>
					<Свойство>
						<Код>26</Код>
						<Наименование>--&gt; СпособЗаполнения</Наименование>
						<Порядок>450</Порядок>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="СпособЗаполнения" Вид="Реквизит"/>
						<ПередВыгрузкой>Значение = "ТиповыеОперации";</ПередВыгрузкой>
					</Свойство>
					<Свойство>
						<Код>28</Код>
						<Наименование>--&gt; ТиповаяОперация</Наименование>
						<Порядок>500</Порядок>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="ТиповаяОперация" Вид="Реквизит"/>
						<КодПравилаКонвертации>ТиповыеОперации                                   </КодПравилаКонвертации>
						<ПередВыгрузкой>Значение = Новый Структура("Код", "ВПОК");</ПередВыгрузкой>
					</Свойство>
					<Группа>
						<Код>29</Код>
						<Наименование>--&gt; ЗапрашиваемыеПараметры</Наименование>
						<Порядок>550</Порядок>
						<ПолучитьИзВходящихДанных>true</ПолучитьИзВходящихДанных>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="ЗапрашиваемыеПараметры" Вид="ТабличнаяЧасть"/>
						<Свойство>
							<Код>30</Код>
							<Наименование>--&gt; Значение</Наименование>
							<Порядок>50</Порядок>
							<Источник Имя="" Вид=""/>
							<Приемник Имя="Значение" Вид="Реквизит"/>
						</Свойство>
						<Свойство>
							<Код>31</Код>
							<Наименование>--&gt; Имя</Наименование>
							<Порядок>100</Порядок>
							<Источник Имя="" Вид=""/>
							<Приемник Имя="Имя" Вид="Реквизит" Тип="Строка"/>
						</Свойство>
						<Свойство>
							<Код>32</Код>
							<Наименование>--&gt; Представление</Наименование>
							<Порядок>150</Порядок>
							<Источник Имя="" Вид=""/>
							<Приемник Имя="Представление" Вид="Реквизит" Тип="Строка"/>
						</Свойство>
					</Группа>
					<Группа>
						<Код>17</Код>
						<Наименование>--&gt; ПродажиНалоговыйУчет</Наименование>
						<Порядок>600</Порядок>
						<ПолучитьИзВходящихДанных>true</ПолучитьИзВходящихДанных>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="ПродажиНалоговыйУчет" Вид="НаборДвиженийРегистраНакопления"/>
						<Свойство>
							<Код>23</Код>
							<Наименование>--&gt; ВидДвижения</Наименование>
							<Порядок>50</Порядок>
							<Источник Имя="" Вид=""/>
							<Приемник Имя="ВидДвижения" Вид="Свойство"/>
						</Свойство>
						<Свойство>
							<Код>24</Код>
							<Наименование>--&gt; Период</Наименование>
							<Порядок>100</Порядок>
							<Источник Имя="" Вид=""/>
							<Приемник Имя="Период" Вид="Свойство" Тип="Дата"/>
						</Свойство>
						<Свойство>
							<Код>22</Код>
							<Наименование>--&gt; Активность</Наименование>
							<Порядок>150</Порядок>
							<Источник Имя="" Вид=""/>
							<Приемник Имя="Активность" Вид="Свойство" Тип="Булево"/>
						</Свойство>
						<Свойство>
							<Код>19</Код>
							<Наименование>--&gt; Организация</Наименование>
							<Порядок>200</Порядок>
							<Источник Имя="" Вид=""/>
							<Приемник Имя="Организация" Вид="Измерение" Тип="СправочникСсылка.Организации"/>
							<КодПравилаКонвертации>Организации                                       </КодПравилаКонвертации>
						</Свойство>
						<Свойство>
							<Код>18</Код>
							<Наименование>--&gt; ДоговорКонтрагента</Наименование>
							<Порядок>250</Порядок>
							<Источник Имя="" Вид=""/>
							<Приемник Имя="ДоговорКонтрагента" Вид="Измерение" Тип="СправочникСсылка.ДоговорыКонтрагентов"/>
							<КодПравилаКонвертации>ДоговорыКонтрагентов                              </КодПравилаКонвертации>
						</Свойство>
						<Свойство>
							<Код>20</Код>
							<Наименование>--&gt; Событие</Наименование>
							<Порядок>300</Порядок>
							<Источник Имя="" Вид=""/>
							<Приемник Имя="Событие" Вид="Измерение" Тип="ПеречислениеСсылка.СобытияПродажиНалоговыйУчет"/>
						</Свойство>
						<Свойство>
							<Код>21</Код>
							<Наименование>--&gt; СуммаВзаиморасчетов</Наименование>
							<Порядок>350</Порядок>
							<Источник Имя="" Вид=""/>
							<Приемник Имя="СуммаВзаиморасчетов" Вид="Ресурс" Тип="Число"/>
						</Свойство>
					</Группа>
					<Группа>
						<Код>6</Код>
						<Наименование>--&gt; ОжидаемыйИПодтвержденныйНДСПродаж</Наименование>
						<Порядок>650</Порядок>
						<ПолучитьИзВходящихДанных>true</ПолучитьИзВходящихДанных>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="ОжидаемыйИПодтвержденныйНДСПродаж" Вид="НаборДвиженийРегистраНакопления"/>
						<Свойство>
							<Код>15</Код>
							<Наименование>--&gt; ВидДвижения</Наименование>
							<Порядок>50</Порядок>
							<Источник Имя="" Вид=""/>
							<Приемник Имя="ВидДвижения" Вид="Свойство"/>
						</Свойство>
						<Свойство>
							<Код>16</Код>
							<Наименование>--&gt; Период</Наименование>
							<Порядок>100</Порядок>
							<Источник Имя="" Вид=""/>
							<Приемник Имя="Период" Вид="Свойство" Тип="Дата"/>
						</Свойство>
						<Свойство>
							<Код>14</Код>
							<Наименование>--&gt; Активность</Наименование>
							<Порядок>150</Порядок>
							<Источник Имя="" Вид=""/>
							<Приемник Имя="Активность" Вид="Свойство" Тип="Булево"/>
						</Свойство>
						<Свойство>
							<Код>8</Код>
							<Наименование>--&gt; Организация</Наименование>
							<Порядок>200</Порядок>
							<Источник Имя="" Вид=""/>
							<Приемник Имя="Организация" Вид="Измерение" Тип="СправочникСсылка.Организации"/>
							<КодПравилаКонвертации>Организации                                       </КодПравилаКонвертации>
						</Свойство>
						<Свойство>
							<Код>7</Код>
							<Наименование>--&gt; ДоговорКонтрагента</Наименование>
							<Порядок>250</Порядок>
							<Источник Имя="" Вид=""/>
							<Приемник Имя="ДоговорКонтрагента" Вид="Измерение" Тип="СправочникСсылка.ДоговорыКонтрагентов"/>
							<КодПравилаКонвертации>ДоговорыКонтрагентов                              </КодПравилаКонвертации>
						</Свойство>
						<Свойство>
							<Код>9</Код>
							<Наименование>--&gt; СобытиеНДС</Наименование>
							<Порядок>300</Порядок>
							<Источник Имя="" Вид=""/>
							<Приемник Имя="СобытиеНДС" Вид="Измерение" Тип="ПеречислениеСсылка.СобытияОжидаемыйИПодтвержденныйНДСПродаж"/>
						</Свойство>
						<Свойство>
							<Код>10</Код>
							<Наименование>--&gt; СтавкаНДС</Наименование>
							<Порядок>350</Порядок>
							<Источник Имя="" Вид=""/>
							<Приемник Имя="СтавкаНДС" Вид="Измерение" Тип="ПеречислениеСсылка.СтавкиНДС"/>
							<КодПравилаКонвертации>СтавкиНДС                                         </КодПравилаКонвертации>
						</Свойство>
						<Свойство>
							<Код>12</Код>
							<Наименование>--&gt; БазаНДС</Наименование>
							<Порядок>400</Порядок>
							<Источник Имя="" Вид=""/>
							<Приемник Имя="БазаНДС" Вид="Ресурс" Тип="Число"/>
						</Свойство>
						<Свойство>
							<Код>13</Код>
							<Наименование>--&gt; СуммаНДС</Наименование>
							<Порядок>450</Порядок>
							<Источник Имя="" Вид=""/>
							<Приемник Имя="СуммаНДС" Вид="Ресурс" Тип="Число"/>
						</Свойство>
						<Свойство>
							<Код>11</Код>
							<Наименование>--&gt; КодОперации</Наименование>
							<Порядок>500</Порядок>
							<Источник Имя="" Вид=""/>
							<Приемник Имя="КодОперации" Вид="Реквизит" Тип="ПеречислениеСсылка.КодыОперацийОжидаемыйИПодтвержденныйНДСПродаж"/>
						</Свойство>
					</Группа>
				</Свойства>
				<Значения/>
			</Правило>
			<Правило>
				<Код>КорректировкаДолга</Код>
				<Наименование>Документ: Корректировка долга</Наименование>
				<Порядок>250</Порядок>
				<ПередВыгрузкой>ЗапрашиваемыеПараметры = Новый ТаблицаЗначений;
ЗапрашиваемыеПараметры.Колонки.Добавить("Имя");
ЗапрашиваемыеПараметры.Колонки.Добавить("Представление");
ЗапрашиваемыеПараметры.Колонки.Добавить("Значение");

Если Источник.Проведен Тогда	
	
	Запросы.КорректировкаДолга.УстановитьПараметр("Ссылка", Источник);	
	ТаблицаПроводок = Запросы.КорректировкаДолга.Выполнить().Выгрузить();
		
	// ЗапрашиваемыеПараметры
	НомерПроводки = 1;
	Для Каждого СтрВыборка Из ТаблицаПроводок Цикл 		
		Для Каждого Колонка Из ТаблицаПроводок.Колонки Цикл 
			Значение = СтрВыборка[Колонка.Имя];
			
			Если Колонка.Имя = "Сумма" 
				ИЛИ Колонка.Имя = "СуммаНДС" Тогда
				
				Значение = Формат(Значение, "ЧН=0");
			КонецЕсли;
					
			НоваяСтрока = ЗапрашиваемыеПараметры.Добавить();
			НоваяСтрока.Имя =  "Проводка"+НомерПроводки;
			НоваяСтрока.Представление = Колонка.Имя;
			НоваяСтрока.Значение =  Значение;
		КонецЦикла;
		НомерПроводки = НомерПроводки+1;
	КонецЦикла;
	
КонецЕсли;

ВходящиеДанные = Новый Структура;
ВходящиеДанные.Вставить("ЗапрашиваемыеПараметры", ЗапрашиваемыеПараметры);</ПередВыгрузкой>
				<ПослеЗагрузки>Объект.Подразделение =Справочники.Подразделения.ПустаяСсылка();

Если НЕ Отказ Тогда			
	Если Не ЗначениеЗаполнено(Объект.ТиповаяОперация) Тогда
		тСообщение = "ОШИБКА, ЗАГРУЗКА ПРЕРВАНА, не найдена типовая операция с кодом ""ДК""";
		ВызватьИсключение(тСообщение);
	КонецЕсли;				
	
	Объект.ТаблицаРегистровНакопления.Очистить();
	Объект.Содержание = Объект.ТиповаяОперация.Наименование;
	
	Проведен = ПараметрыОбъекта.Получить("Проведен");
	Если Проведен Тогда 
		Выполнить(Алгоритмы.ЗаполнитьНаОснованииТиповойОперации);
	Иначе
		Объект.Движения.Хозрасчетный.Очистить();
	КонецЕсли;
	
	ЗаписатьОбъект =  ПараметрыОбъекта.Получить("ЗаписатьОбъект");
	Если ЗаписатьОбъект = Неопределено Тогда
		ЗаписатьОбъект = Ложь;
	КонецЕсли;
	
	Если ЗаписатьОбъект Тогда		
		Выполнить(Алгоритмы.ЗаписатьСоответствиеОбъектов);
	КонецЕсли;
КонецЕсли;	</ПослеЗагрузки>
				<ПоследовательностьПолейПоиска>Параметры.ПараметрыАлгоритмов.Вставить("ВидОбъекта","ОперацияБух");
Параметры.ПараметрыАлгоритмов.Вставить("ТипОбъектаИсточника", "ДокументСсылка.ТК_КорректировкаДолга");
СтрокаИменСвойствПоиска = "ПоискАлгоритмом";

Выполнить(Алгоритмы.ПолучитьСоответствиеОбъектов);
ПрекратитьПоиск = Истина;
</ПоследовательностьПолейПоиска>
				<ГенерироватьНовыйНомерИлиКодЕслиНеУказан>true</ГенерироватьНовыйНомерИлиКодЕслиНеУказан>
				<Источник>ДокументСсылка.ТК_КорректировкаДолга</Источник>
				<Приемник>ДокументСсылка.ОперацияБух</Приемник>
				<Свойства>
					<Свойство Поиск="true">
						<Код>1</Код>
						<Наименование>--&gt; GUID_Поиска</Наименование>
						<Порядок>50</Порядок>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="" Вид=""/>
						<ИмяПараметраДляПередачи>GUID_Поиска</ИмяПараметраДляПередачи>
						<ПередВыгрузкой>Значение = ЗначениеВСтрокуВнутр(Источник.УникальныйИдентификатор());</ПередВыгрузкой>
					</Свойство>
					<Свойство>
						<Код>2</Код>
						<Наименование>Проведен --&gt; Проведен</Наименование>
						<Порядок>100</Порядок>
						<Источник Имя="Проведен" Вид="Свойство" Тип="Булево"/>
						<Приемник Имя="" Вид=""/>
						<ИмяПараметраДляПередачи>Проведен</ИмяПараметраДляПередачи>
					</Свойство>
					<Свойство>
						<Код>5</Код>
						<Наименование>Дата --&gt; Дата</Наименование>
						<Порядок>150</Порядок>
						<Источник Имя="Дата" Вид="Свойство" Тип="Дата"/>
						<Приемник Имя="Дата" Вид="Свойство" Тип="Дата"/>
					</Свойство>
					<Свойство>
						<Код>4</Код>
						<Наименование>Организация --&gt; Организация</Наименование>
						<Порядок>200</Порядок>
						<Источник Имя="Организация" Вид="Реквизит" Тип="СправочникСсылка.Организации"/>
						<Приемник Имя="Организация" Вид="Реквизит" Тип="СправочникСсылка.Организации"/>
						<КодПравилаКонвертации>Организации                                       </КодПравилаКонвертации>
					</Свойство>
					<Свойство Отключить="true">
						<Код>7</Код>
						<Наименование>--&gt; Подразделение</Наименование>
						<Порядок>250</Порядок>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="Подразделение" Вид="Реквизит" Тип="СправочникСсылка.Подразделения"/>
						<КодПравилаКонвертации>Подразделения                                     </КодПравилаКонвертации>
						<ПередВыгрузкой>Значение = Неопределено;</ПередВыгрузкой>
					</Свойство>
					<Свойство>
						<Код>6</Код>
						<Наименование>ПометкаУдаления --&gt; ПометкаУдаления</Наименование>
						<Порядок>300</Порядок>
						<Источник Имя="ПометкаУдаления" Вид="Свойство" Тип="Булево"/>
						<Приемник Имя="ПометкаУдаления" Вид="Свойство" Тип="Булево"/>
					</Свойство>
					<Свойство>
						<Код>14</Код>
						<Наименование>--&gt; СуммаОперации</Наименование>
						<Порядок>350</Порядок>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="СуммаОперации" Вид="Реквизит" Тип="Число"/>
						<ПередВыгрузкой>Значение = (Источник.СуммаДокументаПриход * -1) + Источник.СуммаДокументаРасход;</ПередВыгрузкой>
					</Свойство>
					<Свойство>
						<Код>3</Код>
						<Наименование>--&gt; Комментарий</Наименование>
						<Порядок>400</Порядок>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="Комментарий" Вид="Реквизит" Тип="Строка"/>
						<ПередВыгрузкой>Значение = "КД: " + Источник.Номер;</ПередВыгрузкой>
					</Свойство>
					<Свойство>
						<Код>8</Код>
						<Наименование>--&gt; СпособЗаполнения</Наименование>
						<Порядок>450</Порядок>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="СпособЗаполнения" Вид="Реквизит"/>
						<ПередВыгрузкой>Значение = "ТиповыеОперации";</ПередВыгрузкой>
					</Свойство>
					<Свойство>
						<Код>9</Код>
						<Наименование>--&gt; ТиповаяОперация</Наименование>
						<Порядок>500</Порядок>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="ТиповаяОперация" Вид="Реквизит"/>
						<КодПравилаКонвертации>ТиповыеОперации                                   </КодПравилаКонвертации>
						<ПередВыгрузкой>Значение = Новый Структура("Код", "КД");</ПередВыгрузкой>
					</Свойство>
					<Группа>
						<Код>10</Код>
						<Наименование>--&gt; ЗапрашиваемыеПараметры</Наименование>
						<Порядок>550</Порядок>
						<ПолучитьИзВходящихДанных>true</ПолучитьИзВходящихДанных>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="ЗапрашиваемыеПараметры" Вид="ТабличнаяЧасть"/>
						<Свойство>
							<Код>11</Код>
							<Наименование>--&gt; Значение</Наименование>
							<Порядок>50</Порядок>
							<Источник Имя="" Вид=""/>
							<Приемник Имя="Значение" Вид="Реквизит"/>
						</Свойство>
						<Свойство>
							<Код>12</Код>
							<Наименование>--&gt; Имя</Наименование>
							<Порядок>100</Порядок>
							<Источник Имя="" Вид=""/>
							<Приемник Имя="Имя" Вид="Реквизит" Тип="Строка"/>
						</Свойство>
						<Свойство>
							<Код>13</Код>
							<Наименование>--&gt; Представление</Наименование>
							<Порядок>150</Порядок>
							<Источник Имя="" Вид=""/>
							<Приемник Имя="Представление" Вид="Реквизит" Тип="Строка"/>
						</Свойство>
					</Группа>
				</Свойства>
				<Значения/>
			</Правило>
			<Правило>
				<Код>НалоговаяНакладная</Код>
				<Наименование>Документ: Налоговая накладная</Наименование>
				<Порядок>300</Порядок>
				<ПередВыгрузкой>Если Не ЗначениеЗаполнено(Источник.НомерДляБухгалтерии) Тогда
	
	ОбщегоНазначения.СообщитьПользователю(
		СтроковыеФункцииКлиентСервер.ПодставитьПараметрыВСтроку(
			"Документ %1 не выгружен! Не заполнен реквизит ""НомерДляБухгалтерии""",
			Строка(Источник)),
		Источник,,,
		Отказ);

КонецЕсли;

Если Не Отказ Тогда
	Если Источник.Проведен Тогда	
		РежимЗаписи = "Проведение";
	КонецЕсли;
	
	ТаблицаБух = Новый ТаблицаЗначений;
	ТаблицаБух.Колонки.Добавить("СтавкаНДС");
	ТаблицаБух.Колонки.Добавить("Количество");
	ТаблицаБух.Колонки.Добавить("Сумма");
	ТаблицаБух.Колонки.Добавить("СуммаНДС");	
	
	тчТовары = Источник.Товары.Выгрузить();
	тчТовары.Свернуть("СтавкаНДС", "Количество,СуммаВсего,СуммаНДС");
		
	тчТовары.Колонки.Добавить("Ставка");
	тчТовары.Колонки.Добавить("Сумма");		
	Для Каждого Стр Из тчТовары Цикл 
		Стр.Ставка = Стр.СтавкаНДС.Ставка;
		Стр.Сумма = Стр.СуммаВсего;
	КонецЦикла;
	
	тчТовары.Свернуть("Ставка", "Количество,Сумма,СуммаНДС");
	
	Для Каждого Стр Из тчТовары Цикл 
		НоваяСтрока = ТаблицаБух.Добавить();
		
		Если Стр.Ставка = 20 Тогда 
			СтавкаНДС = Справочники.СтавкиНДС.ОсновнаяСтавкаНДС;
		ИначеЕсли Стр.Ставка = 7 Тогда 
			СтавкаНДС = Справочники.СтавкиНДС.НДС7;
		ИначеЕсли Стр.Ставка = 0 Тогда 
			СтавкаНДС = Справочники.СтавкиНДС.БезНДС;
		Иначе
			СтавкаНДС = Справочники.СтавкиНДС.ПустаяСсылка();
		КонецЕсли;
		
		НоваяСтрока.СтавкаНДС = СтавкаНДС;
		НоваяСтрока.Количество = Стр.Количество;
		НоваяСтрока.СуммаНДС = Окр(Стр.СуммаНДС, 2);
		НоваяСтрока.Сумма    = Окр(Стр.Сумма, 2);
		//ЗаполнитьЗначенияСвойств(НоваяСтрока, Стр, "Количество,Сумма,СуммаНДС");	
	КонецЦикла;
	
	РазницаСумма = Окр(тчТовары.Итог("Сумма"), 2) - ТаблицаБух.Итог("Сумма");
	РазницаНДС   = Окр(тчТовары.Итог("СуммаНДС"), 2) - ТаблицаБух.Итог("СуммаНДС");
	
	Если РазницаСумма &lt;&gt; 0 ИЛИ РазницаНДС &lt;&gt; 0 Тогда 	
		СтрокаКорректировка = ТаблицаБух.Найти(Справочники.СтавкиНДС.ОсновнаяСтавкаНДС, "СтавкаНДС");
		Если СтрокаКорректировка = Неопределено Тогда 
			СтрокаКорректировка = ТаблицаБух[0];
		КонецЕсли;
		
		СтрокаКорректировка.Сумма 	 = СтрокаКорректировка.Сумма + РазницаСумма;
		СтрокаКорректировка.СуммаНДС = СтрокаКорректировка.СуммаНДС + РазницаНДС;	
	КонецЕсли;
	
	Услуги = Ложь;
	ВидОперации = "";
	СтавкаНДС = 20;
	
	Если тчТовары.Количество() &gt; 0 Тогда
		СтавкаНДС = тчТовары[0].Ставка;
	КонецЕсли;
	
	Если СтавкаНДС = 0 Тогда
		ВидОперации = "НеНДСОперации";
	Иначе
		ВидОперации = "ОблагаемыеОперации";
	КонецЕсли;
		
	Если Источник.ХозОперация = Справочники.ХозОперации.НалоговаяНакладнаяРозничнаяПродажа Тогда
		ВидОперации = "ИтоговаяРозницаОблагаемыеОперации";
	ИначеЕсли Источник.ХозОперация = Справочники.ХозОперации.НалоговаяНакладнаяАктУслуг Тогда
		Услуги = Истина;
	КонецЕсли;
	
	ВходящиеДанные = Новый Структура;
	ВходящиеДанные.Вставить("Товары", ТаблицаБух);
	ВходящиеДанные.Вставить("ВидОперации", ВидОперации);
	ВходящиеДанные.Вставить("ЭтоУслуги", Услуги);
КонецЕсли;</ПередВыгрузкой>
				<ПослеВыгрузкиВФайл>
Если Источник.РН Тогда
	ВыгрузитьПоПравилу(Источник, , , , "НалоговаяНакладная_РН");		
Иначе
	СтруктураПараметров = Новый Структура;
	СтруктураПараметров.Вставить("ТипОбъектаИсточника", "ДокументСсылка.ТК_НалоговаяНакладная_РН");
		
	ВыгрузитьПоПравилу(Источник, , СтруктураПараметров, , "ДокументНаУдаление");														
КонецЕсли;</ПослеВыгрузкиВФайл>
				<ПослеЗагрузки>Если НЕ Отказ Тогда			
	Проведен = ПараметрыОбъекта.Получить("Проведен");
	ПометкаУдаления = ПараметрыОбъекта.Получить("ПометкаУдаления");
	
	Если Объект.ЭтоНовый() Тогда
		Если Не ПометкаУдаления Тогда
			ИД = ПараметрыОбъекта.Получить("GUID_Поиска");
			ГУИД = ЗначениеИзСтрокиВнутр(ИД);				
			Ссылка = Документы.НалоговаяНакладная.ПолучитьСсылку(ГУИД);
			Если Не ОбщегоНазначения.СсылкаСуществует(Ссылка) Тогда		
				Объект.УстановитьСсылкуНового(Ссылка);
			КонецЕсли;
		Иначе
			Отказ = Истина;
		КонецЕсли;
	КонецЕсли;
КонецЕсли;	
	
Если НЕ Отказ Тогда				
	Если  Объект.ВидОперации = Перечисления.ВидыОперацийНалоговаяНакладная.ИтоговаяРозницаОсвобожденныеОперации
		ИЛИ Объект.ВидОперации = Перечисления.ВидыОперацийНалоговаяНакладная.ИтоговаяРозницаОблагаемыеОперации 
		ИЛИ Объект.ВидОперации = Перечисления.ВидыОперацийНалоговаяНакладная.РозницаКонрагентуОблагаемыеОперации 
		ИЛИ Объект.ВидОперации = Перечисления.ВидыОперацийНалоговаяНакладная.РозницаКонрагентуОсвобожденныеОперации Тогда
		Объект.СчетУчетаНДС = ПланыСчетов.Хозрасчетный.НалоговыеОбязательстваРозница;
	ИначеЕсли Объект.ВидОперации = Перечисления.ВидыОперацийНалоговаяНакладная.РаботыОтНерезидента Тогда
		Объект.СчетУчетаНДС = ПланыСчетов.Хозрасчетный.НалоговыйКредитНеподтвержденный;		
	ИначеЕсли Объект.ВидОперации = Перечисления.ВидыОперацийНалоговаяНакладная.УсловнаяПродажа Тогда
		Объект.СчетУчетаНДС = ПланыСчетов.Хозрасчетный.УсловнаяПродажа;	
	ИначеЕсли Объект.ВидОперации = Перечисления.ВидыОперацийНалоговаяНакладная.УсловнаяПродажаСписаниеОС Тогда
		Объект.СчетУчетаНДС = ПланыСчетов.Хозрасчетный.ПустаяСсылка();	
	Иначе
		СчетаУчета   = БухгалтерскийУчетРасчетовСКонтрагентами.ПолучитьСчетаРасчетовСКонтрагентом(Объект.Организация, Объект.Контрагент, Объект.ДоговорКонтрагента);
		Объект.СчетУчетаНДС = СчетаУчета.СчетУчетаНДСПродаж;
	КонецЕсли;
	
	Объект.ЗаполнитьВидДоговора();	
	Объект.УстановитьТипПричиныНевыдачиПокупателюПоУмолчанию();	
	ЗаполнениеДокументов.ЗаполнитьОбязательныеРеквизитыШапкиНовогоДокумента(Объект, глЗначениеПеременной("глТекущийПользователь"));
	
	тчТовары = Объект.Товары.Выгрузить();
	Услуги = ПараметрыОбъекта.Получить("ЭтоУслуги");
	
	Объект.Товары.Очистить();
	Объект.Услуги.Очистить();

	Если Услуги Тогда
		Номенклатура = Справочники.Номенклатура.НайтиПоКоду("00000000007");
		СтатьяДеклНДС = Справочники.СтатьиНалоговыхДеклараций.НДС_НОПоСтавке20;
		
		Для каждого СтрТовары Из тчТовары Цикл
			НоваяСтрокаТЧУслуги = Объект.Услуги.Добавить();
			НоваяСтрокаТЧУслуги.Номенклатура = Номенклатура;
			
			ОбработкаТабличныхЧастей.ЗаполнитьСтавкуНДСТабЧасти(НоваяСтрокаТЧУслуги, Объект);
			Объект.ОбновитьЗначениеЛьготыНДС(НоваяСтрокаТЧУслуги);
			Объект.ЗаполнитьСтатьюДекларацииНДСНалоговыеОбязательства(НоваяСтрокаТЧУслуги, "Услуги");
			ОбработкаТабличныхЧастей.ЗаполнитьСодержаниеТабЧасти(НоваяСтрокаТЧУслуги, Объект);
			
			НоваяСтрокаТЧУслуги.Количество = СтрТовары.Количество;
			НоваяСтрокаТЧУслуги.Цена = СтрТовары.Сумма/СтрТовары.Количество;
			НоваяСтрокаТЧУслуги.СуммаНДС = СтрТовары.СуммаНДС;
			НоваяСтрокаТЧУслуги.Сумма = СтрТовары.Сумма;
			//НоваяСтрокаТЧУслуги.ДатаОтгрузкиОплаты = СтрТовары.ДатаОтгрузкиОплаты;
			//НоваяСтрокаТЧУслуги.СуммаПревышения = СтрТовары.СуммаПревышения;
			//НоваяСтрокаТЧУслуги.СуммаНДСПревышения = СтрТовары.СуммаНДСПревышения;
			НоваяСтрокаТЧУслуги.СтавкаНДС = СтрТовары.СтавкаНДС;
			НоваяСтрокаТЧУслуги.СтатьяДекларацииНДСНалоговыеОбязательства = СтатьяДеклНДС;
		КонецЦикла;	
	Иначе
		Номенклатура = Справочники.Номенклатура.НайтиПоКоду("00000000008");
		СтатьяДеклНДС = Справочники.СтатьиНалоговыхДеклараций.НДС_НОПоСтавке20;
		мВалютаРегламентированногоУчета = Константы.ВалютаРегламентированногоУчета.Получить();
		
		Для каждого СтрТовары Из тчТовары Цикл
			НоваяСтрокаТЧТовары = Объект.Товары.Добавить();
			НоваяСтрокаТЧТовары.Номенклатура = Номенклатура;
			
			// Выполнить общие действия для всех документов при изменении номенклатуры.
			ОбработкаТабличныхЧастей.ПриИзмененииНоменклатурыТабЧасти(НоваяСтрокаТЧТовары, Объект);
			
			ОбработкаТабличныхЧастей.ЗаполнитьСтавкуНДСТабЧасти(НоваяСтрокаТЧТовары, Объект);
			Объект.ОбновитьЗначениеЛьготыНДС(НоваяСтрокаТЧТовары);
			ОбработкаТабличныхЧастей.ЗаполнитьЕдиницуЦенуПродажиТабЧасти(НоваяСтрокаТЧТовары, Объект, мВалютаРегламентированногоУчета);
			
			Объект.ЗаполнитьСчетаУчетаВСтрокеТабЧастиРегл(НоваяСтрокаТЧТовары, "Товары");
			НоваяСтрокаТЧТовары.Количество = СтрТовары.Количество;
			НоваяСтрокаТЧТовары.Цена = СтрТовары.Сумма/СтрТовары.Количество;
			НоваяСтрокаТЧТовары.СуммаНДС = СтрТовары.СуммаНДС;
			НоваяСтрокаТЧТовары.Сумма = СтрТовары.Сумма;
			//НоваяСтрокаТЧТовары.ДатаОтгрузкиОплаты = СтрТовары.ДатаОтгрузкиОплаты;
			//НоваяСтрокаТЧТовары.СуммаПревышения = СтрТовары.СуммаПревышения;
			//НоваяСтрокаТЧТовары.СуммаНДСПревышения = СтрТовары.СуммаНДСПревышения;
			НоваяСтрокаТЧТовары.СтавкаНДС = СтрТовары.СтавкаНДС;
			НоваяСтрокаТЧТовары.СтатьяДекларацииНДСНалоговыеОбязательства = СтатьяДеклНДС;			
		КонецЦикла;
	КонецЕсли;

	Объект.СуммаДокумента 	  = УчетНДС.ПолучитьСуммуДокументаСНДС(Объект); //с учетом стоимости возвратнонй тары
	Объект.СуммаНДСДокумента  = УчетНДС.ПолучитьНДСДокумента(Объект);	
	
	ЗаписатьОбъект =  ПараметрыОбъекта.Получить("ЗаписатьОбъект");
	Если ЗаписатьОбъект = Неопределено Тогда
		ЗаписатьОбъект = Ложь;
	КонецЕсли;
	
	Если ЗаписатьОбъект Тогда
		Выполнить(Алгоритмы.ЗаписатьСоответствиеОбъектов);
	КонецЕсли;
Иначе
	Сообщить("Загрузка отменена");
КонецЕсли;	</ПослеЗагрузки>
				<ПоследовательностьПолейПоиска>
Параметры.ПараметрыАлгоритмов.Вставить("ВидОбъекта","НалоговаяНакладная");
Параметры.ПараметрыАлгоритмов.Вставить("ТипОбъектаИсточника", "ДокументСсылка.ТК_НалоговаяНакладная");
СтрокаИменСвойствПоиска = "ПоискАлгоритмом";

Выполнить(Алгоритмы.ПолучитьСоответствиеОбъектов);

ПрекратитьПоиск = Истина;
	</ПоследовательностьПолейПоиска>
				<Источник>ДокументСсылка.ТК_НалоговаяНакладная</Источник>
				<Приемник>ДокументСсылка.НалоговаяНакладная</Приемник>
				<Свойства>
					<Свойство Поиск="true">
						<Код>4</Код>
						<Наименование>--&gt; GUID_Поиска</Наименование>
						<Порядок>50</Порядок>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="" Вид=""/>
						<ИмяПараметраДляПередачи>GUID_Поиска</ИмяПараметраДляПередачи>
						<ПередВыгрузкой>Значение = ЗначениеВСтрокуВнутр(Источник.УникальныйИдентификатор());</ПередВыгрузкой>
					</Свойство>
					<Свойство>
						<Код>37</Код>
						<Наименование>--&gt; ЭтоУслуги</Наименование>
						<Порядок>100</Порядок>
						<ПолучитьИзВходящихДанных>true</ПолучитьИзВходящихДанных>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="" Вид=""/>
						<ИмяПараметраДляПередачи>ЭтоУслуги</ИмяПараметраДляПередачи>
					</Свойство>
					<Свойство>
						<Код>3</Код>
						<Наименование>Проведен --&gt; Проведен</Наименование>
						<Порядок>150</Порядок>
						<Источник Имя="Проведен" Вид="Свойство" Тип="Булево"/>
						<Приемник Имя="" Вид=""/>
						<ИмяПараметраДляПередачи>Проведен</ИмяПараметраДляПередачи>
					</Свойство>
					<Свойство>
						<Код>17</Код>
						<Наименование>ПометкаУдаления --&gt; ПометкаУдаления</Наименование>
						<Порядок>200</Порядок>
						<Источник Имя="ПометкаУдаления" Вид="Свойство" Тип="Булево"/>
						<Приемник Имя="" Вид=""/>
						<ИмяПараметраДляПередачи>ПометкаУдаления</ИмяПараметраДляПередачи>
					</Свойство>
					<Свойство>
						<Код>35</Код>
						<Наименование>РН --&gt; РН</Наименование>
						<Порядок>250</Порядок>
						<Источник Имя="РН" Вид="Реквизит" Тип="Булево"/>
						<Приемник Имя="" Вид=""/>
						<ИмяПараметраДляПередачи>РН</ИмяПараметраДляПередачи>
					</Свойство>
					<Свойство>
						<Код>36</Код>
						<Наименование>--&gt; ВидОперации</Наименование>
						<Порядок>300</Порядок>
						<ПолучитьИзВходящихДанных>true</ПолучитьИзВходящихДанных>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="ВидОперации" Вид="Реквизит" Тип="ПеречислениеСсылка.ВидыОперацийНалоговаяНакладная"/>
					</Свойство>
					<Свойство>
						<Код>1</Код>
						<Наименование>НомерДляБухгалтерии --&gt; Номер</Наименование>
						<Порядок>350</Порядок>
						<Источник Имя="НомерДляБухгалтерии" Вид="Реквизит" Тип="Строка"/>
						<Приемник Имя="Номер" Вид="Свойство" Тип="Строка"/>
					</Свойство>
					<Свойство>
						<Код>2</Код>
						<Наименование>Дата --&gt; Дата</Наименование>
						<Порядок>400</Порядок>
						<Источник Имя="Дата" Вид="Свойство" Тип="Дата"/>
						<Приемник Имя="Дата" Вид="Свойство" Тип="Дата"/>
					</Свойство>
					<Свойство>
						<Код>5</Код>
						<Наименование>ВалютаДокумента --&gt; ВалютаДокумента</Наименование>
						<Порядок>450</Порядок>
						<Источник Имя="ВалютаДокумента" Вид="Реквизит" Тип="СправочникСсылка.Валюты"/>
						<Приемник Имя="ВалютаДокумента" Вид="Реквизит" Тип="СправочникСсылка.Валюты"/>
						<КодПравилаКонвертации>Валюты                                            </КодПравилаКонвертации>
					</Свойство>
					<Свойство>
						<Код>6</Код>
						<Наименование>ВключенаВЕдиныйРеестрНалоговыхНакладных --&gt; ВключенаВЕдиныйРеестрНалоговыхНакладных</Наименование>
						<Порядок>500</Порядок>
						<Источник Имя="ВключенаВЕдиныйРеестрНалоговыхНакладных" Вид="Реквизит" Тип="Булево"/>
						<Приемник Имя="ВключенаВЕдиныйРеестрНалоговыхНакладных" Вид="Реквизит" Тип="Булево"/>
					</Свойство>
					<Свойство>
						<Код>7</Код>
						<Наименование>--&gt; Комментарий</Наименование>
						<Порядок>550</Порядок>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="Комментарий" Вид="Реквизит" Тип="Строка"/>
						<ПередВыгрузкой>Значение = "Загружено из ТК (УФ) " + Источник.Комментарий;</ПередВыгрузкой>
					</Свойство>
					<Свойство>
						<Код>8</Код>
						<Наименование>Контрагент --&gt; Контрагент</Наименование>
						<Порядок>600</Порядок>
						<Источник Имя="Контрагент" Вид="Реквизит" Тип="СправочникСсылка.Контрагенты"/>
						<Приемник Имя="Контрагент" Вид="Реквизит" Тип="СправочникСсылка.Контрагенты"/>
						<КодПравилаКонвертации>Контрагенты                                       </КодПравилаКонвертации>
					</Свойство>
					<Свойство>
						<Код>9</Код>
						<Наименование>КтоВыписалНалоговуюНакладную --&gt; КтоВыписалНалоговуюНакладную</Наименование>
						<Порядок>650</Порядок>
						<Источник Имя="КтоВыписалНалоговуюНакладную" Вид="Реквизит" Тип="СправочникСсылка.ФизическиеЛица"/>
						<Приемник Имя="КтоВыписалНалоговуюНакладную" Вид="Реквизит" Тип="СправочникСсылка.ФизическиеЛица"/>
						<КодПравилаКонвертации>ФизическиеЛица                                    </КодПравилаКонвертации>
					</Свойство>
					<Свойство>
						<Код>10</Код>
						<Наименование>Организация --&gt; Организация</Наименование>
						<Порядок>700</Порядок>
						<Источник Имя="Организация" Вид="Реквизит" Тип="СправочникСсылка.Организации"/>
						<Приемник Имя="Организация" Вид="Реквизит" Тип="СправочникСсылка.Организации"/>
						<КодПравилаКонвертации>Организации                                       </КодПравилаКонвертации>
					</Свойство>
					<Свойство>
						<Код>13</Код>
						<Наименование>ТипПричиныНевыдачиПокупателю --&gt; ТипПричиныНевыдачиПокупателю</Наименование>
						<Порядок>750</Порядок>
						<Источник Имя="ТипПричиныНевыдачиПокупателю" Вид="Реквизит" Тип="Число"/>
						<Приемник Имя="ТипПричиныНевыдачиПокупателю" Вид="Реквизит" Тип="Число"/>
					</Свойство>
					<Свойство>
						<Код>14</Код>
						<Наименование>ТребуетВключенияВЕдиныйРеестрНалоговыхНакладных --&gt; ТребуетВключенияВЕдиныйРеестрНалоговыхНакладных</Наименование>
						<Порядок>800</Порядок>
						<Источник Имя="ТребуетВключенияВЕдиныйРеестрНалоговыхНакладных" Вид="Реквизит" Тип="Булево"/>
						<Приемник Имя="ТребуетВключенияВЕдиныйРеестрНалоговыхНакладных" Вид="Реквизит" Тип="Булево"/>
					</Свойство>
					<Свойство>
						<Код>15</Код>
						<Наименование>УсловиеПродажи --&gt; УсловиеПродажи</Наименование>
						<Порядок>850</Порядок>
						<Источник Имя="УсловиеПродажи" Вид="Реквизит" Тип="Строка"/>
						<Приемник Имя="УсловиеПродажи" Вид="Реквизит" Тип="Строка"/>
					</Свойство>
					<Свойство>
						<Код>16</Код>
						<Наименование>ФормаРасчетов --&gt; ФормаРасчетов</Наименование>
						<Порядок>900</Порядок>
						<Источник Имя="ФормаРасчетов" Вид="Реквизит" Тип="Строка"/>
						<Приемник Имя="ФормаРасчетов" Вид="Реквизит" Тип="Строка"/>
					</Свойство>
					<Свойство>
						<Код>18</Код>
						<Наименование>ДоговорВзаиморасчетов --&gt; ДоговорКонтрагента</Наименование>
						<Порядок>950</Порядок>
						<Источник Имя="ДоговорВзаиморасчетов" Вид="Реквизит" Тип="СправочникСсылка.ДоговорыКонтрагентов"/>
						<Приемник Имя="ДоговорКонтрагента" Вид="Реквизит" Тип="СправочникСсылка.ДоговорыКонтрагентов"/>
						<КодПравилаКонвертации>ДоговорыКонтрагентов                              </КодПравилаКонвертации>
					</Свойство>
					<Свойство>
						<Код>19</Код>
						<Наименование>КурсДокумента --&gt; КурсВзаиморасчетов</Наименование>
						<Порядок>1000</Порядок>
						<Источник Имя="КурсДокумента" Вид="Реквизит" Тип="Число"/>
						<Приемник Имя="КурсВзаиморасчетов" Вид="Реквизит" Тип="Число"/>
					</Свойство>
					<Свойство>
						<Код>20</Код>
						<Наименование>--&gt; АвторасчетНДС</Наименование>
						<Порядок>1050</Порядок>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="АвторасчетНДС" Вид="Реквизит" Тип="Булево"/>
						<ПередВыгрузкой>Значение = Ложь;</ПередВыгрузкой>
					</Свойство>
					<Свойство>
						<Код>21</Код>
						<Наименование>--&gt; КратностьВзаиморасчетов</Наименование>
						<Порядок>1100</Порядок>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="КратностьВзаиморасчетов" Вид="Реквизит" Тип="Число"/>
						<ПередВыгрузкой>Значение = 1;</ПередВыгрузкой>
					</Свойство>
					<Свойство>
						<Код>23</Код>
						<Наименование>--&gt; СуммаВключаетНДС</Наименование>
						<Порядок>1150</Порядок>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="СуммаВключаетНДС" Вид="Реквизит" Тип="Булево"/>
						<ПередВыгрузкой>Значение = Истина;</ПередВыгрузкой>
					</Свойство>
					<Свойство>
						<Код>24</Код>
						<Наименование>--&gt; СчетДт</Наименование>
						<Порядок>1200</Порядок>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="СчетДт" Вид="Реквизит" Тип="ПланСчетовСсылка.Хозрасчетный"/>
						<ПередВыгрузкой>Значение = "ВычетыИзДохода";</ПередВыгрузкой>
					</Свойство>
					<Свойство>
						<Код>25</Код>
						<Наименование>--&gt; СчетНДС</Наименование>
						<Порядок>1250</Порядок>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="СчетНДС" Вид="Реквизит" Тип="ПланСчетовСсылка.Хозрасчетный"/>
						<ПередВыгрузкой>Значение = "РасчетыПоНДС";</ПередВыгрузкой>
					</Свойство>
					<Свойство>
						<Код>26</Код>
						<Наименование>--&gt; СчетУчетаНДС</Наименование>
						<Порядок>1300</Порядок>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="СчетУчетаНДС" Вид="Реквизит" Тип="ПланСчетовСсылка.Хозрасчетный"/>
					</Свойство>
					<Свойство>
						<Код>29</Код>
						<Наименование>--&gt; УчитыватьНДС</Наименование>
						<Порядок>1350</Порядок>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="УчитыватьНДС" Вид="Реквизит" Тип="Булево"/>
						<ПередВыгрузкой>Значение = Истина;</ПередВыгрузкой>
					</Свойство>
					<Свойство>
						<Код>38</Код>
						<Наименование>--&gt; НалоговоеНазначениеДоходовИЗатрат</Наименование>
						<Порядок>1400</Порядок>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="НалоговоеНазначениеДоходовИЗатрат" Вид="Реквизит" Тип="СправочникСсылка.НалоговыеНазначенияАктивовИЗатрат"/>
						<ПередВыгрузкой>Значение = "НКУ_ХозДеятельность";</ПередВыгрузкой>
					</Свойство>
					<Группа>
						<Код>30</Код>
						<Наименование>--&gt; Товары</Наименование>
						<Порядок>1450</Порядок>
						<ПолучитьИзВходящихДанных>true</ПолучитьИзВходящихДанных>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="Товары" Вид="ТабличнаяЧасть"/>
						<Свойство>
							<Код>32</Код>
							<Наименование>--&gt; СтавкаНДС</Наименование>
							<Порядок>50</Порядок>
							<Источник Имя="" Вид=""/>
							<Приемник Имя="СтавкаНДС" Вид="Реквизит" Тип="ПеречислениеСсылка.СтавкиНДС"/>
							<КодПравилаКонвертации>СтавкиНДС                                         </КодПравилаКонвертации>
						</Свойство>
						<Свойство>
							<Код>31</Код>
							<Наименование>--&gt; Количество</Наименование>
							<Порядок>100</Порядок>
							<Источник Имя="" Вид=""/>
							<Приемник Имя="Количество" Вид="Реквизит" Тип="Число"/>
						</Свойство>
						<Свойство>
							<Код>33</Код>
							<Наименование>--&gt; Сумма</Наименование>
							<Порядок>150</Порядок>
							<Источник Имя="" Вид=""/>
							<Приемник Имя="Сумма" Вид="Реквизит" Тип="Число"/>
						</Свойство>
						<Свойство>
							<Код>34</Код>
							<Наименование>--&gt; СуммаНДС</Наименование>
							<Порядок>200</Порядок>
							<Источник Имя="" Вид=""/>
							<Приемник Имя="СуммаНДС" Вид="Реквизит" Тип="Число"/>
						</Свойство>
					</Группа>
				</Свойства>
				<Значения/>
			</Правило>
			<Правило>
				<Код>НалоговаяНакладная_РН</Код>
				<Наименование>Документ: Налоговая накладная</Наименование>
				<Порядок>350</Порядок>
				<ПриВыгрузке>ЗапрашиваемыеПараметры = Новый ТаблицаЗначений;
ЗапрашиваемыеПараметры.Колонки.Добавить("Имя");
ЗапрашиваемыеПараметры.Колонки.Добавить("Представление");
ЗапрашиваемыеПараметры.Колонки.Добавить("Значение");

ПродажиНУ = Новый ТаблицаЗначений;
ПродажиНУ.Колонки.Добавить("ВидДвижения");
ПродажиНУ.Колонки.Добавить("Период");
ПродажиНУ.Колонки.Добавить("Активность");
ПродажиНУ.Колонки.Добавить("Организация");  
ПродажиНУ.Колонки.Добавить("ДоговорКонтрагента");
ПродажиНУ.Колонки.Добавить("Событие");
ПродажиНУ.Колонки.Добавить("СуммаВзаиморасчетов");

ОжидаемыйНДС = Новый ТаблицаЗначений;
ОжидаемыйНДС.Колонки.Добавить("ВидДвижения");
ОжидаемыйНДС.Колонки.Добавить("Период");
ОжидаемыйНДС.Колонки.Добавить("Активность");
ОжидаемыйНДС.Колонки.Добавить("Организация");  
ОжидаемыйНДС.Колонки.Добавить("ДоговорКонтрагента");
ОжидаемыйНДС.Колонки.Добавить("СобытиеНДС");
ОжидаемыйНДС.Колонки.Добавить("СтавкаНДС");
ОжидаемыйНДС.Колонки.Добавить("БазаНДС");
ОжидаемыйНДС.Колонки.Добавить("СуммаНДС");
ОжидаемыйНДС.Колонки.Добавить("КодОперации");

Если Источник.Проведен Тогда	
	Дата = Источник.Дата;
	Организация = Источник.Организация;
	ДоговорКонтрагента = Источник.ДоговорВзаиморасчетов;
	СуммаДокумента= Источник.СуммаДокумента;
	КонтрагентВнутренний = ТК_СправочникиПовтИсп.ЭтоВнутреннийКонтрагент(Источник.Контрагент);
	
	Запросы.РН_НН.УстановитьПараметр("Ссылка", Источник);		
	МассивРезультатов = Запросы.РН_НН.ВыполнитьПакет();
	МаксИндекс = МассивРезультатов.ВГраница();
	
	ВыборкаНДС = МассивРезультатов[МаксИндекс-1].Выбрать();
	ВыборкаНДС.Следующий();
	
	ТаблицаПроводок = МассивРезультатов[МаксИндекс].Выгрузить();
	ТаблицаПроводок.ЗаполнитьЗначения(КонтрагентВнутренний, "ЭтоВнутренний");
	
	Если ТаблицаПроводок.Количество() &gt; 0 Тогда 	
		РазницаНДС = Окр(ВыборкаНДС.СуммаНДС, 2) - Окр(ТаблицаПроводок.Итог("СуммаНДС"), 2);
		РазницаСумма = Окр(ВыборкаНДС.Сумма, 2) - Окр(ТаблицаПроводок.Итог("Сумма"), 2);
		
		Если РазницаСумма &lt;&gt; 0 ИЛИ РазницаНДС &lt;&gt; 0 Тогда 
			ПоследняяСтрока = ТаблицаПроводок[ТаблицаПроводок.Количество()-1];
		КонецЕсли;
		
		Если РазницаНДС &lt;&gt; 0 Тогда 		
			ПоследняяСтрока.СуммаНДС = ПоследняяСтрока.СуммаНДС + РазницаНДС;
		КонецЕсли;
		
		Если РазницаСумма &lt;&gt; 0 Тогда 
			ПоследняяСтрока.Сумма = ПоследняяСтрока.Сумма + РазницаСумма;
		КонецЕсли;
	КонецЕсли;
	
	ТЗСобствНоменклатура = ТаблицаПроводок.Скопировать(Новый Структура("ПризнакПроводки, Тара", "ПоСобственнойНоменклатуре", Ложь), "Сумма, СуммаНДС");		
	
	Если ТЗСобствНоменклатура.Количество() &gt; 0 Тогда 
		ТЗСобствНоменклатура.Свернуть(,"Сумма, СуммаНДС");	
		
		НоваяПроводка = ТаблицаПроводок.Добавить();
		НоваяПроводка.Контрагенты = Источник.Контрагент;		
		НоваяПроводка.Договоры = ДоговорКонтрагента;
		НоваяПроводка.Склады = Источник.СкладКомпании;
		НоваяПроводка.Сумма = ТЗСобствНоменклатура[0].Сумма;
		НоваяПроводка.СуммаНДС = ТЗСобствНоменклатура[0].СуммаНДС;
		НоваяПроводка.СуммаПФ = 0;
		НоваяПроводка.Тара = Ложь;
		НоваяПроводка.ПФ = Ложь;
		НоваяПроводка.ПризнакПроводки = "ПоСобственнойНоменклатуреОбщ";
		НоваяПроводка.ЭтоВнутренний = КонтрагентВнутренний;
	КонецЕсли;
		
	// ПриобретенияНалоговыйУчет	
	НовоеДвижение = ПродажиНУ.Добавить();
	НовоеДвижение.ВидДвижения = ВидДвиженияНакопления.Приход;
	НовоеДвижение.Период = Дата;
	НовоеДвижение.Активность = Истина;
	НовоеДвижение.Организация = Организация;
	НовоеДвижение.ДоговорКонтрагента = ДоговорКонтрагента;
	НовоеДвижение.Событие = "РеализацияПокупателю";	
	НовоеДвижение.СуммаВзаиморасчетов = СуммаДокумента;	

	
 	// ОжидаемыйИПодтвержденныйНДСПриобретений 	
	Если ТЗСобствНоменклатура.Количество() &gt; 0 Тогда 
		НовоеДвижение = ОжидаемыйНДС.Добавить();
		НовоеДвижение.ВидДвижения = ВидДвиженияНакопления.Приход;
		НовоеДвижение.Период = Дата;
		НовоеДвижение.Активность = Истина;
		НовоеДвижение.Организация = Организация;
		НовоеДвижение.ДоговорКонтрагента = ДоговорКонтрагента;
		НовоеДвижение.СобытиеНДС = "Реализация";			
		НовоеДвижение.КодОперации = "ОжидаемыйНДС";	
		НовоеДвижение.СтавкаНДС = Справочники.СтавкиНДС.ОсновнаяСтавкаНДС;
		НовоеДвижение.БазаНДС = ТЗСобствНоменклатура[0].Сумма - ТЗСобствНоменклатура[0].СуммаНДС;
		НовоеДвижение.СуммаНДС = ТЗСобствНоменклатура[0].СуммаНДС;
	КонецЕсли;
	
	// ЗапрашиваемыеПараметры
	НомерПроводки = 1;
	Для Каждого СтрВыборка Из ТаблицаПроводок Цикл 		
		Для Каждого Колонка Из ТаблицаПроводок.Колонки Цикл 
			Значение = СтрВыборка[Колонка.Имя];
			
			Если Колонка.Имя = "Сумма" 
				ИЛИ Колонка.Имя = "СуммаНДС"
				ИЛИ Колонка.Имя = "СуммаПФ" Тогда
				
				Значение = Формат(Значение, "ЧН=0");
			КонецЕсли;
			
			НоваяСтрока = ЗапрашиваемыеПараметры.Добавить();
			НоваяСтрока.Имя =  "Проводка"+НомерПроводки;
			НоваяСтрока.Представление = Колонка.Имя;
			НоваяСтрока.Значение = Значение;
			
			//Сообщить("Имя: " + НоваяСтрока.Имя + "; Представление: " + НоваяСтрока.Представление + "; Значение: " + НоваяСтрока.Значение);
		КонецЦикла;
		НомерПроводки = НомерПроводки+1;
	КонецЦикла;
	
КонецЕсли;

ВходящиеДанные = Новый Структура;
ВходящиеДанные.Вставить("ЗапрашиваемыеПараметры", ЗапрашиваемыеПараметры);
ВходящиеДанные.Вставить("ПродажиНалоговыйУчет", ПродажиНУ);
ВходящиеДанные.Вставить("ОжидаемыйИПодтвержденныйНДСПродаж", ОжидаемыйНДС);</ПриВыгрузке>
				<ПослеЗагрузки>Объект.Подразделение =Справочники.Подразделения.ПустаяСсылка();

Если НЕ Отказ Тогда			
	Если Не ЗначениеЗаполнено(Объект.ТиповаяОперация) Тогда
		тСообщение = "ОШИБКА, ЗАГРУЗКА ПРЕРВАНА, не найдена типовая операция с кодом ""РТУНН""";
		ВызватьИсключение(тСообщение);
	КонецЕсли;				
	
	Объект.ТаблицаРегистровНакопления.Очистить();
	Объект.Содержание = Объект.ТиповаяОперация.Наименование;
	
	Проведен = ПараметрыОбъекта.Получить("Проведен");
	Если Проведен Тогда 
		НовРегНакопл = Объект.ТаблицаРегистровНакопления.Добавить();
		НовРегНакопл.Имя = "ПродажиНалоговыйУчет";
		НовРегНакопл.Представление = "Продажи налоговый учет";
		
		НовРегНакопл = Объект.ТаблицаРегистровНакопления.Добавить();
		НовРегНакопл.Имя = "ОжидаемыйИПодтвержденныйНДСПродаж";
		НовРегНакопл.Представление = "Ожидаемый и подтвержденный НДС продаж";
		
		Выполнить(Алгоритмы.ЗаполнитьНаОснованииТиповойОперации);
	Иначе
		Объект.Движения.Хозрасчетный.Очистить();
		Объект.Движения.ПродажиНалоговыйУчет.Очистить();
		Объект.Движения.ОжидаемыйИПодтвержденныйНДСПродаж.Очистить();
	КонецЕсли;
	
	ЗаписатьОбъект =  ПараметрыОбъекта.Получить("ЗаписатьОбъект");
	Если ЗаписатьОбъект = Неопределено Тогда
		ЗаписатьОбъект = Ложь;
	КонецЕсли;
	
	Если ЗаписатьОбъект Тогда		
		Выполнить(Алгоритмы.ЗаписатьСоответствиеОбъектов);
	КонецЕсли;
КонецЕсли;	</ПослеЗагрузки>
				<ПоследовательностьПолейПоиска>Параметры.ПараметрыАлгоритмов.Вставить("ВидОбъекта", "ОперацияБух");
Параметры.ПараметрыАлгоритмов.Вставить("ТипОбъектаИсточника", "ДокументСсылка.ТК_НалоговаяНакладная_РН");
СтрокаИменСвойствПоиска = "ПоискАлгоритмом";

Выполнить(Алгоритмы.ПолучитьСоответствиеОбъектов);
ПрекратитьПоиск = Истина;
</ПоследовательностьПолейПоиска>
				<ГенерироватьНовыйНомерИлиКодЕслиНеУказан>true</ГенерироватьНовыйНомерИлиКодЕслиНеУказан>
				<Источник>ДокументСсылка.ТК_НалоговаяНакладная</Источник>
				<Приемник>ДокументСсылка.ОперацияБух</Приемник>
				<Свойства>
					<Свойство Поиск="true">
						<Код>1</Код>
						<Наименование>--&gt; GUID_Поиска</Наименование>
						<Порядок>50</Порядок>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="" Вид=""/>
						<ИмяПараметраДляПередачи>GUID_Поиска</ИмяПараметраДляПередачи>
						<ПередВыгрузкой>Значение = ЗначениеВСтрокуВнутр(Источник.УникальныйИдентификатор());</ПередВыгрузкой>
					</Свойство>
					<Свойство>
						<Код>7</Код>
						<Наименование>Проведен --&gt; Проведен</Наименование>
						<Порядок>100</Порядок>
						<Источник Имя="Проведен" Вид="Свойство" Тип="Булево"/>
						<Приемник Имя="" Вид=""/>
						<ИмяПараметраДляПередачи>Проведен</ИмяПараметраДляПередачи>
					</Свойство>
					<Свойство>
						<Код>4</Код>
						<Наименование>Дата --&gt; Дата</Наименование>
						<Порядок>150</Порядок>
						<Источник Имя="Дата" Вид="Свойство" Тип="Дата"/>
						<Приемник Имя="Дата" Вид="Свойство" Тип="Дата"/>
					</Свойство>
					<Свойство>
						<Код>3</Код>
						<Наименование>Организация --&gt; Организация</Наименование>
						<Порядок>200</Порядок>
						<Источник Имя="Организация" Вид="Реквизит" Тип="СправочникСсылка.Организации"/>
						<Приемник Имя="Организация" Вид="Реквизит" Тип="СправочникСсылка.Организации"/>
						<КодПравилаКонвертации>Организации                                       </КодПравилаКонвертации>
					</Свойство>
					<Свойство>
						<Код>5</Код>
						<Наименование>ПометкаУдаления --&gt; ПометкаУдаления</Наименование>
						<Порядок>250</Порядок>
						<Источник Имя="ПометкаУдаления" Вид="Свойство" Тип="Булево"/>
						<Приемник Имя="ПометкаУдаления" Вид="Свойство" Тип="Булево"/>
					</Свойство>
					<Свойство>
						<Код>6</Код>
						<Наименование>СуммаДокумента --&gt; СуммаОперации</Наименование>
						<Порядок>300</Порядок>
						<Источник Имя="СуммаДокумента" Вид="Реквизит" Тип="Число"/>
						<Приемник Имя="СуммаОперации" Вид="Реквизит" Тип="Число"/>
					</Свойство>
					<Свойство>
						<Код>2</Код>
						<Наименование>--&gt; Комментарий</Наименование>
						<Порядок>350</Порядок>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="Комментарий" Вид="Реквизит" Тип="Строка"/>
						<ПередВыгрузкой>Значение = "РТ " + СокрЛП(Источник.НомерРН) + " из """ + Источник.Номер + """";</ПередВыгрузкой>
					</Свойство>
					<Свойство>
						<Код>8</Код>
						<Наименование>--&gt; СпособЗаполнения</Наименование>
						<Порядок>400</Порядок>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="СпособЗаполнения" Вид="Реквизит"/>
						<ПередВыгрузкой>Значение = "ТиповыеОперации";</ПередВыгрузкой>
					</Свойство>
					<Свойство>
						<Код>9</Код>
						<Наименование>--&gt; ТиповаяОперация</Наименование>
						<Порядок>450</Порядок>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="ТиповаяОперация" Вид="Реквизит"/>
						<КодПравилаКонвертации>ТиповыеОперации                                   </КодПравилаКонвертации>
						<ПередВыгрузкой>Значение = Новый Структура("Код", "РТУНН");</ПередВыгрузкой>
					</Свойство>
					<Группа>
						<Код>10</Код>
						<Наименование>--&gt; ЗапрашиваемыеПараметры</Наименование>
						<Порядок>500</Порядок>
						<ПолучитьИзВходящихДанных>true</ПолучитьИзВходящихДанных>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="ЗапрашиваемыеПараметры" Вид="ТабличнаяЧасть"/>
						<Свойство>
							<Код>12</Код>
							<Наименование>--&gt; Имя</Наименование>
							<Порядок>50</Порядок>
							<Источник Имя="" Вид=""/>
							<Приемник Имя="Имя" Вид="Реквизит" Тип="Строка"/>
						</Свойство>
						<Свойство>
							<Код>13</Код>
							<Наименование>--&gt; Представление</Наименование>
							<Порядок>100</Порядок>
							<Источник Имя="" Вид=""/>
							<Приемник Имя="Представление" Вид="Реквизит" Тип="Строка"/>
						</Свойство>
						<Свойство>
							<Код>11</Код>
							<Наименование>--&gt; Значение</Наименование>
							<Порядок>150</Порядок>
							<Источник Имя="" Вид=""/>
							<Приемник Имя="Значение" Вид="Реквизит"/>
						</Свойство>
					</Группа>
					<Группа>
						<Код>14</Код>
						<Наименование>--&gt; ПродажиНалоговыйУчет</Наименование>
						<Порядок>550</Порядок>
						<ПолучитьИзВходящихДанных>true</ПолучитьИзВходящихДанных>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="ПродажиНалоговыйУчет" Вид="НаборДвиженийРегистраНакопления"/>
						<Свойство>
							<Код>20</Код>
							<Наименование>--&gt; ВидДвижения</Наименование>
							<Порядок>50</Порядок>
							<Источник Имя="" Вид=""/>
							<Приемник Имя="ВидДвижения" Вид="Свойство"/>
						</Свойство>
						<Свойство>
							<Код>21</Код>
							<Наименование>--&gt; Период</Наименование>
							<Порядок>100</Порядок>
							<Источник Имя="" Вид=""/>
							<Приемник Имя="Период" Вид="Свойство" Тип="Дата"/>
						</Свойство>
						<Свойство>
							<Код>19</Код>
							<Наименование>--&gt; Активность</Наименование>
							<Порядок>150</Порядок>
							<Источник Имя="" Вид=""/>
							<Приемник Имя="Активность" Вид="Свойство" Тип="Булево"/>
						</Свойство>
						<Свойство>
							<Код>16</Код>
							<Наименование>--&gt; Организация</Наименование>
							<Порядок>200</Порядок>
							<Источник Имя="" Вид=""/>
							<Приемник Имя="Организация" Вид="Измерение" Тип="СправочникСсылка.Организации"/>
						</Свойство>
						<Свойство>
							<Код>15</Код>
							<Наименование>--&gt; ДоговорКонтрагента</Наименование>
							<Порядок>250</Порядок>
							<Источник Имя="" Вид=""/>
							<Приемник Имя="ДоговорКонтрагента" Вид="Измерение" Тип="СправочникСсылка.ДоговорыКонтрагентов"/>
						</Свойство>
						<Свойство>
							<Код>17</Код>
							<Наименование>--&gt; Событие</Наименование>
							<Порядок>300</Порядок>
							<Источник Имя="" Вид=""/>
							<Приемник Имя="Событие" Вид="Измерение" Тип="ПеречислениеСсылка.СобытияПродажиНалоговыйУчет"/>
						</Свойство>
						<Свойство>
							<Код>18</Код>
							<Наименование>--&gt; СуммаВзаиморасчетов</Наименование>
							<Порядок>350</Порядок>
							<Источник Имя="" Вид=""/>
							<Приемник Имя="СуммаВзаиморасчетов" Вид="Ресурс" Тип="Число"/>
						</Свойство>
					</Группа>
					<Группа>
						<Код>22</Код>
						<Наименование>--&gt; ОжидаемыйИПодтвержденныйНДСПродаж</Наименование>
						<Порядок>600</Порядок>
						<ПолучитьИзВходящихДанных>true</ПолучитьИзВходящихДанных>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="ОжидаемыйИПодтвержденныйНДСПродаж" Вид="НаборДвиженийРегистраНакопления"/>
						<Свойство>
							<Код>31</Код>
							<Наименование>--&gt; ВидДвижения</Наименование>
							<Порядок>50</Порядок>
							<Источник Имя="" Вид=""/>
							<Приемник Имя="ВидДвижения" Вид="Свойство"/>
						</Свойство>
						<Свойство>
							<Код>32</Код>
							<Наименование>--&gt; Период</Наименование>
							<Порядок>100</Порядок>
							<Источник Имя="" Вид=""/>
							<Приемник Имя="Период" Вид="Свойство" Тип="Дата"/>
						</Свойство>
						<Свойство>
							<Код>30</Код>
							<Наименование>--&gt; Активность</Наименование>
							<Порядок>150</Порядок>
							<Источник Имя="" Вид=""/>
							<Приемник Имя="Активность" Вид="Свойство" Тип="Булево"/>
						</Свойство>
						<Свойство>
							<Код>24</Код>
							<Наименование>--&gt; Организация</Наименование>
							<Порядок>200</Порядок>
							<Источник Имя="" Вид=""/>
							<Приемник Имя="Организация" Вид="Измерение" Тип="СправочникСсылка.Организации"/>
						</Свойство>
						<Свойство>
							<Код>23</Код>
							<Наименование>--&gt; ДоговорКонтрагента</Наименование>
							<Порядок>250</Порядок>
							<Источник Имя="" Вид=""/>
							<Приемник Имя="ДоговорКонтрагента" Вид="Измерение" Тип="СправочникСсылка.ДоговорыКонтрагентов"/>
						</Свойство>
						<Свойство>
							<Код>25</Код>
							<Наименование>--&gt; СобытиеНДС</Наименование>
							<Порядок>300</Порядок>
							<Источник Имя="" Вид=""/>
							<Приемник Имя="СобытиеНДС" Вид="Измерение" Тип="ПеречислениеСсылка.СобытияОжидаемыйИПодтвержденныйНДСПродаж"/>
						</Свойство>
						<Свойство>
							<Код>26</Код>
							<Наименование>--&gt; СтавкаНДС</Наименование>
							<Порядок>350</Порядок>
							<Источник Имя="" Вид=""/>
							<Приемник Имя="СтавкаНДС" Вид="Измерение" Тип="ПеречислениеСсылка.СтавкиНДС"/>
						</Свойство>
						<Свойство>
							<Код>28</Код>
							<Наименование>--&gt; БазаНДС</Наименование>
							<Порядок>400</Порядок>
							<Источник Имя="" Вид=""/>
							<Приемник Имя="БазаНДС" Вид="Ресурс" Тип="Число"/>
						</Свойство>
						<Свойство>
							<Код>29</Код>
							<Наименование>--&gt; СуммаНДС</Наименование>
							<Порядок>450</Порядок>
							<Источник Имя="" Вид=""/>
							<Приемник Имя="СуммаНДС" Вид="Ресурс" Тип="Число"/>
						</Свойство>
						<Свойство>
							<Код>27</Код>
							<Наименование>--&gt; КодОперации</Наименование>
							<Порядок>500</Порядок>
							<Источник Имя="" Вид=""/>
							<Приемник Имя="КодОперации" Вид="Реквизит" Тип="ПеречислениеСсылка.КодыОперацийОжидаемыйИПодтвержденныйНДСПродаж"/>
						</Свойство>
					</Группа>
				</Свойства>
				<Значения/>
			</Правило>
			<Правило>
				<Код>Приложение2КНалоговойНакладной</Код>
				<Наименование>Документ: Приложение 2 к налоговой накладной (Украина)</Наименование>
				<Порядок>400</Порядок>
				<ПередВыгрузкой>Если Не ЗначениеЗаполнено(Источник.НомерДляБухгалтерии) Тогда
	
	ОбщегоНазначения.СообщитьПользователю(
		СтроковыеФункцииКлиентСервер.ПодставитьПараметрыВСтроку(
			"Документ %1 не выгружен! Не заполнен реквизит ""НомерДляБухгалтерии""",
			Строка(Источник)),
		Источник,,,
		Отказ);

КонецЕсли;

Если Не Отказ Тогда
	Если Источник.Проведен Тогда	
		РежимЗаписи = "Проведение";
	КонецЕсли;
	
	ВидОперации = "";
	ОснованиеКорректировки = "";
	
	Если Источник.СуммаДокумента &gt; 0 Тогда
		ВидОперации = "ОблагаемыеОперацииКорректировка";
		ОснованиеКорректировки = "Змiна цiни";		
	Иначе
		ВидОперации = "ОблагаемыеОперацииВозврат";
		ОснованиеКорректировки = "Повернення товару";				
	КонецЕсли;
	
	тчТовары = Источник.Товары.Выгрузить();
	тчТовары.Свернуть("СтавкаНДС,ДатаКорректировки,Причина", "Количество,Сумма,СуммаНДС,ИзменениеКоличество,ИзменениеКоличество,ИзменениеСуммаБезНалогов,ИзменениеСуммаНДС");
	
	Для Каждого Колонка Из тчТовары.Колонки Цикл
		Если Колонка.Имя = "ИзменениеКоличество" Тогда
			Колонка.Имя = "ИзменениеКоличества";
		ИначеЕсли Колонка.Имя = "ИзменениеСуммаБезНалогов" Тогда
			Колонка.Имя = "ИзменениеСуммы";
		ИначеЕсли Колонка.Имя = "ИзменениеСуммаНДС" Тогда
			Колонка.Имя = "ИзменениеСуммыНДС";
		КонецЕсли;
	КонецЦикла;
	
	ВходящиеДанные = Новый Структура;
	ВходящиеДанные.Вставить("Товары", тчТовары);
	ВходящиеДанные.Вставить("ВидОперации", ВидОперации);
	ВходящиеДанные.Вставить("ОснованиеКорректировки", ОснованиеКорректировки);
КонецЕсли;</ПередВыгрузкой>
				<ПослеЗагрузки>Если НЕ Отказ Тогда			
	Проведен = ПараметрыОбъекта.Получить("Проведен");
	ПометкаУдаления = ПараметрыОбъекта.Получить("ПометкаУдаления");
	
	Если Объект.ЭтоНовый() Тогда
		Если Не ПометкаУдаления Тогда
			ИД = ПараметрыОбъекта.Получить("GUID_Поиска");
			ГУИД = ЗначениеИзСтрокиВнутр(ИД);				
			Ссылка = Документы.Приложение2КНалоговойНакладной.ПолучитьСсылку(ГУИД);
			Если Не ОбщегоНазначения.СсылкаСуществует(Ссылка) Тогда		
				Объект.УстановитьСсылкуНового(Ссылка);
			КонецЕсли;
		Иначе
			Отказ = Истина;
		КонецЕсли;
	КонецЕсли;
КонецЕсли;		
	
Если НЕ Отказ Тогда				
	СчетаУчета   = БухгалтерскийУчетРасчетовСКонтрагентами.ПолучитьСчетаРасчетовСКонтрагентом(Объект.Организация, Объект.Контрагент, Объект.ДоговорКонтрагента);
	Объект.СчетУчетаНДС = СчетаУчета.СчетУчетаНДСПродаж;
	Объект.ЗаполнитьВидДоговора();	
	
	//Объект.УстановитьТипПричиныНевыдачиПокупателюПоУмолчанию();	
	ЗаполнениеДокументов.ЗаполнитьОбязательныеРеквизитыШапкиНовогоДокумента(Объект, глЗначениеПеременной("глТекущийПользователь"));
	
	тчТовары = Объект.Товары.Выгрузить();
	
	Объект.Товары.Очистить();
	Объект.Услуги.Очистить();
	
	Номенклатура = Справочники.Номенклатура.НайтиПоКоду("00000000008");
	СтатьяДеклНДС = Справочники.СтатьиНалоговыхДеклараций.НДС_НОПоСтавке20;
	мВалютаРегламентированногоУчета = Константы.ВалютаРегламентированногоУчета.Получить();
	
	Для каждого СтрТовары Из тчТовары Цикл
		НоваяСтрокаТЧТовары = Объект.Товары.Добавить();
		НоваяСтрокаТЧТовары.Номенклатура = Номенклатура;
		
		// Выполнить общие действия для всех документов при изменении номенклатуры.
		ОбработкаТабличныхЧастей.ПриИзмененииНоменклатурыТабЧасти(НоваяСтрокаТЧТовары, Объект);		
		ОбработкаТабличныхЧастей.ЗаполнитьСтавкуНДСТабЧасти(НоваяСтрокаТЧТовары, Объект);
		ОбработкаТабличныхЧастей.ЗаполнитьЕдиницуЦенуПродажиТабЧасти(НоваяСтрокаТЧТовары, Объект, мВалютаРегламентированногоУчета);				
		Объект.ЗаполнитьСчетаУчетаВСтрокеТабЧастиРегл(НоваяСтрокаТЧТовары, "Товары");
		
		НоваяСтрокаТЧТовары.Количество = СтрТовары.Количество;
		НоваяСтрокаТЧТовары.Цена = ?(СтрТовары.Количество = 0, 0, СтрТовары.Сумма/СтрТовары.Количество);
		НоваяСтрокаТЧТовары.СуммаНДС = СтрТовары.СуммаНДС;
		НоваяСтрокаТЧТовары.Сумма = СтрТовары.Сумма;
		НоваяСтрокаТЧТовары.ДатаКорректировки = СтрТовары.ДатаКорректировки;
		НоваяСтрокаТЧТовары.ИзменениеКоличества = СтрТовары.ИзменениеКоличества;
		НоваяСтрокаТЧТовары.ИзменениеЦены = ?(СтрТовары.ИзменениеКоличества = 0, 0, СтрТовары.ИзменениеСуммы/СтрТовары.ИзменениеКоличества);
		НоваяСтрокаТЧТовары.ИзменениеСуммы = СтрТовары.ИзменениеСуммы;
		НоваяСтрокаТЧТовары.ИзменениеСуммыНДС = СтрТовары.ИзменениеСуммыНДС;
		НоваяСтрокаТЧТовары.Причина = СтрТовары.Причина;
	КонецЦикла;

	//Объект.СуммаДокумента 	  = УчетНДС.ПолучитьСуммуДокументаСНДС(Объект); //с учетом стоимости возвратнонй тары
	//Объект.СуммаНДСДокумента  = УчетНДС.ПолучитьНДСДокумента(Объект);	
	
	// Посчитать суммы документа и записать их в соответствующие реквизиты шапки для показа в журналах
	Объект.СуммаДокумента 	  = 0 + Объект.Товары.Итог("ИзменениеСуммы") 	 + Объект.Услуги.Итог("ИзменениеСуммы") 	+ Объект.ОС.Итог("ИзменениеСуммы")    + Объект.НМА.Итог("ИзменениеСуммы");
	Объект.СуммаНДСДокумента  = 0 + Объект.Товары.Итог("ИзменениеСуммыНДС") + Объект.Услуги.Итог("ИзменениеСуммыНДС") + Объект.ОС.Итог("ИзменениеСуммыНДС") + Объект.НМА.Итог("ИзменениеСуммыНДС");	
	
	ЗаписатьОбъект =  ПараметрыОбъекта.Получить("ЗаписатьОбъект");
	Если ЗаписатьОбъект = Неопределено Тогда
		ЗаписатьОбъект = Ложь;
	КонецЕсли;
	
	Если ЗаписатьОбъект Тогда
		Выполнить(Алгоритмы.ЗаписатьСоответствиеОбъектов);
	КонецЕсли;
Иначе
	Сообщить("Загрузка отменена");
КонецЕсли;	</ПослеЗагрузки>
				<ПоследовательностьПолейПоиска>Параметры.ПараметрыАлгоритмов.Вставить("ВидОбъекта","Приложение2КНалоговойНакладной");
Параметры.ПараметрыАлгоритмов.Вставить("ТипОбъектаИсточника", "ДокументСсылка.ТК_Приложение2КНалоговойНакладной");
СтрокаИменСвойствПоиска = "ПоискАлгоритмом";

Выполнить(Алгоритмы.ПолучитьСоответствиеОбъектов);

ПрекратитьПоиск = Истина;
	</ПоследовательностьПолейПоиска>
				<Источник>ДокументСсылка.ТК_Приложение2КНалоговойНакладной</Источник>
				<Приемник>ДокументСсылка.Приложение2КНалоговойНакладной</Приемник>
				<Свойства>
					<Свойство Поиск="true">
						<Код>3</Код>
						<Наименование>--&gt; GUID_Поиска</Наименование>
						<Порядок>50</Порядок>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="" Вид=""/>
						<ИмяПараметраДляПередачи>GUID_Поиска</ИмяПараметраДляПередачи>
						<ПередВыгрузкой>Значение = ЗначениеВСтрокуВнутр(Источник.УникальныйИдентификатор());</ПередВыгрузкой>
					</Свойство>
					<Свойство>
						<Код>46</Код>
						<Наименование>Проведен --&gt; Проведен</Наименование>
						<Порядок>100</Порядок>
						<Источник Имя="Проведен" Вид="Свойство" Тип="Булево"/>
						<Приемник Имя="" Вид=""/>
						<ИмяПараметраДляПередачи>Проведен</ИмяПараметраДляПередачи>
					</Свойство>
					<Свойство>
						<Код>17</Код>
						<Наименование>ПометкаУдаления --&gt; ПометкаУдаления</Наименование>
						<Порядок>150</Порядок>
						<Источник Имя="ПометкаУдаления" Вид="Свойство" Тип="Булево"/>
						<Приемник Имя="" Вид=""/>
						<ИмяПараметраДляПередачи>ПометкаУдаления</ИмяПараметраДляПередачи>
					</Свойство>
					<Свойство>
						<Код>1</Код>
						<Наименование>Дата --&gt; Дата</Наименование>
						<Порядок>200</Порядок>
						<Источник Имя="Дата" Вид="Свойство" Тип="Дата"/>
						<Приемник Имя="Дата" Вид="Свойство" Тип="Дата"/>
					</Свойство>
					<Свойство>
						<Код>2</Код>
						<Наименование>НомерДляБухгалтерии --&gt; Номер</Наименование>
						<Порядок>250</Порядок>
						<Источник Имя="НомерДляБухгалтерии" Вид="Реквизит" Тип="Строка"/>
						<Приемник Имя="Номер" Вид="Свойство" Тип="Строка"/>
					</Свойство>
					<Свойство>
						<Код>18</Код>
						<Наименование>--&gt; ВидОперации</Наименование>
						<Порядок>300</Порядок>
						<ПолучитьИзВходящихДанных>true</ПолучитьИзВходящихДанных>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="ВидОперации" Вид="Реквизит" Тип="ПеречислениеСсылка.ВидыОперацийПриложение2КНалоговойНакладной"/>
					</Свойство>
					<Свойство>
						<Код>41</Код>
						<Наименование>--&gt; ОснованиеКорректировки</Наименование>
						<Порядок>350</Порядок>
						<ПолучитьИзВходящихДанных>true</ПолучитьИзВходящихДанных>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="ОснованиеКорректировки" Вид="Реквизит" Тип="Строка"/>
					</Свойство>
					<Свойство>
						<Код>4</Код>
						<Наименование>ВалютаДокумента --&gt; ВалютаДокумента</Наименование>
						<Порядок>400</Порядок>
						<Источник Имя="ВалютаДокумента" Вид="Реквизит" Тип="СправочникСсылка.Валюты"/>
						<Приемник Имя="ВалютаДокумента" Вид="Реквизит" Тип="СправочникСсылка.Валюты"/>
						<КодПравилаКонвертации>Валюты                                            </КодПравилаКонвертации>
					</Свойство>
					<Свойство>
						<Код>5</Код>
						<Наименование>ВключенаВЕдиныйРеестрНалоговыхНакладных --&gt; ВключенаВЕдиныйРеестрНалоговыхНакладных</Наименование>
						<Порядок>450</Порядок>
						<Источник Имя="ВключенаВЕдиныйРеестрНалоговыхНакладных" Вид="Реквизит" Тип="Булево"/>
						<Приемник Имя="ВключенаВЕдиныйРеестрНалоговыхНакладных" Вид="Реквизит" Тип="Булево"/>
					</Свойство>
					<Свойство>
						<Код>6</Код>
						<Наименование>--&gt; Комментарий</Наименование>
						<Порядок>500</Порядок>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="Комментарий" Вид="Реквизит" Тип="Строка"/>
						<ПередВыгрузкой>Значение = "Загружено из ТК (УФ) " + Источник.Комментарий;</ПередВыгрузкой>
					</Свойство>
					<Свойство>
						<Код>7</Код>
						<Наименование>Контрагент --&gt; Контрагент</Наименование>
						<Порядок>550</Порядок>
						<Источник Имя="Контрагент" Вид="Реквизит" Тип="СправочникСсылка.Контрагенты"/>
						<Приемник Имя="Контрагент" Вид="Реквизит" Тип="СправочникСсылка.Контрагенты"/>
						<КодПравилаКонвертации>Контрагенты                                       </КодПравилаКонвертации>
					</Свойство>
					<Свойство>
						<Код>8</Код>
						<Наименование>КтоВыписалНалоговуюНакладную --&gt; КтоВыписалНалоговуюНакладную</Наименование>
						<Порядок>600</Порядок>
						<Источник Имя="КтоВыписалНалоговуюНакладную" Вид="Реквизит" Тип="СправочникСсылка.ФизическиеЛица"/>
						<Приемник Имя="КтоВыписалНалоговуюНакладную" Вид="Реквизит" Тип="СправочникСсылка.ФизическиеЛица"/>
						<КодПравилаКонвертации>ФизическиеЛица                                    </КодПравилаКонвертации>
					</Свойство>
					<Свойство>
						<Код>9</Код>
						<Наименование>НалоговаяНакладная --&gt; НалоговаяНакладная</Наименование>
						<Порядок>650</Порядок>
						<Источник Имя="НалоговаяНакладная" Вид="Реквизит" Тип="ДокументСсылка.ТК_НалоговаяНакладная"/>
						<Приемник Имя="НалоговаяНакладная" Вид="Реквизит" Тип="ДокументСсылка.НалоговаяНакладная"/>
						<КодПравилаКонвертации>НалоговаяНакладная                                </КодПравилаКонвертации>
						<ПередВыгрузкой>ВыгрузитьОбъект = Ложь;</ПередВыгрузкой>
					</Свойство>
					<Свойство>
						<Код>10</Код>
						<Наименование>Организация --&gt; Организация</Наименование>
						<Порядок>700</Порядок>
						<Источник Имя="Организация" Вид="Реквизит" Тип="СправочникСсылка.Организации"/>
						<Приемник Имя="Организация" Вид="Реквизит" Тип="СправочникСсылка.Организации"/>
						<КодПравилаКонвертации>Организации                                       </КодПравилаКонвертации>
					</Свойство>
					<Свойство>
						<Код>11</Код>
						<Наименование>СуммаДокумента --&gt; СуммаДокумента</Наименование>
						<Порядок>750</Порядок>
						<Источник Имя="СуммаДокумента" Вид="Реквизит" Тип="Число"/>
						<Приемник Имя="СуммаДокумента" Вид="Реквизит" Тип="Число"/>
					</Свойство>
					<Свойство>
						<Код>12</Код>
						<Наименование>СуммаНДСДокумента --&gt; СуммаНДСДокумента</Наименование>
						<Порядок>800</Порядок>
						<Источник Имя="СуммаНДСДокумента" Вид="Реквизит" Тип="Число"/>
						<Приемник Имя="СуммаНДСДокумента" Вид="Реквизит" Тип="Число"/>
					</Свойство>
					<Свойство>
						<Код>13</Код>
						<Наименование>ТипПричиныНевыдачиПокупателю --&gt; ТипПричиныНевыдачиПокупателю</Наименование>
						<Порядок>850</Порядок>
						<Источник Имя="ТипПричиныНевыдачиПокупателю" Вид="Реквизит" Тип="Число"/>
						<Приемник Имя="ТипПричиныНевыдачиПокупателю" Вид="Реквизит" Тип="Число"/>
					</Свойство>
					<Свойство>
						<Код>14</Код>
						<Наименование>ТребуетВключенияВЕдиныйРеестрНалоговыхНакладных --&gt; ТребуетВключенияВЕдиныйРеестрНалоговыхНакладных</Наименование>
						<Порядок>900</Порядок>
						<Источник Имя="ТребуетВключенияВЕдиныйРеестрНалоговыхНакладных" Вид="Реквизит" Тип="Булево"/>
						<Приемник Имя="ТребуетВключенияВЕдиныйРеестрНалоговыхНакладных" Вид="Реквизит" Тип="Булево"/>
					</Свойство>
					<Свойство>
						<Код>15</Код>
						<Наименование>УсловиеПродажи --&gt; УсловиеПродажи</Наименование>
						<Порядок>950</Порядок>
						<Источник Имя="УсловиеПродажи" Вид="Реквизит" Тип="Строка"/>
						<Приемник Имя="УсловиеПродажи" Вид="Реквизит" Тип="Строка"/>
					</Свойство>
					<Свойство>
						<Код>16</Код>
						<Наименование>ФормаРасчетов --&gt; ФормаРасчетов</Наименование>
						<Порядок>1000</Порядок>
						<Источник Имя="ФормаРасчетов" Вид="Реквизит" Тип="Строка"/>
						<Приемник Имя="ФормаРасчетов" Вид="Реквизит" Тип="Строка"/>
					</Свойство>
					<Свойство>
						<Код>19</Код>
						<Наименование>ДоговорВзаиморасчетов --&gt; ДоговорКонтрагента</Наименование>
						<Порядок>1050</Порядок>
						<Источник Имя="ДоговорВзаиморасчетов" Вид="Реквизит" Тип="СправочникСсылка.ДоговорыКонтрагентов"/>
						<Приемник Имя="ДоговорКонтрагента" Вид="Реквизит" Тип="СправочникСсылка.ДоговорыКонтрагентов"/>
						<КодПравилаКонвертации>ДоговорыКонтрагентов                              </КодПравилаКонвертации>
					</Свойство>
					<Свойство>
						<Код>20</Код>
						<Наименование>--&gt; КратностьВзаиморасчетов</Наименование>
						<Порядок>1100</Порядок>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="КратностьВзаиморасчетов" Вид="Реквизит" Тип="Число"/>
						<ПередВыгрузкой>Значение = 1;</ПередВыгрузкой>
					</Свойство>
					<Свойство>
						<Код>21</Код>
						<Наименование>--&gt; КурсВзаиморасчетов</Наименование>
						<Порядок>1150</Порядок>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="КурсВзаиморасчетов" Вид="Реквизит" Тип="Число"/>
						<ПередВыгрузкой>Значение = 1;</ПередВыгрузкой>
					</Свойство>
					<Свойство>
						<Код>22</Код>
						<Наименование>--&gt; СчетНДС</Наименование>
						<Порядок>1200</Порядок>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="СчетНДС" Вид="Реквизит" Тип="ПланСчетовСсылка.Хозрасчетный"/>
						<ПередВыгрузкой>Значение = "РасчетыПоНДС";</ПередВыгрузкой>
					</Свойство>
					<Группа>
						<Код>23</Код>
						<Наименование>--&gt; Товары</Наименование>
						<Порядок>1250</Порядок>
						<ПолучитьИзВходящихДанных>true</ПолучитьИзВходящихДанных>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="Товары" Вид="ТабличнаяЧасть"/>
						<Свойство>
							<Код>33</Код>
							<Наименование>--&gt; СтавкаНДС</Наименование>
							<Порядок>50</Порядок>
							<Источник Имя="" Вид=""/>
							<Приемник Имя="СтавкаНДС" Вид="Реквизит" Тип="ПеречислениеСсылка.СтавкиНДС"/>
							<КодПравилаКонвертации>СтавкиНДС                                         </КодПравилаКонвертации>
						</Свойство>
						<Свойство>
							<Код>27</Код>
							<Наименование>--&gt; Количество</Наименование>
							<Порядок>100</Порядок>
							<Источник Имя="" Вид=""/>
							<Приемник Имя="Количество" Вид="Реквизит" Тип="Число"/>
						</Свойство>
						<Свойство>
							<Код>35</Код>
							<Наименование>--&gt; СуммаНДС</Наименование>
							<Порядок>150</Порядок>
							<Источник Имя="" Вид=""/>
							<Приемник Имя="СуммаНДС" Вид="Реквизит" Тип="Число"/>
						</Свойство>
						<Свойство>
							<Код>34</Код>
							<Наименование>--&gt; Сумма</Наименование>
							<Порядок>200</Порядок>
							<Источник Имя="" Вид=""/>
							<Приемник Имя="Сумма" Вид="Реквизит" Тип="Число"/>
						</Свойство>
						<Свойство>
							<Код>42</Код>
							<Наименование>--&gt; ДатаКорректировки</Наименование>
							<Порядок>250</Порядок>
							<Источник Имя="" Вид=""/>
							<Приемник Имя="ДатаКорректировки" Вид="Реквизит" Тип="Дата"/>
						</Свойство>
						<Свойство>
							<Код>43</Код>
							<Наименование>--&gt; ИзменениеКоличества</Наименование>
							<Порядок>300</Порядок>
							<Источник Имя="" Вид=""/>
							<Приемник Имя="ИзменениеКоличества" Вид="Реквизит" Тип="Число"/>
						</Свойство>
						<Свойство>
							<Код>44</Код>
							<Наименование>--&gt; ИзменениеСуммы</Наименование>
							<Порядок>350</Порядок>
							<Источник Имя="" Вид=""/>
							<Приемник Имя="ИзменениеСуммы" Вид="Реквизит" Тип="Число"/>
						</Свойство>
						<Свойство>
							<Код>45</Код>
							<Наименование>--&gt; ИзменениеСуммыНДС</Наименование>
							<Порядок>400</Порядок>
							<Источник Имя="" Вид=""/>
							<Приемник Имя="ИзменениеСуммыНДС" Вид="Реквизит" Тип="Число"/>
						</Свойство>
						<Свойство>
							<Код>47</Код>
							<Наименование>--&gt; Причина</Наименование>
							<Порядок>450</Порядок>
							<Источник Имя="" Вид=""/>
							<Приемник Имя="Причина" Вид="Реквизит" Тип="Строка"/>
						</Свойство>
					</Группа>
				</Свойства>
				<Значения/>
			</Правило>
			<Правило>
				<Код>РасходныйКассовыйОрдер</Код>
				<Наименование>Документ: РКО</Наименование>
				<Порядок>450</Порядок>
				<ПередВыгрузкой>Если Источник.Проведен Тогда	
	РежимЗаписи = "Проведение";
КонецЕсли;
</ПередВыгрузкой>
				<ПослеЗагрузки>	Проведен = ПараметрыОбъекта.Получить("Проведен");
	ПометкаУдаления = ПараметрыОбъекта.Получить("ПометкаУдаления");
	
	Если Объект.ЭтоНовый() Тогда
		Если Не ПометкаУдаления Тогда
			ИД = ПараметрыОбъекта.Получить("GUID_Поиска");
			ГУИД = ЗначениеИзСтрокиВнутр(ИД);				
			Ссылка = Документы.РасходныйКассовыйОрдер.ПолучитьСсылку(ГУИД);
			Если Не ОбщегоНазначения.СсылкаСуществует(Ссылка) Тогда		
				Объект.УстановитьСсылкуНового(Ссылка);
			КонецЕсли;
		Иначе
			Отказ = Истина;
		КонецЕсли;
	КонецЕсли;

	Если НЕ Отказ Тогда
	
	ЗаписатьОбъект =  ПараметрыОбъекта.Получить("ЗаписатьОбъект");
	Если ЗаписатьОбъект = Неопределено Тогда
		ЗаписатьОбъект = Ложь;
	КонецЕсли;
	
	Если ЗаписатьОбъект Тогда
		Выполнить(Алгоритмы.ЗаписатьСоответствиеОбъектов);
	КонецЕсли;
	КонецЕсли;
</ПослеЗагрузки>
				<ПоследовательностьПолейПоиска>Параметры.ПараметрыАлгоритмов.Вставить("ВидОбъекта","РасходныйКассовыйОрдер");
Параметры.ПараметрыАлгоритмов.Вставить("ТипОбъектаИсточника", "ДокументСсылка.РасходныйКассовыйОрдер");
СтрокаИменСвойствПоиска = "ПоискАлгоритмом";

Выполнить(Алгоритмы.ПолучитьСоответствиеОбъектов);

ПрекратитьПоиск = Истина;
	</ПоследовательностьПолейПоиска>
				<ГенерироватьНовыйНомерИлиКодЕслиНеУказан>true</ГенерироватьНовыйНомерИлиКодЕслиНеУказан>
				<Источник>ДокументСсылка.РасходныйКассовыйОрдер</Источник>
				<Приемник>ДокументСсылка.РасходныйКассовыйОрдер</Приемник>
				<Свойства>
					<Свойство Поиск="true">
						<Код>1</Код>
						<Наименование>--&gt; GUID_Поиска</Наименование>
						<Порядок>50</Порядок>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="" Вид=""/>
						<ИмяПараметраДляПередачи>GUID_Поиска</ИмяПараметраДляПередачи>
						<ПередВыгрузкой>Значение = ЗначениеВСтрокуВнутр(Источник.УникальныйИдентификатор());</ПередВыгрузкой>
					</Свойство>
					<Свойство>
						<Код>2</Код>
						<Наименование>Проведен --&gt; Проведен</Наименование>
						<Порядок>100</Порядок>
						<Источник Имя="Проведен" Вид="Свойство" Тип="Булево"/>
						<Приемник Имя="" Вид=""/>
						<ИмяПараметраДляПередачи>Проведен</ИмяПараметраДляПередачи>
					</Свойство>
					<Свойство>
						<Код>3</Код>
						<Наименование>ПометкаУдаления --&gt; ПометкаУдаления</Наименование>
						<Порядок>150</Порядок>
						<Источник Имя="ПометкаУдаления" Вид="Свойство" Тип="Булево"/>
						<Приемник Имя="" Вид=""/>
						<ИмяПараметраДляПередачи>ПометкаУдаления</ИмяПараметраДляПередачи>
					</Свойство>
					<Свойство>
						<Код>5</Код>
						<Наименование>Дата --&gt; Дата</Наименование>
						<Порядок>200</Порядок>
						<Источник Имя="Дата" Вид="Свойство" Тип="Дата"/>
						<Приемник Имя="Дата" Вид="Свойство" Тип="Дата"/>
					</Свойство>
					<Свойство>
						<Код>6</Код>
						<Наименование>Организация --&gt; Организация</Наименование>
						<Порядок>250</Порядок>
						<Источник Имя="Организация" Вид="Реквизит" Тип="СправочникСсылка.Организации"/>
						<Приемник Имя="Организация" Вид="Измерение" Тип="СправочникСсылка.Организации"/>
						<КодПравилаКонвертации>Организации                                       </КодПравилаКонвертации>
					</Свойство>
					<Свойство>
						<Код>4</Код>
						<Наименование>ВалютаДокумента --&gt; ВалютаДокумента</Наименование>
						<Порядок>300</Порядок>
						<Источник Имя="ВалютаДокумента" Вид="Реквизит" Тип="СправочникСсылка.Валюты"/>
						<Приемник Имя="ВалютаДокумента" Вид="Реквизит" Тип="СправочникСсылка.Валюты"/>
						<КодПравилаКонвертации>Валюты                                            </КодПравилаКонвертации>
					</Свойство>
					<Свойство>
						<Код>7</Код>
						<Наименование>Контрагент --&gt; Контрагент</Наименование>
						<Порядок>350</Порядок>
						<Источник Имя="Контрагент" Вид="Реквизит" Тип="СправочникСсылка.Контрагенты"/>
						<Приемник Имя="Контрагент" Вид="Реквизит"/>
						<КодПравилаКонвертации>Контрагенты                                       </КодПравилаКонвертации>
					</Свойство>
					<Свойство>
						<Код>8</Код>
						<Наименование>ДоговорВзаиморасчетов --&gt; ДоговорКонтрагента</Наименование>
						<Порядок>400</Порядок>
						<Источник Имя="ДоговорВзаиморасчетов" Вид="Реквизит" Тип="СправочникСсылка.ДоговорыКонтрагентов"/>
						<Приемник Имя="ДоговорКонтрагента" Вид="Реквизит" Тип="СправочникСсылка.ДоговорыКонтрагентов"/>
						<КодПравилаКонвертации>ДоговорыКонтрагентов                              </КодПравилаКонвертации>
					</Свойство>
					<Свойство>
						<Код>9</Код>
						<Наименование>ПоДокументу --&gt; ПоДокументу</Наименование>
						<Порядок>450</Порядок>
						<Источник Имя="ПоДокументу" Вид="Реквизит" Тип="Строка"/>
						<Приемник Имя="ПоДокументу" Вид="Реквизит" Тип="Строка"/>
					</Свойство>
					<Свойство>
						<Код>10</Код>
						<Наименование>Приложение --&gt; Приложение</Наименование>
						<Порядок>500</Порядок>
						<Источник Имя="Приложение" Вид="Реквизит" Тип="Строка"/>
						<Приемник Имя="Приложение" Вид="Реквизит" Тип="Строка"/>
					</Свойство>
					<Свойство>
						<Код>11</Код>
						<Наименование>СтавкаНДС --&gt; СтавкаНДС</Наименование>
						<Порядок>550</Порядок>
						<Источник Имя="СтавкаНДС" Вид="Реквизит" Тип="СправочникСсылка.СтавкиНДС"/>
						<Приемник Имя="СтавкаНДС" Вид="Реквизит" Тип="ПеречислениеСсылка.СтавкиНДС"/>
						<КодПравилаКонвертации>СтавкиНДС                                         </КодПравилаКонвертации>
					</Свойство>
					<Свойство>
						<Код>12</Код>
						<Наименование>СуммаДокумента --&gt; СуммаДокумента</Наименование>
						<Порядок>600</Порядок>
						<Источник Имя="СуммаДокумента" Вид="Реквизит" Тип="Число"/>
						<Приемник Имя="СуммаДокумента" Вид="Реквизит" Тип="Число"/>
					</Свойство>
					<Свойство>
						<Код>13</Код>
						<Наименование>--&gt; ВидОперации</Наименование>
						<Порядок>650</Порядок>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="ВидОперации" Вид="Реквизит" Тип="ПеречислениеСсылка.ВидыОперацийРКО"/>
					</Свойство>
					<Свойство>
						<Код>20</Код>
						<Наименование>НомерКО --&gt; НомерОрдера</Наименование>
						<Порядок>700</Порядок>
						<Источник Имя="НомерКО" Вид="Реквизит" Тип="Строка"/>
						<Приемник Имя="НомерОрдера" Вид="Реквизит" Тип="Строка"/>
					</Свойство>
					<Свойство>
						<Код>14</Код>
						<Наименование>--&gt; ПоОбособленномуПодразделению</Наименование>
						<Порядок>750</Порядок>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="ПоОбособленномуПодразделению" Вид="Реквизит" Тип="Булево"/>
						<ПередВыгрузкой>Значение = Истина;</ПередВыгрузкой>
					</Свойство>
					<Свойство>
						<Код>15</Код>
						<Наименование>--&gt; СчетКасса</Наименование>
						<Порядок>800</Порядок>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="СчетКасса" Вид="Реквизит" Тип="ПланСчетовСсылка.Хозрасчетный"/>
						<КодПравилаКонвертации>Хозрасчетный                                      </КодПравилаКонвертации>
						<ПередВыгрузкой>Значение = новый Структура("Код","301");</ПередВыгрузкой>
					</Свойство>
					<Свойство>
						<Код>16</Код>
						<Наименование>--&gt; СубконтоДт1</Наименование>
						<Порядок>850</Порядок>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="СубконтоДт1" Вид="Реквизит"/>
						<КодПравилаКонвертации>Контрагенты                                       </КодПравилаКонвертации>
						<ПередВыгрузкой>Значение = Источник.Контрагент;</ПередВыгрузкой>
					</Свойство>
					<Свойство>
						<Код>17</Код>
						<Наименование>--&gt; СубконтоДт2</Наименование>
						<Порядок>900</Порядок>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="СубконтоДт2" Вид="Реквизит"/>
						<КодПравилаКонвертации>БанковскиеСчетаКод                                </КодПравилаКонвертации>
						<ПередВыгрузкой>
Значение = Новый Структура("Код,Владелец",Параметры.СоответствиеСчетов.Получить(Источник.Организация),Источник.Организация);</ПередВыгрузкой>
					</Свойство>
					<Свойство>
						<Код>18</Код>
						<Наименование>--&gt; ОбособленноеПодразделениеОрганизации</Наименование>
						<Порядок>950</Порядок>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="ОбособленноеПодразделениеОрганизации" Вид="Реквизит" Тип="СправочникСсылка.ОбособленныеПодразделенияОрганизаций"/>
						<КодПравилаКонвертации>ОбособленныеПодразделенияКассаКомпании            </КодПравилаКонвертации>
						<ПередВыгрузкой>Выполнить(Алгоритмы.ОбособленоеПодразделение);</ПередВыгрузкой>
					</Свойство>
					<Свойство>
						<Код>19</Код>
						<Наименование>--&gt; СчетУчетаРасчетовСКонтрагентом</Наименование>
						<Порядок>1000</Порядок>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="СчетУчетаРасчетовСКонтрагентом" Вид="Реквизит" Тип="ПланСчетовСсылка.Хозрасчетный"/>
						<КодПравилаКонвертации>Хозрасчетный                                      </КодПравилаКонвертации>
						<ПередВыгрузкой>Значение = новый Структура("Код","333");</ПередВыгрузкой>
					</Свойство>
					<Свойство>
						<Код>21</Код>
						<Наименование>--&gt; НазначениеДенежныхСредств</Наименование>
						<Порядок>1050</Порядок>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="НазначениеДенежныхСредств" Вид="Реквизит" Тип="СправочникСсылка.НазначенияНаличныхДенежныхСредств"/>
						<ПередВыгрузкой>Значение ="Прочее";</ПередВыгрузкой>
					</Свойство>
					<Свойство>
						<Код>22</Код>
						<Наименование>--&gt; ВидОперации</Наименование>
						<Порядок>1100</Порядок>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="ВидОперации" Вид="Реквизит" Тип="ПеречислениеСсылка.ВидыОперацийРКО"/>
						<ПередВыгрузкой>Значение ="ИнкассацияДенежныхСредств";</ПередВыгрузкой>
					</Свойство>
					<Свойство>
						<Код>23</Код>
						<Наименование>--&gt; СтатьяДвиженияДенежныхСредств</Наименование>
						<Порядок>1150</Порядок>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="СтатьяДвиженияДенежныхСредств" Вид="Реквизит" Тип="СправочникСсылка.СтатьиДвиженияДенежныхСредств"/>
						<КодПравилаКонвертации>СтатьиДДС_Код                                     </КодПравилаКонвертации>
						<ПередВыгрузкой>Значение = новый Структура("Код","OR0000401");</ПередВыгрузкой>
					</Свойство>
					<Свойство>
						<Код>24</Код>
						<Наименование>Выдать --&gt; Выдать</Наименование>
						<Порядок>1200</Порядок>
						<Источник Имя="Выдать" Вид="Реквизит"/>
						<Приемник Имя="Выдать" Вид="Реквизит" Тип="Строка"/>
						<ПередВыгрузкой>Значение = Строка(Источник.Выдать);</ПередВыгрузкой>
					</Свойство>
					<Свойство>
						<Код>25</Код>
						<Наименование>Основание --&gt; Основание</Наименование>
						<Порядок>1250</Порядок>
						<Источник Имя="Основание" Вид="Реквизит" Тип="Строка"/>
						<Приемник Имя="Основание" Вид="Реквизит" Тип="Строка"/>
					</Свойство>
					<Свойство>
						<Код>26</Код>
						<Наименование>--&gt; Комментарий</Наименование>
						<Порядок>1300</Порядок>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="Комментарий" Вид="Реквизит" Тип="Строка"/>
						<ПередВыгрузкой>Значение  =  "Загружено с ТК РКО "+ Источник.Номер;</ПередВыгрузкой>
					</Свойство>
				</Свойства>
				<Значения/>
			</Правило>
			<Правило>
				<Код>КонсПоступлениеТоваров</Код>
				<Наименование>Документ: Консолидированные остатки организации</Наименование>
				<Порядок>500</Порядок>
				<ПередВыгрузкой>
Если Не Отказ Тогда 
	
	ЗапрашиваемыеПараметры = Новый ТаблицаЗначений;
	ЗапрашиваемыеПараметры.Колонки.Добавить("Имя");
	ЗапрашиваемыеПараметры.Колонки.Добавить("Представление");
	ЗапрашиваемыеПараметры.Колонки.Добавить("Значение");
	
	ПриобретенияНУ = Новый ТаблицаЗначений;
	ПриобретенияНУ.Колонки.Добавить("ВидДвижения");
	ПриобретенияНУ.Колонки.Добавить("Период");
	ПриобретенияНУ.Колонки.Добавить("Активность");
	ПриобретенияНУ.Колонки.Добавить("Организация");  
	ПриобретенияНУ.Колонки.Добавить("ДоговорКонтрагента");
	ПриобретенияНУ.Колонки.Добавить("Событие");
	ПриобретенияНУ.Колонки.Добавить("СуммаВзаиморасчетов");
	
	ОжидаемыйНДС = Новый ТаблицаЗначений;
	ОжидаемыйНДС.Колонки.Добавить("ВидДвижения");
	ОжидаемыйНДС.Колонки.Добавить("Период");
	ОжидаемыйНДС.Колонки.Добавить("Активность");
	ОжидаемыйНДС.Колонки.Добавить("Организация");  
	ОжидаемыйНДС.Колонки.Добавить("ДоговорКонтрагента");
	ОжидаемыйНДС.Колонки.Добавить("СобытиеНДС");
	ОжидаемыйНДС.Колонки.Добавить("СтавкаНДС");
	ОжидаемыйНДС.Колонки.Добавить("ДляХозяйственнойДеятельности");
	ОжидаемыйНДС.Колонки.Добавить("ВидДеятельностиНДС");
	ОжидаемыйНДС.Колонки.Добавить("БазаНДС");
	ОжидаемыйНДС.Колонки.Добавить("СуммаНДС");
	ОжидаемыйНДС.Колонки.Добавить("КодОперации");
	
	Если Источник.Проведен Тогда
		КонтрагентВнутренний = ТК_СправочникиПовтИсп.ЭтоВнутреннийКонтрагент(Источник.Контрагент);
		
		Дата = Источник.Дата;
		Организация = Источник.Организация;
		ДоговорКонтрагента = Источник.ДоговорВзаиморасчетов;
		СуммаДокумента= Источник.СуммаДокумента;		
		
		Запросы.КонсолидированныеПоступления.УстановитьПараметр("Ссылка", Источник);	
		ТаблицаПроводок = Запросы.КонсолидированныеПоступления.Выполнить().Выгрузить();
		ТаблицаПроводок.ЗаполнитьЗначения(КонтрагентВнутренний, "ЭтоВнутренний");
		
		ПогрешностьСумма 	= 0;
		ПогрешностьСуммаНДС = 0;
		
		КолВоПроводок = ТаблицаПроводок.Количество();
		Ит = 0;
		Для Каждого Стр Из ТаблицаПроводок Цикл 
			Ит = Ит + 1;	
			
			Стр.Сумма = ОбщегоНазначенияТККлиентСервер.ОкруглитьСУчетомПогрешности(Стр.Сумма, 2, ПогрешностьСумма);
			Стр.СуммаНДС = ОбщегоНазначенияТККлиентСервер.ОкруглитьСУчетомПогрешности(Стр.СуммаНДС, 2, ПогрешностьСуммаНДС);
			
			Если Ит = КолВоПроводок Тогда 
				Стр.Сумма = ОбщегоНазначенияТККлиентСервер.ОкруглитьСУчетомПогрешности(Стр.Сумма, 2, ПогрешностьСумма);
				Стр.СуммаНДС = ОбщегоНазначенияТККлиентСервер.ОкруглитьСУчетомПогрешности(Стр.СуммаНДС, 2, ПогрешностьСуммаНДС);		
			КонецЕсли;
		КонецЦикла;			
		
		
		// ПриобретенияНалоговыйУчет	
		НовоеДвижение = ПриобретенияНУ.Добавить();
		НовоеДвижение.ВидДвижения = ВидДвиженияНакопления.Приход;
		НовоеДвижение.Период = Дата;
		НовоеДвижение.Активность = Истина;
		НовоеДвижение.Организация = Организация;
		НовоеДвижение.ДоговорКонтрагента = ДоговорКонтрагента;
		НовоеДвижение.Событие = "ПоступлениеОтПоставщика";	
		НовоеДвижение.СуммаВзаиморасчетов = СуммаДокумента;
		
		// ОжидаемыйИПодтвержденныйНДСПриобретений 
		ТЗПроводки = ТаблицаПроводок.Скопировать(Новый Структура("Тара", Ложь), "Сумма, СуммаНДС");
		ТЗПроводки.Свернуть(, "Сумма, СуммаНДС");	
		
		Для каждого СтрПроводки Из ТЗПроводки Цикл			
			НовоеДвижение = ОжидаемыйНДС.Добавить();
			НовоеДвижение.ВидДвижения = ВидДвиженияНакопления.Приход;
			НовоеДвижение.Период = Дата;
			НовоеДвижение.Активность = Истина;
			НовоеДвижение.Организация = Организация;
			НовоеДвижение.ДоговорКонтрагента = ДоговорКонтрагента;
			НовоеДвижение.СобытиеНДС = "Поступление";			
			НовоеДвижение.ДляХозяйственнойДеятельности = Истина;
			НовоеДвижение.ВидДеятельностиНДС = "Облагаемая";
			НовоеДвижение.КодОперации = "ОжидаемыйНДС";	
			
			НовоеДвижение.СтавкаНДС = Справочники.СтавкиНДС.ОсновнаяСтавкаНДС;
			НовоеДвижение.БазаНДС = СтрПроводки.Сумма - СтрПроводки.СуммаНДС;
			НовоеДвижение.СуммаНДС = СтрПроводки.СуммаНДС;
		КонецЦикла;	
		
		// ЗапрашиваемыеПараметры
		НомерПроводки = 1;
		Для Каждого СтрВыборка Из ТаблицаПроводок Цикл 		
			Для Каждого Колонка Из ТаблицаПроводок.Колонки Цикл 
				Значение = СтрВыборка[Колонка.Имя];
				
				Если Колонка.Имя = "Сумма" 
					ИЛИ Колонка.Имя = "СуммаНДС"
					ИЛИ Колонка.Имя = "СуммаВсего" 
					ИЛИ Колонка.Имя = "Количество" Тогда
					
					Значение = Формат(Значение, "ЧН=0");
				КонецЕсли;
				
				НоваяСтрока = ЗапрашиваемыеПараметры.Добавить();
				НоваяСтрока.Имя =  "Проводка"+НомерПроводки;
				НоваяСтрока.Представление = Колонка.Имя;
				НоваяСтрока.Значение = Значение;
			КонецЦикла;
			НомерПроводки = НомерПроводки+1;
		КонецЦикла;
		
	КонецЕсли;
	
	ВходящиеДанные = Новый Структура;
	ВходящиеДанные.Вставить("ЗапрашиваемыеПараметры", ЗапрашиваемыеПараметры);
	ВходящиеДанные.Вставить("ПриобретенияНалоговыйУчет", ПриобретенияНУ);
	ВходящиеДанные.Вставить("ОжидаемыйИПодтвержденныйНДСПриобретений", ОжидаемыйНДС);
	
КонецЕсли;</ПередВыгрузкой>
				<ПослеЗагрузки>Объект.Подразделение = Справочники.Подразделения.ПустаяСсылка();

Если НЕ Отказ Тогда			
	Если Не ЗначениеЗаполнено(Объект.ТиповаяОперация) Тогда
		тСообщение = "ОШИБКА, ЗАГРУЗКА ПРЕРВАНА, не найдена типовая операция с кодом ""ПТКон""";
		ВызватьИсключение(тСообщение);
	КонецЕсли;				
	
	Объект.ТаблицаРегистровНакопления.Очистить();
	Объект.Содержание = Объект.ТиповаяОперация.Наименование;
	
	Проведен = ПараметрыОбъекта.Получить("Проведен");
	
	Если Проведен Тогда	
		НовРегНакопл = Объект.ТаблицаРегистровНакопления.Добавить();
		НовРегНакопл.Имя = "ПриобретенияНалоговыйУчет";
		НовРегНакопл.Представление = "Приобретения налоговый учет";
		
		НовРегНакопл = Объект.ТаблицаРегистровНакопления.Добавить();
		НовРегНакопл.Имя = "ОжидаемыйИПодтвержденныйНДСПриобретений";
		НовРегНакопл.Представление = "Ожидаемый и подтвержденный НДС приобретений";
		
		Выполнить(Алгоритмы.ЗаполнитьНаОснованииТиповойОперации);
	Иначе
		Объект.Движения.Хозрасчетный.Очистить();
		Объект.Движения.ПриобретенияНалоговыйУчет.Очистить();
		Объект.Движения.ОжидаемыйИПодтвержденныйНДСПриобретений.Очистить();
	КонецЕсли;
	
	ЗаписатьОбъект =  ПараметрыОбъекта.Получить("ЗаписатьОбъект");
	Если ЗаписатьОбъект = Неопределено Тогда
		ЗаписатьОбъект = Ложь;
	КонецЕсли;
	
	Если ЗаписатьОбъект Тогда		
		Выполнить(Алгоритмы.ЗаписатьСоответствиеОбъектов);
	КонецЕсли;
КонецЕсли;	</ПослеЗагрузки>
				<ПоследовательностьПолейПоиска>Параметры.ПараметрыАлгоритмов.Вставить("ВидОбъекта", "ОперацияБух");
Параметры.ПараметрыАлгоритмов.Вставить("ТипОбъектаИсточника", "ДокументСсылка.КонсолидированныеОстаткиОрганизации");
СтрокаИменСвойствПоиска = "ПоискАлгоритмом";

Выполнить(Алгоритмы.ПолучитьСоответствиеОбъектов);

ПрекратитьПоиск = Истина;
</ПоследовательностьПолейПоиска>
				<ГенерироватьНовыйНомерИлиКодЕслиНеУказан>true</ГенерироватьНовыйНомерИлиКодЕслиНеУказан>
				<Источник>ДокументСсылка.КонсолидированныеОстаткиОрганизации</Источник>
				<Приемник>ДокументСсылка.ОперацияБух</Приемник>
				<Свойства>
					<Свойство Поиск="true">
						<Код>1</Код>
						<Наименование>--&gt; GUID_Поиска</Наименование>
						<Порядок>50</Порядок>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="" Вид=""/>
						<ИмяПараметраДляПередачи>GUID_Поиска</ИмяПараметраДляПередачи>
						<ПередВыгрузкой>Значение = ЗначениеВСтрокуВнутр(Источник.УникальныйИдентификатор());</ПередВыгрузкой>
					</Свойство>
					<Свойство>
						<Код>6</Код>
						<Наименование>Проведен --&gt; Проведен</Наименование>
						<Порядок>100</Порядок>
						<Источник Имя="Проведен" Вид="Свойство" Тип="Булево"/>
						<Приемник Имя="" Вид=""/>
						<ИмяПараметраДляПередачи>Проведен</ИмяПараметраДляПередачи>
					</Свойство>
					<Свойство>
						<Код>2</Код>
						<Наименование>Дата --&gt; Дата</Наименование>
						<Порядок>150</Порядок>
						<Источник Имя="Дата" Вид="Свойство" Тип="Дата"/>
						<Приемник Имя="Дата" Вид="Свойство" Тип="Дата"/>
					</Свойство>
					<Свойство>
						<Код>4</Код>
						<Наименование>Организация --&gt; Организация</Наименование>
						<Порядок>200</Порядок>
						<Источник Имя="Организация" Вид="Реквизит" Тип="СправочникСсылка.Организации"/>
						<Приемник Имя="Организация" Вид="Реквизит" Тип="СправочникСсылка.Организации"/>
						<КодПравилаКонвертации>Организации                                       </КодПравилаКонвертации>
					</Свойство>
					<Свойство>
						<Код>5</Код>
						<Наименование>ПометкаУдаления --&gt; ПометкаУдаления</Наименование>
						<Порядок>250</Порядок>
						<Источник Имя="ПометкаУдаления" Вид="Свойство" Тип="Булево"/>
						<Приемник Имя="ПометкаУдаления" Вид="Свойство" Тип="Булево"/>
					</Свойство>
					<Свойство>
						<Код>8</Код>
						<Наименование>СуммаДокумента --&gt; СуммаОперации</Наименование>
						<Порядок>300</Порядок>
						<Источник Имя="СуммаДокумента" Вид="Реквизит" Тип="Число"/>
						<Приемник Имя="СуммаОперации" Вид="Реквизит" Тип="Число"/>
					</Свойство>
					<Свойство>
						<Код>3</Код>
						<Наименование>--&gt; Комментарий</Наименование>
						<Порядок>350</Порядок>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="Комментарий" Вид="Реквизит" Тип="Строка"/>
						<ПередВыгрузкой>Значение = "ПТКон " + Источник.Номер;</ПередВыгрузкой>
					</Свойство>
					<Свойство>
						<Код>7</Код>
						<Наименование>--&gt; СпособЗаполнения</Наименование>
						<Порядок>400</Порядок>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="СпособЗаполнения" Вид="Реквизит"/>
						<ПередВыгрузкой>Значение = "ТиповыеОперации";</ПередВыгрузкой>
					</Свойство>
					<Свойство>
						<Код>9</Код>
						<Наименование>--&gt; ТиповаяОперация</Наименование>
						<Порядок>450</Порядок>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="ТиповаяОперация" Вид="Реквизит"/>
						<КодПравилаКонвертации>ТиповыеОперации                                   </КодПравилаКонвертации>
						<ПередВыгрузкой>Значение = Новый Структура("Код", "ПТКон");</ПередВыгрузкой>
					</Свойство>
					<Группа>
						<Код>30</Код>
						<Наименование>--&gt; ЗапрашиваемыеПараметры</Наименование>
						<Порядок>500</Порядок>
						<ПолучитьИзВходящихДанных>true</ПолучитьИзВходящихДанных>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="ЗапрашиваемыеПараметры" Вид="ТабличнаяЧасть"/>
						<Свойство>
							<Код>32</Код>
							<Наименование>--&gt; Имя</Наименование>
							<Порядок>50</Порядок>
							<Источник Имя="" Вид=""/>
							<Приемник Имя="Имя" Вид="Реквизит" Тип="Строка"/>
						</Свойство>
						<Свойство>
							<Код>33</Код>
							<Наименование>--&gt; Представление</Наименование>
							<Порядок>100</Порядок>
							<Источник Имя="" Вид=""/>
							<Приемник Имя="Представление" Вид="Реквизит" Тип="Строка"/>
						</Свойство>
						<Свойство>
							<Код>31</Код>
							<Наименование>--&gt; Значение</Наименование>
							<Порядок>150</Порядок>
							<Источник Имя="" Вид=""/>
							<Приемник Имя="Значение" Вид="Реквизит"/>
						</Свойство>
					</Группа>
					<Группа>
						<Код>22</Код>
						<Наименование>--&gt; ПриобретенияНалоговыйУчет</Наименование>
						<Порядок>550</Порядок>
						<ПолучитьИзВходящихДанных>true</ПолучитьИзВходящихДанных>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="ПриобретенияНалоговыйУчет" Вид="НаборДвиженийРегистраНакопления"/>
						<Свойство>
							<Код>28</Код>
							<Наименование>--&gt; ВидДвижения</Наименование>
							<Порядок>50</Порядок>
							<Источник Имя="" Вид=""/>
							<Приемник Имя="ВидДвижения" Вид="Свойство"/>
						</Свойство>
						<Свойство>
							<Код>29</Код>
							<Наименование>--&gt; Период</Наименование>
							<Порядок>100</Порядок>
							<Источник Имя="" Вид=""/>
							<Приемник Имя="Период" Вид="Свойство" Тип="Дата"/>
						</Свойство>
						<Свойство>
							<Код>27</Код>
							<Наименование>--&gt; Активность</Наименование>
							<Порядок>150</Порядок>
							<Источник Имя="" Вид=""/>
							<Приемник Имя="Активность" Вид="Свойство" Тип="Булево"/>
						</Свойство>
						<Свойство>
							<Код>24</Код>
							<Наименование>--&gt; Организация</Наименование>
							<Порядок>200</Порядок>
							<Источник Имя="" Вид=""/>
							<Приемник Имя="Организация" Вид="Измерение" Тип="СправочникСсылка.Организации"/>
							<КодПравилаКонвертации>Организации                                       </КодПравилаКонвертации>
						</Свойство>
						<Свойство>
							<Код>23</Код>
							<Наименование>--&gt; ДоговорКонтрагента</Наименование>
							<Порядок>250</Порядок>
							<Источник Имя="" Вид=""/>
							<Приемник Имя="ДоговорКонтрагента" Вид="Измерение" Тип="СправочникСсылка.ДоговорыКонтрагентов"/>
							<КодПравилаКонвертации>ДоговорыКонтрагентов                              </КодПравилаКонвертации>
						</Свойство>
						<Свойство>
							<Код>25</Код>
							<Наименование>--&gt; Событие</Наименование>
							<Порядок>300</Порядок>
							<Источник Имя="" Вид=""/>
							<Приемник Имя="Событие" Вид="Измерение" Тип="ПеречислениеСсылка.СобытияПриобретенияНалоговыйУчет"/>
						</Свойство>
						<Свойство>
							<Код>26</Код>
							<Наименование>--&gt; СуммаВзаиморасчетов</Наименование>
							<Порядок>350</Порядок>
							<Источник Имя="" Вид=""/>
							<Приемник Имя="СуммаВзаиморасчетов" Вид="Ресурс" Тип="Число"/>
						</Свойство>
					</Группа>
					<Группа>
						<Код>10</Код>
						<Наименование>--&gt; ОжидаемыйИПодтвержденныйНДСПриобретений</Наименование>
						<Порядок>600</Порядок>
						<ПолучитьИзВходящихДанных>true</ПолучитьИзВходящихДанных>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="ОжидаемыйИПодтвержденныйНДСПриобретений" Вид="НаборДвиженийРегистраНакопления"/>
						<Свойство>
							<Код>20</Код>
							<Наименование>--&gt; ВидДвижения</Наименование>
							<Порядок>50</Порядок>
							<Источник Имя="" Вид=""/>
							<Приемник Имя="ВидДвижения" Вид="Свойство"/>
						</Свойство>
						<Свойство>
							<Код>21</Код>
							<Наименование>--&gt; Период</Наименование>
							<Порядок>100</Порядок>
							<Источник Имя="" Вид=""/>
							<Приемник Имя="Период" Вид="Свойство" Тип="Дата"/>
						</Свойство>
						<Свойство>
							<Код>19</Код>
							<Наименование>--&gt; Активность</Наименование>
							<Порядок>150</Порядок>
							<Источник Имя="" Вид=""/>
							<Приемник Имя="Активность" Вид="Свойство" Тип="Булево"/>
						</Свойство>
						<Свойство>
							<Код>13</Код>
							<Наименование>--&gt; Организация</Наименование>
							<Порядок>200</Порядок>
							<Источник Имя="" Вид=""/>
							<Приемник Имя="Организация" Вид="Измерение" Тип="СправочникСсылка.Организации"/>
							<КодПравилаКонвертации>Организации                                       </КодПравилаКонвертации>
						</Свойство>
						<Свойство>
							<Код>12</Код>
							<Наименование>--&gt; ДоговорКонтрагента</Наименование>
							<Порядок>250</Порядок>
							<Источник Имя="" Вид=""/>
							<Приемник Имя="ДоговорКонтрагента" Вид="Измерение" Тип="СправочникСсылка.ДоговорыКонтрагентов"/>
							<КодПравилаКонвертации>ДоговорыКонтрагентов                              </КодПравилаКонвертации>
						</Свойство>
						<Свойство>
							<Код>11</Код>
							<Наименование>--&gt; ДляХозяйственнойДеятельности</Наименование>
							<Порядок>300</Порядок>
							<Источник Имя="" Вид=""/>
							<Приемник Имя="ДляХозяйственнойДеятельности" Вид="Измерение" Тип="Булево"/>
						</Свойство>
						<Свойство>
							<Код>14</Код>
							<Наименование>--&gt; СобытиеНДС</Наименование>
							<Порядок>350</Порядок>
							<Источник Имя="" Вид=""/>
							<Приемник Имя="СобытиеНДС" Вид="Измерение" Тип="ПеречислениеСсылка.СобытияОжидаемыйИПодтвержденныйНДСПриобретений"/>
						</Свойство>
						<Свойство>
							<Код>15</Код>
							<Наименование>--&gt; СтавкаНДС</Наименование>
							<Порядок>400</Порядок>
							<Источник Имя="" Вид=""/>
							<Приемник Имя="СтавкаНДС" Вид="Измерение" Тип="ПеречислениеСсылка.СтавкиНДС"/>
							<КодПравилаКонвертации>СтавкиНДС                                         </КодПравилаКонвертации>
						</Свойство>
						<Свойство>
							<Код>16</Код>
							<Наименование>--&gt; КодОперации</Наименование>
							<Порядок>450</Порядок>
							<Источник Имя="" Вид=""/>
							<Приемник Имя="КодОперации" Вид="Реквизит" Тип="ПеречислениеСсылка.КодыОперацийОжидаемыйИПодтвержденныйНДСПриобретений"/>
						</Свойство>
						<Свойство>
							<Код>17</Код>
							<Наименование>--&gt; БазаНДС</Наименование>
							<Порядок>500</Порядок>
							<Источник Имя="" Вид=""/>
							<Приемник Имя="БазаНДС" Вид="Ресурс" Тип="Число"/>
						</Свойство>
						<Свойство>
							<Код>18</Код>
							<Наименование>--&gt; СуммаНДС</Наименование>
							<Порядок>550</Порядок>
							<Источник Имя="" Вид=""/>
							<Приемник Имя="СуммаНДС" Вид="Ресурс" Тип="Число"/>
						</Свойство>
						<Свойство>
							<Код>34</Код>
							<Наименование>--&gt; ВидДеятельностиНДС</Наименование>
							<Порядок>600</Порядок>
							<Источник Имя="" Вид=""/>
							<Приемник Имя="ВидДеятельностиНДС" Вид="Измерение" Тип="ПеречислениеСсылка.ВидыДеятельностиНДС"/>
						</Свойство>
					</Группа>
				</Свойства>
				<Значения/>
			</Правило>
			<Правило>
				<Код>ЗКС</Код>
				<Наименование>Документ: Поступление товаров</Наименование>
				<Порядок>550</Порядок>
				<ПередВыгрузкой>
Если Не Отказ Тогда 
	
	ЗапрашиваемыеПараметры = Новый ТаблицаЗначений;
	ЗапрашиваемыеПараметры.Колонки.Добавить("Имя");
	ЗапрашиваемыеПараметры.Колонки.Добавить("Представление");
	ЗапрашиваемыеПараметры.Колонки.Добавить("Значение");
	
	Если Источник.Проведен Тогда	
		Запросы.ЗКС.УстановитьПараметр("Ссылка", Источник);	
		Запросы.ЗКС.УстановитьПараметр("Дата", Источник.Дата);	
		МассивРезультатов = Запросы.ЗКС.ВыполнитьПакет();

		Проводки1 = МассивРезультатов[1].Выгрузить();
		Проводки2 = МассивРезультатов[2].Выгрузить();
		Проводки3 = МассивРезультатов[3].Выгрузить();
		
		НомерПроводки = 0;
		Для Каждого Стр Из Проводки1 Цикл 
			НомерПроводки = НомерПроводки + 1;
			ИмяПроводки = "Проводка" + НомерПроводки;
			
			Для Каждого Колонка Из Проводки1.Колонки Цикл 
				Значение = Стр[Колонка.Имя];
				
				Если Колонка.Имя = "Сумма" 
					ИЛИ Колонка.Имя = "СуммаНДС"
					ИЛИ Колонка.Имя = "СебестоимостьБезНДС" Тогда
					
					Значение = Формат(Значение, "ЧН=0");
				КонецЕсли;
				
				НоваяСтрока = ЗапрашиваемыеПараметры.Добавить();
				НоваяСтрока.Имя = ИмяПроводки;
				НоваяСтрока.Представление = Колонка.Имя;
				НоваяСтрока.Значение =  Значение;
			КонецЦикла;
		КонецЦикла;

		Для Каждого Стр Из Проводки2 Цикл 
			НомерПроводки = НомерПроводки + 1;
			ИмяПроводки = "Проводка" + НомерПроводки;
			
			Для Каждого Колонка Из Проводки2.Колонки Цикл 
				Значение = Стр[Колонка.Имя];
				
				Если Колонка.Имя = "Сумма" 
					ИЛИ Колонка.Имя = "СуммаНДС"
					ИЛИ Колонка.Имя = "СебестоимостьБезНДС" Тогда
					
					Значение = Формат(Значение, "ЧН=0");
				КонецЕсли;

				
				НоваяСтрока = ЗапрашиваемыеПараметры.Добавить();
				НоваяСтрока.Имя = ИмяПроводки;
				НоваяСтрока.Представление = Колонка.Имя;
				НоваяСтрока.Значение =  Значение;
			КонецЦикла;
		КонецЦикла;

		Для Каждого Стр Из Проводки3 Цикл 
			НомерПроводки = НомерПроводки + 1;
			ИмяПроводки = "Проводка" + НомерПроводки;
			
			Для Каждого Колонка Из Проводки3.Колонки Цикл 
				Если Колонка.Имя = "Кассы" 
					И Не (Стр.ПризнакПроводки = "ПоКассамЗаСобственныйТовар"
						ИЛИ Стр.ПризнакПроводки = "СкидкаПоКассамНаСобственныйТовар" ИЛИ Стр.ПризнакПроводки = "ПоКассамЗаСобственныйТоварВозврат") Тогда 
					
					Продолжить;
				КонецЕсли;
				
				Значение = Стр[Колонка.Имя];
				
				Если Колонка.Имя = "Сумма" 
					ИЛИ Колонка.Имя = "СуммаНДС"
					ИЛИ Колонка.Имя = "СебестоимостьБезНДС" Тогда
					
					Значение = Формат(Значение, "ЧН=0");
				КонецЕсли;

				
				НоваяСтрока = ЗапрашиваемыеПараметры.Добавить();
				НоваяСтрока.Имя = ИмяПроводки;
				НоваяСтрока.Представление = Колонка.Имя;
				НоваяСтрока.Значение =  Значение;
			КонецЦикла;
		КонецЦикла;
		
		////Корректировки округления
		//ВыборкаРазница = МассивРезультатов[4].Выбрать();
		//ВыборкаРазница.Следующий();
		//
		//ТаблицаРазница = Новый ТаблицаЗначений;
		//ТаблицаРазница.Колонки.Добавить("Сумма");
		//ТаблицаРазница.Колонки.Добавить("ПризнакПроводки");
		//
		//Если ВыборкаРазница.РазницаСуммаНДС &lt;&gt; 0 Тогда 
		//	НоваяСтрока = ТаблицаРазница.Добавить();
		//	НоваяСтрока.Сумма = ВыборкаРазница.РазницаСуммаНДС;
		//	НоваяСтрока.ПризнакПроводки = "КорректировкаНДС";	
		//КонецЕсли;
		//
		//Если ВыборкаРазница.РазницаАкциз &lt;&gt; 0 Тогда 
		//	НоваяСтрока = ТаблицаРазница.Добавить();
		//	НоваяСтрока.Сумма = ВыборкаРазница.РазницаАкциз;
		//	НоваяСтрока.ПризнакПроводки = "КорректировкаАкциз";	
		//КонецЕсли;

		//Для Каждого Стр Из ТаблицаРазница Цикл 
		//	НомерПроводки = НомерПроводки + 1;
		//	ИмяПроводки = "Проводка" + НомерПроводки;
		//	
		//	Для Каждого Колонка Из ТаблицаРазница.Колонки Цикл 
		//		НоваяСтрока = ЗапрашиваемыеПараметры.Добавить();
		//		НоваяСтрока.Имя = ИмяПроводки;
		//		НоваяСтрока.Представление = Колонка.Имя;
		//		НоваяСтрока.Значение =  Стр[Колонка.Имя];
		//	КонецЦикла;
		//КонецЦикла;

	КонецЕсли;
	
	ВходящиеДанные = Новый Структура;
	ВходящиеДанные.Вставить("ЗапрашиваемыеПараметры", ЗапрашиваемыеПараметры);
	
КонецЕсли;</ПередВыгрузкой>
				<ПослеЗагрузки>Объект.Подразделение =Справочники.Подразделения.ПустаяСсылка();

Если НЕ Отказ Тогда			
	Если Не ЗначениеЗаполнено(Объект.ТиповаяОперация) Тогда
		тСообщение = "ОШИБКА, ЗАГРУЗКА ПРЕРВАНА, не найдена типовая операция с кодом ""РТУРН""";
		ВызватьИсключение(тСообщение);
	КонецЕсли;				
	
	Объект.ТаблицаРегистровНакопления.Очистить();
	Объект.Движения.Хозрасчетный.Очистить();	
	Объект.Содержание = Объект.ТиповаяОперация.Наименование;	
	
	Проведен = ПараметрыОбъекта.Получить("Проведен");
	Если Проведен Тогда 
		Выполнить(Алгоритмы.ЗаполнитьНаОснованииТиповойОперации);
	КонецЕсли;
	
	ЗаписатьОбъект =  ПараметрыОбъекта.Получить("ЗаписатьОбъект");
	Если ЗаписатьОбъект = Неопределено Тогда
		ЗаписатьОбъект = Ложь;
	КонецЕсли;
	
	Если ЗаписатьОбъект Тогда		
		Выполнить(Алгоритмы.ЗаписатьСоответствиеОбъектов);
	КонецЕсли;
КонецЕсли;	</ПослеЗагрузки>
				<ПоследовательностьПолейПоиска>Параметры.ПараметрыАлгоритмов.Вставить("ВидОбъекта","ОперацияБух");
Параметры.ПараметрыАлгоритмов.Вставить("ТипОбъектаИсточника", "ДокументСсылка.ТК_ЗакрытиеСменыЗКС");
СтрокаИменСвойствПоиска = "ПоискАлгоритмом";

Выполнить(Алгоритмы.ПолучитьСоответствиеОбъектов);
ПрекратитьПоиск = Истина;
</ПоследовательностьПолейПоиска>
				<ГенерироватьНовыйНомерИлиКодЕслиНеУказан>true</ГенерироватьНовыйНомерИлиКодЕслиНеУказан>
				<Источник>ДокументСсылка.ТК_ЗакрытиеСменыЗКС</Источник>
				<Приемник>ДокументСсылка.ОперацияБух</Приемник>
				<Свойства>
					<Свойство Поиск="true">
						<Код>1</Код>
						<Наименование>--&gt; GUID_Поиска</Наименование>
						<Порядок>50</Порядок>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="" Вид=""/>
						<ИмяПараметраДляПередачи>GUID_Поиска</ИмяПараметраДляПередачи>
						<ПередВыгрузкой>Значение = ЗначениеВСтрокуВнутр(Источник.УникальныйИдентификатор());</ПередВыгрузкой>
					</Свойство>
					<Свойство>
						<Код>6</Код>
						<Наименование>Проведен --&gt; Проведен</Наименование>
						<Порядок>100</Порядок>
						<Источник Имя="Проведен" Вид="Свойство" Тип="Булево"/>
						<Приемник Имя="" Вид=""/>
						<ИмяПараметраДляПередачи>Проведен</ИмяПараметраДляПередачи>
					</Свойство>
					<Свойство>
						<Код>4</Код>
						<Наименование>Дата --&gt; Дата</Наименование>
						<Порядок>150</Порядок>
						<Источник Имя="Дата" Вид="Свойство" Тип="Дата"/>
						<Приемник Имя="Дата" Вид="Свойство" Тип="Дата"/>
					</Свойство>
					<Свойство>
						<Код>3</Код>
						<Наименование>Организация --&gt; Организация</Наименование>
						<Порядок>200</Порядок>
						<Источник Имя="Организация" Вид="Реквизит" Тип="СправочникСсылка.Организации"/>
						<Приемник Имя="Организация" Вид="Реквизит" Тип="СправочникСсылка.Организации"/>
						<КодПравилаКонвертации>Организации                                       </КодПравилаКонвертации>
					</Свойство>
					<Свойство>
						<Код>7</Код>
						<Наименование>ПодразделениеКомпании --&gt; Подразделение</Наименование>
						<Порядок>250</Порядок>
						<Источник Имя="ПодразделениеКомпании" Вид="Реквизит" Тип="СправочникСсылка.ПодразделенияКомпании"/>
						<Приемник Имя="Подразделение" Вид="Реквизит" Тип="СправочникСсылка.Подразделения"/>
						<КодПравилаКонвертации>Подразделения                                     </КодПравилаКонвертации>
						<ПередВыгрузкой>Если Источник.Дата &lt; Дата("20211201") Тогда
	Значение = Неопределено;
КонецЕсли;</ПередВыгрузкой>
					</Свойство>
					<Свойство>
						<Код>5</Код>
						<Наименование>ПометкаУдаления --&gt; ПометкаУдаления</Наименование>
						<Порядок>300</Порядок>
						<Источник Имя="ПометкаУдаления" Вид="Свойство" Тип="Булево"/>
						<Приемник Имя="ПометкаУдаления" Вид="Свойство" Тип="Булево"/>
					</Свойство>
					<Свойство>
						<Код>9</Код>
						<Наименование>СуммаДокумента --&gt; СуммаОперации</Наименование>
						<Порядок>350</Порядок>
						<Источник Имя="СуммаДокумента" Вид="Реквизит" Тип="Число"/>
						<Приемник Имя="СуммаОперации" Вид="Реквизит" Тип="Число"/>
					</Свойство>
					<Свойство>
						<Код>2</Код>
						<Наименование>--&gt; Комментарий</Наименование>
						<Порядок>400</Порядок>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="Комментарий" Вид="Реквизит" Тип="Строка"/>
						<ПередВыгрузкой>Значение = "РР(новый) " + Источник.Номер;</ПередВыгрузкой>
					</Свойство>
					<Свойство>
						<Код>8</Код>
						<Наименование>--&gt; СпособЗаполнения</Наименование>
						<Порядок>450</Порядок>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="СпособЗаполнения" Вид="Реквизит"/>
						<ПередВыгрузкой>Значение = "ТиповыеОперации";</ПередВыгрузкой>
					</Свойство>
					<Свойство>
						<Код>10</Код>
						<Наименование>--&gt; ТиповаяОперация</Наименование>
						<Порядок>500</Порядок>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="ТиповаяОперация" Вид="Реквизит"/>
						<КодПравилаКонвертации>ТиповыеОперации                                   </КодПравилаКонвертации>
						<ПередВыгрузкой>Значение = Новый Структура("Код", "РТУРН");</ПередВыгрузкой>
					</Свойство>
					<Группа>
						<Код>11</Код>
						<Наименование>--&gt; ЗапрашиваемыеПараметры</Наименование>
						<Порядок>550</Порядок>
						<ПолучитьИзВходящихДанных>true</ПолучитьИзВходящихДанных>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="ЗапрашиваемыеПараметры" Вид="ТабличнаяЧасть"/>
						<Свойство>
							<Код>13</Код>
							<Наименование>--&gt; Имя</Наименование>
							<Порядок>50</Порядок>
							<Источник Имя="" Вид=""/>
							<Приемник Имя="Имя" Вид="Реквизит" Тип="Строка"/>
						</Свойство>
						<Свойство>
							<Код>14</Код>
							<Наименование>--&gt; Представление</Наименование>
							<Порядок>100</Порядок>
							<Источник Имя="" Вид=""/>
							<Приемник Имя="Представление" Вид="Реквизит" Тип="Строка"/>
						</Свойство>
						<Свойство>
							<Код>12</Код>
							<Наименование>--&gt; Значение</Наименование>
							<Порядок>150</Порядок>
							<Источник Имя="" Вид=""/>
							<Приемник Имя="Значение" Вид="Реквизит"/>
							<ПриВыгрузке>Если ОбъектКоллекции.Представление = "Номенклатурные_группы" Тогда
	ИмяПКО = "НоменклатурныеГруппы";	
КонецЕсли;</ПриВыгрузке>
						</Свойство>
					</Группа>
				</Свойства>
				<Значения/>
			</Правило>
			<Правило>
				<Код>ЗКС_Корректировки</Код>
				<Наименование>: </Наименование>
				<Порядок>600</Порядок>
				<ПередВыгрузкой>Если Не Отказ Тогда
	Дата 		= Неопределено;
	GUID_Поиска = Неопределено;
	Организация = Неопределено;
	
	Если Не ИсходящиеДанные.Свойство("Дата", Дата)
		ИЛИ Не ИсходящиеДанные.Свойство("GUID_Поиска", GUID_Поиска)
		ИЛИ Не ИсходящиеДанные.Свойство("Организация", Организация) Тогда 
		
		ОбщегоНазначения.СообщитьПользователю("Не переданы требуемые параметры выгрузки корректировки ЗКС");
		
		Отказ = Истина;
	КонецЕсли;
КонецЕсли;		

Если Не Отказ Тогда
	//НачалоПериода = НачалоДня(НачалоМесяца(Дата));
	//КонецПериода = КонецДня(КонецМесяца(Дата));
	
	ЗапрашиваемыеПараметры = Новый ТаблицаЗначений;
	ЗапрашиваемыеПараметры.Колонки.Добавить("Имя");
	ЗапрашиваемыеПараметры.Колонки.Добавить("Представление");
	ЗапрашиваемыеПараметры.Колонки.Добавить("Значение");
	
	//Запросы.КорректировкаЗКС.УстановитьПараметр("НачалоПериода", НачалоПериода);	
	//Запросы.КорректировкаЗКС.УстановитьПараметр("КонецПериода", КонецПериода);	
	//Запросы.КорректировкаЗКС.УстановитьПараметр("Организация", Организация);		
	//тзЗКС = Запросы.КорректировкаЗКС.Выполнить().Выгрузить();
	
	РазницаСуммаНДС = ОбщегоНазначенияКлиентСервер.СвойствоСтруктуры(ИсходящиеДанные, "СуммаНДС", 0);
	РазницаСуммаАкциз = ОбщегоНазначенияКлиентСервер.СвойствоСтруктуры(ИсходящиеДанные, "СуммаАкциз", 0);
		
	ТаблицаПроводок = Новый ТаблицаЗначений;
	ТаблицаПроводок.Колонки.Добавить("ПризнакПроводки");
	ТаблицаПроводок.Колонки.Добавить("Сумма");
	
	Если РазницаСуммаНДС &lt;&gt; 0 Тогда 
		НоваяСтрока = ТаблицаПроводок.Добавить();
		НоваяСтрока.ПризнакПроводки = "КорректировкаНДС";
		НоваяСтрока.Сумма = РазницаСуммаНДС;
	КонецЕсли;
	
	Если РазницаСуммаАкциз &lt;&gt; 0 Тогда 
		НоваяСтрока = ТаблицаПроводок.Добавить();
		НоваяСтрока.ПризнакПроводки = "КорректировкаАкциз";
		НоваяСтрока.Сумма = РазницаСуммаАкциз;		
	КонецЕсли;
	
	Если ТаблицаПроводок.Количество() &gt; 0 Тогда 
		// ЗапрашиваемыеПараметры
		НомерПроводки = 1;
		Для Каждого СтрВыборка Из ТаблицаПроводок Цикл 		
			Для Каждого Колонка Из ТаблицаПроводок.Колонки Цикл 
				НоваяСтрока = ЗапрашиваемыеПараметры.Добавить();
				НоваяСтрока.Имя =  "Проводка"+НомерПроводки;
				НоваяСтрока.Представление = Колонка.Имя;
				НоваяСтрока.Значение =  СтрВыборка[Колонка.Имя];
			КонецЦикла;
			НомерПроводки = НомерПроводки+1;
		КонецЦикла;	
	Иначе
		Отказ = Истина;
	КонецЕсли;
	
	ВходящиеДанные = Новый Структура;
	ВходящиеДанные.Вставить("GUID_Поиска", GUID_Поиска);
	ВходящиеДанные.Вставить("Дата", КонецДня(Дата));
	ВходящиеДанные.Вставить("Организация", Организация);
	ВходящиеДанные.Вставить("Комментарий", СтроковыеФункцииКлиентСервер.ПодставитьПараметрыВСтроку("Корректировка расхождений ЗКС за %1", Формат(Дата, "ДФ=dd.MM.yyyy")));
	ВходящиеДанные.Вставить("ЗапрашиваемыеПараметры", ЗапрашиваемыеПараметры);	
КонецЕсли;
</ПередВыгрузкой>
				<ПослеЗагрузки>Объект.Подразделение =Справочники.Подразделения.ПустаяСсылка();

Если НЕ Отказ Тогда			
	Если Не ЗначениеЗаполнено(Объект.ТиповаяОперация) Тогда
		тСообщение = "ОШИБКА, ЗАГРУЗКА ПРЕРВАНА, не найдена типовая операция с кодом ""РТУРН_К""";
		ВызватьИсключение(тСообщение);
	КонецЕсли;				
	
	Объект.ТаблицаРегистровНакопления.Очистить();
	Объект.Движения.Хозрасчетный.Очистить();	
	Объект.Содержание = Объект.ТиповаяОперация.Наименование;	
	
	Выполнить(Алгоритмы.ЗаполнитьНаОснованииТиповойОперации);
	
	ЗаписатьОбъект =  ПараметрыОбъекта.Получить("ЗаписатьОбъект");
	Если ЗаписатьОбъект = Неопределено Тогда
		ЗаписатьОбъект = Ложь;
	КонецЕсли;
	
	Если ЗаписатьОбъект Тогда		
		Выполнить(Алгоритмы.ЗаписатьСоответствиеОбъектов);
	КонецЕсли;
КонецЕсли;	</ПослеЗагрузки>
				<ПоследовательностьПолейПоиска>Параметры.ПараметрыАлгоритмов.Вставить("ВидОбъекта","ОперацияБух");
Параметры.ПараметрыАлгоритмов.Вставить("ТипОбъектаИсточника", "ДокументСсылка.ТК_ЗакрытиеСменыЗКС");
СтрокаИменСвойствПоиска = "ПоискАлгоритмом";

Выполнить(Алгоритмы.ПолучитьСоответствиеОбъектов);
ПрекратитьПоиск = Истина;
</ПоследовательностьПолейПоиска>
				<ГенерироватьНовыйНомерИлиКодЕслиНеУказан>true</ГенерироватьНовыйНомерИлиКодЕслиНеУказан>
				<Приемник>ДокументСсылка.ОперацияБух</Приемник>
				<Свойства>
					<Свойство Поиск="true">
						<Код>1</Код>
						<Наименование>--&gt; GUID_Поиска</Наименование>
						<Порядок>50</Порядок>
						<ПолучитьИзВходящихДанных>true</ПолучитьИзВходящихДанных>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="" Вид=""/>
						<ИмяПараметраДляПередачи>GUID_Поиска</ИмяПараметраДляПередачи>
					</Свойство>
					<Свойство>
						<Код>7</Код>
						<Наименование>--&gt; Дата</Наименование>
						<Порядок>100</Порядок>
						<ПолучитьИзВходящихДанных>true</ПолучитьИзВходящихДанных>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="Дата" Вид="Свойство" Тип="Дата"/>
					</Свойство>
					<Свойство>
						<Код>3</Код>
						<Наименование>--&gt; Организация</Наименование>
						<Порядок>150</Порядок>
						<ПолучитьИзВходящихДанных>true</ПолучитьИзВходящихДанных>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="Организация" Вид="Реквизит" Тип="СправочникСсылка.Организации"/>
						<КодПравилаКонвертации>Организации                                       </КодПравилаКонвертации>
					</Свойство>
					<Свойство>
						<Код>2</Код>
						<Наименование>--&gt; Комментарий</Наименование>
						<Порядок>200</Порядок>
						<ПолучитьИзВходящихДанных>true</ПолучитьИзВходящихДанных>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="Комментарий" Вид="Реквизит" Тип="Строка"/>
					</Свойство>
					<Свойство>
						<Код>5</Код>
						<Наименование>--&gt; СпособЗаполнения</Наименование>
						<Порядок>250</Порядок>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="СпособЗаполнения" Вид="Реквизит"/>
						<ПередВыгрузкой>Значение = "ТиповыеОперации";</ПередВыгрузкой>
					</Свойство>
					<Свойство>
						<Код>6</Код>
						<Наименование>--&gt; ТиповаяОперация</Наименование>
						<Порядок>300</Порядок>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="ТиповаяОперация" Вид="Реквизит"/>
						<КодПравилаКонвертации>ТиповыеОперации                                   </КодПравилаКонвертации>
						<ПередВыгрузкой>Значение = Новый Структура("Код", "РТУРН_К");</ПередВыгрузкой>
					</Свойство>
					<Группа>
						<Код>8</Код>
						<Наименование>--&gt; ЗапрашиваемыеПараметры</Наименование>
						<Порядок>400</Порядок>
						<ПолучитьИзВходящихДанных>true</ПолучитьИзВходящихДанных>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="ЗапрашиваемыеПараметры" Вид="ТабличнаяЧасть"/>
						<Свойство>
							<Код>10</Код>
							<Наименование>--&gt; Имя</Наименование>
							<Порядок>50</Порядок>
							<Источник Имя="" Вид=""/>
							<Приемник Имя="Имя" Вид="Реквизит" Тип="Строка"/>
						</Свойство>
						<Свойство>
							<Код>11</Код>
							<Наименование>--&gt; Представление</Наименование>
							<Порядок>100</Порядок>
							<Источник Имя="" Вид=""/>
							<Приемник Имя="Представление" Вид="Реквизит" Тип="Строка"/>
						</Свойство>
						<Свойство>
							<Код>9</Код>
							<Наименование>--&gt; Значение</Наименование>
							<Порядок>150</Порядок>
							<Источник Имя="" Вид=""/>
							<Приемник Имя="Значение" Вид="Реквизит"/>
						</Свойство>
					</Группа>
				</Свойства>
				<Значения/>
			</Правило>
			<Правило>
				<Код>ЗКС_Общий</Код>
				<Наименование>: </Наименование>
				<Порядок>650</Порядок>
				<ПередВыгрузкой>GUID_Поиска = Неопределено;
Дата 		= Неопределено;
Организация = Неопределено;
Подразделение = Неопределено;
МенеджерВТ 	= Неопределено;

ЗапрашиваемыеПараметры = Новый ТаблицаЗначений;
ЗапрашиваемыеПараметры.Колонки.Добавить("Имя");
ЗапрашиваемыеПараметры.Колонки.Добавить("Представление");
ЗапрашиваемыеПараметры.Колонки.Добавить("Значение");


Если Не Отказ Тогда 		
	Если Не ИсходящиеДанные.Свойство("GUID_Поиска", GUID_Поиска)
		ИЛИ Не ИсходящиеДанные.Свойство("Дата", Дата)
		ИЛИ Не ИсходящиеДанные.Свойство("Организация", Организация)
		ИЛИ Не ИсходящиеДанные.Свойство("ПодразделениеКомпании", Подразделение)
		ИЛИ Не ИсходящиеДанные.Свойство("МенеджерВТ", МенеджерВТ) Тогда
		
		ОбщегоНазначения.СообщитьПользователю("Не переданы требуемые параметры выгрузки корректировки ЗКС");
		Отказ = Истина;
	КонецЕсли;
КонецЕсли;

Если Не Отказ Тогда 
	Запрос = Новый Запрос;
	Запрос.МенеджерВременныхТаблиц = МенеджерВТ;
	
	Запрос.УстановитьПараметр("Организация", Организация);
	Запрос.УстановитьПараметр("Подразделение", Подразделение);
	
	Запрос.Текст = "ВЫБРАТЬ
	               |	втТоварыЗКС.Дата КАК Дата,
	               |	втТоварыЗКС.Организация КАК Организация,
	               |	втТоварыЗКС.ПодразделениеКомпании КАК ПодразделениеКомпании,
	               |	втТоварыЗКС.СкладКомпании КАК СкладКомпании,
	               |	втТоварыЗКС.ТорговаяПлощадка КАК ТорговаяПлощадка,
	               |	втТоварыЗКС.КассаККМ КАК КассаККМ,
	               |	втТоварыЗКС.ГруппаЦенообразования КАК ГруппаЦенообразования,
	               |	втТоварыЗКС.окрСуммаВсего КАК окрСуммаВсего,
	               |	втТоварыЗКС.окрСуммаНДС КАК окрСуммаНДС,
	               |	втТоварыЗКС.окрСуммаАкцизногоНалога КАК окрСуммаАкцизногоНалога
	               |ПОМЕСТИТЬ втТоварыПодразделения
	               |ИЗ
	               |	втТоварыЗКС КАК втТоварыЗКС
	               |ГДЕ
	               |	втТоварыЗКС.Организация = &amp;Организация
	               |	И втТоварыЗКС.ПодразделениеКомпании = &amp;Подразделение
	               |;
	               |
	               |////////////////////////////////////////////////////////////////////////////////
	               |ВЫБРАТЬ
	               |	втТоварыПодразделения.ГруппаЦенообразования КАК Номенклатура,
	               |	втТоварыПодразделения.ГруппаЦенообразования КАК Номенклатурные_группы,
	               |	втТоварыПодразделения.СкладКомпании КАК Склады,
	               |	ВЫРАЗИТЬ(СУММА(втТоварыПодразделения.окрСуммаВсего - втТоварыПодразделения.окрСуммаНДС - втТоварыПодразделения.окрСуммаАкцизногоНалога) * 0.95 КАК ЧИСЛО(15, 2)) КАК СебестоимостьБезНДС,
	               |	СУММА(втТоварыПодразделения.окрСуммаНДС) КАК СуммаНДС,
	               |	ЛОЖЬ КАК ПоставщикНаЕдиномНалоге,
	               |	""ПоСобственнойНоменклатуре"" КАК ПризнакПроводки
	               |ИЗ
	               |	втТоварыПодразделения КАК втТоварыПодразделения
	               |
	               |СГРУППИРОВАТЬ ПО
	               |	втТоварыПодразделения.СкладКомпании,
	               |	втТоварыПодразделения.ГруппаЦенообразования,
	               |	втТоварыПодразделения.ГруппаЦенообразования
	               |
	               |УПОРЯДОЧИТЬ ПО
	               |	Склады,
	               |	Номенклатура
	               |;
	               |
	               |////////////////////////////////////////////////////////////////////////////////
	               |ВЫБРАТЬ
	               |	втОплатаКартамиЗКС.КассаККМ КАК Кассы,
	               |	втОплатаКартамиЗКС.БанковскийСчет КАК БанковскийСчет,
	               |	втОплатаКартамиЗКС.Контрагент КАК Контрагенты,
	               |	втОплатаКартамиЗКС.Сумма КАК Сумма,
	               |	""ОплатаПоТерминалу"" КАК ПризнакПроводки
	               |ИЗ
	               |	втОплатаКартамиЗКС КАК втОплатаКартамиЗКС
	               |ГДЕ
	               |	втОплатаКартамиЗКС.Организация = &amp;Организация
	               |	И втОплатаКартамиЗКС.ПодразделениеКомпании = &amp;Подразделение
	               |;
	               |
	               |////////////////////////////////////////////////////////////////////////////////
	               |ВЫБРАТЬ
	               |	втТоварыПодразделения.КассаККМ КАК Кассы,
	               |	СУММА(втТоварыПодразделения.окрСуммаВсего) КАК Сумма,
	               |	""ПоКассамЗаСобственныйТовар"" КАК ПризнакПроводки
	               |ИЗ
	               |	втТоварыПодразделения КАК втТоварыПодразделения
	               |
	               |СГРУППИРОВАТЬ ПО
	               |	втТоварыПодразделения.КассаККМ
	               |
	               |ОБЪЕДИНИТЬ ВСЕ
	               |
	               |ВЫБРАТЬ
	               |	ЗНАЧЕНИЕ(Справочник.КассыККМ.ПустаяСсылка),
	               |	СУММА(втТоварыПодразделения.окрСуммаАкцизногоНалога),
	               |	""АкцизныйНалог""
	               |ИЗ
	               |	втТоварыПодразделения КАК втТоварыПодразделения
	               |
	               |ИМЕЮЩИЕ
	               |	СУММА(втТоварыПодразделения.окрСуммаАкцизногоНалога) &gt; 0
	               |
	               |ОБЪЕДИНИТЬ ВСЕ
	               |
	               |ВЫБРАТЬ
	               |	ЗНАЧЕНИЕ(Справочник.КассыККМ.ПустаяСсылка),
	               |	СУММА(втТоварыПодразделения.окрСуммаНДС),
	               |	""НДСПоСобственнойНоменклатуре""
	               |ИЗ
	               |	втТоварыПодразделения КАК втТоварыПодразделения
	               |
	               |ИМЕЮЩИЕ
	               |	СУММА(втТоварыПодразделения.окрСуммаНДС) &gt; 0
	               |
	               |ОБЪЕДИНИТЬ ВСЕ
	               |
	               |ВЫБРАТЬ
	               |	ЗНАЧЕНИЕ(Справочник.КассыККМ.ПустаяСсылка),
	               |	СУММА(втТоварыПодразделения.окрСуммаВсего - втТоварыПодразделения.окрСуммаНДС - втТоварыПодразделения.окрСуммаАкцизногоНалога),
	               |	""ПоВсемСобственнымТоварам""
	               |ИЗ
	               |	втТоварыПодразделения КАК втТоварыПодразделения";
	
	МассивРезультатов = Запрос.ВыполнитьПакет();
	Проводки1 = МассивРезультатов[1].Выгрузить();
	Проводки2 = МассивРезультатов[2].Выгрузить();
	Проводки3 = МассивРезультатов[3].Выгрузить();
	
	НомерПроводки = 0;
	Для Каждого Стр Из Проводки1 Цикл 
		НомерПроводки = НомерПроводки + 1;
		ИмяПроводки = "Проводка" + НомерПроводки;
		
		Для Каждого Колонка Из Проводки1.Колонки Цикл 
			Значение = Стр[Колонка.Имя];
			
			Если Колонка.Имя = "Сумма" 
				ИЛИ Колонка.Имя = "СуммаНДС"
				ИЛИ Колонка.Имя = "СебестоимостьБезНДС" Тогда
				
				Значение = Формат(Значение, "ЧН=0");
			КонецЕсли;
			
			НоваяСтрока = ЗапрашиваемыеПараметры.Добавить();
			НоваяСтрока.Имя = ИмяПроводки;
			НоваяСтрока.Представление = Колонка.Имя;
			НоваяСтрока.Значение =  Значение;
		КонецЦикла;
	КонецЦикла;

	Для Каждого Стр Из Проводки2 Цикл 
		НомерПроводки = НомерПроводки + 1;
		ИмяПроводки = "Проводка" + НомерПроводки;
		
		Для Каждого Колонка Из Проводки2.Колонки Цикл 
			Значение = Стр[Колонка.Имя];
			
			Если Колонка.Имя = "Сумма" 
				ИЛИ Колонка.Имя = "СуммаНДС"
				ИЛИ Колонка.Имя = "СебестоимостьБезНДС" Тогда
				
				Значение = Формат(Значение, "ЧН=0");
			КонецЕсли;

			
			НоваяСтрока = ЗапрашиваемыеПараметры.Добавить();
			НоваяСтрока.Имя = ИмяПроводки;
			НоваяСтрока.Представление = Колонка.Имя;
			НоваяСтрока.Значение =  Значение;
		КонецЦикла;
	КонецЦикла;

	Для Каждого Стр Из Проводки3 Цикл 
		НомерПроводки = НомерПроводки + 1;
		ИмяПроводки = "Проводка" + НомерПроводки;
		
		Для Каждого Колонка Из Проводки3.Колонки Цикл 
			//Если Колонка.Имя = "Кассы" 
			//	И Не (Стр.ПризнакПроводки = "ПоКассамЗаСобственныйТовар"
			//		ИЛИ Стр.ПризнакПроводки = "СкидкаПоКассамНаСобственныйТовар" ИЛИ Стр.ПризнакПроводки = "ПоКассамЗаСобственныйТоварВозврат") Тогда 
			//	
			//	Продолжить;
			//КонецЕсли;
			
			Значение = Стр[Колонка.Имя];
			
			Если Колонка.Имя = "Сумма" 
				ИЛИ Колонка.Имя = "СуммаНДС"
				ИЛИ Колонка.Имя = "СебестоимостьБезНДС" Тогда
				
				Значение = Формат(Значение, "ЧН=0");
			КонецЕсли;

			
			НоваяСтрока = ЗапрашиваемыеПараметры.Добавить();
			НоваяСтрока.Имя = ИмяПроводки;
			НоваяСтрока.Представление = Колонка.Имя;
			НоваяСтрока.Значение =  Значение;
		КонецЦикла;
	КонецЦикла;
	
	//Корректировки сумм
	Если ИсходящиеДанные.Свойство("ТаблицаКорректировки") Тогда 
		ТаблицаКорректировки = ИсходящиеДанные.ТаблицаКорректировки;
		
		Для Каждого Стр Из ТаблицаКорректировки Цикл 
			НомерПроводки = НомерПроводки + 1;
			ИмяПроводки = "Проводка" + НомерПроводки;
			
			Для Каждого Колонка Из ТаблицаКорректировки.Колонки Цикл 
				Значение = Стр[Колонка.Имя];
				
				НоваяСтрока = ЗапрашиваемыеПараметры.Добавить();
				НоваяСтрока.Имя = ИмяПроводки;
				НоваяСтрока.Представление = Колонка.Имя;
				НоваяСтрока.Значение =  Значение;
			КонецЦикла;
		КонецЦикла;
	КонецЕсли;
	
	
	ВходящиеДанные = Новый Структура;
	ВходящиеДанные.Вставить("GUID_Поиска", GUID_Поиска);
	ВходящиеДанные.Вставить("Дата", КонецДня(Дата));
	ВходящиеДанные.Вставить("Организация", Организация);
	ВходящиеДанные.Вставить("Подразделение", Подразделение);
	ВходящиеДанные.Вставить("СуммаОперации", ОбщегоНазначенияКлиентСервер.СвойствоСтруктуры(ИсходящиеДанные, "СуммаОперации", 0));
	ВходящиеДанные.Вставить("Комментарий", СтроковыеФункцииКлиентСервер.ПодставитьПараметрыВСтроку("Продажи ЗКС за %1", Формат(Дата, "ДФ=dd.MM.yyyy")));
	ВходящиеДанные.Вставить("ЗапрашиваемыеПараметры", ЗапрашиваемыеПараметры);		
КонецЕсли;
</ПередВыгрузкой>
				<ПослеЗагрузки>//Объект.Подразделение = Справочники.Подразделения.ПустаяСсылка();

Если НЕ Отказ Тогда			
	Если Не ЗначениеЗаполнено(Объект.ТиповаяОперация) Тогда
		тСообщение = "ОШИБКА, ЗАГРУЗКА ПРЕРВАНА, не найдена типовая операция с кодом ""РТУРН_Общ""";
		ВызватьИсключение(тСообщение);
	КонецЕсли;				
	
	Объект.ТаблицаРегистровНакопления.Очистить();
	Объект.Движения.Хозрасчетный.Очистить();	
	Объект.Содержание = Объект.ТиповаяОперация.Наименование;	
	
	Выполнить(Алгоритмы.ЗаполнитьНаОснованииТиповойОперации);
	
	ЗаписатьОбъект =  ПараметрыОбъекта.Получить("ЗаписатьОбъект");
	Если ЗаписатьОбъект = Неопределено Тогда
		ЗаписатьОбъект = Ложь;
	КонецЕсли;
	
	Если ЗаписатьОбъект Тогда		
		Выполнить(Алгоритмы.ЗаписатьСоответствиеОбъектов);
	КонецЕсли;
КонецЕсли;	</ПослеЗагрузки>
				<ПоследовательностьПолейПоиска>Параметры.ПараметрыАлгоритмов.Вставить("ВидОбъекта","ОперацияБух");
Параметры.ПараметрыАлгоритмов.Вставить("ТипОбъектаИсточника", "ДокументСсылка.ТК_ЗакрытиеСменыЗКС_Общий");
СтрокаИменСвойствПоиска = "ПоискАлгоритмом";

Выполнить(Алгоритмы.ПолучитьСоответствиеОбъектов);
ПрекратитьПоиск = Истина;
</ПоследовательностьПолейПоиска>
				<НеЗапоминатьВыгруженные>true</НеЗапоминатьВыгруженные>
				<ГенерироватьНовыйНомерИлиКодЕслиНеУказан>true</ГенерироватьНовыйНомерИлиКодЕслиНеУказан>
				<Приемник>ДокументСсылка.ОперацияБух</Приемник>
				<Свойства>
					<Свойство Поиск="true">
						<Код>1</Код>
						<Наименование>--&gt; GUID_Поиска</Наименование>
						<Порядок>50</Порядок>
						<ПолучитьИзВходящихДанных>true</ПолучитьИзВходящихДанных>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="" Вид=""/>
						<ИмяПараметраДляПередачи>GUID_Поиска</ИмяПараметраДляПередачи>
					</Свойство>
					<Свойство>
						<Код>8</Код>
						<Наименование>--&gt; Дата</Наименование>
						<Порядок>100</Порядок>
						<ПолучитьИзВходящихДанных>true</ПолучитьИзВходящихДанных>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="Дата" Вид="Свойство" Тип="Дата"/>
					</Свойство>
					<Свойство>
						<Код>3</Код>
						<Наименование>--&gt; Организация</Наименование>
						<Порядок>150</Порядок>
						<ПолучитьИзВходящихДанных>true</ПолучитьИзВходящихДанных>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="Организация" Вид="Реквизит" Тип="СправочникСсылка.Организации"/>
						<КодПравилаКонвертации>Организации                                       </КодПравилаКонвертации>
					</Свойство>
					<Свойство Отключить="true">
						<Код>4</Код>
						<Наименование>--&gt; Подразделение</Наименование>
						<Порядок>200</Порядок>
						<ПолучитьИзВходящихДанных>true</ПолучитьИзВходящихДанных>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="Подразделение" Вид="Реквизит" Тип="СправочникСсылка.Подразделения"/>
						<КодПравилаКонвертации>Подразделения                                     </КодПравилаКонвертации>
					</Свойство>
					<Свойство>
						<Код>6</Код>
						<Наименование>--&gt; СуммаОперации</Наименование>
						<Порядок>250</Порядок>
						<ПолучитьИзВходящихДанных>true</ПолучитьИзВходящихДанных>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="СуммаОперации" Вид="Реквизит" Тип="Число"/>
					</Свойство>
					<Свойство>
						<Код>2</Код>
						<Наименование>--&gt; Комментарий</Наименование>
						<Порядок>300</Порядок>
						<ПолучитьИзВходящихДанных>true</ПолучитьИзВходящихДанных>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="Комментарий" Вид="Реквизит" Тип="Строка"/>
					</Свойство>
					<Свойство>
						<Код>5</Код>
						<Наименование>--&gt; СпособЗаполнения</Наименование>
						<Порядок>350</Порядок>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="СпособЗаполнения" Вид="Реквизит"/>
						<ПередВыгрузкой>Значение = "ТиповыеОперации";</ПередВыгрузкой>
					</Свойство>
					<Свойство>
						<Код>7</Код>
						<Наименование>--&gt; ТиповаяОперация</Наименование>
						<Порядок>400</Порядок>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="ТиповаяОперация" Вид="Реквизит"/>
						<КодПравилаКонвертации>ТиповыеОперации                                   </КодПравилаКонвертации>
						<ПередВыгрузкой>Значение = Новый Структура("Код", "РТУРН_Общ");</ПередВыгрузкой>
					</Свойство>
					<Группа Отключить="true">
						<Код>9</Код>
						<Наименование>--&gt; ЗапрашиваемыеПараметры</Наименование>
						<Порядок>450</Порядок>
						<ПолучитьИзВходящихДанных>true</ПолучитьИзВходящихДанных>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="ЗапрашиваемыеПараметры" Вид="ТабличнаяЧасть"/>
						<Свойство>
							<Код>10</Код>
							<Наименование>--&gt; Значение</Наименование>
							<Порядок>50</Порядок>
							<Источник Имя="" Вид=""/>
							<Приемник Имя="Значение" Вид="Реквизит"/>
						</Свойство>
						<Свойство>
							<Код>11</Код>
							<Наименование>--&gt; Имя</Наименование>
							<Порядок>100</Порядок>
							<Источник Имя="" Вид=""/>
							<Приемник Имя="Имя" Вид="Реквизит" Тип="Строка"/>
						</Свойство>
						<Свойство>
							<Код>12</Код>
							<Наименование>--&gt; Представление</Наименование>
							<Порядок>150</Порядок>
							<Источник Имя="" Вид=""/>
							<Приемник Имя="Представление" Вид="Реквизит" Тип="Строка"/>
						</Свойство>
					</Группа>
					<Группа>
						<Код>13</Код>
						<Наименование>--&gt; Хозрасчетный</Наименование>
						<Порядок>500</Порядок>
						<ПолучитьИзВходящихДанных>true</ПолучитьИзВходящихДанных>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="Хозрасчетный" Вид="НаборДвиженийРегистраБухгалтерии"/>
						<Свойство>
							<Код>34</Код>
							<Наименование>--&gt; Период</Наименование>
							<Порядок>50</Порядок>
							<Источник Имя="" Вид=""/>
							<Приемник Имя="Период" Вид="Свойство" Тип="Дата"/>
							<ПередВыгрузкой>Значение = ИсходящиеДанные.Дата;</ПередВыгрузкой>
						</Свойство>
						<Свойство>
							<Код>36</Код>
							<Наименование>--&gt; СчетДт</Наименование>
							<Порядок>100</Порядок>
							<Источник Имя="" Вид=""/>
							<Приемник Имя="СчетДт" Вид="Свойство" Тип="ПланСчетовСсылка.Хозрасчетный"/>
						</Свойство>
						<Свойство>
							<Код>37</Код>
							<Наименование>--&gt; СчетКт</Наименование>
							<Порядок>150</Порядок>
							<Источник Имя="" Вид=""/>
							<Приемник Имя="СчетКт" Вид="Свойство" Тип="ПланСчетовСсылка.Хозрасчетный"/>
						</Свойство>
						<Свойство>
							<Код>14</Код>
							<Наименование>--&gt; СубконтоДт</Наименование>
							<Порядок>200</Порядок>
							<Источник Имя="" Вид=""/>
							<Приемник Имя="СубконтоДт" Вид="ВидыСубконтоСчета"/>
						</Свойство>
						<Свойство>
							<Код>15</Код>
							<Наименование>--&gt; СубконтоКт</Наименование>
							<Порядок>250</Порядок>
							<Источник Имя="" Вид=""/>
							<Приемник Имя="СубконтоКт" Вид="ВидыСубконтоСчета"/>
						</Свойство>
						<Свойство>
							<Код>16</Код>
							<Наименование>--&gt; ВалютаДт</Наименование>
							<Порядок>300</Порядок>
							<Источник Имя="" Вид=""/>
							<Приемник Имя="ВалютаДт" Вид="Измерение" Тип="СправочникСсылка.Валюты"/>
							<КодПравилаКонвертации>Валюты                                            </КодПравилаКонвертации>
							<ПередВыгрузкой>Значение = ИсходящиеДанные.Валюта;</ПередВыгрузкой>
						</Свойство>
						<Свойство>
							<Код>17</Код>
							<Наименование>--&gt; ВалютаКт</Наименование>
							<Порядок>350</Порядок>
							<Источник Имя="" Вид=""/>
							<Приемник Имя="ВалютаКт" Вид="Измерение" Тип="СправочникСсылка.Валюты"/>
							<КодПравилаКонвертации>Валюты                                            </КодПравилаКонвертации>
							<ПередВыгрузкой>Значение = ИсходящиеДанные.Валюта;</ПередВыгрузкой>
						</Свойство>
						<Свойство>
							<Код>20</Код>
							<Наименование>--&gt; Организация</Наименование>
							<Порядок>400</Порядок>
							<Источник Имя="" Вид=""/>
							<Приемник Имя="Организация" Вид="Измерение" Тип="СправочникСсылка.Организации"/>
							<КодПравилаКонвертации>Организации                                       </КодПравилаКонвертации>
							<ПередВыгрузкой>Значение = ИсходящиеДанные.Организация;</ПередВыгрузкой>
						</Свойство>
						<Свойство>
							<Код>30</Код>
							<Наименование>--&gt; Сумма</Наименование>
							<Порядок>450</Порядок>
							<Источник Имя="" Вид=""/>
							<Приемник Имя="Сумма" Вид="Ресурс" Тип="Число"/>
						</Свойство>
						<Свойство>
							<Код>24</Код>
							<Наименование>--&gt; Содержание</Наименование>
							<Порядок>500</Порядок>
							<Источник Имя="" Вид=""/>
							<Приемник Имя="Содержание" Вид="Реквизит" Тип="Строка"/>
						</Свойство>
						<Свойство Отключить="true">
							<Код>18</Код>
							<Наименование>--&gt; НалоговоеНазначениеДт</Наименование>
							<Порядок>550</Порядок>
							<Источник Имя="" Вид=""/>
							<Приемник Имя="НалоговоеНазначениеДт" Вид="Измерение" Тип="СправочникСсылка.НалоговыеНазначенияАктивовИЗатрат"/>
						</Свойство>
						<Свойство Отключить="true">
							<Код>19</Код>
							<Наименование>--&gt; НалоговоеНазначениеКт</Наименование>
							<Порядок>600</Порядок>
							<Источник Имя="" Вид=""/>
							<Приемник Имя="НалоговоеНазначениеКт" Вид="Измерение" Тип="СправочникСсылка.НалоговыеНазначенияАктивовИЗатрат"/>
						</Свойство>
						<Свойство Отключить="true">
							<Код>21</Код>
							<Наименование>--&gt; НеКорректироватьСтоимостьАвтоматически</Наименование>
							<Порядок>650</Порядок>
							<Источник Имя="" Вид=""/>
							<Приемник Имя="НеКорректироватьСтоимостьАвтоматически" Вид="Реквизит" Тип="Булево"/>
						</Свойство>
						<Свойство Отключить="true">
							<Код>22</Код>
							<Наименование>--&gt; НомерЖурнала</Наименование>
							<Порядок>700</Порядок>
							<Источник Имя="" Вид=""/>
							<Приемник Имя="НомерЖурнала" Вид="Реквизит" Тип="Строка"/>
						</Свойство>
						<Свойство Отключить="true">
							<Код>23</Код>
							<Наименование>--&gt; НомерИсходнойПроводки</Наименование>
							<Порядок>750</Порядок>
							<Источник Имя="" Вид=""/>
							<Приемник Имя="НомерИсходнойПроводки" Вид="Реквизит" Тип="Число"/>
						</Свойство>
						<Свойство Отключить="true">
							<Код>25</Код>
							<Наименование>--&gt; СчетДополнительный</Наименование>
							<Порядок>800</Порядок>
							<Источник Имя="" Вид=""/>
							<Приемник Имя="СчетДополнительный" Вид="Реквизит" Тип="ПланСчетовСсылка.Хозрасчетный"/>
						</Свойство>
						<Свойство Отключить="true">
							<Код>26</Код>
							<Наименование>--&gt; ВалютнаяСуммаДт</Наименование>
							<Порядок>850</Порядок>
							<Источник Имя="" Вид=""/>
							<Приемник Имя="ВалютнаяСуммаДт" Вид="Ресурс" Тип="Число"/>
						</Свойство>
						<Свойство Отключить="true">
							<Код>27</Код>
							<Наименование>--&gt; ВалютнаяСуммаКт</Наименование>
							<Порядок>900</Порядок>
							<Источник Имя="" Вид=""/>
							<Приемник Имя="ВалютнаяСуммаКт" Вид="Ресурс" Тип="Число"/>
						</Свойство>
						<Свойство Отключить="true">
							<Код>28</Код>
							<Наименование>--&gt; КоличествоДт</Наименование>
							<Порядок>950</Порядок>
							<Источник Имя="" Вид=""/>
							<Приемник Имя="КоличествоДт" Вид="Ресурс" Тип="Число"/>
						</Свойство>
						<Свойство Отключить="true">
							<Код>29</Код>
							<Наименование>--&gt; КоличествоКт</Наименование>
							<Порядок>1000</Порядок>
							<Источник Имя="" Вид=""/>
							<Приемник Имя="КоличествоКт" Вид="Ресурс" Тип="Число"/>
						</Свойство>
						<Свойство Отключить="true">
							<Код>31</Код>
							<Наименование>--&gt; СуммаНУДт</Наименование>
							<Порядок>1050</Порядок>
							<Источник Имя="" Вид=""/>
							<Приемник Имя="СуммаНУДт" Вид="Ресурс" Тип="Число"/>
						</Свойство>
						<Свойство Отключить="true">
							<Код>32</Код>
							<Наименование>--&gt; СуммаНУКт</Наименование>
							<Порядок>1100</Порядок>
							<Источник Имя="" Вид=""/>
							<Приемник Имя="СуммаНУКт" Вид="Ресурс" Тип="Число"/>
						</Свойство>
						<Свойство Отключить="true">
							<Код>33</Код>
							<Наименование>--&gt; Активность</Наименование>
							<Порядок>1150</Порядок>
							<Источник Имя="" Вид=""/>
							<Приемник Имя="Активность" Вид="Свойство" Тип="Булево"/>
						</Свойство>
						<Свойство Отключить="true">
							<Код>35</Код>
							<Наименование>--&gt; Регистратор</Наименование>
							<Порядок>1200</Порядок>
							<Источник Имя="" Вид=""/>
							<Приемник Имя="Регистратор" Вид="Свойство"/>
						</Свойство>
					</Группа>
				</Свойства>
				<Значения/>
			</Правило>
			<Правило>
				<Код>ЗКС_Общий_Новый</Код>
				<Наименование>: </Наименование>
				<Порядок>700</Порядок>
				<ПередВыгрузкой>
Если Не Отказ Тогда 		
	ТаблицаПроводок = Параметры.КешШаблонов.Получить("ЗКС_Общий");
	
	Если ТипЗнч(ТаблицаПроводок) &lt;&gt; Тип("ТаблицаЗначений") Тогда 
		ОбщегоНазначения.СообщитьПользователю("Не задан список шаблонов для типа документа ""ЗКС_Общий""");
		Отказ = Истина;
	КонецЕсли;
КонецЕсли;
	
Если Не Отказ Тогда 
	
	тзПроводок = Новый ТаблицаЗначений;
	тзПроводок.Колонки.Добавить("СчетДт");
	тзПроводок.Колонки.Добавить("СубконтоДт1");
	тзПроводок.Колонки.Добавить("ТипСубДт1");
	тзПроводок.Колонки.Добавить("СубконтоДт2");
	тзПроводок.Колонки.Добавить("ТипСубДт2");
	тзПроводок.Колонки.Добавить("СубконтоДт3");
	тзПроводок.Колонки.Добавить("ТипСубДт3");
	тзПроводок.Колонки.Добавить("КоличествоДт");
	тзПроводок.Колонки.Добавить("СчетКт");
	тзПроводок.Колонки.Добавить("СубконтоКт1");
	тзПроводок.Колонки.Добавить("ТипСубКт1");
	тзПроводок.Колонки.Добавить("СубконтоКт2");
	тзПроводок.Колонки.Добавить("ТипСубКт2");
	тзПроводок.Колонки.Добавить("СубконтоКт3");
	тзПроводок.Колонки.Добавить("ТипСубКт3");
	тзПроводок.Колонки.Добавить("КоличествоКт");
	тзПроводок.Колонки.Добавить("Сумма");
	тзПроводок.Колонки.Добавить("Содержание");	
	тзПроводок.Колонки.Добавить("НалоговоеНазначениеДт");
	тзПроводок.Колонки.Добавить("НалоговоеНазначениеКт");
	тзПроводок.Колонки.Добавить("СуммаНУДт");
	тзПроводок.Колонки.Добавить("СуммаНУКт");
	
	Запросы.ЗКС_Общий.УстановитьПараметр("НачалоПериода", НачалоДня(ИсходящиеДанные.Дата));
	Запросы.ЗКС_Общий.УстановитьПараметр("КонецПериода",  КонецДня(ИсходящиеДанные.Дата));	
	Запросы.ЗКС_Общий.УстановитьПараметр("Организация",  ИсходящиеДанные.Организация);	
	
	МассивРезультатов = Запросы.ЗКС_Общий.ВыполнитьПакет();
	МаксИндекс = МассивРезультатов.ВГраница();
	
	ВыборкаСумма = МассивРезультатов[МаксИндекс-3].Выбрать();
	Если ВыборкаСумма.Следующий() Тогда 
		СуммаОперации = ВыборкаСумма.СуммаОперации;
		Валюта = ВыборкаСумма.Валюта;
	Иначе
		СуммаОперации = 0;
		Валюта = Справочники.Валюты.НайтиПоКоду("980");
	КонецЕсли;

	Проводки1 = МассивРезультатов[МаксИндекс-2].Выгрузить();
	Проводки2 = МассивРезультатов[МаксИндекс-1].Выгрузить();
	Проводки3 = МассивРезультатов[МаксИндекс].Выгрузить();
	
	врКешШаблонов = Новый Соответствие;		
	
	Для Каждого Стр Из Проводки1 Цикл 
		МассивШаблоновПроводок = врКешШаблонов.Получить(Стр.ПризнакПроводки);
		Если МассивШаблоновПроводок = Неопределено Тогда 
			МассивШаблоновПроводок = ТаблицаПроводок.НайтиСтроки(Новый Структура("ПризнакПроводки", Стр.ПризнакПроводки));				
			врКешШаблонов.Вставить(Стр.ПризнакПроводки, МассивШаблоновПроводок);					
		КонецЕсли;
		
		Если МассивШаблоновПроводок = Неопределено ИЛИ МассивШаблоновПроводок.Количество() = 0 Тогда 
			Продолжить;
		КонецЕсли;
			
		Выполнить(Алгоритмы.ПолучитьСубконтоПоШаблону);
	КонецЦикла;
	
	Для Каждого Стр Из Проводки2 Цикл 
		МассивШаблоновПроводок = врКешШаблонов.Получить(Стр.ПризнакПроводки);
		Если МассивШаблоновПроводок = Неопределено Тогда 
			МассивШаблоновПроводок = ТаблицаПроводок.НайтиСтроки(Новый Структура("ПризнакПроводки", Стр.ПризнакПроводки));				
			врКешШаблонов.Вставить(Стр.ПризнакПроводки, МассивШаблоновПроводок);					
		КонецЕсли;
		
		Если МассивШаблоновПроводок = Неопределено ИЛИ МассивШаблоновПроводок.Количество() = 0 Тогда 
			Продолжить;
		КонецЕсли;
			
		Выполнить(Алгоритмы.ПолучитьСубконтоПоШаблону);
	КонецЦикла;
	
	Для Каждого Стр Из Проводки3 Цикл 
		МассивШаблоновПроводок = врКешШаблонов.Получить(Стр.ПризнакПроводки);
		Если МассивШаблоновПроводок = Неопределено Тогда 
			МассивШаблоновПроводок = ТаблицаПроводок.НайтиСтроки(Новый Структура("ПризнакПроводки", Стр.ПризнакПроводки));				
			врКешШаблонов.Вставить(Стр.ПризнакПроводки, МассивШаблоновПроводок);					
		КонецЕсли;
		
		Если МассивШаблоновПроводок = Неопределено ИЛИ МассивШаблоновПроводок.Количество() = 0 Тогда 
			Продолжить;
		КонецЕсли;
			
		Выполнить(Алгоритмы.ПолучитьСубконтоПоШаблону);
	КонецЦикла;
	
	
	Хозрасчетный = Новый ТаблицаЗначений;
	Хозрасчетный.Колонки.Добавить("СчетДт");
	Хозрасчетный.Колонки.Добавить("СчетКт");
	Хозрасчетный.Колонки.Добавить("СубконтоДт");
	Хозрасчетный.Колонки.Добавить("СубконтоКт");
	Хозрасчетный.Колонки.Добавить("Сумма");
	Хозрасчетный.Колонки.Добавить("НалоговоеНазначениеДт");
	Хозрасчетный.Колонки.Добавить("НалоговоеНазначениеКт");
	Хозрасчетный.Колонки.Добавить("СуммаНУДт");
	Хозрасчетный.Колонки.Добавить("СуммаНУКт");
	Хозрасчетный.Колонки.Добавить("Содержание");
	
	Для Каждого Проводка Из  тзПроводок Цикл
		нСтрока = Хозрасчетный.Добавить();
		ЗаполнитьЗначенияСвойств(нСтрока,Проводка);
		Выполнить(Алгоритмы.ЗаполнитьСубконто);
	КонецЦикла;
	
	ГУИД_Поиска = СтроковыеФункцииКлиентСервер.ПодставитьПараметрыВСтроку(
				"{%1_%2_%3}",
				СтрЗаменить(Строка(ИсходящиеДанные.Организация.УникальныйИдентификатор()), "-", ""),
				"10001",
				Формат(ИсходящиеДанные.Дата, "ДФ=yyyyMMdd"));
	
	ВходящиеДанные = Новый Структура;
	ВходящиеДанные.Вставить("GUID_Поиска", ГУИД_Поиска);
	ВходящиеДанные.Вставить("Дата", КонецДня(ИсходящиеДанные.Дата));
	ВходящиеДанные.Вставить("Организация", ИсходящиеДанные.Организация);
	ВходящиеДанные.Вставить("Валюта", Валюта);
	ВходящиеДанные.Вставить("СуммаОперации", СуммаОперации);	
	ВходящиеДанные.Вставить("Хозрасчетный", Хозрасчетный);
КонецЕсли;
</ПередВыгрузкой>
				<ПослеЗагрузки>Если НЕ Отказ Тогда				
	ЗаписатьОбъект =  ПараметрыОбъекта.Получить("ЗаписатьОбъект");
	Если ЗаписатьОбъект = Неопределено Тогда
		ЗаписатьОбъект = Ложь;
	КонецЕсли;
	
	Если ЗаписатьОбъект Тогда		
		Выполнить(Алгоритмы.ЗаписатьСоответствиеОбъектов);
	КонецЕсли;
КонецЕсли;	</ПослеЗагрузки>
				<ПоследовательностьПолейПоиска>Параметры.ПараметрыАлгоритмов.Вставить("ВидОбъекта","ОперацияБух");
Параметры.ПараметрыАлгоритмов.Вставить("ТипОбъектаИсточника", "ДокументСсылка.ТК_ЗакрытиеСменыЗКС_Общий");
СтрокаИменСвойствПоиска = "ПоискАлгоритмом";

Выполнить(Алгоритмы.ПолучитьСоответствиеОбъектов);
ПрекратитьПоиск = Истина;
</ПоследовательностьПолейПоиска>
				<НеЗапоминатьВыгруженные>true</НеЗапоминатьВыгруженные>
				<ГенерироватьНовыйНомерИлиКодЕслиНеУказан>true</ГенерироватьНовыйНомерИлиКодЕслиНеУказан>
				<Приемник>ДокументСсылка.ОперацияБух</Приемник>
				<Свойства>
					<Свойство Поиск="true">
						<Код>1</Код>
						<Наименование>--&gt; GUID_Поиска</Наименование>
						<Порядок>50</Порядок>
						<ПолучитьИзВходящихДанных>true</ПолучитьИзВходящихДанных>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="" Вид=""/>
						<ИмяПараметраДляПередачи>GUID_Поиска</ИмяПараметраДляПередачи>
					</Свойство>
					<Свойство>
						<Код>18</Код>
						<Наименование>--&gt; Дата</Наименование>
						<Порядок>100</Порядок>
						<ПолучитьИзВходящихДанных>true</ПолучитьИзВходящихДанных>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="Дата" Вид="Свойство" Тип="Дата"/>
					</Свойство>
					<Свойство>
						<Код>14</Код>
						<Наименование>--&gt; Организация</Наименование>
						<Порядок>150</Порядок>
						<ПолучитьИзВходящихДанных>true</ПолучитьИзВходящихДанных>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="Организация" Вид="Реквизит" Тип="СправочникСсылка.Организации"/>
						<КодПравилаКонвертации>Организации                                       </КодПравилаКонвертации>
					</Свойство>
					<Свойство>
						<Код>13</Код>
						<Наименование>--&gt; Комментарий</Наименование>
						<Порядок>200</Порядок>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="Комментарий" Вид="Реквизит" Тип="Строка"/>
						<ПередВыгрузкой>Значение = "Общие продажи ЗКС за " + Формат(ВходящиеДанные.Дата, "ДФ=dd.MM.yyyy");</ПередВыгрузкой>
					</Свойство>
					<Свойство>
						<Код>16</Код>
						<Наименование>--&gt; СпособЗаполнения</Наименование>
						<Порядок>250</Порядок>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="СпособЗаполнения" Вид="Реквизит"/>
						<ПередВыгрузкой>Значение = "Вручную";</ПередВыгрузкой>
					</Свойство>
					<Свойство>
						<Код>17</Код>
						<Наименование>--&gt; СуммаОперации</Наименование>
						<Порядок>300</Порядок>
						<ПолучитьИзВходящихДанных>true</ПолучитьИзВходящихДанных>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="СуммаОперации" Вид="Реквизит" Тип="Число"/>
					</Свойство>
					<Свойство>
						<Код>15</Код>
						<Наименование>--&gt; Содержание</Наименование>
						<Порядок>350</Порядок>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="Содержание" Вид="Реквизит" Тип="Строка"/>
						<ПередВыгрузкой>Значение = "Реализация товаров розница общая";</ПередВыгрузкой>
					</Свойство>
					<Группа>
						<Код>2</Код>
						<Наименование>--&gt; Хозрасчетный</Наименование>
						<Порядок>400</Порядок>
						<ПолучитьИзВходящихДанных>true</ПолучитьИзВходящихДанных>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="Хозрасчетный" Вид="НаборДвиженийРегистраБухгалтерии"/>
						<Свойство>
							<Код>10</Код>
							<Наименование>--&gt; Период</Наименование>
							<Порядок>50</Порядок>
							<Источник Имя="" Вид=""/>
							<Приемник Имя="Период" Вид="Свойство" Тип="Дата"/>
							<ПередВыгрузкой>Значение = ВходящиеДанные.Дата;</ПередВыгрузкой>
						</Свойство>
						<Свойство>
							<Код>11</Код>
							<Наименование>--&gt; СчетДт</Наименование>
							<Порядок>100</Порядок>
							<Источник Имя="" Вид=""/>
							<Приемник Имя="СчетДт" Вид="Свойство" Тип="ПланСчетовСсылка.Хозрасчетный"/>
						</Свойство>
						<Свойство>
							<Код>12</Код>
							<Наименование>--&gt; СчетКт</Наименование>
							<Порядок>150</Порядок>
							<Источник Имя="" Вид=""/>
							<Приемник Имя="СчетКт" Вид="Свойство" Тип="ПланСчетовСсылка.Хозрасчетный"/>
						</Свойство>
						<Свойство>
							<Код>3</Код>
							<Наименование>--&gt; СубконтоДт</Наименование>
							<Порядок>200</Порядок>
							<Источник Имя="" Вид=""/>
							<Приемник Имя="СубконтоДт" Вид="ВидыСубконтоСчета"/>
							<ПередВыгрузкой>ИмяПКОВидСубконто = "ВидыСубконтоХозрасчетные";</ПередВыгрузкой>
							<ПриВыгрузке>Выполнить(Алгоритмы.ПроверитьСубконто);</ПриВыгрузке>
						</Свойство>
						<Свойство>
							<Код>4</Код>
							<Наименование>--&gt; СубконтоКт</Наименование>
							<Порядок>250</Порядок>
							<Источник Имя="" Вид=""/>
							<Приемник Имя="СубконтоКт" Вид="ВидыСубконтоСчета"/>
							<ПередВыгрузкой>ИмяПКОВидСубконто = "ВидыСубконтоХозрасчетные";</ПередВыгрузкой>
							<ПриВыгрузке>Выполнить(Алгоритмы.ПроверитьСубконто);</ПриВыгрузке>
						</Свойство>
						<Свойство>
							<Код>5</Код>
							<Наименование>--&gt; ВалютаДт</Наименование>
							<Порядок>300</Порядок>
							<Источник Имя="" Вид=""/>
							<Приемник Имя="ВалютаДт" Вид="Измерение" Тип="СправочникСсылка.Валюты"/>
							<КодПравилаКонвертации>Валюты                                            </КодПравилаКонвертации>
							<ПередВыгрузкой>Значение = ВходящиеДанные.Валюта;</ПередВыгрузкой>
						</Свойство>
						<Свойство>
							<Код>6</Код>
							<Наименование>--&gt; ВалютаКт</Наименование>
							<Порядок>350</Порядок>
							<Источник Имя="" Вид=""/>
							<Приемник Имя="ВалютаКт" Вид="Измерение" Тип="СправочникСсылка.Валюты"/>
							<КодПравилаКонвертации>Валюты                                            </КодПравилаКонвертации>
							<ПередВыгрузкой>Значение = ВходящиеДанные.Валюта;</ПередВыгрузкой>
						</Свойство>
						<Свойство>
							<Код>7</Код>
							<Наименование>--&gt; Организация</Наименование>
							<Порядок>400</Порядок>
							<Источник Имя="" Вид=""/>
							<Приемник Имя="Организация" Вид="Измерение" Тип="СправочникСсылка.Организации"/>
							<КодПравилаКонвертации>Организации                                       </КодПравилаКонвертации>
							<ПередВыгрузкой>Значение = ВходящиеДанные.Организация;</ПередВыгрузкой>
						</Свойство>
						<Свойство>
							<Код>8</Код>
							<Наименование>--&gt; Содержание</Наименование>
							<Порядок>450</Порядок>
							<Источник Имя="" Вид=""/>
							<Приемник Имя="Содержание" Вид="Реквизит" Тип="Строка"/>
						</Свойство>
						<Свойство>
							<Код>9</Код>
							<Наименование>--&gt; Сумма</Наименование>
							<Порядок>500</Порядок>
							<Источник Имя="" Вид=""/>
							<Приемник Имя="Сумма" Вид="Ресурс" Тип="Число"/>
						</Свойство>
						<Свойство>
							<Код>19</Код>
							<Наименование>--&gt; НалоговоеНазначениеДт</Наименование>
							<Порядок>550</Порядок>
							<Источник Имя="" Вид=""/>
							<Приемник Имя="НалоговоеНазначениеДт" Вид="Измерение" Тип="СправочникСсылка.НалоговыеНазначенияАктивовИЗатрат"/>
							<КодПравилаКонвертации>НалоговыеНазначенияАктивовИЗатрат                 </КодПравилаКонвертации>
						</Свойство>
						<Свойство>
							<Код>20</Код>
							<Наименование>--&gt; НалоговоеНазначениеКт</Наименование>
							<Порядок>600</Порядок>
							<Источник Имя="" Вид=""/>
							<Приемник Имя="НалоговоеНазначениеКт" Вид="Измерение" Тип="СправочникСсылка.НалоговыеНазначенияАктивовИЗатрат"/>
							<КодПравилаКонвертации>НалоговыеНазначенияАктивовИЗатрат                 </КодПравилаКонвертации>
						</Свойство>
						<Свойство>
							<Код>21</Код>
							<Наименование>--&gt; СуммаНУДт</Наименование>
							<Порядок>650</Порядок>
							<Источник Имя="" Вид=""/>
							<Приемник Имя="СуммаНУДт" Вид="Ресурс" Тип="Число"/>
						</Свойство>
						<Свойство>
							<Код>22</Код>
							<Наименование>--&gt; СуммаНУКт</Наименование>
							<Порядок>700</Порядок>
							<Источник Имя="" Вид=""/>
							<Приемник Имя="СуммаНУКт" Вид="Ресурс" Тип="Число"/>
						</Свойство>
					</Группа>
				</Свойства>
				<Значения/>
			</Правило>
			<Правило>
				<Код>ДокументНаУдаление</Код>
				<Наименование>: </Наименование>
				<Порядок>750</Порядок>
				<ПослеЗагрузки>Если ОбъектНайден Тогда
	Объект.УстановитьПометкуУдаления(Истина);
	
	Если ТипЗнч(Объект) = Тип("ДокументОбъект.ОперацияБух") Тогда 
		Объект.Движения.Хозрасчетный.Очистить();
		Объект.Движения.Хозрасчетный.Записать();
	КонецЕсли;
	
	Объект.Записать();
	ОбъектМодифицирован = Ложь;
КонецЕсли;

Отказ = Истина;
</ПослеЗагрузки>
				<ПоследовательностьПолейПоиска>
Параметры.ПараметрыАлгоритмов.Вставить("ВидОбъекта", "");
Параметры.ПараметрыАлгоритмов.Вставить("ТипОбъектаИсточника", ПараметрыОбъекта.Получить("ТипОбъектаИсточника"));
СтрокаИменСвойствПоиска = "ПоискАлгоритмом";

Выполнить(Алгоритмы.ПолучитьСоответствиеОбъектов);

СтрокаИменСвойствПоиска="";
ПрекратитьПоиск = Истина;
</ПоследовательностьПолейПоиска>
				<НеЗапоминатьВыгруженные>true</НеЗапоминатьВыгруженные>
				<НеСоздаватьЕслиНеНайден>true</НеСоздаватьЕслиНеНайден>
				<Приемник>ДокументСсылка.ОперацияБух</Приемник>
				<Свойства>
					<Свойство Поиск="true">
						<Код>1</Код>
						<Наименование>--&gt; GUID_Поиска</Наименование>
						<Порядок>50</Порядок>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="" Вид=""/>
						<ИмяПараметраДляПередачи>GUID_Поиска</ИмяПараметраДляПередачи>
						<ПередВыгрузкой>Значение = ЗначениеВСтрокуВнутр(Источник.УникальныйИдентификатор());</ПередВыгрузкой>
					</Свойство>
					<Свойство Отключить="true">
						<Код>2</Код>
						<Наименование>--&gt; ВидОбъекта</Наименование>
						<Порядок>100</Порядок>
						<ПолучитьИзВходящихДанных>true</ПолучитьИзВходящихДанных>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="" Вид=""/>
						<ИмяПараметраДляПередачи>ВидОбъекта</ИмяПараметраДляПередачи>
					</Свойство>
					<Свойство Поиск="true">
						<Код>3</Код>
						<Наименование>--&gt; ТипОбъектаИсточника</Наименование>
						<Порядок>150</Порядок>
						<ПолучитьИзВходящихДанных>true</ПолучитьИзВходящихДанных>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="" Вид=""/>
						<ИмяПараметраДляПередачи>ТипОбъектаИсточника</ИмяПараметраДляПередачи>
					</Свойство>
				</Свойства>
				<Значения/>
			</Правило>
		</Группа>
		<Правило>
			<Код>Хозрасчетный</Код>
			<Наименование>: </Наименование>
			<Порядок>600</Порядок>
			<НеСоздаватьЕслиНеНайден>true</НеСоздаватьЕслиНеНайден>
			<Приемник>ПланСчетовСсылка.Хозрасчетный</Приемник>
			<Свойства>
				<Свойство Поиск="true">
					<Код>1</Код>
					<Наименование>--&gt; Код</Наименование>
					<Порядок>50</Порядок>
					<Источник Имя="" Вид=""/>
					<Приемник Имя="Код" Вид="Свойство" Тип="Строка"/>
				</Свойство>
			</Свойства>
			<Значения/>
		</Правило>
		<Группа>
			<Код>Регистры сведений</Код>
			<Наименование>Регистры сведений</Наименование>
			<Порядок>650</Порядок>
			<Правило>
				<Код>СхемыНалогообложенияКонтрагентов</Код>
				<Наименование>Регистр сведений: Учет плательщика НДС</Наименование>
				<Порядок>50</Порядок>
				<НеЗапоминатьВыгруженные>true</НеЗапоминатьВыгруженные>
				<НеВыгружатьОбъектыСвойствПоСсылкам>true</НеВыгружатьОбъектыСвойствПоСсылкам>
				<Источник>РегистрСведенийЗапись.ТК_УчетнаяПолитикаКонтрагенты</Источник>
				<Приемник>РегистрСведенийЗапись.СхемыНалогообложенияКонтрагентов</Приемник>
				<Свойства>
					<Свойство>
						<Код>3</Код>
						<Наименование>Активность --&gt; Активность</Наименование>
						<Порядок>50</Порядок>
						<Источник Имя="Активность" Вид="Свойство" Тип="Булево"/>
						<Приемник Имя="Активность" Вид="Свойство" Тип="Булево"/>
						<ПередВыгрузкой>Значение = Истина;</ПередВыгрузкой>
					</Свойство>
					<Свойство>
						<Код>2</Код>
						<Наименование>Контрагент --&gt; Контрагент</Наименование>
						<Порядок>100</Порядок>
						<Источник Имя="Контрагент" Вид="Измерение" Тип="СправочникСсылка.Контрагенты"/>
						<Приемник Имя="Контрагент" Вид="Измерение" Тип="СправочникСсылка.Контрагенты"/>
						<КодПравилаКонвертации>Контрагенты                                       </КодПравилаКонвертации>
					</Свойство>
					<Свойство>
						<Код>1</Код>
						<Наименование>Период --&gt; Период</Наименование>
						<Порядок>150</Порядок>
						<Источник Имя="Период" Вид="Свойство" Тип="Дата"/>
						<Приемник Имя="Период" Вид="Свойство" Тип="Дата"/>
					</Свойство>
					<Свойство>
						<Код>4</Код>
						<Наименование>СхемаНалогообложения --&gt; СхемаНалогообложения</Наименование>
						<Порядок>200</Порядок>
						<Источник Имя="СхемаНалогообложения" Вид="Ресурс" Тип="ПеречислениеСсылка.СхемыНалогообложения"/>
						<Приемник Имя="СхемаНалогообложения" Вид="Ресурс" Тип="СправочникСсылка.СхемыНалогообложения"/>
						<КодПравилаКонвертации>СхемыНалогообложения                              </КодПравилаКонвертации>
					</Свойство>
				</Свойства>
				<Значения/>
			</Правило>
			<Правило>
				<Код>КонтактнаяИнформация</Код>
				<Наименование>: </Наименование>
				<Порядок>100</Порядок>
				<ПослеЗагрузки>Вид = Объект.Вид;

Если Вид = "ЮридическийАдресКонтрагента" Тогда
	Объект.Вид = Справочники.ВидыКонтактнойИнформации.ЮрАдресКонтрагента;
ИначеЕсли Вид = "КонтактныйТелефонКонтрагента" Тогда
	Объект.Вид = Справочники.ВидыКонтактнойИнформации.ТелефонКонтрагента;
Иначе
	Отказ = Истина;
КонецЕсли;</ПослеЗагрузки>
				<НеЗапоминатьВыгруженные>true</НеЗапоминатьВыгруженные>
				<Приемник>РегистрСведенийЗапись.КонтактнаяИнформация</Приемник>
				<Свойства>
					<Свойство>
						<Код>6</Код>
						<Наименование>--&gt; Объект</Наименование>
						<Порядок>100</Порядок>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="Объект" Вид="Измерение"/>
						<КодПравилаКонвертации>Контрагенты                                       </КодПравилаКонвертации>
					</Свойство>
					<Свойство>
						<Код>1</Код>
						<Наименование>--&gt; Тип</Наименование>
						<Порядок>150</Порядок>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="Тип" Вид="Измерение" Тип="ПеречислениеСсылка.ТипыКонтактнойИнформации"/>
						<КодПравилаКонвертации>ТипыКонтактнойИнформации                          </КодПравилаКонвертации>
					</Свойство>
					<Свойство>
						<Код>2</Код>
						<Наименование>--&gt; Вид</Наименование>
						<Порядок>200</Порядок>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="Вид" Вид="Измерение"/>
					</Свойство>
					<Свойство>
						<Код>3</Код>
						<Наименование>--&gt; Комментарий</Наименование>
						<Порядок>250</Порядок>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="Комментарий" Вид="Ресурс" Тип="Строка"/>
					</Свойство>
					<Свойство>
						<Код>7</Код>
						<Наименование>--&gt; Представление</Наименование>
						<Порядок>350</Порядок>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="Представление" Вид="Ресурс" Тип="Строка"/>
					</Свойство>
					<Свойство>
						<Код>4</Код>
						<Наименование>--&gt; Поле1</Наименование>
						<Порядок>450</Порядок>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="Поле1" Вид="Ресурс" Тип="Строка"/>
					</Свойство>
					<Свойство>
						<Код>5</Код>
						<Наименование>--&gt; Поле10</Наименование>
						<Порядок>500</Порядок>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="Поле10" Вид="Ресурс" Тип="Строка"/>
					</Свойство>
					<Свойство>
						<Код>8</Код>
						<Наименование>--&gt; Поле2</Наименование>
						<Порядок>750</Порядок>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="Поле2" Вид="Ресурс" Тип="Строка"/>
					</Свойство>
					<Свойство>
						<Код>9</Код>
						<Наименование>--&gt; Поле3</Наименование>
						<Порядок>800</Порядок>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="Поле3" Вид="Ресурс" Тип="Строка"/>
					</Свойство>
					<Свойство>
						<Код>10</Код>
						<Наименование>--&gt; Поле4</Наименование>
						<Порядок>850</Порядок>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="Поле4" Вид="Ресурс" Тип="Строка"/>
					</Свойство>
					<Свойство>
						<Код>11</Код>
						<Наименование>--&gt; Поле5</Наименование>
						<Порядок>850</Порядок>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="Поле5" Вид="Ресурс" Тип="Строка"/>
					</Свойство>
					<Свойство>
						<Код>12</Код>
						<Наименование>--&gt; Поле6</Наименование>
						<Порядок>900</Порядок>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="Поле6" Вид="Ресурс" Тип="Строка"/>
					</Свойство>
					<Свойство>
						<Код>13</Код>
						<Наименование>--&gt; Поле7</Наименование>
						<Порядок>950</Порядок>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="Поле7" Вид="Ресурс" Тип="Строка"/>
					</Свойство>
					<Свойство>
						<Код>14</Код>
						<Наименование>--&gt; Поле8</Наименование>
						<Порядок>1000</Порядок>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="Поле8" Вид="Ресурс" Тип="Строка"/>
					</Свойство>
					<Свойство>
						<Код>15</Код>
						<Наименование>--&gt; Поле9</Наименование>
						<Порядок>1050</Порядок>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="Поле9" Вид="Ресурс" Тип="Строка"/>
					</Свойство>
				</Свойства>
				<Значения/>
			</Правило>
		</Группа>
		<Группа>
			<Код>Планы видов характеристик</Код>
			<Наименование>Планы видов характеристик</Наименование>
			<Порядок>700</Порядок>
			<Правило>
				<Код>ВидыСубконтоХозрасчетные</Код>
				<Наименование>: </Наименование>
				<Порядок>50</Порядок>
				<НеСоздаватьЕслиНеНайден>true</НеСоздаватьЕслиНеНайден>
				<Приемник>ПланВидовХарактеристикСсылка.ВидыСубконтоХозрасчетные</Приемник>
				<Свойства>
					<Свойство Поиск="true">
						<Код>1</Код>
						<Наименование>--&gt; Код</Наименование>
						<Порядок>50</Порядок>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="Код" Вид="Свойство" Тип="Строка"/>
					</Свойство>
				</Свойства>
				<Значения/>
			</Правило>
		</Группа>
	</ПравилаКонвертацииОбъектов>
	<ПравилаВыгрузкиДанных>
		<Группа Отключить="false">
			<Код>Документы</Код>
			<Наименование>Документы                                         </Наименование>
			<Порядок>50</Порядок>
			<Правило Отключить="false">
				<Код>ПоступлениеТоваров</Код>
				<Наименование>Поступление товаров</Наименование>
				<Порядок>50</Порядок>
				<КодПравилаКонвертации>ПоступлениеТоваров                                </КодПравилаКонвертации>
				<СпособОтбораДанных>ПроизвольныйАлгоритм</СпособОтбораДанных>
				<ОбъектВыборки>ДокументСсылка.ПоступлениеТоваров</ОбъектВыборки>
				<ПередОбработкойПравила>
ТипОбъекта 	  = "ПоступлениеТоваров";
ИмяПравилаПКО = "ПоступлениеТоваров";

ИсходящиеДанные = Новый Структура("ДопПоля", "ОбъектИзменения.Ссылка.РегламентированныйУчет КАК РегламентированныйУчет,");

Если Параметры.ВыгрузкаДокументы Тогда
	Выполнить(Алгоритмы.ВыполнитьВыгрузкуДокументов);
ИначеЕсли ЗначениеЗаполнено(Параметры.ПоступлениеТоваров) Тогда
	ВыгрузитьПоПравилу(Параметры.ПоступлениеТоваров, , , , ИмяПравилаПКО);	
КонецЕсли;

Отказ = Истина;</ПередОбработкойПравила>
			</Правило>
			<Правило Отключить="false">
				<Код>РеализацияТоваров</Код>
				<Наименование>РеализацияТоваров</Наименование>
				<Порядок>100</Порядок>
				<КодПравилаКонвертации>РеализацияТоваров                                 </КодПравилаКонвертации>
				<СпособОтбораДанных>ПроизвольныйАлгоритм</СпособОтбораДанных>
				<ОбъектВыборки>ДокументСсылка.РеализацияТоваров</ОбъектВыборки>
				<ПередОбработкойПравила>ТипОбъекта 	  = "РеализацияТоваров";
ИмяПравилаПКО = "РеализацияТоваров";

ДопПоля = "ОбъектИзменения.Ссылка.РегламентированныйУчет КАК РегламентированныйУчет,
		  |ОбъектИзменения.Ссылка.ХозОперация = ЗНАЧЕНИЕ(Справочник.ХозОперации.АктОбОказанииУслуг) КАК АктУслуг,";

ИсходящиеДанные = Новый Структура("ДопПоля", ДопПоля);

Если Параметры.ВыгрузкаДокументы Тогда
	Выполнить(Алгоритмы.ВыполнитьВыгрузкуДокументов);
ИначеЕсли ЗначениеЗаполнено(Параметры.РеализацияТоваров) Тогда
	ВыгрузитьПоПравилу(Параметры.РеализацияТоваров, , , , ИмяПравилаПКО);	
КонецЕсли;

Отказ = Истина;</ПередОбработкойПравила>
			</Правило>
			<Правило Отключить="false">
				<Код>ВозвратПоставщику</Код>
				<Наименование>ВозвратПоставщику</Наименование>
				<Порядок>150</Порядок>
				<КодПравилаКонвертации>ВозвратПоставщику                                 </КодПравилаКонвертации>
				<СпособОтбораДанных>ПроизвольныйАлгоритм</СпособОтбораДанных>
				<ОбъектВыборки>ДокументСсылка.ВозвратПоставщику</ОбъектВыборки>
				<ПередОбработкойПравила>ТипОбъекта 	  = "ВозвратПоставщику";
ИмяПравилаПКО = "ВозвратПоставщику";

ИсходящиеДанные = Новый Структура("ДопПоля", "ОбъектИзменения.Ссылка.РегламентированныйУчет КАК РегламентированныйУчет,");

Если Параметры.ВыгрузкаДокументы Тогда
	Выполнить(Алгоритмы.ВыполнитьВыгрузкуДокументов);
ИначеЕсли ЗначениеЗаполнено(Параметры.ВозвратПоставщику) Тогда
	ВыгрузитьПоПравилу(Параметры.ВозвратПоставщику, , , , ИмяПравилаПКО);	
КонецЕсли;

Отказ = Истина;
</ПередОбработкойПравила>
			</Правило>
			<Правило Отключить="false">
				<Код>ВозвратОтПокупателя</Код>
				<Наименование>ВозвратОтПокупателя</Наименование>
				<Порядок>200</Порядок>
				<КодПравилаКонвертации>ВозвратОтПокупателя                               </КодПравилаКонвертации>
				<СпособОтбораДанных>ПроизвольныйАлгоритм</СпособОтбораДанных>
				<ОбъектВыборки>ДокументСсылка.ВозвратОтПокупателя</ОбъектВыборки>
				<ПередОбработкойПравила>ТипОбъекта 	  = "ВозвратОтПокупателя";
ИмяПравилаПКО = "ВозвратОтПокупателя";

ИсходящиеДанные = Новый Структура("ДопПоля", "ОбъектИзменения.Ссылка.РегламентированныйУчет КАК РегламентированныйУчет,");

Если Параметры.ВыгрузкаДокументы Тогда
	Выполнить(Алгоритмы.ВыполнитьВыгрузкуДокументов);
ИначеЕсли ЗначениеЗаполнено(Параметры.ВозвратОтПокупателя) Тогда
	ВыгрузитьПоПравилу(Параметры.ВозвратОтПокупателя, , , , ИмяПравилаПКО);	
КонецЕсли;

Отказ = Истина;</ПередОбработкойПравила>
			</Правило>
			<Правило Отключить="false">
				<Код>КорректировкаДолга</Код>
				<Наименование>ТК_КорректировкаДолга</Наименование>
				<Порядок>250</Порядок>
				<КодПравилаКонвертации>КорректировкаДолга                                </КодПравилаКонвертации>
				<СпособОтбораДанных>ПроизвольныйАлгоритм</СпособОтбораДанных>
				<ОбъектВыборки>ДокументСсылка.ТК_КорректировкаДолга</ОбъектВыборки>
				<ПередОбработкойПравила>ТипОбъекта 	  = "ТК_КорректировкаДолга";
ИмяПравилаПКО = "КорректировкаДолга";

ИсходящиеДанные = Новый Структура("ДопПоля", "ОбъектИзменения.Ссылка.РегламентированныйУчет КАК РегламентированныйУчет,");

Если Параметры.ВыгрузкаДокументы Тогда
	Выполнить(Алгоритмы.ВыполнитьВыгрузкуДокументов);
ИначеЕсли ЗначениеЗаполнено(Параметры.КорректировкаДолга) Тогда
	ВыгрузитьПоПравилу(Параметры.КорректировкаДолга, , , , ИмяПравилаПКО);	
КонецЕсли;

Отказ = Истина;</ПередОбработкойПравила>
			</Правило>
			<Правило Отключить="false">
				<Код>НалоговаяНакладная</Код>
				<Наименование>ТК_НалоговаяНакладная</Наименование>
				<Порядок>300</Порядок>
				<КодПравилаКонвертации>НалоговаяНакладная                                </КодПравилаКонвертации>
				<СпособОтбораДанных>ПроизвольныйАлгоритм</СпособОтбораДанных>
				<ОбъектВыборки>ДокументСсылка.ТК_НалоговаяНакладная</ОбъектВыборки>
				<ПередОбработкойПравила>ТипОбъекта 	  		= "ТК_НалоговаяНакладная";
ИмяПравилаПКО 		= "НалоговаяНакладная";

Если Параметры.ВыгрузкаДокументы Тогда
	Выполнить(Алгоритмы.ВыполнитьВыгрузкуДокументов);
ИначеЕсли ЗначениеЗаполнено(Параметры.НалоговаяНакладная) Тогда
	ВыгрузитьПоПравилу(Параметры.НалоговаяНакладная, , , , ИмяПравилаПКО);	
КонецЕсли;

Отказ = Истина;</ПередОбработкойПравила>
			</Правило>
			<Правило Отключить="false">
				<Код>ЗКС</Код>
				<Наименование>ТК_ЗакрытиеСменыЗКС</Наименование>
				<Порядок>350</Порядок>
				<КодПравилаКонвертации>ЗКС                                               </КодПравилаКонвертации>
				<СпособОтбораДанных>ПроизвольныйАлгоритм</СпособОтбораДанных>
				<ОбъектВыборки>ДокументСсылка.ТК_ЗакрытиеСменыЗКС</ОбъектВыборки>
				<ПередОбработкойПравила>ТипОбъекта 	  = "ТК_ЗакрытиеСменыЗКС";
ИмяПравилаПКО = "ЗКС";

Если Параметры.ВыгрузкаДокументы Тогда
	Выполнить(Алгоритмы.ВыполнитьВыгрузкуДокументов);
ИначеЕсли ЗначениеЗаполнено(Параметры.ЗКС) Тогда
	ВыгрузитьПоПравилу(Параметры.ЗКС, , , , ИмяПравилаПКО);	
КонецЕсли;

Отказ = Истина;</ПередОбработкойПравила>
			</Правило>
			<Правило Отключить="false">
				<Код>Приложение2кНН</Код>
				<Наименование>ТК_Приложение2КНалоговойНакладной</Наименование>
				<Порядок>400</Порядок>
				<КодПравилаКонвертации>Приложение2КНалоговойНакладной                    </КодПравилаКонвертации>
				<СпособОтбораДанных>ПроизвольныйАлгоритм</СпособОтбораДанных>
				<ОбъектВыборки>ДокументСсылка.ТК_Приложение2КНалоговойНакладной</ОбъектВыборки>
				<ПередОбработкойПравила>ТипОбъекта 	  = "ТК_Приложение2КНалоговойНакладной";
ИмяПравилаПКО = "Приложение2КНалоговойНакладной";

Если Параметры.ВыгрузкаДокументы Тогда
	Выполнить(Алгоритмы.ВыполнитьВыгрузкуДокументов);
ИначеЕсли ЗначениеЗаполнено(Параметры.Приложение2кНН) Тогда
	ВыгрузитьПоПравилу(Параметры.Приложение2кНН, , , , ИмяПравилаПКО);	
КонецЕсли;

Отказ = Истина;</ПередОбработкойПравила>
			</Правило>
			<Правило Отключить="false">
				<Код>РасходныйКассовыйОрдер</Код>
				<Наименование>РКО</Наименование>
				<Порядок>450</Порядок>
				<КодПравилаКонвертации>РасходныйКассовыйОрдер                            </КодПравилаКонвертации>
				<СпособОтбораДанных>ПроизвольныйАлгоритм</СпособОтбораДанных>
				<ОбъектВыборки>ДокументСсылка.РасходныйКассовыйОрдер</ОбъектВыборки>
				<ПередОбработкойПравила>ТипОбъекта 	  = "РасходныйКассовыйОрдер";
ИмяПравилаПКО = "РасходныйКассовыйОрдер";

ИсходящиеДанные = Новый Структура("ДопПоля", "ОбъектИзменения.Ссылка.СтатьяДДС КАК СтатьяДДС,");

Если Параметры.ВыгрузкаДокументы Тогда
	Выполнить(Алгоритмы.ВыполнитьВыгрузкуДокументов);
ИначеЕсли ЗначениеЗаполнено(Параметры.РКО) Тогда
	ВыгрузитьПоПравилу(Параметры.РКО, , , , ИмяПравилаПКО);	
КонецЕсли;

Отказ = Истина;
</ПередОбработкойПравила>
			</Правило>
			<Правило Отключить="false">
				<Код>ЗКС_Общий</Код>
				<Наименование>ЗКС_Общ                                           </Наименование>
				<Порядок>500</Порядок>
				<СпособОтбораДанных>ПроизвольныйАлгоритм</СпособОтбораДанных>
				<ПередОбработкойПравила>ИмяПравилаПКО = "ЗКС_Общий_Новый";

Если Параметры.ВыгрузкаДокументы Тогда
	Выполнить(Алгоритмы.ВыполнитьВыгрузкуЗКС_Общий);
ИначеЕсли ЗначениеЗаполнено(Параметры.ЗКС_Дата) И ЗначениеЗаполнено(Параметры.ЗКС_Организация) Тогда
	Дата 		= НачалоДня(Параметры.ЗКС_Дата);
	Организация = Параметры.ЗКС_Организация;
	
	СтруктураПараметров = Новый Структура;
	СтруктураПараметров.Вставить("Дата", Дата);
	СтруктураПараметров.Вставить("Организация", Организация);
	
	ВыгрузитьПоПравилу(,,, СтруктураПараметров, "ЗКС_Общий_Новый");	
КонецЕсли;

Отказ = Истина;</ПередОбработкойПравила>
			</Правило>
			<Правило Отключить="false">
				<Код>КонсолидированныеПоступленияОрг</Код>
				<Наименование>Консолидированные Поступления Организации                                  </Наименование>
				<Порядок>550</Порядок>
				<КодПравилаКонвертации>КонсПоступлениеТоваров                            </КодПравилаКонвертации>
				<СпособОтбораДанных>ПроизвольныйАлгоритм</СпособОтбораДанных>
				<ОбъектВыборки>ДокументСсылка.КонсолидированныеОстаткиОрганизации</ОбъектВыборки>
				<ПередОбработкойПравила>
ТипОбъекта 	  = "КонсолидированныеОстаткиОрганизации";
ИмяПравилаПКО = "КонсПоступлениеТоваров";

ДопПоля = "ОбъектИзменения.Ссылка.ХозОперация = ЗНАЧЕНИЕ(Справочник.ХозОперации.КонсолидированныеПоступленияОрганизации) КАК КонсПоступление,
		  |ОбъектИзменения.Ссылка.ДоговорВзаиморасчетов.ВидДоговора = ЗНАЧЕНИЕ(Справочник.ВидыДоговоров.БухгалтерскаяКомиссияПоставка) КАК КомиссияБух,
		  |ОбъектИзменения.Ссылка.ДоговорВзаиморасчетов.ВидДоговора = ЗНАЧЕНИЕ(Справочник.ВидыДоговоров.КомиссияПоставка) КАК Комиссия,";

ИсходящиеДанные = Новый Структура("ДопПоля", ДопПоля);

Если Параметры.ВыгрузкаДокументы Тогда
	Выполнить(Алгоритмы.ВыполнитьВыгрузкуДокументов);
ИначеЕсли ЗначениеЗаполнено(Параметры.КонсПоступлениеТоваров) Тогда
	ВыгрузитьПоПравилу(Параметры.КонсПоступлениеТоваров, , , , ИмяПравилаПКО);	
КонецЕсли;

Отказ = Истина;</ПередОбработкойПравила>
			</Правило>
		</Группа>
		<Группа Отключить="false">
			<Код>Справочники</Код>
			<Наименование>Справочники</Наименование>
			<Порядок>100</Порядок>
			<Правило Отключить="false">
				<Код>Контрагенты</Код>
				<Наименование>Контрагенты</Наименование>
				<Порядок>50</Порядок>
				<КодПравилаКонвертации>Контрагенты                                       </КодПравилаКонвертации>
				<СпособОтбораДанных>СтандартнаяВыборка</СпособОтбораДанных>
				<ОбъектВыборки>СправочникСсылка.Контрагенты</ОбъектВыборки>
				<ПередОбработкойПравила>ТипОбъекта 	  = "Контрагенты";
ИмяПравилаПКО = "Контрагенты";

Выполнить(Алгоритмы.ВыполнитьВыгрузкуСправочников);

Отказ  = Истина;
</ПередОбработкойПравила>
			</Правило>
			<Правило Отключить="false">
				<Код>ДоговорыКонтрагентов</Код>
				<Наименование>Договоры с контрагентами</Наименование>
				<Порядок>100</Порядок>
				<КодПравилаКонвертации>ДоговорыКонтрагентов                              </КодПравилаКонвертации>
				<СпособОтбораДанных>СтандартнаяВыборка</СпособОтбораДанных>
				<ОбъектВыборки>СправочникСсылка.ДоговорыКонтрагентов</ОбъектВыборки>
				<ПередОбработкойПравила>//Если ЗначениеЗаполнено(Параметры.Договор) Тогда
//	ВыгрузитьПоПравилу(Параметры.Договор, , , , "ДоговорыКонтрагентов");	
//КонецЕсли;


ТипОбъекта 	  = "ДоговорыКонтрагентов";
ИмяПравилаПКО = "ДоговорыКонтрагентов";

Выполнить(Алгоритмы.ВыполнитьВыгрузкуСправочников);

Отказ  = Истина;
</ПередОбработкойПравила>
			</Правило>
			<Правило Отключить="false">
				<Код>БанковскиеСчетаКонтрагентов</Код>
				<Наименование>Банковские счета</Наименование>
				<Порядок>150</Порядок>
				<КодПравилаКонвертации>БанковскиеСчетаКонтр                              </КодПравилаКонвертации>
				<СпособОтбораДанных>СтандартнаяВыборка</СпособОтбораДанных>
				<ОбъектВыборки>СправочникСсылка.БанковскиеСчетаКонтрагентов</ОбъектВыборки>
				<ПередОбработкойПравила>ТипОбъекта 	  = "БанковскиеСчетаКонтрагентов";
ИмяПравилаПКО = "БанковскиеСчетаКонтр";

Выполнить(Алгоритмы.ВыполнитьВыгрузкуСправочников);

Отказ  = Истина;
</ПередОбработкойПравила>
			</Правило>
			<Правило Отключить="false">
				<Код>БанковскиеСчетаОрганизаций</Код>
				<Наименование>Банковские счета организаций</Наименование>
				<Порядок>200</Порядок>
				<КодПравилаКонвертации>БанковскиеСчетаОрг                                </КодПравилаКонвертации>
				<СпособОтбораДанных>СтандартнаяВыборка</СпособОтбораДанных>
				<ОбъектВыборки>СправочникСсылка.БанковскиеСчетаОрганизаций</ОбъектВыборки>
				<ПередОбработкойПравила>ТипОбъекта 	  = "БанковскиеСчетаОрганизаций";
ИмяПравилаПКО = "БанковскиеСчетаОрг";

Выполнить(Алгоритмы.ВыполнитьВыгрузкуСправочников);

Отказ  = Истина;
</ПередОбработкойПравила>
			</Правило>
		</Группа>
	</ПравилаВыгрузкиДанных>
	<ПравилаОчисткиДанных/>
	<Алгоритмы>
		<Алгоритм Имя="ВыполнитьВыгрузкуДокументов" ИспользуетсяПриЗагрузке="false">
			<Текст>ПланОбмена = Параметры.УзелБухгалтерия;

ДокНаВыгрузку = "100";
ДатаГраница = Дата(2021,01,01);

ТекстЗапроса =	"ВЫБРАТЬ ПЕРВЫЕ "+ДокНаВыгрузку+"
|	%ДопПоля%
|	ОбъектИзменения.Ссылка.Дата КАК Дата,
|	ОбъектИзменения.Ссылка.Проведен КАК Проведен,
|	ОбъектИзменения.Ссылка.ПометкаУдаления КАК ПометкаУдаления,
|	ОбъектИзменения.Ссылка,
|   ОбъектИзменения.Ссылка.МоментВремени КАК СсылкаМоментВремени,
|	ОбъектИзменения.НомерСообщения КАК НомерСообщения
|ИЗ
|	Документ.%ТипОбъекта%.Изменения КАК ОбъектИзменения
|ГДЕ
|	ОбъектИзменения.Узел = &amp;Узел
|	%ДопОтбор%
|
|УПОРЯДОЧИТЬ ПО
|	НомерСообщения УБЫВ,
|	СсылкаМоментВремени";

ДопПоля = "";
ДопОтбор = "";

Попытка
	Если ТипЗнч(ИсходящиеДанные) = Тип("Структура") Тогда			
		Если ИсходящиеДанные.Свойство("ДопПоля") Тогда
			ДопПоля = ИсходящиеДанные.ДопПоля;
		КонецЕсли;
		
		Если ИсходящиеДанные.Свойство("ДопОтбор") Тогда
			ДопОтбор = ИсходящиеДанные.ДопОтбор;
		КонецЕсли;
	КонецЕсли;
Исключение
КонецПопытки;

ТекстЗапроса = СтрЗаменить(ТекстЗапроса, "%ДопПоля%",	ДопПоля);
ТекстЗапроса = СтрЗаменить(ТекстЗапроса, "%ДопОтбор%",	ДопОтбор);
ТекстЗапроса = СтрЗаменить(ТекстЗапроса, "%ТипОбъекта%",ТипОбъекта);

Запрос = Новый Запрос;
Запрос.Текст = ТекстЗапроса;
Запрос.УстановитьПараметр("Узел", ПланОбмена);

РезультатЗапроса = Запрос.Выполнить();

Если НЕ РезультатЗапроса.Пустой() Тогда 			
	
	таблРезультат = РезультатЗапроса.Выгрузить();						
	МассивСсылок = таблРезультат.ВыгрузитьКолонку("Ссылка");			
	
	ПланыОбмена.ВыбратьИзменения(ПланОбмена,1,МассивСсылок);
	
	Если Не ПустаяСтрока(ИмяПравилаПКО) Тогда
		Для Каждого Документ Из таблРезультат Цикл
			НаУдаление = Ложь;
			
			Выполнить(Алгоритмы.ПроверитьДокумент);
			
			Если Документ.Дата &gt;= ДатаГраница Тогда 				
				Попытка
					Если НаУдаление Тогда											
						СтруктураПараметров = Новый Структура;
						СтруктураПараметров.Вставить("ТипОбъектаИсточника", "ДокументСсылка." + ТипОбъекта);
						
						ВыгрузитьПоПравилу(Документ.Ссылка, , СтруктураПараметров, , "ДокументНаУдаление");
						
						Если ИмяПравилаПКО = "НалоговаяНакладная" Тогда						
							СтруктураПараметров = Новый Структура;
							СтруктураПараметров.Вставить("ТипОбъектаИсточника", "ДокументСсылка.ТК_НалоговаяНакладная_РН");
							ВыгрузитьПоПравилу(Документ.Ссылка, , СтруктураПараметров, , "ДокументНаУдаление");														
						КонецЕсли;
					Иначе
						ВыгрузитьПоПравилу(Документ.Ссылка, , , , ИмяПравилаПКО);
					КонецЕсли;
				Исключение
					ПланыОбмена.ЗарегистрироватьИзменения(ПланОбмена, Документ.Ссылка);  
				КонецПопытки;
			КонецЕсли;
		КонецЦикла;
	КонецЕсли;
КонецЕсли;
</Текст>
		</Алгоритм>
		<Алгоритм Имя="ВыполнитьВыгрузкуЗКС_Общ_Нов" ИспользуетсяПриЗагрузке="false">
			<Текст>
МенеджерВТ = Новый МенеджерВременныхТаблиц;

Запрос = Новый Запрос;
Запрос.МенеджерВременныхТаблиц = МенеджерВТ;

Запрос.УстановитьПараметр("НачалоПериода", НачалоДня(Дата));
Запрос.УстановитьПараметр("КонецПериода", КонецДня(Дата));
Запрос.УстановитьПараметр("Организация", Организация);

Запрос.Текст = "ВЫБРАТЬ
               |	ТК_ЗакрытиеСменыЗКС.Дата КАК Дата,
               |	ТК_ЗакрытиеСменыЗКС.Ссылка КАК ДокументЗКС,
               |	ТК_ЗакрытиеСменыЗКС.Организация КАК Организация,
               |	ТК_ЗакрытиеСменыЗКС.ПодразделениеКомпании КАК ПодразделениеКомпании,
               |	ТК_ЗакрытиеСменыЗКС.ТорговаяПлощадка КАК ТорговаяПлощадка,
               |	ТК_ЗакрытиеСменыЗКС.СкладКомпании КАК СкладКомпании,
               |	ТК_ЗакрытиеСменыЗКС.КассоваяСмена.КассаККМ КАК КассаККМ,
               |	ТК_ЗакрытиеСменыЗКС.ВалютаДокумента КАК Валюта
               |ПОМЕСТИТЬ втЗКС
               |ИЗ
               |	Документ.ТК_ЗакрытиеСменыЗКС КАК ТК_ЗакрытиеСменыЗКС
               |ГДЕ
               |	ТК_ЗакрытиеСменыЗКС.Дата МЕЖДУ &amp;НачалоПериода И &amp;КонецПериода
               |	И ТК_ЗакрытиеСменыЗКС.Организация = &amp;Организация
               |	И ТК_ЗакрытиеСменыЗКС.Проведен
               |;
               |
               |////////////////////////////////////////////////////////////////////////////////
               |ВЫБРАТЬ
               |	ВЫБОР
               |		КОГДА ТК_ЗакрытиеСменыЗКСТовары.Возврат
               |				И ТК_ЗакрытиеСменыЗКСТовары.ДатаВозврата &lt;&gt; ДАТАВРЕМЯ(1, 1, 1)
               |			ТОГДА ТК_ЗакрытиеСменыЗКСТовары.ДатаВозврата
               |		ИНАЧЕ &amp;НачалоПериода
               |	КОНЕЦ КАК Дата,
               |	втЗКС.Организация КАК Организация,
               |	втЗКС.ПодразделениеКомпании КАК ПодразделениеКомпании,
               |	втЗКС.СкладКомпании КАК СкладКомпании,
               |	втЗКС.ТорговаяПлощадка КАК ТорговаяПлощадка,
               |	втЗКС.КассаККМ КАК КассаККМ,
               |	втЗКС.Валюта КАК Валюта,
               |	ТК_ЗакрытиеСменыЗКСТовары.Номенклатура.ГруппаЦенообразования КАК ГруппаЦенообразования,
               |	СУММА(ТК_ЗакрытиеСменыЗКСТовары.КоличествоБазовое) КАК КоличествоБазовое,
               |	СУММА(ТК_ЗакрытиеСменыЗКСТовары.СуммаВсего) КАК СуммаВсего,
               |	СУММА(ТК_ЗакрытиеСменыЗКСТовары.СуммаНДС) КАК СуммаНДС,
               |	СУММА(ТК_ЗакрытиеСменыЗКСТовары.СуммаАкцизногоНалога) КАК СуммаАкцизногоНалога,
               |	ВЫРАЗИТЬ(СУММА(ТК_ЗакрытиеСменыЗКСТовары.СуммаВсего) КАК ЧИСЛО(15, 2)) КАК окрСуммаВсего,
               |	ВЫРАЗИТЬ(СУММА(ТК_ЗакрытиеСменыЗКСТовары.СуммаНДС) КАК ЧИСЛО(15, 2)) КАК окрСуммаНДС,
               |	ВЫРАЗИТЬ(СУММА(ТК_ЗакрытиеСменыЗКСТовары.СуммаАкцизногоНалога) КАК ЧИСЛО(15, 2)) КАК окрСуммаАкцизногоНалога
               |ПОМЕСТИТЬ втТоварыЗКС
               |ИЗ
               |	Документ.ТК_ЗакрытиеСменыЗКС.Товары КАК ТК_ЗакрытиеСменыЗКСТовары
               |		ВНУТРЕННЕЕ СОЕДИНЕНИЕ втЗКС КАК втЗКС
               |		ПО ТК_ЗакрытиеСменыЗКСТовары.Ссылка = втЗКС.ДокументЗКС
               |
               |СГРУППИРОВАТЬ ПО
               |	ТК_ЗакрытиеСменыЗКСТовары.Номенклатура.ГруппаЦенообразования,
               |	ВЫБОР
               |		КОГДА ТК_ЗакрытиеСменыЗКСТовары.Возврат
               |				И ТК_ЗакрытиеСменыЗКСТовары.ДатаВозврата &lt;&gt; ДАТАВРЕМЯ(1, 1, 1)
               |			ТОГДА ТК_ЗакрытиеСменыЗКСТовары.ДатаВозврата
               |		ИНАЧЕ &amp;НачалоПериода
               |	КОНЕЦ,
               |	втЗКС.Организация,
               |	втЗКС.ПодразделениеКомпании,
               |	втЗКС.СкладКомпании,
               |	втЗКС.ТорговаяПлощадка,
               |	втЗКС.КассаККМ,
               |	втЗКС.Валюта
               |
               |ИМЕЮЩИЕ
               |	СУММА(ТК_ЗакрытиеСменыЗКСТовары.КоличествоБазовое) &gt; 0
               |;
               |
               |////////////////////////////////////////////////////////////////////////////////
               |ВЫБРАТЬ
               |	втЗКС.Организация КАК Организация,
               |	втЗКС.ПодразделениеКомпании КАК ПодразделениеКомпании,
               |	ТК_ЗакрытиеСменыЗКСОплатаПлатежнымиКартами.КассаККМ КАК КассаККМ,
               |	ЕСТЬNULL(ТК_СчетаЭкварингаСрезПоследних.БанковскийСчет, ЗНАЧЕНИЕ(Справочник.БанковскиеСчетаОрганизаций.ПустаяСсылка)) КАК БанковскийСчет,
               |	ЕСТЬNULL(ТК_СчетаЭкварингаСрезПоследних.Контрагент, ЗНАЧЕНИЕ(Справочник.Контрагенты.ПустаяСсылка)) КАК Контрагент,
               |	СУММА(ТК_ЗакрытиеСменыЗКСОплатаПлатежнымиКартами.Сумма) КАК Сумма
               |ПОМЕСТИТЬ втОплатаКартамиЗКС
               |ИЗ
               |	Документ.ТК_ЗакрытиеСменыЗКС.ОплатаПлатежнымиКартами КАК ТК_ЗакрытиеСменыЗКСОплатаПлатежнымиКартами
               |		ВНУТРЕННЕЕ СОЕДИНЕНИЕ втЗКС КАК втЗКС
               |			ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.ТК_СчетаЭкваринга.СрезПоследних(
               |					&amp;НачалоПериода,
               |					ТорговаяПлощадка В
               |						(ВЫБРАТЬ
               |							втЗКС.ТорговаяПлощадка КАК ТорговаяПлощадка
               |						ИЗ
               |							втЗКС КАК втЗКС
               |						СГРУППИРОВАТЬ ПО
               |							втЗКС.ТорговаяПлощадка)) КАК ТК_СчетаЭкварингаСрезПоследних
               |			ПО втЗКС.ТорговаяПлощадка = ТК_СчетаЭкварингаСрезПоследних.ТорговаяПлощадка
               |		ПО ТК_ЗакрытиеСменыЗКСОплатаПлатежнымиКартами.Ссылка = втЗКС.ДокументЗКС
               |
               |СГРУППИРОВАТЬ ПО
               |	втЗКС.ПодразделениеКомпании,
               |	втЗКС.Организация,
               |	ЕСТЬNULL(ТК_СчетаЭкварингаСрезПоследних.БанковскийСчет, ЗНАЧЕНИЕ(Справочник.БанковскиеСчетаОрганизаций.ПустаяСсылка)),
               |	ЕСТЬNULL(ТК_СчетаЭкварингаСрезПоследних.Контрагент, ЗНАЧЕНИЕ(Справочник.Контрагенты.ПустаяСсылка)),
               |	ТК_ЗакрытиеСменыЗКСОплатаПлатежнымиКартами.КассаККМ
               |;
               |
               |////////////////////////////////////////////////////////////////////////////////
               |ВЫБРАТЬ
               |	втТоварыЗКС.Организация КАК Организация,
               |	втТоварыЗКС.ПодразделениеКомпании КАК ПодразделениеКомпании,
               |	СУММА(втТоварыЗКС.СуммаНДС) КАК СуммаНДС,
               |	СУММА(втТоварыЗКС.СуммаАкцизногоНалога) КАК СуммаАкциз,
               |	СУММА(втТоварыЗКС.СуммаВсего) КАК Сумма,
               |	СУММА(втТоварыЗКС.окрСуммаНДС) КАК окрСуммаНДС,
               |	СУММА(втТоварыЗКС.окрСуммаВсего) КАК окрСумма,
               |	СУММА(втТоварыЗКС.окрСуммаАкцизногоНалога) КАК окрСуммаАкциз,
               |	втТоварыЗКС.Валюта КАК Валюта
               |ИЗ
               |	втТоварыЗКС КАК втТоварыЗКС
               |
               |СГРУППИРОВАТЬ ПО
               |	втТоварыЗКС.ПодразделениеКомпании,
               |	втТоварыЗКС.Организация,
               |	втТоварыЗКС.Валюта";

ТаблицаПодразделений = Запрос.Выполнить().Выгрузить();

РазницаНДС = Окр(ТаблицаПодразделений.Итог("СуммаНДС"), 2) - Окр(ТаблицаПодразделений.Итог("окрСуммаНДС"), 2);
РазницаАкциз = Окр(ТаблицаПодразделений.Итог("СуммаАкциз"), 2) - Окр(ТаблицаПодразделений.Итог("окрСуммаАкциз"), 2);

тзКорректировки = Новый ТаблицаЗначений;
тзКорректировки.Колонки.Добавить("ПризнакПроводки");
тзКорректировки.Колонки.Добавить("Сумма");

Если РазницаНДС &lt;&gt; 0 Тогда 
	НоваяСтрока = тзКорректировки.Добавить();
	НоваяСтрока.ПризнакПроводки = "КорректировкаНДС";
	НоваяСтрока.Сумма = РазницаНДС;		
КонецЕсли;

Если РазницаАкциз &lt;&gt; 0 Тогда 
	НоваяСтрока = тзКорректировки.Добавить();
	НоваяСтрока.ПризнакПроводки = "КорректировкаАкциз";
	НоваяСтрока.Сумма = РазницаАкциз;				
КонецЕсли;

Ит = 0;
Для Каждого Стр Из ТаблицаПодразделений Цикл 
	Ит = Ит + 1;
			
	ГУИД_Поиска = СтроковыеФункцииКлиентСервер.ПодставитьПараметрыВСтроку(
					"{%1_%2_%3}",
					СтрЗаменить(Строка(Стр.Организация.УникальныйИдентификатор()), "-", ""),
					СтрЗаменить(Строка(Стр.ПодразделениеКомпании.УникальныйИдентификатор()), "-", ""),
					Формат(Дата, "ДФ=yyyyMMdd"));
					
	СтруктураДокумента = Новый Структура;
	СтруктураДокумента.Вставить("GUID_Поиска", ГУИД_Поиска);
	СтруктураДокумента.Вставить("Дата", КонецДня(Дата));
	СтруктураДокумента.Вставить("Организация", Организация);
	СтруктураДокумента.Вставить("Подразделение", Стр.ПодразделениеКомпании);
	СтруктураДокумента.Вставить("СуммаОперации", Окр(Стр.Сумма, 2));
					
	СтруктураПараметров = Новый Структура;
	СтруктураПараметров.Вставить("МенеджерВТ", МенеджерВТ);
	СтруктураПараметров.Вставить("Валюта", Стр.Валюта);
	
	Если Ит = 1 И тзКорректировки.Количество() &gt; 0 Тогда 
		СтруктураПараметров.Вставить("ТаблицаКорректировки", тзКорректировки);
	КонецЕсли;
	
	ВыгрузитьПоПравилу(СтруктураДокумента,,, СтруктураПараметров, "ЗКС_Общий_Новый");	
КонецЦикла;
</Текст>
		</Алгоритм>
		<Алгоритм Имя="ВыполнитьВыгрузкуЗКС_Общий" ИспользуетсяПриЗагрузке="false">
			<Текст>ПланОбмена = Параметры.УзелБухгалтерия;
//ДатаГраница = Дата(2021,01,01);

ТекстЗапроса = "ВЫБРАТЬ ПЕРВЫЕ 10
|	ТК_РегистрацияВыгрузкиЗКСИзменения.Период КАК Дата,
|	ТК_РегистрацияВыгрузкиЗКСИзменения.Организация КАК Организация,
|	ТК_РегистрацияВыгрузкиЗКСИзменения.НомерСообщения КАК НомерСообщения
|ИЗ
|	РегистрСведений.ТК_РегистрацияВыгрузкиЗКС.Изменения КАК ТК_РегистрацияВыгрузкиЗКСИзменения
|ГДЕ
|	ТК_РегистрацияВыгрузкиЗКСИзменения.Узел = &amp;Узел
|
|УПОРЯДОЧИТЬ ПО
|	НомерСообщения УБЫВ,
|	Дата";


Запрос = Новый Запрос;
Запрос.Текст = ТекстЗапроса;
Запрос.УстановитьПараметр("Узел", ПланОбмена);

Выборка = Запрос.Выполнить().Выбрать();
Пока Выборка.Следующий() Цикл 		
	НаборЗаписей = РегистрыСведений.ТК_РегистрацияВыгрузкиЗКС.СоздатьНаборЗаписей();
	НаборЗаписей.Отбор.Период.Установить(Выборка.Дата);
	НаборЗаписей.Отбор.Организация.Установить(Выборка.Организация);				
	НаборЗаписей.Прочитать();	
	ПланыОбмена.ВыбратьИзменения(ПланОбмена, 1, НаборЗаписей);
	
	Попытка
		СтруктураПараметров = Новый Структура;
		СтруктураПараметров.Вставить("Дата", Выборка.Дата);
		СтруктураПараметров.Вставить("Организация", Выборка.Организация);
		
		ВыгрузитьПоПравилу(,,, СтруктураПараметров, ИмяПравилаПКО);
	Исключение		
		НаборЗаписей = РегистрыСведений.ТК_РегистрацияВыгрузкиЗКС.СоздатьНаборЗаписей();
		НаборЗаписей.Отбор.Период.Установить(Выборка.Дата);
		НаборЗаписей.Отбор.Организация.Установить(Выборка.Организация);				
		ЗаписьНабора = НаборЗаписей.Добавить();
		
		ПланыОбмена.ЗарегистрироватьИзменения(ПланОбмена, НаборЗаписей);  
	КонецПопытки;

КонецЦикла;
</Текст>
		</Алгоритм>
		<Алгоритм Имя="ВыполнитьВыгрузкуСправочников" ИспользуетсяПриЗагрузке="false">
			<Текст>ПланОбмена = Параметры.УзелНСИ;
//Сообщить(ТипЗнч(ПланОбмена));
Если ЗначениеЗаполнено(ПланОбмена) И Не ПланОбмена.Пустая() Тогда 
	
	ТекстЗапроса =	"ВЫБРАТЬ ПЕРВЫЕ 1000 
	|	ОбъектИзменения.Ссылка,
	|	ОбъектИзменения.НомерСообщения КАК НомерСообщения
	|ИЗ
	|	Справочник.%ТипОбъекта%.Изменения КАК ОбъектИзменения
	|ГДЕ
	|	ОбъектИзменения.Узел = &amp;Узел
	|
	|УПОРЯДОЧИТЬ ПО
	|	НомерСообщения УБЫВ";
	
	ТекстЗапроса = СтрЗаменить(ТекстЗапроса, "%ТипОбъекта%", ТипОбъекта);
	
	Запрос = Новый Запрос;
	Запрос.Текст = ТекстЗапроса;
	Запрос.УстановитьПараметр("Узел", ПланОбмена);
	
	РезультатЗапроса = Запрос.Выполнить();
	
	Если НЕ РезультатЗапроса.Пустой() Тогда 						
		
		МассивСсылок = РезультатЗапроса.Выгрузить().ВыгрузитьКолонку("Ссылка");
		
		ПланыОбмена.ВыбратьИзменения(ПланОбмена,1,МассивСсылок);
		
		Если НЕ ПустаяСтрока(ИмяПравилаПКО) Тогда
			Для Каждого Спр Из МассивСсылок Цикл 
				ВыгрузитьПоПравилу(Спр, , , , ИмяПравилаПКО);				
			КонецЦикла;			
		КонецЕсли;
		
	КонецЕсли;
	
КонецЕсли;	
</Текст>
		</Алгоритм>
		<Алгоритм Имя="ЗаписатьСоответствиеОбъектов" ИспользуетсяПриЗагрузке="true">
			<Текст>GUID_Поиска = ПараметрыОбъекта.Получить("GUID_Поиска");
ТипОбъектаИсточника  = Параметры.ПараметрыАлгоритмов["ТипОбъектаИсточника"];

НачатьТранзакцию();

Попытка 				
	УстановитьОбменДаннымиЗагрузка(Объект);
	Объект.Записать();		
	
	Запись = РегистрыСведений.СоответствиеОбъектовДляОбмена.СоздатьМенеджерЗаписи();
	Запись.УзелОбмена		= Параметры.УзелОбменаДляСоответствияОбъектов;
	Запись.СобственнаяСсылка= Объект.Ссылка;
	Запись.СсылкаВДругойИБ	= GUID_Поиска;
	Запись.ИмяТипаПриемника = ТипОбъектаИсточника;
	Запись.Записать();
	
	ЗафиксироватьТранзакцию();	
Исключение
	ОтменитьТранзакцию();
	Отказ = Истина;
	тСообщение = "ОШИБКА ЗАГРУЗКА ПРЕРВАНА, не удалось записать соответствие объектов обмена, описание ошибки :"+ОписаниеОшибки();
	ВызватьИсключение(тСообщение);
КонецПопытки;</Текст>
		</Алгоритм>
		<Алгоритм Имя="ЗаполнитьНаОснованииТиповойОперации" ИспользуетсяПриЗагрузке="true">
			<Текст>
ТО = Объект.ТиповаяОперация;  
зпПараметры = Объект.ЗапрашиваемыеПараметры;

Если зпПараметры.Количество() = 0 Тогда
	Объект.Движения.Хозрасчетный.Очистить();
Иначе
	
	ТОПараметры = ТО.Параметры.Выгрузить();
	
	тзПараметров = зпПараметры.Выгрузить();		
	тзПроводок = тзПараметров.Скопировать(,"Имя");
	тзПроводок.Свернуть("Имя");
	
	//ПодразделениеДокумента = Объект.Подразделение; 
	счПроводка = 1;	
	Для Каждого СтрПроводка Из тзПроводок Цикл 
		зпПараметры.Очистить();
		нСтрокиПараметров = тзПараметров.НайтиСтроки(Новый Структура("Имя",СтрПроводка.Имя));
		ТаблицаПараметры = ТОПараметры.Скопировать();
		Для Каждого Стр Из нСтрокиПараметров Цикл 
			нСтрока = ТаблицаПараметры.Найти(Стр.Представление, "Имя");
			Если нСтрока &lt;&gt; Неопределено Тогда  			
				нСтрока.Имя           = Стр.Представление;	
				нСтрока.Представление = Стр.Представление;
				нСтрока.Значение 	  = Стр.Значение;
			КонецЕсли;
		КонецЦикла;
		зпПараметры.Загрузить(ТаблицаПараметры);
		Объект.ЗаполнитьНаОснованииТиповойОперации(ТО, счПроводка=1);
		счПроводка = счПроводка+1;		
	КонецЦикла;
	
	зпПараметры.Очистить();
	
	ДвиженияХозрасчетный = Объект.Движения.Хозрасчетный;  
	МассивУдаляемыхПроводок = Новый Массив;
	Для Каждого СтрПроводки Из ДвиженияХозрасчетный Цикл
		Если СтрПроводки.Сумма = 0 Тогда
			МассивУдаляемыхПроводок.Добавить(СтрПроводки);
			Продолжить;
		КонецЕсли;
		СтрПроводки.Организация = Объект.Организация;
		СтрПроводки.Период 	    = Объект.Дата;
	КонецЦикла;
	
	Для каждого Проводка Из МассивУдаляемыхПроводок Цикл
		ДвиженияХозрасчетный.Удалить(Проводка);
	КонецЦикла;
КонецЕсли;</Текст>
		</Алгоритм>
		<Алгоритм Имя="ЗаполнитьСубконто" ИспользуетсяПриЗагрузке="false">
			<Текст>СубконтоДт = Новый Соответствие;
СубконтоКт = Новый Соответствие;

текСубконто = "СубконтоДт";

Попытка
	Выполнить(Алгоритмы["сч"+Проводка.СчетДт]);
Исключение
	тОшибка = "ВЫГРУЗКА ПРЕРВАНА!. Ошибка заполнения субконто по счету Дт :"""+ Проводка.СчетДт +""", текст ошибки: "+ОписаниеОшибки();
	ВызватьИсключение(тОшибка);
КонецПопытки;



текСубконто = "СубконтоКт";		

Попытка
	Выполнить(Алгоритмы["сч"+Проводка.СчетКт]);
Исключение
	тОшибка = "ВЫГРУЗКА ПРЕРВАНА!. Ошибка заполнения субконто по счету Кт :"""+ Проводка.СчетКт +""", текст ошибки: "+ОписаниеОшибки();
	ВызватьИсключение(тОшибка);
КонецПопытки;



нСтрока.СубконтоДт = СубконтоДт;
нСтрока.СубконтоКт = СубконтоКт; 
</Текст>
		</Алгоритм>
		<Алгоритм Имя="ОбособленоеПодразделение" ИспользуетсяПриЗагрузке="false">
			<Текст>	Запрос = Новый Запрос;
	Запрос.Текст = 
		"ВЫБРАТЬ
		|	КассыКомпании.Ссылка КАК Ссылка
		|ИЗ
		|	Справочник.КассыКомпании КАК КассыКомпании
		|ГДЕ
		|	КассыКомпании.Объект = &amp;Объект
		|	И КассыКомпании.РегламентированныйУчет
		|	И КассыКомпании.ПометкаУдаления = ЛОЖЬ";
	
	Запрос.УстановитьПараметр("Объект", Источник.ТорговаяПлощадка);
	
	РезультатЗапроса = Запрос.Выполнить();
	
	Если РезультатЗапроса.Пустой() Тогда
		Если ЗначениеЗаполнено(Источник.КассаКомпании) Тогда
			Значение = Источник.КассаКомпании;
		Иначе
			Значение = Неопределено;
		КонецЕсли;	
	Иначе
		Выборка = РезультатЗапроса.Выбрать();
		Выборка.Следующий();
			Значение = Выборка.Ссылка;
	КонецЕсли;
	</Текст>
		</Алгоритм>
		<Алгоритм Имя="ПоискОрганизацииПоЕДРПОУ" ИспользуетсяПриЗагрузке="true">
			<Текст>
КодПоЕДРПОУ = СокрП(ПараметрыОбъекта.Получить("КодПоЕДРПОУ"));

Если ЗначениеЗаполнено(КодПоЕДРПОУ) Тогда 

	Запрос = Новый Запрос;
	Запрос.Текст = "ВЫБРАТЬ ПЕРВЫЕ 1
	               |	КодыОрганизации.Организация
	               |ИЗ
	               |	РегистрСведений.КодыОрганизации КАК КодыОрганизации
	               |ГДЕ
	               |	КодыОрганизации.КодПоЕДРПОУ = &amp;КодПоЕДРПОУ
	               |
	               |УПОРЯДОЧИТЬ ПО
	               |	КодыОрганизации.Период УБЫВ";
	
	Запрос.УстановитьПараметр("КодПоЕДРПОУ", КодПоЕДРПОУ);
	
	Выборка = Запрос.Выполнить().Выбрать();
	
	Если Выборка.Следующий() Тогда 
		СсылкаНаОбъект = Выборка.Организация;
		ОбъектНайден = Истина;	
		ПараметрыОбъекта.Вставить("ЗаписатьОбъект", Истина);
	КонецЕсли;
КонецЕсли;</Текст>
		</Алгоритм>
		<Алгоритм Имя="ПолучитьСоответствиеОбъектов" ИспользуетсяПриЗагрузке="true">
			<Текст>ОбъектНайден = Ложь;
ЗаписатьОбъект = Ложь;
Отказ  = Ложь;

Если Параметры.ПараметрыАлгоритмов.Свойство("ВидОбъекта") Тогда
	ВидОбъекта  = Параметры.ПараметрыАлгоритмов["ВидОбъекта"];
Иначе
	ВидОбъекта = "";
КонецЕсли;

Если Параметры.ПараметрыАлгоритмов.Свойство("ТипОбъектаИсточника") Тогда
	ТипОбъектаИсточника  = Параметры.ПараметрыАлгоритмов["ТипОбъектаИсточника"];
Иначе
	ТипОбъектаИсточника = "";
КонецЕсли;

GUID_Поиска = ПараметрыОбъекта.Получить("GUID_Поиска");
ТипМетаданных = НРег(Лев(ТипОбъектаИсточника, 3));

Если GUID_Поиска &lt;&gt; Неопределено Тогда
	
	ОтборПоТипуОбъекта = ЗначениеЗаполнено(ТипОбъектаИсточника);
	
	ТекстЗапроса = "ВЫБРАТЬ
	               |	СоответствиеОбъектовДляОбмена.СобственнаяСсылка КАК Ссылка
	               |ИЗ
	               |	РегистрСведений.СоответствиеОбъектовДляОбмена КАК СоответствиеОбъектовДляОбмена
	               |ГДЕ
	               |	СоответствиеОбъектовДляОбмена.УзелОбмена = &amp;УзелОбмена
	               |	И СоответствиеОбъектовДляОбмена.СсылкаВДругойИБ = &amp;СсылкаВДругойИБ
				   |" + ?(ОтборПоТипуОбъекта, "И СоответствиеОбъектовДляОбмена.ИмяТипаПриемника = &amp;ИмяТипаПриемника", "");
		
	
	Запрос = Новый Запрос;
	Запрос.Текст = ТекстЗапроса;
	
	Запрос.УстановитьПараметр("УзелОбмена", Параметры.УзелОбменаДляСоответствияОбъектов);
	Запрос.УстановитьПараметр("СсылкаВДругойИБ", GUID_Поиска);
	
	Если ОтборПоТипуОбъекта Тогда 
		Запрос.УстановитьПараметр("ИмяТипаПриемника", ТипОбъектаИсточника);
	КонецЕсли;
	
	
	Выборка = Запрос.Выполнить().Выбрать();
	
	Если Выборка.Следующий() Тогда
		СсылкаНаОбъект=Выборка.Ссылка;
		ОбъектНайден=Истина;
	Иначе
		ЗаписатьОбъект = Истина;
		
		Попытка
			ГУИД = ЗначениеИзСтрокиВнутр(GUID_Поиска);		
		Исключение
			ГУИД = "";
		КонецПопытки;
		
		Если ТипЗнч(ГУИД) = Тип("УникальныйИдентификатор") Тогда 
			нСсылка = Неопределено;
			Если ТипМетаданных = "спр" Тогда 
				нСсылка = Справочники[ВидОбъекта].ПолучитьСсылку(ГУИД);				
			//ИначеЕсли ТипМетаданных = "док" Тогда 
			//	нСсылка = Документы[ВидОбъекта].ПолучитьСсылку(ГУИД);
			КонецЕсли;
			
			Если нСсылка &lt;&gt; Неопределено И ОбщегоНазначения.СсылкаСуществует(нСсылка) Тогда 
				СсылкаНаОбъект = нСсылка;
				ОбъектНайден = Истина;				
				
				НачатьТранзакцию();
				
				Попытка 				
					Запись = РегистрыСведений.СоответствиеОбъектовДляОбмена.СоздатьМенеджерЗаписи();
					Запись.УзелОбмена		= Параметры.УзелОбменаДляСоответствияОбъектов;
					Запись.СобственнаяСсылка= нСсылка;
					Запись.СсылкаВДругойИБ	= GUID_Поиска;
					Запись.ИмяТипаПриемника = ТипОбъектаИсточника;
					Запись.Записать();
					
					ЗафиксироватьТранзакцию();	
				Исключение
					ОтменитьТранзакцию();					
					тСообщение = "ОШИБКА ЗАГРУЗКА ПРЕРВАНА, не удалось записать соответствие объектов обмена, описание ошибки :"+ОписаниеОшибки();
					ВызватьИсключение(тСообщение);
				КонецПопытки;
				
				ЗаписатьОбъект = Ложь;
			КонецЕсли;
		КонецЕсли;
	КонецЕсли;
КонецЕсли;


ПараметрыОбъекта.Вставить("ЗаписатьОбъект", ЗаписатьОбъект);

//Сообщить("Поиск " + ВидОбъекта + ". Найдено в регистре = " + (Не ЗаписатьОбъект));</Текст>
		</Алгоритм>
		<Алгоритм Имя="ПолучитьСубконтоПоШаблону" ИспользуетсяПриЗагрузке="false">
			<Текст>Для Каждого Шаблон Из МассивШаблоновПроводок Цикл 	
	
	Попытка
		СуммаПроводки = Число(Формат(Стр[Шаблон.Сумма], "ЧРД=.; ЧН=; ЧГ=0"));
	Исключение
		СуммаПроводки = 0;
		ОбщегоНазначения.СообщитьПользователю("Не удалось получить сумму проводки по причине: " + ОписаниеОшибки());
	КонецПопытки;
	
	Если СуммаПроводки &lt;&gt; 0 Тогда 
		Попытка
			МножительДТ = Число(Шаблон.СуммаНУДт);
		Исключение
			МножительДТ = 0;
		КонецПопытки;
		
		Попытка			
			МножительКТ = Число(Шаблон.СуммаНУКт);
		Исключение
			МножительКТ = 0;
		КонецПопытки;
		
		НоваяПроводка = тзПроводок.Добавить();								
		НоваяПроводка.СчетДт = Шаблон.СчетДт;
		НоваяПроводка.СчетКт = Шаблон.СчетКт;
		НоваяПроводка.Содержание = СокрЛП(Шаблон.Содержание);
		НоваяПроводка.Сумма 	 = СуммаПроводки;
		НоваяПроводка.НалоговоеНазначениеДт = Шаблон.НалоговоеНазначениеДт;
		НоваяПроводка.НалоговоеНазначениеКт = Шаблон.НалоговоеНазначениеКт;
		НоваяПроводка.СуммаНУДт  = СуммаПроводки * МножительДТ;
		НоваяПроводка.СуммаНУКт  = СуммаПроводки * МножительКТ;
		
		текСубконто = Новый Структура;
		ВидыСубконто = Новый Структура("Дт,Кт");
		
		Для Каждого Вид Из ВидыСубконто Цикл 
			Для Ит = 1 По 3 Цикл
				ИмяСубконто = "Субконто" + Вид.Ключ + Ит;
				ПараметрСубконто = Шаблон[ИмяСубконто];
				
				ТипПараметраСубконто = ТипЗнч(ПараметрСубконто);
				
				Если ТипПараметраСубконто = Тип("Структура") Тогда
					ЗначСубконто = ПараметрСубконто;
				ИначеЕсли ЗначениеЗаполнено(ПараметрСубконто) И ТипПараметраСубконто = Тип("Строка") Тогда 
					Попытка
						ЗначСубконто = Стр[ПараметрСубконто];
					Исключение
						ЗначСубконто = Неопределено;
					КонецПопытки;
				Иначе
					ЗначСубконто = Неопределено;
				КонецЕсли;
				
				Если ЗначениеЗаполнено(ЗначСубконто) Тогда 
					текСубконто.Вставить(ИмяСубконто, ЗначСубконто);
					текСубконто.Вставить("ТипСуб" + Вид.Ключ + Ит, ТипЗнч(ЗначСубконто));								
				КонецЕсли;
			КонецЦикла;				
		КонецЦикла;
		
		ЗаполнитьЗначенияСвойств(НоваяПроводка, текСубконто);
	КонецЕсли;
КонецЦикла;</Текст>
		</Алгоритм>
		<Алгоритм Имя="ПроверитьДокумент" ИспользуетсяПриЗагрузке="false">
			<Текст>//Документ
//НаУдаление = Ложь;

Если Документ.ПометкаУдаления ИЛИ Не Документ.Проведен Тогда
	НаУдаление = Истина;	
ИначеЕсли (ТипОбъекта = "ПоступлениеТоваров" И Не Документ.РегламентированныйУчет) 
	ИЛИ (ТипОбъекта = "ВозвратПоставщику" И Не Документ.РегламентированныйУчет) 
	ИЛИ (ТипОбъекта = "ВозвратОтПокупателя" И Не Документ.РегламентированныйУчет) 
	ИЛИ (ТипОбъекта = "ТК_КорректировкаДолга" И Не Документ.РегламентированныйУчет) 
	ИЛИ (ТипОбъекта = "РеализацияТоваров" И (Не Документ.РегламентированныйУчет ИЛИ Документ.АктУслуг))
	ИЛИ (ТипОбъекта = "РасходныйКассовыйОрдер" И Документ.СтатьяДДС &lt;&gt; Параметры.СтатьяДДСРКО) 
	ИЛИ (ТипОбъекта = "КонсолидированныеОстаткиОрганизации" 
			И (Не Документ.КонсПоступление ИЛИ Документ.КомиссияБух ИЛИ Документ.Комиссия))	Тогда
	
	НаУдаление = Истина;
КонецЕсли;
</Текст>
		</Алгоритм>
		<Алгоритм Имя="ПроверитьСубконто" ИспользуетсяПриЗагрузке="false">
			<Текст>
ТипСубконто = ТипЗнч(Субконто);

Если ТипСубконто = Тип("Структура") Тогда 
	Если Субконто.Свойство("Субконто") И Субконто.Свойство("ИмяПКО") Тогда 
		ИмяПКО = Субконто.ИмяПКО;
		Субконто = Субконто.Субконто;
	КонецЕсли;
ИначеЕсли ТипСубконто = Тип("СправочникСсылка.КассыКомпании") Тогда 
	ИмяПКО = "ОбособленныеПодразделенияКассаКомпании";
КонецЕсли;
</Текст>
		</Алгоритм>
		<Группа Имя="Счета">
			<Алгоритм Имя="сч281" ИспользуетсяПриЗагрузке="false">
				<Текст>СубконтоНоменклатура		  = Проводка[текСубконто+1];
СубконтоПартии		          = Проводка[текСубконто+2];
СубконтоСклады                = Проводка[текСубконто+3];

Выполнить(текСубконто+".Вставить(Новый Структура(""Код"",""00001""),СубконтоНоменклатура)");
Выполнить(текСубконто+".Вставить(Новый Структура(""Код"",""00030""),СубконтоПартии)");
Выполнить(текСубконто+".Вставить(Новый Структура(""Код"",""00013""),СубконтоСклады)");</Текст>
			</Алгоритм>
			<Алгоритм Имя="сч303" ИспользуетсяПриЗагрузке="false">
				<Текст>СубконтоОбПодразделение		  = Проводка[текСубконто+1];
СубконтоКассы		          = Проводка[текСубконто+2];
СубконтоСтатьиДДС             = Проводка[текСубконто+3];

Выполнить(текСубконто+".Вставить(Новый Структура(""Код"",""00046""),СубконтоОбПодразделение)");
Выполнить(текСубконто+".Вставить(Новый Структура(""Код"",""00061""),СубконтоКассы)");
Выполнить(текСубконто+".Вставить(Новый Структура(""Код"",""00019""),СубконтоСтатьиДДС)");</Текст>
			</Алгоритм>
			<Алгоритм Имя="сч331" ИспользуетсяПриЗагрузке="false">
				<Текст>СубконтоКонтрагенты 		  = Проводка[текСубконто+1];
СубконтоБанковскиеСчета       = Проводка[текСубконто+2];


Выполнить(текСубконто+".Вставить(Новый Структура(""Код"",""00004""),СубконтоКонтрагенты)");
Выполнить(текСубконто+".Вставить(Новый Структура(""Код"",""00007""),СубконтоБанковскиеСчета)");
</Текст>
			</Алгоритм>
			<Алгоритм Имя="сч6415" ИспользуетсяПриЗагрузке="false">
				<Текст>СубконтоНалоги  = Проводка[текСубконто+1];

Выполнить(текСубконто+".Вставить(Новый Структура(""Код"",""00025""),СубконтоНалоги)");
</Текст>
			</Алгоритм>
			<Алгоритм Имя="сч6434" ИспользуетсяПриЗагрузке="false"/>
			<Алгоритм Имя="сч702" ИспользуетсяПриЗагрузке="false">
				<Текст>СубконтоСтатьиДоходов		  = Проводка[текСубконто+1];
СубконтоНоменклатурныеГруппы  = Проводка[текСубконто+2];
СубконтоОбъекты               = Проводка[текСубконто+3];

Выполнить(текСубконто+".Вставить(Новый Структура(""Код"",""00017""),СубконтоСтатьиДоходов)");
Выполнить(текСубконто+".Вставить(Новый Структура(""Код"",""00009""),СубконтоНоменклатурныеГруппы)");
Выполнить(текСубконто+".Вставить(Новый Структура(""Код"",""00058""),СубконтоОбъекты)");</Текст>
			</Алгоритм>
			<Алгоритм Имя="сч791" ИспользуетсяПриЗагрузке="false"/>
			<Алгоритм Имя="сч902" ИспользуетсяПриЗагрузке="false">
				<Текст>СубконтоНоменклатурныеГруппы  = Проводка[текСубконто+1];
СубконтоСтатьиЗатрат          = Проводка[текСубконто+2];
СубконтоОбъекты               = Проводка[текСубконто+3];

Выполнить(текСубконто+".Вставить(Новый Структура(""Код"",""00009""),СубконтоНоменклатурныеГруппы)");
Выполнить(текСубконто+".Вставить(Новый Структура(""Код"",""00006""),СубконтоСтатьиЗатрат)");
Выполнить(текСубконто+".Вставить(Новый Структура(""Код"",""00058""),СубконтоОбъекты)");</Текст>
			</Алгоритм>
		</Группа>
		<Алгоритм Имя="ЭтоВнутреннийКонтрагент" ИспользуетсяПриЗагрузке="false">
			<Текст>КонтрагентВнутренний = ТК_СправочникиПовтИсп.ЭтоВнутреннийКонтрагент(Источник.Контрагент);</Текст>
		</Алгоритм>
	</Алгоритмы>
	<Запросы>
		<Запрос Имя="ВозвратОтПокупателя" ИспользуетсяПриЗагрузке="false">
			<Текст>ВЫБРАТЬ
	ТК_УчетнаяПолитикаКонтрагентыСрезПоследних.Контрагент КАК Контрагент,
	ТК_УчетнаяПолитикаКонтрагентыСрезПоследних.СхемаНалогообложения = ЗНАЧЕНИЕ(Перечисление.СхемыНалогообложения.ЕдиныйНалог) КАК ПоставщикНаЕдиномНалоге
ПОМЕСТИТЬ втСхемаНалогообложения
ИЗ
	РегистрСведений.ТК_УчетнаяПолитикаКонтрагенты.СрезПоследних(&amp;Дата, Контрагент = ВЫРАЗИТЬ(&amp;Ссылка КАК Документ.ВозвратОтПокупателя).Контрагент) КАК ТК_УчетнаяПолитикаКонтрагентыСрезПоследних
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	Продажи.Покупатель КАК Контрагенты,
	Продажи.ДоговорВзаиморасчетов КАК Договоры,
	Продажи.Номенклатура.ГруппаЦенообразования КАК Номенклатура,
	Продажи.Номенклатура.ГруппаЦенообразования КАК Номенклатурные_группы,
	Продажи.СкладКомпании КАК Склады,
	СУММА(Продажи.Количество) * -1 КАК Количество,
	СУММА(Продажи.Сумма) * -1 КАК Сумма,
	Продажи.СтавкаНДС КАК СтавкаНДС,
	СУММА(Продажи.СуммаНДС) * -1 КАК СуммаНДС,
	СУММА(Продажи.Себестоимость) * -1 КАК СебестоимостьБезНДС,
	Продажи.Номенклатура.ВидНоменклатуры = ЗНАЧЕНИЕ(Перечисление.ВидыНоменклатуры.Тара) КАК Тара,
	ЕСТЬNULL(втСхемаНалогообложения.ПоставщикНаЕдиномНалоге, ЛОЖЬ) КАК ПоставщикНаЕдиномНалоге
ИЗ
	РегистрНакопления.Продажи КАК Продажи
		ЛЕВОЕ СОЕДИНЕНИЕ втСхемаНалогообложения КАК втСхемаНалогообложения
		ПО Продажи.Покупатель = втСхемаНалогообложения.Контрагент
ГДЕ
	Продажи.Регистратор ССЫЛКА Документ.ВозвратОтПокупателя
	И Продажи.Регистратор = &amp;Ссылка

СГРУППИРОВАТЬ ПО
	Продажи.ДоговорВзаиморасчетов,
	Продажи.Номенклатура.ГруппаЦенообразования,
	Продажи.СкладКомпании,
	Продажи.Номенклатура.ВидНоменклатуры = ЗНАЧЕНИЕ(Перечисление.ВидыНоменклатуры.Тара),
	Продажи.СтавкаНДС,
	Продажи.Номенклатура,
	ЕСТЬNULL(втСхемаНалогообложения.ПоставщикНаЕдиномНалоге, ЛОЖЬ),
	Продажи.Покупатель,
	Продажи.Номенклатура.ГруппаЦенообразования</Текст>
		</Запрос>
		<Запрос Имя="ВозвратПоставщику" ИспользуетсяПриЗагрузке="false">
			<Текст>ВЫБРАТЬ
	ВозвратПоставщикуТовары.Ссылка КАК Ссылка,
	ВозвратПоставщикуТовары.Ссылка.Дата КАК Дата,
	ВозвратПоставщикуТовары.Ссылка.Номер КАК Номер,
	ВозвратПоставщикуТовары.Номенклатура.ГруппаЦенообразования КАК Номенклатура,
	ВозвратПоставщикуТовары.СтавкаНДС КАК СтавкаНДС,
	ВозвратПоставщикуТовары.СтавкаНДС.Ставка КАК чСтавкаНДС,
	ВозвратПоставщикуТовары.Ссылка.Организация КАК Организация,
	ВозвратПоставщикуТовары.Ссылка.Контрагент КАК Контрагенты,
	ВозвратПоставщикуТовары.Ссылка.ПодразделениеКомпании КАК ПодразделениеКомпании,
	ВЫРАЗИТЬ(ВозвратПоставщикуТовары.Ссылка.Комментарий КАК СТРОКА(100)) КАК Комментарий,
	ВозвратПоставщикуТовары.Ссылка.ДоговорВзаиморасчетов КАК Договоры,
	ВЫБОР
		КОГДА ВозвратПоставщикуТовары.Номенклатура.ВидНоменклатуры = ЗНАЧЕНИЕ(Перечисление.ВидыНоменклатуры.Тара)
			ТОГДА ИСТИНА
		ИНАЧЕ ЛОЖЬ
	КОНЕЦ КАК Тара,
	ВозвратПоставщикуТовары.Ссылка.СкладКомпании КАК Склады,
	СУММА(ВозвратПоставщикуТовары.Сумма) КАК Сумма,
	СУММА(ВозвратПоставщикуТовары.Количество) КАК Количество,
	СУММА(ВозвратПоставщикуТовары.СуммаНДС) КАК СуммаНДС,
	ЛОЖЬ КАК ЭтоВнутренний
ИЗ
	Документ.ВозвратПоставщику.Товары КАК ВозвратПоставщикуТовары
ГДЕ
	ВозвратПоставщикуТовары.Ссылка = &amp;Ссылка
	И ВозвратПоставщикуТовары.Ссылка.Проведен

СГРУППИРОВАТЬ ПО
	ВозвратПоставщикуТовары.Ссылка,
	ВозвратПоставщикуТовары.Ссылка.Дата,
	ВозвратПоставщикуТовары.Ссылка.Номер,
	ВозвратПоставщикуТовары.Номенклатура.ГруппаЦенообразования,
	ВозвратПоставщикуТовары.Ссылка.Организация,
	ВозвратПоставщикуТовары.Ссылка.Контрагент,
	ВозвратПоставщикуТовары.Ссылка.ПодразделениеКомпании,
	ВЫРАЗИТЬ(ВозвратПоставщикуТовары.Ссылка.Комментарий КАК СТРОКА(100)),
	ВозвратПоставщикуТовары.Ссылка.ДоговорВзаиморасчетов,
	ВЫБОР
		КОГДА ВозвратПоставщикуТовары.Номенклатура.ВидНоменклатуры = ЗНАЧЕНИЕ(Перечисление.ВидыНоменклатуры.Тара)
			ТОГДА ИСТИНА
		ИНАЧЕ ЛОЖЬ
	КОНЕЦ,
	ВозвратПоставщикуТовары.Ссылка.СкладКомпании,
	ВозвратПоставщикуТовары.СтавкаНДС</Текст>
		</Запрос>
		<Запрос Имя="ЗКС" ИспользуетсяПриЗагрузке="false">
			<Текст>ВЫБРАТЬ
	ПогрешностиДокументов.Регистратор.СкладКомпании КАК СкладКомпании,
	ПогрешностиДокументов.ТорговаяПлощадка КАК ТорговаяПлощадка,
	ПогрешностиДокументов.ГруппаЦенообразования КАК ГруппаЦенообразования,
	ПогрешностиДокументов.Регистратор.КассоваяСмена.КассаККМ КАК КассаККМ,
	ПогрешностиДокументов.ОкрСумма КАК Сумма,
	ПогрешностиДокументов.ОкрСуммаНДС КАК СуммаНДС,
	ПогрешностиДокументов.ОкрСуммаАкцизногоНалога КАК СуммаАкцизногоНалога
ПОМЕСТИТЬ втТовары
ИЗ
	РегистрНакопления.ПогрешностиДокументов КАК ПогрешностиДокументов
ГДЕ
	ПогрешностиДокументов.Регистратор = &amp;Ссылка
	И ПогрешностиДокументов.Активность
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	втТовары.ГруппаЦенообразования КАК Номенклатура,
	втТовары.ГруппаЦенообразования КАК Номенклатурные_группы,
	втТовары.СкладКомпании КАК Склады,
	ВЫРАЗИТЬ(СУММА((втТовары.Сумма - втТовары.СуммаНДС - втТовары.СуммаАкцизногоНалога) * 0.95) КАК ЧИСЛО(15, 2)) КАК СебестоимостьБезНДС,
	СУММА(втТовары.СуммаНДС) КАК СуммаНДС,
	ЛОЖЬ КАК ПоставщикНаЕдиномНалоге,
	ВЫБОР
		КОГДА втТовары.Сумма &lt; 0
				ИЛИ втТовары.СуммаНДС &lt; 0
			ТОГДА "ПоСобственнойНоменклатуреВозврат"
		ИНАЧЕ "ПоСобственнойНоменклатуре"
	КОНЕЦ КАК ПризнакПроводки
ИЗ
	втТовары КАК втТовары

СГРУППИРОВАТЬ ПО
	втТовары.ГруппаЦенообразования,
	втТовары.СкладКомпании,
	ВЫБОР
		КОГДА втТовары.Сумма &lt; 0
				ИЛИ втТовары.СуммаНДС &lt; 0
			ТОГДА "ПоСобственнойНоменклатуреВозврат"
		ИНАЧЕ "ПоСобственнойНоменклатуре"
	КОНЕЦ,
	втТовары.ГруппаЦенообразования
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ТК_ЗакрытиеСменыЗКСОплатаПлатежнымиКартами.КассаККМ КАК Кассы,
	ТК_СчетаЭкварингаСрезПоследних.БанковскийСчет КАК БанковскийСчет,
	ТК_СчетаЭкварингаСрезПоследних.Контрагент КАК Контрагенты,
	СУММА(ТК_ЗакрытиеСменыЗКСОплатаПлатежнымиКартами.Сумма) КАК Сумма,
	"ОплатаПоТерминалу" КАК ПризнакПроводки
ИЗ
	Документ.ТК_ЗакрытиеСменыЗКС.ОплатаПлатежнымиКартами КАК ТК_ЗакрытиеСменыЗКСОплатаПлатежнымиКартами
		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.ТК_СчетаЭкваринга.СрезПоследних(&amp;Дата, ТорговаяПлощадка = ВЫРАЗИТЬ(&amp;Ссылка КАК Документ.ТК_ЗакрытиеСменыЗКС).ТорговаяПлощадка) КАК ТК_СчетаЭкварингаСрезПоследних
		ПО ТК_ЗакрытиеСменыЗКСОплатаПлатежнымиКартами.Ссылка.ТорговаяПлощадка = ТК_СчетаЭкварингаСрезПоследних.ТорговаяПлощадка
ГДЕ
	ТК_ЗакрытиеСменыЗКСОплатаПлатежнымиКартами.Ссылка = &amp;Ссылка

СГРУППИРОВАТЬ ПО
	ТК_СчетаЭкварингаСрезПоследних.Контрагент,
	ТК_ЗакрытиеСменыЗКСОплатаПлатежнымиКартами.КассаККМ,
	ТК_СчетаЭкварингаСрезПоследних.БанковскийСчет
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	втТовары.КассаККМ КАК Кассы,
	СУММА(втТовары.Сумма) КАК Сумма,
	ВЫБОР
		КОГДА втТовары.Сумма &lt; 0
			ТОГДА "ПоКассамЗаСобственныйТоварВозврат"
		ИНАЧЕ "ПоКассамЗаСобственныйТовар"
	КОНЕЦ КАК ПризнакПроводки
ИЗ
	втТовары КАК втТовары

СГРУППИРОВАТЬ ПО
	втТовары.КассаККМ,
	ВЫБОР
		КОГДА втТовары.Сумма &lt; 0
			ТОГДА "ПоКассамЗаСобственныйТоварВозврат"
		ИНАЧЕ "ПоКассамЗаСобственныйТовар"
	КОНЕЦ

ОБЪЕДИНИТЬ ВСЕ

ВЫБРАТЬ
	ЗНАЧЕНИЕ(Справочник.КассыККМ.ПустаяСсылка),
	СУММА(втТовары.СуммаАкцизногоНалога),
	ВЫБОР
		КОГДА втТовары.СуммаАкцизногоНалога &lt; 0
			ТОГДА "АкцизныйНалогВозврат"
		ИНАЧЕ "АкцизныйНалог"
	КОНЕЦ
ИЗ
	втТовары КАК втТовары
ГДЕ
	втТовары.СуммаАкцизногоНалога &lt;&gt; 0

СГРУППИРОВАТЬ ПО
	ВЫБОР
		КОГДА втТовары.СуммаАкцизногоНалога &lt; 0
			ТОГДА "АкцизныйНалогВозврат"
		ИНАЧЕ "АкцизныйНалог"
	КОНЕЦ

ИМЕЮЩИЕ
	СУММА(втТовары.СуммаАкцизногоНалога) &lt;&gt; 0

ОБЪЕДИНИТЬ ВСЕ

ВЫБРАТЬ
	ЗНАЧЕНИЕ(Справочник.КассыККМ.ПустаяСсылка),
	СУММА(втТовары.СуммаНДС),
	ВЫБОР
		КОГДА втТовары.СуммаНДС &lt; 0
			ТОГДА "НДСПоСобственнойНоменклатуреВозврат"
		ИНАЧЕ "НДСПоСобственнойНоменклатуре"
	КОНЕЦ
ИЗ
	втТовары КАК втТовары

СГРУППИРОВАТЬ ПО
	ВЫБОР
		КОГДА втТовары.СуммаНДС &lt; 0
			ТОГДА "НДСПоСобственнойНоменклатуреВозврат"
		ИНАЧЕ "НДСПоСобственнойНоменклатуре"
	КОНЕЦ

ОБЪЕДИНИТЬ ВСЕ

ВЫБРАТЬ
	ЗНАЧЕНИЕ(Справочник.КассыККМ.ПустаяСсылка),
	СУММА(втТовары.Сумма - втТовары.СуммаНДС - втТовары.СуммаАкцизногоНалога),
	ВЫБОР
		КОГДА втТовары.Сумма &lt; 0
			ТОГДА "ПоВсемСобственнымТоварамВозврат"
		ИНАЧЕ "ПоВсемСобственнымТоварам"
	КОНЕЦ
ИЗ
	втТовары КАК втТовары

СГРУППИРОВАТЬ ПО
	ВЫБОР
		КОГДА втТовары.Сумма &lt; 0
			ТОГДА "ПоВсемСобственнымТоварамВозврат"
		ИНАЧЕ "ПоВсемСобственнымТоварам"
	КОНЕЦ</Текст>
		</Запрос>
		<Запрос Имя="ЗКС_Общий" ИспользуетсяПриЗагрузке="false">
			<Текст>ВЫБРАТЬ
	ТК_ЗакрытиеСменыЗКС.Дата КАК Дата,
	ТК_ЗакрытиеСменыЗКС.Ссылка КАК ДокументЗКС,
	ТК_ЗакрытиеСменыЗКС.Организация КАК Организация,
	ТК_ЗакрытиеСменыЗКС.ПодразделениеКомпании КАК ПодразделениеКомпании,
	ТК_ЗакрытиеСменыЗКС.ТорговаяПлощадка КАК ТорговаяПлощадка,
	ТК_ЗакрытиеСменыЗКС.СкладКомпании КАК СкладКомпании,
	ТК_ЗакрытиеСменыЗКС.КассоваяСмена.КассаККМ КАК КассаККМ,
	ТК_ЗакрытиеСменыЗКС.ВалютаДокумента КАК Валюта
ПОМЕСТИТЬ втЗКС
ИЗ
	Документ.ТК_ЗакрытиеСменыЗКС КАК ТК_ЗакрытиеСменыЗКС
ГДЕ
	ТК_ЗакрытиеСменыЗКС.Дата МЕЖДУ &amp;НачалоПериода И &amp;КонецПериода
	И ТК_ЗакрытиеСменыЗКС.Организация = &amp;Организация
	И ТК_ЗакрытиеСменыЗКС.Проведен
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ВЫБОР
		КОГДА ТК_ЗакрытиеСменыЗКСТовары.Возврат
				И ТК_ЗакрытиеСменыЗКСТовары.ДатаВозврата &lt;&gt; ДАТАВРЕМЯ(1, 1, 1)
			ТОГДА ТК_ЗакрытиеСменыЗКСТовары.ДатаВозврата
		ИНАЧЕ &amp;НачалоПериода
	КОНЕЦ КАК Дата,
	втЗКС.Организация КАК Организация,
	втЗКС.ПодразделениеКомпании КАК ПодразделениеКомпании,
	втЗКС.СкладКомпании КАК СкладКомпании,
	втЗКС.ТорговаяПлощадка КАК ТорговаяПлощадка,
	втЗКС.КассаККМ КАК КассаККМ,
	втЗКС.Валюта КАК Валюта,
	ТК_ЗакрытиеСменыЗКСТовары.Номенклатура.ГруппаЦенообразования КАК ГруппаЦенообразования,
	СУММА(ТК_ЗакрытиеСменыЗКСТовары.КоличествоБазовое) КАК КоличествоБазовое,
	СУММА(ТК_ЗакрытиеСменыЗКСТовары.СуммаВсего) КАК СуммаВсего,
	СУММА(ТК_ЗакрытиеСменыЗКСТовары.СуммаНДС) КАК СуммаНДС,
	СУММА(ТК_ЗакрытиеСменыЗКСТовары.СуммаАкцизногоНалога) КАК СуммаАкцизногоНалога,
	ВЫРАЗИТЬ(СУММА(ТК_ЗакрытиеСменыЗКСТовары.СуммаВсего) КАК ЧИСЛО(15, 2)) КАК окрСуммаВсего,
	ВЫРАЗИТЬ(СУММА(ТК_ЗакрытиеСменыЗКСТовары.СуммаНДС) КАК ЧИСЛО(15, 2)) КАК окрСуммаНДС,
	ВЫРАЗИТЬ(СУММА(ТК_ЗакрытиеСменыЗКСТовары.СуммаАкцизногоНалога) КАК ЧИСЛО(15, 2)) КАК окрСуммаАкцизногоНалога
ПОМЕСТИТЬ втТоварыЗКС
ИЗ
	Документ.ТК_ЗакрытиеСменыЗКС.Товары КАК ТК_ЗакрытиеСменыЗКСТовары
		ВНУТРЕННЕЕ СОЕДИНЕНИЕ втЗКС КАК втЗКС
		ПО ТК_ЗакрытиеСменыЗКСТовары.Ссылка = втЗКС.ДокументЗКС

СГРУППИРОВАТЬ ПО
	ТК_ЗакрытиеСменыЗКСТовары.Номенклатура.ГруппаЦенообразования,
	ВЫБОР
		КОГДА ТК_ЗакрытиеСменыЗКСТовары.Возврат
				И ТК_ЗакрытиеСменыЗКСТовары.ДатаВозврата &lt;&gt; ДАТАВРЕМЯ(1, 1, 1)
			ТОГДА ТК_ЗакрытиеСменыЗКСТовары.ДатаВозврата
		ИНАЧЕ &amp;НачалоПериода
	КОНЕЦ,
	втЗКС.Организация,
	втЗКС.ПодразделениеКомпании,
	втЗКС.СкладКомпании,
	втЗКС.ТорговаяПлощадка,
	втЗКС.КассаККМ,
	втЗКС.Валюта

ИМЕЮЩИЕ
	СУММА(ТК_ЗакрытиеСменыЗКСТовары.КоличествоБазовое) &gt; 0
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	втЗКС.Организация КАК Организация,
	втЗКС.ПодразделениеКомпании КАК ПодразделениеКомпании,
	ТК_ЗакрытиеСменыЗКСОплатаПлатежнымиКартами.КассаККМ КАК КассаККМ,
	ЕСТЬNULL(ТК_СчетаЭкварингаСрезПоследних.БанковскийСчет, ЗНАЧЕНИЕ(Справочник.БанковскиеСчетаОрганизаций.ПустаяСсылка)) КАК БанковскийСчет,
	ЕСТЬNULL(ТК_СчетаЭкварингаСрезПоследних.Контрагент, ЗНАЧЕНИЕ(Справочник.Контрагенты.ПустаяСсылка)) КАК Контрагент,
	СУММА(ТК_ЗакрытиеСменыЗКСОплатаПлатежнымиКартами.Сумма) КАК Сумма
ПОМЕСТИТЬ втОплатаКартамиЗКС
ИЗ
	Документ.ТК_ЗакрытиеСменыЗКС.ОплатаПлатежнымиКартами КАК ТК_ЗакрытиеСменыЗКСОплатаПлатежнымиКартами
		ВНУТРЕННЕЕ СОЕДИНЕНИЕ втЗКС КАК втЗКС
			ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.ТК_СчетаЭкваринга.СрезПоследних(
					&amp;НачалоПериода,
					ТорговаяПлощадка В
						(ВЫБРАТЬ
							втЗКС.ТорговаяПлощадка КАК ТорговаяПлощадка
						ИЗ
							втЗКС КАК втЗКС
						СГРУППИРОВАТЬ ПО
							втЗКС.ТорговаяПлощадка)) КАК ТК_СчетаЭкварингаСрезПоследних
			ПО втЗКС.ТорговаяПлощадка = ТК_СчетаЭкварингаСрезПоследних.ТорговаяПлощадка
		ПО ТК_ЗакрытиеСменыЗКСОплатаПлатежнымиКартами.Ссылка = втЗКС.ДокументЗКС

СГРУППИРОВАТЬ ПО
	втЗКС.ПодразделениеКомпании,
	втЗКС.Организация,
	ЕСТЬNULL(ТК_СчетаЭкварингаСрезПоследних.БанковскийСчет, ЗНАЧЕНИЕ(Справочник.БанковскиеСчетаОрганизаций.ПустаяСсылка)),
	ЕСТЬNULL(ТК_СчетаЭкварингаСрезПоследних.Контрагент, ЗНАЧЕНИЕ(Справочник.Контрагенты.ПустаяСсылка)),
	ТК_ЗакрытиеСменыЗКСОплатаПлатежнымиКартами.КассаККМ
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	втТоварыЗКС.Валюта КАК Валюта,
	СУММА(втТоварыЗКС.СуммаВсего) КАК СуммаОперации
ИЗ
	втТоварыЗКС КАК втТоварыЗКС

СГРУППИРОВАТЬ ПО
	втТоварыЗКС.Валюта
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	втТоварыЗКС.ГруппаЦенообразования КАК Номенклатура,
	втТоварыЗКС.ГруппаЦенообразования КАК Номенклатурные_группы,
	втТоварыЗКС.СкладКомпании КАК Склады,
	ВЫРАЗИТЬ(СУММА(втТоварыЗКС.окрСуммаВсего - втТоварыЗКС.окрСуммаНДС - втТоварыЗКС.окрСуммаАкцизногоНалога) * 0.95 КАК ЧИСЛО(15, 2)) КАК СебестоимостьБезНДС,
	СУММА(втТоварыЗКС.окрСуммаНДС) КАК СуммаНДС,
	ЛОЖЬ КАК ПоставщикНаЕдиномНалоге,
	"ПоСобственнойНоменклатуре" КАК ПризнакПроводки
ИЗ
	втТоварыЗКС КАК втТоварыЗКС

СГРУППИРОВАТЬ ПО
	втТоварыЗКС.СкладКомпании,
	втТоварыЗКС.ГруппаЦенообразования,
	втТоварыЗКС.ГруппаЦенообразования

УПОРЯДОЧИТЬ ПО
	Склады,
	Номенклатура
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	втОплатаКартамиЗКС.КассаККМ КАК Кассы,
	втОплатаКартамиЗКС.БанковскийСчет КАК БанковскийСчет,
	втОплатаКартамиЗКС.Контрагент КАК Контрагенты,
	СУММА(втОплатаКартамиЗКС.Сумма) КАК Сумма,
	"ОплатаПоТерминалу" КАК ПризнакПроводки
ИЗ
	втОплатаКартамиЗКС КАК втОплатаКартамиЗКС

СГРУППИРОВАТЬ ПО
	втОплатаКартамиЗКС.КассаККМ,
	втОплатаКартамиЗКС.Контрагент,
	втОплатаКартамиЗКС.БанковскийСчет
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	втТоварыЗКС.КассаККМ КАК Кассы,
	СУММА(втТоварыЗКС.окрСуммаВсего) КАК Сумма,
	NULL КАК СуммаФинРезультат,
	"ПоКассамЗаСобственныйТовар" КАК ПризнакПроводки
ИЗ
	втТоварыЗКС КАК втТоварыЗКС

СГРУППИРОВАТЬ ПО
	втТоварыЗКС.КассаККМ

ОБЪЕДИНИТЬ ВСЕ

ВЫБРАТЬ
	NULL,
	СУММА(втТоварыЗКС.окрСуммаАкцизногоНалога),
	NULL,
	"АкцизныйНалог"
ИЗ
	втТоварыЗКС КАК втТоварыЗКС

ИМЕЮЩИЕ
	СУММА(втТоварыЗКС.окрСуммаАкцизногоНалога) &gt; 0

ОБЪЕДИНИТЬ ВСЕ

ВЫБРАТЬ
	NULL,
	СУММА(втТоварыЗКС.окрСуммаНДС),
	NULL,
	"НДСПоСобственнойНоменклатуре"
ИЗ
	втТоварыЗКС КАК втТоварыЗКС

ИМЕЮЩИЕ
	СУММА(втТоварыЗКС.окрСуммаНДС) &gt; 0

ОБЪЕДИНИТЬ ВСЕ

ВЫБРАТЬ
	NULL,
	СУММА(втТоварыЗКС.окрСуммаВсего - втТоварыЗКС.окрСуммаНДС - втТоварыЗКС.окрСуммаАкцизногоНалога),
	NULL,
	"ПоВсемСобственнымТоварам"
ИЗ
	втТоварыЗКС КАК втТоварыЗКС

ОБЪЕДИНИТЬ ВСЕ

ВЫБРАТЬ
	NULL,
	(ВЫРАЗИТЬ(СУММА(втТоварыЗКС.СуммаНДС) КАК ЧИСЛО(15, 2))) - (ВЫРАЗИТЬ(СУММА(втТоварыЗКС.окрСуммаНДС) КАК ЧИСЛО(15, 2))),
	-1*((ВЫРАЗИТЬ(СУММА(втТоварыЗКС.СуммаНДС) КАК ЧИСЛО(15, 2))) - (ВЫРАЗИТЬ(СУММА(втТоварыЗКС.окрСуммаНДС) КАК ЧИСЛО(15, 2)))),
	"КорректировкаНДС"
ИЗ
	втТоварыЗКС КАК втТоварыЗКС

ИМЕЮЩИЕ
	(ВЫРАЗИТЬ(СУММА(втТоварыЗКС.СуммаНДС) КАК ЧИСЛО(15, 2))) - (ВЫРАЗИТЬ(СУММА(втТоварыЗКС.окрСуммаНДС) КАК ЧИСЛО(15, 2))) &lt;&gt; 0

ОБЪЕДИНИТЬ ВСЕ

ВЫБРАТЬ
	NULL,
	(ВЫРАЗИТЬ(СУММА(втТоварыЗКС.СуммаАкцизногоНалога) КАК ЧИСЛО(15, 2))) - (ВЫРАЗИТЬ(СУММА(втТоварыЗКС.окрСуммаАкцизногоНалога) КАК ЧИСЛО(15, 2))),
	-1*((ВЫРАЗИТЬ(СУММА(втТоварыЗКС.СуммаАкцизногоНалога) КАК ЧИСЛО(15, 2))) - (ВЫРАЗИТЬ(СУММА(втТоварыЗКС.окрСуммаАкцизногоНалога) КАК ЧИСЛО(15, 2)))),
	"КорректировкаАкциз"
ИЗ
	втТоварыЗКС КАК втТоварыЗКС

ИМЕЮЩИЕ
	(ВЫРАЗИТЬ(СУММА(втТоварыЗКС.СуммаАкцизногоНалога) КАК ЧИСЛО(15, 2))) - (ВЫРАЗИТЬ(СУММА(втТоварыЗКС.окрСуммаАкцизногоНалога) КАК ЧИСЛО(15, 2))) &lt;&gt; 0</Текст>
		</Запрос>
		<Запрос Имя="КонсолидированныеПоступления" ИспользуетсяПриЗагрузке="false">
			<Текст>ВЫБРАТЬ
	ОстаткиТовары.Ссылка.Контрагент КАК Контрагенты,
	ОстаткиТовары.Ссылка.ДоговорВзаиморасчетов КАК Договоры,
	ОстаткиТовары.Номенклатура.ГруппаЦенообразования КАК Номенклатура,
	ОстаткиТовары.Номенклатура.ВидНоменклатуры = ЗНАЧЕНИЕ(Перечисление.ВидыНоменклатуры.Тара) КАК Тара,
	ОстаткиТовары.Ссылка.СкладКомпании КАК Склады,
	СУММА(ВЫБОР
			КОГДА ОстаткиТовары.ВидДвижения = ЗНАЧЕНИЕ(Перечисление.ВидыДвижений.Приход)
				ТОГДА ОстаткиТовары.КоличествоБазовое
			ИНАЧЕ -ОстаткиТовары.КоличествоБазовое
		КОНЕЦ) КАК Количество,
	СУММА(ВЫБОР
			КОГДА ОстаткиТовары.ВидДвижения = ЗНАЧЕНИЕ(Перечисление.ВидыДвижений.Приход)
				ТОГДА ОстаткиТовары.СуммаВсего
			ИНАЧЕ -ОстаткиТовары.СуммаВсего
		КОНЕЦ) КАК Сумма,
	СУММА(ВЫБОР
			КОГДА ОстаткиТовары.ВидДвижения = ЗНАЧЕНИЕ(Перечисление.ВидыДвижений.Приход)
				ТОГДА ОстаткиТовары.СуммаНДС
			ИНАЧЕ -ОстаткиТовары.СуммаНДС
		КОНЕЦ) КАК СуммаНДС,
	"ПоступлениеТоваров" КАК ПризнакПроводки,
	ЛОЖЬ КАК ЭтоВнутренний
ИЗ
	Документ.КонсолидированныеОстаткиОрганизации.Товары КАК ОстаткиТовары
ГДЕ
	ОстаткиТовары.Ссылка = &amp;Ссылка
	И ОстаткиТовары.Ссылка.Проведен

СГРУППИРОВАТЬ ПО
	ОстаткиТовары.Ссылка.Контрагент,
	ОстаткиТовары.Ссылка.ДоговорВзаиморасчетов,
	ОстаткиТовары.Номенклатура.ГруппаЦенообразования,
	ОстаткиТовары.Номенклатура.ВидНоменклатуры = ЗНАЧЕНИЕ(Перечисление.ВидыНоменклатуры.Тара),
	ОстаткиТовары.Ссылка.СкладКомпании</Текст>
		</Запрос>
		<Запрос Имя="КорректировкаДолга" ИспользуетсяПриЗагрузке="false">
			<Текст>ВЫБРАТЬ
	ТК_КорректировкаДолгаСостав.Ссылка.Контрагент КАК Контрагент,
	ТК_КорректировкаДолгаСостав.ДоговорВзаиморасчетов КАК ДоговорВзаиморасчетов,
	ТК_КорректировкаДолгаСостав.Сделка КАК Сделка,
	ТК_КорректировкаДолгаСостав.УвеличениеДолга * -1 + ТК_КорректировкаДолгаСостав.УменьшениеДолга КАК Сумма
ПОМЕСТИТЬ КД
ИЗ
	Документ.ТК_КорректировкаДолга.Состав КАК ТК_КорректировкаДолгаСостав
ГДЕ
	ТК_КорректировкаДолгаСостав.Ссылка = &amp;Ссылка
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ПоступлениеТоваровТовары.Ссылка КАК Сделка,
	МИНИМУМ(ПоступлениеТоваровТовары.Номенклатура.ГруппаЦенообразования) КАК Номенклатура,
	ПоступлениеТоваровТовары.Ссылка.СкладКомпании КАК СкладКомпании
ПОМЕСТИТЬ втТовары
ИЗ
	Документ.ПоступлениеТоваров.Товары КАК ПоступлениеТоваровТовары
ГДЕ
	ПоступлениеТоваровТовары.Ссылка В
			(ВЫБРАТЬ
				КД.Сделка КАК Сделка
			ИЗ
				КД КАК КД
			ГДЕ
				КД.Сделка ССЫЛКА Документ.ПоступлениеТоваров)

СГРУППИРОВАТЬ ПО
	ПоступлениеТоваровТовары.Ссылка,
	ПоступлениеТоваровТовары.Ссылка.СкладКомпании

ОБЪЕДИНИТЬ ВСЕ

ВЫБРАТЬ
	ВозвратПоставщикуТовары.Ссылка,
	МИНИМУМ(ВозвратПоставщикуТовары.Номенклатура.ГруппаЦенообразования),
	ВозвратПоставщикуТовары.Ссылка.СкладКомпании
ИЗ
	Документ.ВозвратПоставщику.Товары КАК ВозвратПоставщикуТовары
ГДЕ
	ВозвратПоставщикуТовары.Ссылка В
			(ВЫБРАТЬ
				КД.Сделка КАК Сделка
			ИЗ
				КД КАК КД
			ГДЕ
				КД.Сделка ССЫЛКА Документ.ВозвратПоставщику)

СГРУППИРОВАТЬ ПО
	ВозвратПоставщикуТовары.Ссылка,
	ВозвратПоставщикуТовары.Ссылка.СкладКомпании

ОБЪЕДИНИТЬ ВСЕ

ВЫБРАТЬ
	РеализацияТоваровТовары.Ссылка,
	МИНИМУМ(РеализацияТоваровТовары.Номенклатура.ГруппаЦенообразования),
	РеализацияТоваровТовары.Ссылка.СкладКомпании
ИЗ
	Документ.РеализацияТоваров.Товары КАК РеализацияТоваровТовары
ГДЕ
	РеализацияТоваровТовары.Ссылка В
			(ВЫБРАТЬ
				КД.Сделка КАК Сделка
			ИЗ
				КД КАК КД
			ГДЕ
				КД.Сделка ССЫЛКА Документ.РеализацияТоваров)

СГРУППИРОВАТЬ ПО
	РеализацияТоваровТовары.Ссылка,
	РеализацияТоваровТовары.Ссылка.СкладКомпании
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	КД.Контрагент КАК Контрагенты,
	КД.ДоговорВзаиморасчетов КАК Договоры,
	втТовары.Номенклатура КАК Номенклатура,
	втТовары.СкладКомпании КАК Склады,
	СУММА(ВЫРАЗИТЬ(КД.Сумма / 6 * 5 КАК ЧИСЛО(15, 2))) КАК Сумма,
	СУММА(ВЫРАЗИТЬ(КД.Сумма / 6 КАК ЧИСЛО(15, 2))) КАК СуммаНДС
ИЗ
	КД КАК КД
		ЛЕВОЕ СОЕДИНЕНИЕ втТовары КАК втТовары
		ПО КД.Сделка = втТовары.Сделка

СГРУППИРОВАТЬ ПО
	КД.Контрагент,
	втТовары.Номенклатура,
	КД.ДоговорВзаиморасчетов,
	втТовары.СкладКомпании</Текст>
		</Запрос>
		<Запрос Имя="КорректировкаЗКС" ИспользуетсяПриЗагрузке="false">
			<Текст>ВЫБРАТЬ
	ПогрешностиДокументов.Организация КАК Организация,
	СУММА(ПогрешностиДокументов.Сумма) КАК Сумма,
	СУММА(ПогрешностиДокументов.СуммаНДС) КАК СуммаНДС,
	СУММА(ПогрешностиДокументов.СуммаАкцизногоНалога) КАК СуммаАкцизногоНалога,
	СУММА(ПогрешностиДокументов.ОкрСумма) КАК ОкрСумма,
	СУММА(ПогрешностиДокументов.ОкрСуммаНДС) КАК ОкрСуммаНДС,
	СУММА(ПогрешностиДокументов.ОкрСуммаАкцизногоНалога) КАК ОкрСуммаАкцизногоНалога
ИЗ
	РегистрНакопления.ПогрешностиДокументов КАК ПогрешностиДокументов
ГДЕ
	ПогрешностиДокументов.Период МЕЖДУ &amp;НачалоПериода И &amp;КонецПериода
	И ПогрешностиДокументов.Организация = &amp;Организация

СГРУППИРОВАТЬ ПО
	ПогрешностиДокументов.Организация</Текст>
		</Запрос>
		<Запрос Имя="ПоступлениеТоваров" ИспользуетсяПриЗагрузке="false">
			<Текст>ВЫБРАТЬ
	ПоступлениеТоваровТовары.Ссылка КАК Ссылка,
	ПоступлениеТоваровТовары.Ссылка.Номер КАК Номер,
	ПоступлениеТоваровТовары.Ссылка.Дата КАК Дата,
	ПоступлениеТоваровТовары.Ссылка.Организация КАК Организация,
	ПоступлениеТоваровТовары.Ссылка.ПодразделениеКомпании КАК ПодразделениеКомпании,
	ПоступлениеТоваровТовары.Ссылка.ТорговаяПлощадка КАК ТорговаяПлощадка,
	ПоступлениеТоваровТовары.Ссылка.Контрагент КАК Контрагенты,
	ЛОЖЬ КАК ЭтоВнутренний,
	ПоступлениеТоваровТовары.Ссылка.ДоговорВзаиморасчетов КАК Договоры,
	ПоступлениеТоваровТовары.Ссылка.СкладКомпании КАК Склады,
	ПоступлениеТоваровТовары.Ссылка.ТипЦен КАК ТипЦен,
	ПоступлениеТоваровТовары.Ссылка.ХозОперация КАК ХозОперация,
	ПоступлениеТоваровТовары.Ссылка.СуммаДокумента КАК СуммаВсего,
	ПоступлениеТоваровТовары.Номенклатура.ГруппаЦенообразования КАК Номенклатура,
	СУММА(ПоступлениеТоваровТовары.КоличествоБазовое) КАК Количество,
	СУММА(ПоступлениеТоваровТовары.СуммаВсего) КАК Сумма,
	СУММА(ПоступлениеТоваровТовары.СуммаНДС) КАК СуммаНДС,
	ПоступлениеТоваровТовары.Ссылка.ТипЦен.ЦенаВключаетНДС КАК ТипЦенЦенаВключаетНДС,
	ВЫРАЗИТЬ(ПоступлениеТоваровТовары.Ссылка.Комментарий КАК СТРОКА(100)) КАК Комментарий,
	0 КАК Себестоимость,
	ВЫБОР
		КОГДА ПоступлениеТоваровТовары.Номенклатура.ВидНоменклатуры = ЗНАЧЕНИЕ(Перечисление.ВидыНоменклатуры.Тара)
			ТОГДА ИСТИНА
		ИНАЧЕ ЛОЖЬ
	КОНЕЦ КАК Тара,
	ЛОЖЬ КАК ЭтоПФ,
	"" КАК ПризнакПроводки,
	ЛОЖЬ КАК ЭтоРФМ
ИЗ
	Документ.ПоступлениеТоваров.Товары КАК ПоступлениеТоваровТовары
ГДЕ
	ПоступлениеТоваровТовары.Ссылка = &amp;Ссылка
	И ПоступлениеТоваровТовары.Ссылка.Проведен

СГРУППИРОВАТЬ ПО
	ПоступлениеТоваровТовары.Ссылка,
	ПоступлениеТоваровТовары.Ссылка.Номер,
	ПоступлениеТоваровТовары.Ссылка.Дата,
	ПоступлениеТоваровТовары.Ссылка.Организация,
	ПоступлениеТоваровТовары.Ссылка.ПодразделениеКомпании,
	ПоступлениеТоваровТовары.Ссылка.ТорговаяПлощадка,
	ПоступлениеТоваровТовары.Ссылка.Контрагент,
	ПоступлениеТоваровТовары.Ссылка.ДоговорВзаиморасчетов,
	ПоступлениеТоваровТовары.Ссылка.СкладКомпании,
	ПоступлениеТоваровТовары.Ссылка.ТипЦен,
	ПоступлениеТоваровТовары.Ссылка.ХозОперация,
	ПоступлениеТоваровТовары.Ссылка.СуммаДокумента,
	ПоступлениеТоваровТовары.Номенклатура.ГруппаЦенообразования,
	ПоступлениеТоваровТовары.Ссылка.ТипЦен.ЦенаВключаетНДС,
	ВЫРАЗИТЬ(ПоступлениеТоваровТовары.Ссылка.Комментарий КАК СТРОКА(100)),
	ВЫБОР
		КОГДА ПоступлениеТоваровТовары.Номенклатура.ВидНоменклатуры = ЗНАЧЕНИЕ(Перечисление.ВидыНоменклатуры.Тара)
			ТОГДА ИСТИНА
		ИНАЧЕ ЛОЖЬ
	КОНЕЦ</Текст>
		</Запрос>
		<Запрос Имя="ПоступлениеТоваровТранзит" ИспользуетсяПриЗагрузке="false">
			<Текст>ВЫБРАТЬ
	ПоступлениеТоваровТовары.Ссылка.Контрагент КАК Контрагенты,
	ПоступлениеТоваровТовары.Ссылка.ДоговорВзаиморасчетов КАК Договоры,
	ПоступлениеТоваровТовары.Номенклатура.ГруппаЦенообразования КАК Номенклатура,
	ПоступлениеТоваровТовары.Ссылка.СкладКомпании КАК Склады,
	СУММА(ПоступлениеТоваровТовары.КоличествоБазовое) КАК Количество,
	СУММА(ПоступлениеТоваровТовары.СуммаВсего) КАК Сумма,
	ПоступлениеТоваровТовары.СтавкаНДС КАК СтавкаНДС,
	СУММА(ПоступлениеТоваровТовары.СуммаНДС) КАК СуммаНДС,
	ПоступлениеТоваровТовары.Номенклатура.ГруппаЦенообразования.Код = "000000012" КАК ЭтоМатериал,
	ЛОЖЬ КАК ЭтоВнутренний
ИЗ
	Документ.ПоступлениеТоваров.Товары КАК ПоступлениеТоваровТовары
ГДЕ
	ПоступлениеТоваровТовары.Ссылка = &amp;Ссылка
	И ПоступлениеТоваровТовары.Ссылка.Проведен

СГРУППИРОВАТЬ ПО
	ПоступлениеТоваровТовары.Ссылка.Контрагент,
	ПоступлениеТоваровТовары.Ссылка.ДоговорВзаиморасчетов,
	ПоступлениеТоваровТовары.Номенклатура.ГруппаЦенообразования,
	ПоступлениеТоваровТовары.Ссылка.СкладКомпании,
	ПоступлениеТоваровТовары.СтавкаНДС,
	ПоступлениеТоваровТовары.Номенклатура.ГруппаЦенообразования.Код = "000000012"</Текст>
		</Запрос>
		<Запрос Имя="РеализацияТоваров" ИспользуетсяПриЗагрузке="false">
			<Текст>ВЫБРАТЬ
	ТК_УчетнаяПолитикаКонтрагентыСрезПоследних.Контрагент КАК Контрагент,
	ТК_УчетнаяПолитикаКонтрагентыСрезПоследних.СхемаНалогообложения = ЗНАЧЕНИЕ(Перечисление.СхемыНалогообложения.ЕдиныйНалог) КАК ПоставщикНаЕдиномНалоге
ПОМЕСТИТЬ втСхемаНалогообложения
ИЗ
	РегистрСведений.ТК_УчетнаяПолитикаКонтрагенты.СрезПоследних(&amp;Дата, Контрагент = ВЫРАЗИТЬ(&amp;Ссылка КАК Документ.РеализацияТоваров).Контрагент) КАК ТК_УчетнаяПолитикаКонтрагентыСрезПоследних
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	РеализацияТоваровТовары.Ссылка КАК Ссылка,
	СУММА(РеализацияТоваровТовары.СуммаНДС) КАК СуммаНДС,
	СУММА(РеализацияТоваровТовары.СуммаВсего) КАК Сумма
ИЗ
	Документ.РеализацияТоваров.Товары КАК РеализацияТоваровТовары
ГДЕ
	РеализацияТоваровТовары.Ссылка = &amp;Ссылка

СГРУППИРОВАТЬ ПО
	РеализацияТоваровТовары.Ссылка
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	Продажи.Покупатель КАК Контрагенты,
	Продажи.ДоговорВзаиморасчетов КАК Договоры,
	Продажи.Номенклатура.ГруппаЦенообразования КАК Номенклатура,
	Продажи.Номенклатура.ГруппаЦенообразования КАК Номенклатурные_группы,
	Продажи.СкладКомпании КАК Склады,
	СУММА(Продажи.Сумма) КАК Сумма,
	Продажи.СтавкаНДС КАК СтавкаНДС,
	СУММА(Продажи.СуммаНДС) КАК СуммаНДС,
	СУММА(Продажи.Себестоимость) КАК Себестоимость,
	Продажи.Номенклатура.ВидНоменклатуры = ЗНАЧЕНИЕ(Перечисление.ВидыНоменклатуры.Тара) КАК Тара,
	ВЫРАЗИТЬ(ВЫБОР
			КОГДА Продажи.СтатусПартии = ЗНАЧЕНИЕ(Перечисление.СтатусыПартий.ТоварПринятыйКомиссия)
				ТОГДА "ПоКомиссионнойНоменклатуре"
			ИНАЧЕ "ПоСобственнойНоменклатуре"
		КОНЕЦ КАК СТРОКА(50)) КАК ПризнакПроводки,
	ЛОЖЬ КАК ЭтоВнутренний,
	ЕСТЬNULL(втСхемаНалогообложения.ПоставщикНаЕдиномНалоге, ЛОЖЬ) КАК ПоставщикНаЕдиномНалоге,
	ЛОЖЬ КАК ПФ,
	СУММА(0) КАК СуммаПФ,
	ЗНАЧЕНИЕ(Справочник.Контрагенты.ПустаяСсылка) КАК Поставщик,
	ЗНАЧЕНИЕ(Справочник.ДоговорыКонтрагентов.ПустаяСсылка) КАК ДоговорыКомиссии
ИЗ
	РегистрНакопления.Продажи КАК Продажи
		ЛЕВОЕ СОЕДИНЕНИЕ втСхемаНалогообложения КАК втСхемаНалогообложения
		ПО Продажи.Покупатель = втСхемаНалогообложения.Контрагент
ГДЕ
	Продажи.Регистратор ССЫЛКА Документ.РеализацияТоваров
	И Продажи.Регистратор = &amp;Ссылка

СГРУППИРОВАТЬ ПО
	Продажи.Покупатель,
	Продажи.ДоговорВзаиморасчетов,
	Продажи.Номенклатура.ГруппаЦенообразования,
	Продажи.СкладКомпании,
	Продажи.Номенклатура.ВидНоменклатуры = ЗНАЧЕНИЕ(Перечисление.ВидыНоменклатуры.Тара),
	Продажи.СтавкаНДС,
	ЕСТЬNULL(втСхемаНалогообложения.ПоставщикНаЕдиномНалоге, ЛОЖЬ),
	ВЫРАЗИТЬ(ВЫБОР
			КОГДА Продажи.СтатусПартии = ЗНАЧЕНИЕ(Перечисление.СтатусыПартий.ТоварПринятыйКомиссия)
				ТОГДА "ПоКомиссионнойНоменклатуре"
			ИНАЧЕ "ПоСобственнойНоменклатуре"
		КОНЕЦ КАК СТРОКА(50)),
	Продажи.Номенклатура.ГруппаЦенообразования</Текст>
		</Запрос>
		<Запрос Имя="РН_НН" ИспользуетсяПриЗагрузке="false">
			<Текст>ВЫБРАТЬ
	ТК_НалоговаяНакладнаяТовары.Ссылка КАК Ссылка,
	СУММА(ТК_НалоговаяНакладнаяТовары.СуммаНДС) КАК СуммаНДС,
	СУММА(ТК_НалоговаяНакладнаяТовары.СуммаВсего) КАК Сумма
ИЗ
	Документ.ТК_НалоговаяНакладная.Товары КАК ТК_НалоговаяНакладнаяТовары
ГДЕ
	ТК_НалоговаяНакладнаяТовары.Ссылка = &amp;Ссылка

СГРУППИРОВАТЬ ПО
	ТК_НалоговаяНакладнаяТовары.Ссылка
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ТК_НалоговаяНакладнаяТовары.Ссылка.Контрагент КАК Контрагенты,
	ТК_НалоговаяНакладнаяТовары.Ссылка.ДоговорВзаиморасчетов КАК Договоры,
	ТК_НалоговаяНакладнаяТовары.Номенклатура.ГруппаЦенообразования КАК Номенклатура,
	ТК_НалоговаяНакладнаяТовары.Ссылка.СкладКомпании КАК Склады,
	ВЫРАЗИТЬ(СУММА(ТК_НалоговаяНакладнаяТовары.СуммаВсего) КАК ЧИСЛО(15, 2)) КАК Сумма,
	ВЫРАЗИТЬ(СУММА(ТК_НалоговаяНакладнаяТовары.СуммаНДС) КАК ЧИСЛО(15, 2)) КАК СуммаНДС,
	ТК_НалоговаяНакладнаяТовары.Номенклатура.ГруппаЦенообразования КАК Номенклатурные_группы,
	ВЫРАЗИТЬ(СУММА(ТК_НалоговаяНакладнаяТовары.СуммаВсего / 1.2) КАК ЧИСЛО(15, 2)) КАК Себестоимость,
	ЗНАЧЕНИЕ(Справочник.Контрагенты.ПустаяСсылка) КАК Поставщик,
	ЗНАЧЕНИЕ(Справочник.ДоговорыКонтрагентов.ПустаяСсылка) КАК ДоговорыКомиссии,
	Выразить("ПоСобственнойНоменклатуре" КАК Строка(50)) КАК ПризнакПроводки,
	0 КАК СуммаПФ,
	ТК_НалоговаяНакладнаяТовары.Номенклатура.ВидНоменклатуры = ЗНАЧЕНИЕ(Перечисление.ВидыНоменклатуры.Тара) КАК Тара,
	ЛОЖЬ КАК ПФ,
	ЛОЖЬ КАК ПоставщикНаЕдиномНалоге,
	ЛОЖЬ КАК ЭтоВнутренний
ИЗ
	Документ.ТК_НалоговаяНакладная.Товары КАК ТК_НалоговаяНакладнаяТовары
ГДЕ
	ТК_НалоговаяНакладнаяТовары.Ссылка = &amp;Ссылка

СГРУППИРОВАТЬ ПО
	ТК_НалоговаяНакладнаяТовары.Номенклатура.ВидНоменклатуры = ЗНАЧЕНИЕ(Перечисление.ВидыНоменклатуры.Тара),
	ТК_НалоговаяНакладнаяТовары.Ссылка.Контрагент,
	ТК_НалоговаяНакладнаяТовары.Ссылка.ДоговорВзаиморасчетов,
	ТК_НалоговаяНакладнаяТовары.Номенклатура.ГруппаЦенообразования,
	ТК_НалоговаяНакладнаяТовары.Ссылка.СкладКомпании,
	ТК_НалоговаяНакладнаяТовары.Номенклатура.ГруппаЦенообразования</Текст>
		</Запрос>
	</Запросы>
</ПравилаОбмена>