

&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	Элементы.ТипСотрудника.Заголовок = ТипСотрудника(Объект.Владелец);
КонецПроцедуры

&НаСервере
Процедура УжеЕстьТерритория(Владелец)
	УжеЕстьТерритория = Справочники.ТерриторииИсполнителей.УжеЕстьТерритория(Владелец, Объект.Ссылка);
	Если УжеЕстьТерритория Тогда
		ВызватьИсключение("У сотрудника " + Владелец + " уже есть территория.");
	КонецЕсли;
КонецПроцедуры

&НаКлиенте
Процедура ВладелецПриИзменении(Элемент)
	УжеЕстьТерритория(Объект.Владелец);
	Элементы.ТипСотрудника.Заголовок = ТипСотрудника(Объект.Владелец);
КонецПроцедуры


&НаКлиенте
Процедура ЗаполнитьТерриторию(Команда)
	ЗаполнитьПоСписку("ТорговыеПлощадки");
	Модифицированность = Истина;
КонецПроцедуры

&НаКлиенте
Процедура ЗаполнитьПоСписку(Данные)
	Подсказка = "Введите новый код с новой строки";
	Строка = "";
	ОписаниеОповещения = Новый ОписаниеОповещения("ВводСтроки", ЭтаФорма, Новый Структура("Справочник" ,Данные));
	ПоказатьВводСтроки(ОписаниеОповещения, Строка, Подсказка,,Истина);
КонецПроцедуры

&НаСервере
Процедура ВводСтроки(ПолученноеЗначение, Данные) Экспорт
	
	Если Данные.Справочник = "ТорговыеПлощадки" Тогда
		Для й=1 По СтрЧислоСтрок(ПолученноеЗначение) Цикл
			зн = СокрЛП(СтрПолучитьСтроку(ПолученноеЗначение,й));
			Если ПустаяСтрока(зн) Тогда
				Продолжить;
			КонецЕсли;
			
			Элем = Справочники.ТорговыеПлощадки.НайтиТорговуюПлощадкуПоКоду(зн);
			Если Элем = Неопределено Тогда
				Сообщить("Точка не найдена, код: " +зн);
				Продолжить;
			КонецЕсли;
			
			Если Объект.Точки.НайтиСтроки(Новый Структура("Точка",Элем)).Количество() = 0 Тогда
				СтрокаТЧ = Объект.Точки.Добавить();
				СтрокаТЧ.Точка = Элем;
			КонецЕсли;
			Объект.Точки.Сортировать("Точка");
		КонецЦикла;
		
	КонецЕсли;
	
КонецПроцедуры

&НаСервереБезКонтекста
Функция ТипСотрудника(Сотрудник)
	ТипСотрудника = "";
	Если ТипЗнч(Сотрудник) = Тип("СправочникСсылка.ФизическиеЛица") Тогда
		ТипСотрудника = "Внутркенний";
	ИначеЕсли ТипЗнч(Сотрудник) = Тип("СправочникСсылка.Посетители") Тогда
		ТипСотрудника = "Внешний";
	КонецЕсли;
	Возврат ТипСотрудника;
КонецФункции
