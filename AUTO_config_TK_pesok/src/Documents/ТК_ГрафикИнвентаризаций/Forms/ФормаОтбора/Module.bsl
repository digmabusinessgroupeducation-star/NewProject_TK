




&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)

	
	
	СхемаКомпоновкиДанных = ПолучитьОбщийМакет("СхемаКомпоновкиОтбораНоменклатуры");	
	КомпоновщикНастроек.Инициализировать(Новый ИсточникДоступныхНастроекКомпоновкиДанных(ПоместитьВоВременноеХранилище(СхемаКомпоновкиДанных, ЭтаФорма.УникальныйИдентификатор)));	

	ЗагрузитьНастройкиПоУмолчанию = Истина;
	Если Параметры.Свойство("Настройки") Тогда
		ЗагрузитьНастройкиПоУмолчанию = Ложь; 
	КонецЕсли;
	Если Параметры.Свойство("Наименование") Тогда
		 Наименование = Параметры.Наименование;
	КонецЕсли;
	
	Если Параметры.Свойство("ТипСклада") Тогда
		ТипСклада  = Параметры.ТипСклада;
	КонецЕсли;

	Если Параметры.Свойство("ИдентификаторСтроки") Тогда
		ИдентификаторСтроки  = Параметры.ИдентификаторСтроки;
		РедактированиеСтроки = Истина;
	КонецЕсли;

	
	Если Не ЗагрузитьНастройкиПоУмолчанию Тогда 
		Попытка
			КомпоновщикНастроек.ЗагрузитьНастройки(ОбщегоНазначения.ЗначениеИзСтрокиXML(Параметры.Настройки));
		Исключение
			ЗагрузитьНастройкиПоУмолчанию = Истина;
		КонецПопытки;
	КонецЕсли;
	
	Если ЗагрузитьНастройкиПоУмолчанию Тогда 
		КомпоновщикНастроек.ЗагрузитьНастройки(СхемаКомпоновкиДанных.НастройкиПоУмолчанию);			
	КонецЕсли;
	

КонецПроцедуры





&НаКлиенте
Процедура ОК(Команда)
	
	Если ПустаяСтрока(Наименование) Тогда
		Возврат;
	КонецЕсли;
	Если НЕ ЗначениеЗаполнено(ТипСклада) Тогда
		Возврат;
	КонецЕсли;
	
	
	Адрес =	ПоместитьВХранилище();
	ОповеститьОВыборе(Адрес);

КонецПроцедуры

&НаСервере
Функция ПоместитьВХранилище();
	
	СтруктураВыбора = Новый Структура;
	Если РедактированиеСтроки Тогда
		СтруктураВыбора.Вставить("ИдентификаторСтроки",ИдентификаторСтроки);
	КонецЕсли;
	СтруктураВыбора.Вставить("Наименование",Наименование);
	СтруктураВыбора.Вставить("ТипСклада",ТипСклада);
	СтруктураВыбора.Вставить("Настройки", ОбщегоНазначения.ЗначениеВСтрокуXML(КомпоновщикНастроек.ПолучитьНастройки()));
	Возврат ПоместитьВоВременноеХранилище(СтруктураВыбора);
	
КонецФункции
